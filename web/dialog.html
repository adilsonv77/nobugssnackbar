<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>dialogSignup Box for Sign Up</title>
<link rel="stylesheet" type="text/css" href="css/easyui/easyui.css">
<link rel="stylesheet" type="text/css" href="css/easyui/icon.css">
<script type="text/javascript" src="js/easyui/jquery.min.js"></script>
<script type="text/javascript" src="js/easyui/jquery.easyui.min.js"></script>
<script src="js/commons/common.js"></script>
</head>
<body>
	<form id="dialogSignup" method="post">
		<div align="center" style="padding: 15px 5px 5px 5px; margin: 1px">
			<input class="easyui-validatebox textbox" type="text" id="nickname"
				maxlength="30" size="10"
				style="width: 300px; height: 25px; padding: 5px; border: 1px groove #2E9AFE"
				name="nickname" data-options="required:true,validType:'userAllowed'"
				autofocus></input>
		</div>
		<div align="center" style="padding: 3px; margin: 1px">
			<input class="easyui-validatebox" type="password" maxlength="30"
				data-options="required:true,validType:'passwStrength'" size="10"
				style="width: 300px; height: 25px; padding: 5px; border: 1px groove #2E9AFE"
				placeholder="Password" name="password" id="password" required></input>
		</div>
		<div align="center" style="padding: 3px; margin: 1px">
			<input class="easyui-validatebox" type="password" maxlength="30"
				size="10"
				style="width: 300px; height: 25px; padding: 5px; border: 1px groove #2E9AFE"
				name="confirmpassword" id="confirmpassword" required="required"
				validType="equals['#password']"></input>
		</div>
		<div align="center" style="padding: 5px; margin: 1px">
			<input class="easyui-validatebox" type="text" maxlength="30"
				size="10"
				style="width: 300px; height: 25px; padding: 5px; border: 1px groove #2E9AFE"
				name="email" id="email"
				data-options="required:true,validType:['email','emailAllowed']"></input>
		</div>
		<div align="center" style="padding: 5px; margin: 1px">
			<input class="easyui-validatebox textbox" type="text" maxlength="30"
				size="10"
				style="width: 300px; height: 25px; padding: 5px; border: 1px groove #2E9AFE"
				name="completename" id="completename" required></input>
		</div>
		<div align="center"
			style="text-align: center; padding: 5px; margin: 5px 5px 5px 32px; width: 300px; height: 25px; border: 1px groove #2E9AFE">
			<span class="panel-body panel-body-noheader panel-body-noborder"
				style="font-size: 17px" id="gendertext">Select your gender: </span><label
				id="genderisM" for="genderM"
				style="font-size: 15px; font-weight: bold"><b>Male</b></label><input
				class="easyui-validatebox" type="radio" name="gender" value="male"
				id="genderM" style="font-size: 15px"
				data-options="validType:'requireRadio[\'input[name=gender]\', \'gender\']'">
			<label id="genderisF" for="genderF"
				style="font-size: 15px; font-weight: bold"><b>Female</b></label><input
				class="easyui-validatebox" type="radio" name="gender" value="female"
				id="genderF">
		</div>
		<div align="center" style="text-align: center">
			<b><a href="javascript:void(0)" class="easyui-linkbutton"
				style="margin: 10px" onclick="submitForm()"><font size="3"
					id="signupbtn">Sign Up</font></a></b> <b><a href="javascript:void(0)"
				class="easyui-linkbutton" style="margin: 10px" onclick="clearForm()"><font
					size="3" id="clearformbtn">Clear</font></a></b>
		</div>
	</form>
	<script>
		document.getElementById("nickname").placeholder = BlocklyApps
				.getMsg("Signup_nickName");
		document.getElementById("password").placeholder = BlocklyApps
				.getMsg("Signup_password");
		document.getElementById("confirmpassword").placeholder = BlocklyApps
				.getMsg("Signup_confirmpassword");
		document.getElementById("email").placeholder = BlocklyApps
				.getMsg("Signup_email");
		document.getElementById("completename").placeholder = BlocklyApps
				.getMsg("Signup_completename");
		document.getElementById("gendertext").innerHTML = BlocklyApps
				.getMsg("Signup_gendertext");
		document.getElementById("genderisM").innerHTML = BlocklyApps
				.getMsg("Signup_genderisM");
		document.getElementById("genderisF").innerHTML = BlocklyApps
				.getMsg("Signup_genderisF");
		document.getElementById("signupbtn").innerHTML = BlocklyApps
				.getMsg("Signup_signupbtn");
		document.getElementById("clearformbtn").innerHTML = BlocklyApps
				.getMsg("Signup_clearformbtn");

		$.fn.validatebox.defaults.missingMessage = BlocklyApps
				.getMsg("Signup_missingmsg");
		$.fn.validatebox.defaults.rules.email.message = BlocklyApps
				.getMsg("Signup_validemailgmsg");

		$.extend($.fn.validatebox.defaults.rules, {
			requireRadio : {
				validator : function(value, param) {
					var input = $(param[0]);
					input.off('.requireRadio').on('click.requireRadio',
							function() {
								$(this).focus();
							});
					return $(param[0] + ':checked').val() != undefined;
				},
				message : BlocklyApps.getMsg("Signup_radiobtnmsg")
			}
		});
		$.extend($.fn.validatebox.defaults.rules, {
			equals : {
				validator : function(value, param) {
					return value == $(param[0]).val();
				},
				message : BlocklyApps.getMsg("Signup_notmatchmsg")
			}
		});
		$.extend($.fn.validatebox.defaults.rules, {
			userAllowed : {
				validator : function(value) {
					var ok = false;
					UserControl.isUserAllowed(value, {
						callback : function(ret) {
							ok = ret;
						},
						async : false
					});
					return ok;
				},
				message : BlocklyApps.getMsg("Signup_unotallowedmsg")
			}
		});

		$.extend($.fn.validatebox.defaults.rules, {
			emailAllowed : {
				validator : function(value) {
					var ok = false;
					UserControl.isEmailAllowed(value, {
						callback : function(ret) {
							ok = ret;
						},
						async : false
					});
					return ok;
				},
				message : BlocklyApps.getMsg("Signup_enotallowedmsg")
			}
		});

		$.extend($.fn.validatebox.defaults.rules, {
			passwStrength : {
				validator : function(value) {

					var password = value;

					// Calculate strength
					var strength = 0;

					var points = 20; // points per test

					var pattern1 = /[A-Z]/g; // Contains uppercase letters
					var pattern2 = /[a-z]/g; // Contains lowercase letters
					var pattern3 = /[0-9]/g; // Contains digits
					var pattern4 = /[~`!@#$%^&*_+-]/g; // Contains a special character

					if (password.length >= 7) {
						strength += points;
					}
					if (password.match(pattern1) != null) {
						strength += points;
					}
					if (password.match(pattern2) != null) {
						strength += points;
					}
					if (password.match(pattern3) != null) {
						strength += points;
					}
					if (password.match(pattern4) != null) {
						strength += points;
					}
					if ((password.length >= 7)
							&& (password.match(pattern1) != null)
							&& (password.match(pattern2) != null)
							&& (password.match(pattern3) != null)
							&& (password.match(pattern4) != null)) {
						return true;
					}

					var msgs = [ BlocklyApps.getMsg("Signup_emptypassmsg"),
							BlocklyApps.getMsg("Signup_tousepassmsg"),
							BlocklyApps.getMsg("Signup_weakpassmsg"),
							BlocklyApps.getMsg("Signup_averagepassmsg"),
							BlocklyApps.getMsg("Signup_strongpassmsg"),
							BlocklyApps.getMsg("Signup_verystrpassmsg") ];

					if (password == "") {
						this.myMsg = msgs[0];
					} else {
						var index = (strength - 20) / 20;
						if (index == -1)
							this.myMsg = msgs[1];
						else {
							this.myMsg = msgs[index + 1];

						}
					}

					return false;
				},
				myMsg : "",

				message : function() {
					return this.myMsg;
				}
			}
		});

		$('#dialogSignup')
				.form(
						{
							onSubmit : function() {
								return $(this).form('validate');
							},
							success : function() {

								var nickName = document
										.getElementById('nickname').value;
								var userPassword = document
										.getElementById('password').value;
								var userName = document
										.getElementById('completename').value;
								var userMail = document.getElementById('email').value;
								var sexM = document.getElementById('genderM').checked;
								var sexF = document.getElementById("genderF").checked;
								var lang = BlocklyApps.getLang();
								var sex;

								if (sexM === true) {
									sex = 'M';
								} else {
									sex = 'F';
								}

								UserControl
										.registerUser(
												nickName,
												userPassword,
												userName,
												sex,
												lang,
												userMail,
												function() {
													$.messager
															.alert(
																	BlocklyApps
																			.getMsg("Signup_signedinfo"),
																	BlocklyApps
																			.getMsg("Signup_showinfomsg"));
													$('#dialogSignup').form(
															'clear');
													$('#sign').tooltip('hide');
												});
							}
						});

		function submitForm() {
			$('#dialogSignup').form('submit');
		};

		function clearForm() {
			$('#dialogSignup').form('clear');
		};
	</script>
</body>
</html>