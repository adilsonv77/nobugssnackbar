"use strict";var nav={};nav.onload=function(f){if(c()||d()){return}window.location.href="error.html";function b(){return navigator.appVersion.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1}function c(){return navigator.appVersion.indexOf("Chrome")>-1}function d(){return navigator.userAgent.indexOf("Firefox")>-1}function a(){return navigator.userAgent.indexOf("Safari")>-1}function g(){return navigator.userAgent.indexOf("Opera")>-1}};"use strict";Blockly.Blocks.move_goToBarCounter={init:function(){this.setColour(160);this.appendValueInput("VALUE").setCheck("Number").appendField("goToBarCounter");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToBarCounterTooltip"))}};Blockly.JavaScript.move_goToBarCounter=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"goToBarCounter("+a+");\n"};Blockly.Blocks.do_talk={init:function(){this.setColour(160);this.appendValueInput("VALUE").appendField("talk");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_talkTooltip"))}};Blockly.JavaScript.do_talk=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"talk("+a+");\n"};Blockly.Blocks.do_deliver={init:function(){this.setColour(160);this.appendValueInput("VALUE").appendField("deliver");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_deliverTooltip"))}};Blockly.JavaScript.do_deliver=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"deliver("+a+");\n updateVariables(); \n "};Blockly.Blocks.ask_isThereACustomer={init:function(){this.setColour(160);this.setOutput(true,"Boolean");this.appendDummyInput().appendField("isThereACustomer");this.setTooltip(BlocklyApps.getMsg("SnackMan_isThereACustomerTooltip"))}};Blockly.JavaScript.ask_isThereACustomer=function(a){return["isThereACustomer( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.do_wait={init:function(){this.jsonInit({message0:"wait %1 s",args0:[{type:"input_value",name:"VALUE"}],colour:Blockly.Blocks.variables.HUE});this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("SnackMan_waitTooltip")}};Blockly.JavaScript.do_wait=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"WAIT_NOBUGS["+(parseInt(a)*1000)+"]"};Blockly.Blocks.money_cashIn={init:function(){this.setColour(160);this.setOutput(true);this.appendValueInput("VALUE").appendField("cashIn");this.setTooltip(BlocklyApps.getMsg("SnackMan_cashInTooltip"))}};Blockly.JavaScript.money_cashIn=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["cashIn( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.money_giveChange={init:function(){this.jsonInit({message0:"giveChange %1 "+BlocklyApps.getMsg("_with")+" %2 ",args0:[{type:"input_value",name:"VALUE"},{type:"input_value",name:"COINSBANKNOTES"}],colour:160});this.setInputsInline(true);this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_giveChangeTooltip"))}};Blockly.JavaScript.money_giveChange=function(c){var b=Blockly.JavaScript.valueToCode(c,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";var a=Blockly.JavaScript.valueToCode(c,"COINSBANKNOTES",Blockly.JavaScript.ORDER_NONE)||"null";return"giveChange( "+b+","+a+" );\n"};Blockly.Blocks.const_money1={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_coin")+" 1")}};Blockly.JavaScript.const_money1=function(a){return['"\\"$$$money1\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money2={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_coin")+" 2")}};Blockly.JavaScript.const_money2=function(a){return['"\\"$$$money2\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money5={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_banknote")+" 5")}};Blockly.JavaScript.const_money5=function(a){return['"\\"$$$money5\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money10={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_banknote")+" 10")}};Blockly.JavaScript.const_money10=function(a){return['"\\"$$$money10\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money20={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_banknote")+" 20")}};Blockly.JavaScript.const_money20=function(a){return['"\\"$$$money20\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToDisplay={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToDisplay");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToDisplayTooltip"))}};Blockly.JavaScript.move_goToDisplay=function(a){return"goToDisplay();\n"};Blockly.Blocks.ask_askForFood={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askForFood");this.setTooltip(BlocklyApps.getMsg("SnackMan_askForFoodTooltip"))}};Blockly.JavaScript.ask_askForFood=function(a){return["askForFood()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askHasHunger={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askHasHunger");this.setTooltip(BlocklyApps.getMsg("SnackMan_askHasHungerTooltip"))}};Blockly.JavaScript.ask_askHasHunger=function(a){return["hasHunger( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.prepare_pickUpHotDog={init:function(){this.setColour(160);this.setOutput(true,"Foods");this.appendValueInput("VALUE").setCheck("FoodOrder").appendField("pickUpHotDog");this.setTooltip(BlocklyApps.getMsg("SnackMan_catchFoodTooltip"))}};Blockly.JavaScript.prepare_pickUpHotDog=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpHotDog( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askWantHowManyFoods={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askWantHowManyFoods");this.setTooltip(BlocklyApps.getMsg("SnackMan_askWantHowManyFoodsTooltip"))}};Blockly.JavaScript.ask_askWantHowManyFoods=function(a){return["askWantHowManyFoods()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToCooler={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToCooler");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToCoolerTooltip"))}};Blockly.JavaScript.move_goToCooler=function(a){return"goToCooler();\n"};Blockly.Blocks.move_goToBoxOfFruits={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToBoxOfFruits");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToBoxOfFruitsTooltip"))}};Blockly.JavaScript.move_goToBoxOfFruits=function(a){return"goToBoxOfFruits();\n"};Blockly.Blocks.prepare_pickUpFruits={init:function(){this.setColour(160);this.setOutput(true);this.appendValueInput("VALUE").appendField("pickUpFruits");this.setTooltip(BlocklyApps.getMsg("SnackMan_catchFruitsTooltip"))}};Blockly.JavaScript.prepare_pickUpFruits=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpFruits("+a+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToJuiceMachine={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToJuiceMachine");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToJuiceMachineTooltip"))}};Blockly.JavaScript.move_goToJuiceMachine=function(a){return"goToJuiceMachine();\n"};Blockly.Blocks.prepare_prepareAndPickUpJuice={init:function(){this.setColour(160);this.setOutput(true);this.appendValueInput("VALUE").appendField("prepareAndPickUpJuice");this.setTooltip(BlocklyApps.getMsg("SnackMan_prepareAndCatchJuiceTooltip"))}};Blockly.JavaScript.prepare_prepareAndPickUpJuice=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["prepareAndPickUpJuice("+a+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askForDrink={init:function(){this.setColour(160);this.setOutput(true,"DrinkOrder");this.appendDummyInput().appendField("askForDrink");this.setTooltip(BlocklyApps.getMsg("SnackMan_askForDrinkTooltip"))}};Blockly.JavaScript.ask_askForDrink=function(a){return["askForDrink( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askHasThirsty={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askHasThirsty");this.setTooltip(BlocklyApps.getMsg("SnackMan_askHasThirstyTooltip"))}};Blockly.JavaScript.ask_askHasThirsty=function(a){return["hasThirsty( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.prepare_pickUpDrink={init:function(){this.setColour(160);this.setOutput(true,"Drinks");this.appendValueInput("VALUE").setCheck("DrinkOrder").appendField("pickUpDrink");this.setTooltip(BlocklyApps.getMsg("SnackMan_catchDrinkTooltip"))}};Blockly.JavaScript.prepare_pickUpDrink=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpDrink( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askWantHowManyDrinks={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askWantHowManyDrinks");this.setTooltip(BlocklyApps.getMsg("SnackMan_askWantHowManyDrinksTooltip"))}};Blockly.JavaScript.ask_askWantHowManyDrinks=function(a){return["askWantHowManyDrinks()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_juiceOfOrange={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("juiceOfOrange");this.setTooltip(BlocklyApps.getMsg("SnackMan_constjuiceOfOrangeTooltip"))}};Blockly.JavaScript.const_juiceOfOrange=function(a){return['"\\"$$$juiceoforange\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_softDrink={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("softDrink");this.setTooltip(BlocklyApps.getMsg("SnackMan_constSoftDrinkTooltip"))}};Blockly.JavaScript.const_softDrink=function(a){return['"\\"$$$coke\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToIceCreamMachine={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToIceCreamMachine");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToIceCreamMachineTooltip"))}};Blockly.JavaScript.move_goToIceCreamMachine=function(a){return"goToIceCreamMachine(); \n"};Blockly.Blocks.prepare_pickUpIceCream={init:function(){this.setColour(160);this.setOutput(true,"Foods");this.appendValueInput("VALUE").setCheck("FoodOrder").appendField("preparePickUpIceCream");this.setTooltip(BlocklyApps.getMsg("SnackMan_pickUpIceCreamTooltip"))}};Blockly.JavaScript.prepare_pickUpIceCream=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpIceCream( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_chocolate={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("Chocolate")}};Blockly.JavaScript.const_chocolate=function(a){return['"\\"$$$chocolate\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_strawberry={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_strawberry"))}};Blockly.JavaScript.const_strawberry=function(a){return['"\\"$$$strawberry\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_vanilla={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_vanilla"))}};Blockly.JavaScript.const_vanilla=function(a){return['"\\"$$$vanilla\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askWantHowManyIceCream={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askWantHowManyIceCream");this.setTooltip(BlocklyApps.getMsg("SnackMan_askWantHowManyIceCreamTooltip"))}};Blockly.JavaScript.ask_askWantHowManyIceCream=function(a){return["askWantHowManyIceCream()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askForIceCream={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askForIceCream");this.setTooltip(BlocklyApps.getMsg("SnackMan_askForIceCreamTooltip"))}};Blockly.JavaScript.ask_askForIceCream=function(a){return["askForIceCream( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.variables_set.init=function(){this.setHelpUrl(Blockly.Msg.VARIABLES_SET_HELPURL);this.jsonInit({message0:BlocklyApps.getMsg("Blockly_variableSet"),args0:[{type:"input_value",name:"VALUE"},{type:"field_variable",name:"VAR",variable:Blockly.Msg.VARIABLES_DEFAULT_NAME}],colour:Blockly.Blocks.variables.HUE});this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(Blockly.Msg.VARIABLES_SET_TOOLTIP);this.contextMenuMsg_=Blockly.Msg.VARIABLES_SET_CREATE_GET;this.contextMenuType_="variables_get"};Blockly.Connection.prototype.checkType_=function(c){var d=this.targetBlock();if(d&&!d.isMovable()&&!this.sourceBlock_.isMovable()){return true}var b=c.targetBlock();if(b&&!b.isMovable()&&!c.sourceBlock_.isMovable()){return true}if(!this.check_||!c.check_){return true}for(var a=0;a<this.check_.length;a++){if(c.check_.indexOf(this.check_[a])!=-1){return true}}return false};Blockly.Blocks.switch_case={init:function(){this.setColour(180);this.setPreviousStatement(true);this.setNextStatement(true);this.appendValueInput("CONDITION").appendField("the case is");this.appendValueInput("CASECONDITION0").appendField("in case of");this.appendStatementInput("CASE0").appendField("do");this.setMutator(new Blockly.Mutator(["case_incaseof","case_default"]));this.setTooltip("Does something if the condition is true. If there isn't a matching case the default function will be executed.");this.caseCount_=0;this.defaultCount_=0},mutationToDom:function(){if(!this.caseCount_&&!this.defaultCount_){return null}var a=document.createElement("mutation");if(this.caseCount_){a.setAttribute("case",this.caseCount_)}if(this.defaultCount_){a.setAttribute("default",1)}return a},domToMutation:function(b){this.caseCount_=parseInt(b.getAttribute("case"),10);this.defaultCount_=parseInt(b.getAttribute("default"),10);for(var a=1;a<=this.caseCount_;a++){this.appendValueInput("CASECONDITION"+a).appendField("in case of");this.appendStatementInput("CASE"+a).appendField("do")}if(this.defaultCount_){this.appendStatementInput("ONDEFAULT").appendField("default")}},decompose:function(d){var b=Blockly.Block.obtain(d,"control_case");b.initSvg();var c=b.getInput("STACK").connection;for(var a=1;a<=this.caseCount_;a++){var f=Blockly.Block.obtain(d,"case_incaseof");f.initSvg();c.connect(f.previousConnection);c=f.nextConnection}if(this.defaultCount_){var e=Blockly.Block.obtain(d,"case_default");e.initSvg();c.connect(e.previousConnection)}return b},compose:function(b){if(this.defaultCount_){this.removeInput("ONDEFAULT")}this.defaultCount_=0;for(var a=this.caseCount_;a>0;a--){this.removeInput("CASECONDITION"+a);this.removeInput("CASE"+a)}this.caseCount_=0;var d=b.getInputTargetBlock("STACK");while(d){switch(d.type){case"case_incaseof":this.caseCount_++;var c=this.appendValueInput("CASECONDITION"+this.caseCount_).appendField("in case of");var f=this.appendStatementInput("CASE"+this.caseCount_).appendField("do");if(d.valueConnection_){c.connection.connect(d.valueConnection_)}if(d.statementConnection_){f.connection.connect(d.statementConnection_)}break;case"case_default":this.defaultCount_++;var e=this.appendStatementInput("ONDEFAULT").appendField("default");if(d.statementConnection_){e.connection.connect(d.statementConnection_)}break;default:throw"Unknown block type."}d=d.nextConnection&&d.nextConnection.targetBlock()}},saveConnections:function(b){var d=b.getInputTargetBlock("STACK");var a=1;while(d){switch(d.type){case"case_incaseof":var c=this.getInput("CASECONDITION"+a);var f=this.getInput("CASE"+a);d.valueConnection_=c&&c.connection.targetConnection;d.statementConnection_=f&&f.connection.targetConnection;a++;break;case"case_default":var e=this.getInput("ONDEFAULT");d.satementConnection_=e&&e.connection.targetConnection;break;default:throw"Unknown block type"}d=d.nextConnection&&d.nextConnection.targetBlock()}}};Blockly.Blocks.control_case={init:function(){this.setColour(180);this.appendDummyInput().appendField("the case is");this.appendStatementInput("STACK");this.setTooltip("--Placeholder--");this.contextMenu=false}};Blockly.Blocks.case_incaseof={init:function(){this.setColour(180);this.appendDummyInput().appendField("in case of");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("--Placeholder--");this.contextMenu=false}};Blockly.Blocks.case_default={init:function(){this.setColour(180);this.appendDummyInput().appendField("default");this.setPreviousStatement(true);this.setNextStatement(false);this.setTooltip("This function will run if there aren't any matching cases.");this.contextMenu=false}};Blockly.JavaScript.switch_case=function(e){var b="";var d;var a;var h=Blockly.JavaScript.valueToCode(e,"CONDITION",Blockly.JavaScript.ORDER_NONE)||null;if(h){var f=/^([a-zA-Z_]+(\d|[a-zA-Z_])*)$/g;if(f.test(h)){b="\nswitch ("+h+"){\n";var g=Blockly.JavaScript.valueToCode(e,"CASECONDITION0",Blockly.JavaScript.ORDER_NONE)||null;var i=Blockly.JavaScript.statementToCode(e,"CASE0");b+="\tcase "+g+":\n"+i+"\n\t\tbreak;\n";for(var c=1;c<=e.caseCount_;c++){a=Blockly.JavaScript.valueToCode(e,"CASECONDITION"+c,Blockly.JavaScript.ORDER_NONE)||null;if(a){d=Blockly.JavaScript.statementToCode(e,"CASE"+c);b+="\tcase "+a+":\n"+d+"\n\t\tbreak;\n"}}if(e.defaultCount_){d=Blockly.JavaScript.statementToCode(e,"ONDEFAULT");b+="\tdefault:\n"+d+"\n\t\tbreak;\n"}b+="}\n"}else{alert("switch_case: "+h+" is not a variable name")}}return b};"use strict";var Slider=function(h,f,b,e,i){this.KNOB_Y_=f-12;this.KNOB_MIN_X_=h+8;this.KNOB_MAX_X_=h+b-8;this.TARGET_OVERHANG_=20;this.value_=0.5;this.changeFunc_=i;this.animationTasks_=[];var d=document.createElementNS(Slider.SVG_NS_,"line");d.setAttribute("class","sliderTrack");d.setAttribute("x1",h);d.setAttribute("y1",f);d.setAttribute("x2",h+b);d.setAttribute("y2",f);e.appendChild(d);this.track_=d;var g=document.createElementNS(Slider.SVG_NS_,"rect");g.setAttribute("style","opacity: 0");g.setAttribute("x",h-this.TARGET_OVERHANG_);g.setAttribute("y",f-this.TARGET_OVERHANG_);g.setAttribute("width",b+2*this.TARGET_OVERHANG_);g.setAttribute("height",2*this.TARGET_OVERHANG_);g.setAttribute("rx",this.TARGET_OVERHANG_);g.setAttribute("ry",this.TARGET_OVERHANG_);e.appendChild(g);this.trackTarget_=g;var c=document.createElementNS(Slider.SVG_NS_,"path");c.setAttribute("class","sliderKnob");c.setAttribute("d","m 0,0 l -8,8 v 12 h 16 v -12 z");e.appendChild(c);this.knob_=c;var a=document.createElementNS(Slider.SVG_NS_,"circle");a.setAttribute("style","opacity: 0");a.setAttribute("r",this.TARGET_OVERHANG_);a.setAttribute("cy",f);e.appendChild(a);this.knobTarget_=a;this.setValue(0.5);while(e&&e.nodeName.toLowerCase()!="svg"){e=e.parentNode}this.SVG_=e;Slider.bindEvent_(this.knobTarget_,"mousedown",this,this.knobMouseDown_);Slider.bindEvent_(this.knobTarget_,"touchstart",this,this.knobMouseDown_);Slider.bindEvent_(this.trackTarget_,"mousedown",this,this.rectMouseDown_);Slider.bindEvent_(this.SVG_,"mouseup",null,Slider.knobMouseUp_);Slider.bindEvent_(this.SVG_,"touchend",null,Slider.knobMouseUp_);Slider.bindEvent_(this.SVG_,"mousemove",null,Slider.knobMouseMove_);Slider.bindEvent_(this.SVG_,"touchmove",null,Slider.knobMouseMove_);Slider.bindEvent_(document,"mouseover",null,Slider.mouseOver_)};Slider.SVG_NS_="http://www.w3.org/2000/svg";Slider.activeSlider_=null;Slider.startMouseX_=0;Slider.startKnobX_=0;Slider.prototype.knobMouseDown_=function(c){if(c.type=="touchstart"){if(c.changedTouches.length!=1){return}Slider.touchToMouse_(c)}Slider.activeSlider_=this;Slider.startMouseX_=this.mouseToSvg_(c).x;Slider.startKnobX_=0;var a=this.knob_.getAttribute("transform");if(a){var b=a.match(/translate\(\s*([-\d.]+)/);if(b){Slider.startKnobX_=Number(b[1])}}c.preventDefault()};Slider.knobMouseUp_=function(a){Slider.activeSlider_=null};Slider.mouseOver_=function(b){if(!Slider.activeSlider_){return}var a=b.target;do{if(a==Slider.activeSlider_.SVG_){return}}while(a=a.parentNode);Slider.knobMouseUp_(b)};Slider.knobMouseMove_=function(c){var b=Slider.activeSlider_;if(!b){return}if(c.type=="touchmove"){if(c.changedTouches.length!=1){return}Slider.touchToMouse_(c)}var a=b.mouseToSvg_(c).x-Slider.startMouseX_+Slider.startKnobX_;b.setValue((a-b.KNOB_MIN_X_)/(b.KNOB_MAX_X_-b.KNOB_MIN_X_))};Slider.prototype.rectMouseDown_=function(b){if(b.type=="touchstart"){if(b.changedTouches.length!=1){return}Slider.touchToMouse_(b)}var a=this.mouseToSvg_(b).x;this.animateValue((a-this.KNOB_MIN_X_)/(this.KNOB_MAX_X_-this.KNOB_MIN_X_))};Slider.prototype.getValue=function(){return this.value_};Slider.prototype.animateValue=function(f){while(this.animationTasks_.length){clearTimeout(this.animationTasks_.pop())}var g=200;var b=10;var c=this.getValue();var e=this;var a=function(h){return function(){var i=h*(f-c)/(b-1)+c;e.setValue(i)}};for(var d=0;d<b;d++){this.animationTasks_.push(setTimeout(a(d),d*g/b))}};Slider.prototype.setValue=function(b){this.value_=Math.min(Math.max(b,0),1);var a=this.KNOB_MIN_X_+(this.KNOB_MAX_X_-this.KNOB_MIN_X_)*this.value_;this.knob_.setAttribute("transform","translate("+a+","+this.KNOB_Y_+")");this.knobTarget_.setAttribute("cx",a);this.changeFunc_&&this.changeFunc_(this.value_)};Slider.prototype.mouseToSvg_=function(c){var b=this.SVG_.createSVGPoint();b.x=c.clientX;b.y=c.clientY;var a=this.SVG_.getScreenCTM().inverse();return b.matrixTransform(a)};Slider.bindEvent_=function(e,c,b,d){var a=function(f){d.apply(b,arguments)};e.addEventListener(c,a,false)};Slider.touchToMouse_=function(b){var a=b.changedTouches[0];b.clientX=a.clientX;b.clientY=a.clientY};"use strict";String.prototype.format=function(){var b=this;for(var a=0;a<arguments.length;a++){b=b.replace("%"+a,arguments[a])}return b};var window_prompt=window.prompt;window.prompt=function(d,b){Blockly.fireUiEventNow(window,"showWindowPrompt");var h;do{try{h=window_prompt(d,b);if(h!=null){h=h.trim()}if(h===b){return b}var g=h==null||VariableNames.validate(h);if(g==false){alert(BlocklyApps.getMsg("Error_variableName"))}}catch(c){var f=document.getElementById("dialogError");var a=document.getElementById("dialogErrorText");a.textContent=BlocklyApps.getMsg("Error_showPrompt");var e={width:"400px"};e[Blockly.RTL?"right":"left"]="215px";MyBlocklyApps.showDialog(f,null,false,true,true,"",e,null);return null}}while(!g);return h};var inherits=function(c,a){var b=Object.create(c.prototype);a.prototype=b;a.prototype.constructor=a};function innerXML(d){var e="";for(var c=0;c<d.childNodes.length;c++){var b=d.childNodes.item(c);var a=b.xml||(new XMLSerializer()).serializeToString(b);e+=a}return e}function convertImgHex(b,f){var a=[];var e=[];var d=[];for(var c=0;c<b.length;c++){a.push(b[c].getAttribute("id"));e.push(b[c].textContent);d.push(b[c].getAttribute("style"))}UserControl.existsImageKey(a,{async:false,callback:function(h){for(var j=0;j<h.length;j++){if(!h[j]){UserControl.convertHexToImage(a[j],e[j],{async:false,callback:function(){}})}var k=d[j];k=(k!=null?' style="'+k+'"':"");var g=' <img src="hintimg?i='+a[j]+'" '+k+"/>";f(a[j],e[j],g,k)}}})}function changeImgHex(c){if(c==null){return c}var e=c;var b=new DOMParser();var f=[];do{var h=c.indexOf("<imghex id=");if(h==-1){break}var d=c.indexOf("</imghex>")+9;var a=c.substring(h,d);var g=b.parseFromString(a,"text/xml");f.push(g.firstChild);c=c.substring(d+1)}while(true);c=e;convertImgHex(f,function(l,j,i,k){c=c.replace('<imghex id="'+l+'"'+k+">"+j+"</imghex>",i)});return c}function addZeros(a,b){a=a+"";while(a.length<b){a="0"+a}return a}function generateImages(a,b){a=addZeros(a,b);var c=new Array(b);$.each(c,function(d){c[d]=a[d]+".png"});return c}function componentToHex(b){var a=b.toString(16);return a.length==1?"0"+a:a}function rgbToHex(){var d,c,a;if(arguments.length==1){d=arguments[0].r;c=arguments[0].g;a=arguments[0].b}else{d=arguments[0];c=arguments[1];a=arguments[2]}return"#"+componentToHex(d)+componentToHex(c)+componentToHex(a)}function hexToRgb(b){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};"use strict";var PreloadImgs={};PreloadImgs.imgs={};PreloadImgs.keys=[];PreloadImgs.loaded=false;PreloadImgs.totalImgs=0;PreloadImgs.put=function(a,c,b){if(PreloadImgs.keys.indexOf(a)>-1){return}PreloadImgs.keys.push(a);PreloadImgs.imgs[a]={src:c,img:null};if(b!=undefined&&b){PreloadImgs.imgs[a].img=new Image();PreloadImgs.imgs[a].img.src=PreloadImgs.imgs[a].src}else{if(c!==""){PreloadImgs.totalImgs++}}};PreloadImgs.get=function(a){return PreloadImgs.imgs[a].img};PreloadImgs.loadImgs=function(d){var c=document.getElementById("preloadimgsxx");var e=0;for(var b=0;b<PreloadImgs.keys.length;b++){var a=PreloadImgs.imgs[PreloadImgs.keys[b]];if(a.img==null){c.style.background="url("+a.src+")";a.img=new Image();a.img.onload=function(){e++;if(e==PreloadImgs.totalImgs){PreloadImgs.loaded=true;d()}};a.img.src=a.src}}};"use strict";var LogClick={};LogClick.clicks=[];LogClick.store=function(a){var b=Date.now();LogClick.clicks.push([a,b]);if(LogClick.clicks.length>10){LogClick.save(true)}};LogClick.save=function(a){var b={callback:function(){},async:a};UserControl.saveClicks(LogClick.clicks,b);LogClick.clicks=[]};"use strict";var Game={};Game.runningStatus=0;Game.howManyRuns=0;var hero;Game.mission=null;Game.hideHints=true;Game.pidList=[];Game.globalMoney;Game.globalXP;Game.lastErrorData;Game.jsInterpreter;Game.variableBox=null;Game.DOWN=1;Game.RIGHT=2;Game.varWindow=Game.RIGHT;Game.counterInstruction=null;PreloadImgs.put("fundo","images/fundo_new.png");PreloadImgs.put("doors","images/door_new.png");Game.generalInit=function(){BlocklyApps.init();NoBugsJavaScript.redefine();Game.rtl=BlocklyApps.isRtl();Game.optResize={blocklyDivW:600,blocklyDivH:"90%",varBoxT:true,varBoxH:"90%"};Blockly.Generator.prototype.STATEMENT_PREFIX="highlightBlock(%1);\n";Blockly.JavaScript.INFINITE_LOOP_TRAP="highlightBlock(%1);\n";Blockly.JavaScript.addReservedWords("Game, code, NoBugsJavaScript");BlocklyApps.bindClick("selectMissionLogoffButton",Game.logoffButtonClick);Game.tracks=[];Game.tracks[0]=new PlayAudio(["music/bensound-buddy.mp3"]);Game.tracks[1]=new PlayAudio(["music/bensound-energy.mp3"]);Game.tracks[2]=new PlayAudio(["music/di-evantile_savage-law.mp3"]);Game.tracks[3]=new PlayAudio(["music/Carefree.mp3","music/Wallpaper.mp3","music/bensound-cute.mp3"]);Game.tracks[3].shuffle();PreloadImgs.loadImgs(function(){Game.ctxDisplay=document.getElementById("display").getContext("2d");Game.tempDisplay=document.getElementById("displayTemp");Game.tempCtxDisplay=Game.tempDisplay.getContext("2d");Game.imgBackground=PreloadImgs.get("fundo");Game.ctxDisplay.drawImage(Game.imgBackground,0,0);Blockly.BlockSvg.Game=Game;AvatarImgMaker.init();Game.init()})};Game.init=function(){Game.currTime=0;window.removeEventListener("resize",Game.resizeMainWindow);window.removeEventListener("keydown",Game.keyDown);window.removeEventListener("keyup",Game.keyUp);window.addEventListener("resize",Game.resizeMainWindow);window.addEventListener("keydown",Game.keyDown);window.addEventListener("keyup",Game.keyUp);Game.CTRLPRESSED=false;Game.blocksSelected=[];UserControl.verifyLogged(function(a){if(a[0]){Game.renderQuestionnaire(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9])}else{window.removeEventListener("beforeunload",Game.unload);document.getElementById("mainBody").style.display="none";document.getElementById("selectMission").style.display="none";document.getElementById("initialBackground").style.display="inline";Game.resizeMainWindow()}})};window.addEventListener("load",Game.generalInit);Game.resizeMainWindow=function(){var a=document.getElementById("loginuser");document.getElementById("errorLogin").style.left=a.offsetLeft+"px";document.getElementById("suporte").style.left=(document.getElementById("suporte").clientWidth-document.getElementById("suportespan").offsetWidth-10)+"px"};Game.keyDown=function(a){Game.CTRLPRESSED=a.ctrlKey};Game.keyUp=function(a){Game.CTRLPRESSED=false};Game.login=function(){document.getElementById("ButtonLogin").disabled="disabled";var a=document.getElementById("loginuser").value;var b=document.getElementById("loginpassw").value;UserControl.login(a,b,function(d){document.getElementById("ButtonLogin").disabled="";var c=document.getElementById("errorLogin");if(d[0]==null){document.getElementById("loginuser").value="";document.getElementById("loginpassw").value="";c.innerHTML="";Game.renderQuestionnaire(d[1],d[2],d[3],d[4],d[5],d[6])}else{c.innerHTML=BlocklyApps.getMsg(d[0])}})};Game.renderQuestionnaire=function(i,d,c,g,a,j,b,h,e){Game.loginData={userLogged:i,doingLogoff:false,missionHist:d,leaderBoard:c,avatar:g,clazzId:b,levelId:h,missionIdx:e,xpToHat:parseInt(a),xpToClothes:parseInt(j)};try{UserControl.retrieveQuestionnaire(function(k){if(k!=null){if(!Game.showQuestionnaire(k)){Game.continueLoginProcess()}}else{Game.continueLoginProcess()}})}catch(f){Game.init()}};Game.showQuestionnaire=function(b){var a=Questionnaire.createForm(b);if(a!=null){$("#contentQuestionnaire").html("");$("#contentQuestionnaire").append(a);MyBlocklyApps.showDialog(document.getElementById("dialogQuestionnaire"),null,false,true,true,$("#questionnaire").get(0).firstChild.data,null,null)}return a!=null};Game.finishQuestionnaire=function(){var a=Questionnaire.consistQuestionnaire();if(a){Questionnaire.handlingQuestionnaire(function(b){UserControl.saveQuestionnaire(b)});BlocklyApps.hideDialog(false);Game.continueLoginProcess()}};Game.continueLoginProcess=function(){try{UserControl.loadTests(function(b){if(b!=null){if(!Game.showTests(b[0],b[1])){Game.continueLoginProcessEx()}}else{Game.continueLoginProcessEx()}})}catch(a){Game.init()}};Game.showTests=function(c,b){var a=Tests.createForm(c);Game.afterTestDialog={};Game.afterTestDialog.nextTest=b;Game.afterTestDialog.f=null;if(a!=null){$("#contentTest").html("");$("#contentTest").append(a);Game.afterTestDialog.f=function(){if(!Game.loginData.doingLogoff){if(Game.afterTestDialog.nextTest!=null){if(!Game.showTests(Game.afterTestDialog.nextTest,null)){Game.continueLoginProcessEx()}}else{Game.continueLoginProcessEx()}}};MyBlocklyApps.showDialog(document.getElementById("dialogTest"),null,false,true,true,"Ganhe b&ocirc;nus",{width:"100%",height:"100%"},Game.afterTestDialog.f)}return a!=null};Game.continueLoginProcessEx=function(){if(Game.loginData.userLogged.lastTime==null){IntroGame.start()}else{Game.logged()}};Game.logged=function(){AvatarEditor.init();UserControl.retrieveReward(Game.updatesReward);$("#playerName").html(Game.loginData.userLogged.name);$("#playerNameInMission").html(Game.loginData.userLogged.name);$("#avatarEditor_playerName").html(Game.loginData.userLogged.name);Game.drawMiniAvatar();UserControl.updateUserLastTime();if(Game.variableBox!=null){Game.variableBox.style.display="none"}if(Game.loginData.clazzId==undefined||Game.loginData.clazzId==0){window.removeEventListener("beforeunload",Game.unload);document.getElementById("mainBody").style.display="none";document.getElementById("initialBackground").style.display="none";document.getElementById("selectMission").style.display="inline";Game.resizeMainWindow();BlocklyApps.bindClick("avatarEditorButton",Game.openAvatarEditor);BlocklyApps.bindClick("profileEditorButton",Game.openProfileEditor);CityMap.init({onclick:Game.cityClick});Game.createsLeaderboard();CityMap.startAnimation();if(Game.loginData.userLogged.lastTime==null){IntroGame.presentTeacher(function(){IntroGame.focusAvatar()})}}else{Game.missionSelected(Game.loginData.clazzId,Game.loginData.levelId,Game.loginData.missionIdx)}};Game.createsLeaderboard=function(){if(Game.loginData.leaderBoard.length>0&&Game.loginData.leaderBoard[0][0]==null){createNoLeaderBoardInfo()}else{createsLeaderBoard()}};Game.updatesReward=function(a){document.getElementById("yourXP").innerHTML=a[0];document.getElementById("yourCash").innerHTML=a[1];document.getElementById("yourXPInMission").innerHTML=a[0];document.getElementById("yourCashInMission").innerHTML=a[1];Game.globalXP=parseInt(a[0]);Game.globalMoney=parseInt(a[1])};Game.cityClick=function(){if(Game.loginData.userLogged.lastTime==null){IntroGame.closeBeforeCity()}SelectMission.generateBoard()};Game.drawMiniAvatar=function(){AvatarImgMaker.createBody(document.getElementById("avatarPlayer").getContext("2d"),Game.loginData.avatar,72,116)};Game.openAvatarEditor=function(a,j){var e="",b="",l="",g="",k="",h="",f="";Game.loginData.avatar.forEach(function(m){switch(m[0]){case"clothes":e=m[1];b=m[2];l=m[3];break;case"skin":k=m[2];break;case"hat":h=m[1];f=m[2];break;default:g=m[2]}});var d=parseInt(document.getElementById("yourXP").innerHTML);var i=(d<Game.loginData.xpToHat?"blocked:"+Game.loginData.xpToHat+":":"")+h;var c=(d<Game.loginData.xpToClothes?"blocked:"+Game.loginData.xpToClothes+":":"")+e;AvatarEditor.show(c,b,l,k,g,i,f,j)};Game.openProfileEditor=function(){var a=Game.loginData.userLogged;$("#profile_user_nick").html(a.nick);$("#profile_user_name").html(a.name);$("input[name=profile_user_mail]").val(a.mail);$("input[name=profile_user_password]").val("");$("input[name=profile_user_retypepassword]").val("");$("#profile_user_checkbox").attr("checked",false);$("input[name=profile_user_password]").attr("disabled","disabled");$("input[name=profile_user_retypepassword]").attr("disabled","disabled");$("#profile_user_save").removeAttr("disabled");$("#profileErrorRetypePassw").html("");MyBlocklyApps.showDialog(document.getElementById("dialogEditProfile"),null,false,true,true,$("#profileEditorButton").html(),{width:"700px"},null)};Game.enablePasswordFields=function(){if($("#profile_user_checkbox").is(":checked")){$("input[name=profile_user_password]").removeAttr("disabled");$("input[name=profile_user_retypepassword]").removeAttr("disabled");Game.verifyRetypePassword()}else{$("input[name=profile_user_password]").attr("disabled","disabled");$("input[name=profile_user_retypepassword]").attr("disabled","disabled");$("#profile_user_save").removeAttr("disabled");$("#profileErrorRetypePassw").html("")}};Game.verifyRetypePassword=function(){if($("input[name=profile_user_password]").val().trim()!==""&&$("input[name=profile_user_password]").val()===$("input[name=profile_user_retypepassword]").val()){$("#profileErrorRetypePassw").html("");$("#profile_user_save").removeAttr("disabled")}else{$("#profileErrorRetypePassw").html(BlocklyApps.getMsg("Profile_WrongPassword"));$("#profile_user_save").attr("disabled","disabled")}};Game.saveProfile=function(){var a=Game.loginData.userLogged;var b=null;a.mail=$("input[name=profile_user_mail]").val();if($("#profile_user_checkbox").is(":checked")){b=$("input[name=profile_user_password]").val().trim()}UserControl.changeUser(a.mail,b);MyBlocklyApps.hideDialog(false)};Game.moveBlocksToZero=function(){var b=Blockly.mainWorkspace.getTopBlocks();for(var a=0;a<b.length;a++){b[a].moveBy(0,0)}};Game.missionSelected=function(a,d,e){document.getElementById("initialBackground").style.display="none";document.getElementById("selectMission").style.display="none";CityMap.stopAnimation();document.getElementById("mainBody").style.display="inline";if(Game.counterInstruction!=null){mainBody.removeChild(Game.counterInstruction);Game.counterInstruction=null}Game.removeChangeListeners();window.addEventListener("scroll",Game.scrollEvent);window.addEventListener("resize",Game.resizeWindow);window.addEventListener("beforeunload",Game.unload);Game.slider={};Game.slider.svg=document.getElementById("slider");Game.slider.svg.style.visibility="hidden";if(Game.speedSlider==undefined){Game.speedSlider=new Slider(10,20,130,Game.slider.svg)}Game.variableBox=document.getElementById("variableBox");Game.blockly=document.getElementById("blockly");CountXP.init("stopWatch");Game.imgDoor=PreloadImgs.get("doors");Game.lastErrorData=new Object();Game.lastErrorData.iderror=0;Game.lastErrorData.message="";Game.lastErrorData.block=null;var b=BlocklyApps.getMsg("_mission")+" "+d+"/"+e;$("#missionIdentification").html(b.charAt(0).toUpperCase()+b.slice(1));try{UserControl.loadMission(a,d,e,Game.missionLoaded)}catch(c){Game.init()}};Game.unload=function(a){LogClick.save(false);Game.saveMission();return null};Game.saveMission=function(){var b=null;if(Blockly.mainWorkspace!=null){b=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.mainWorkspace))}var a=0;if(Game.currTime!=0){a=Math.floor(((new Date().getTime())-Game.currTime)/1000)}UserControl.saveMission(0,0,a,Game.howManyRuns,false,Game.runningStatus,Blockly.getMainWorkspace().scale,b,{callback:function(){},async:false});Game.currTime=new Date().getTime()};Game.missionLoaded=function(d){Game.showedWindowRunDisabled=false;Game.howManyRuns=parseInt(d[4]);Game.previousCode=d[2];Game.zoomLevel=parseFloat(d[5]);var c=d[1];var h=transformStrToXml(c);var e=BlocklyApps.getMsg("_mission");Game.missionTitle=e.charAt(0).toUpperCase()+e.substring(1)+" "+d[0];if(!Game.loginData.userLogged.showInstruction||h.getElementsByTagName("explanation")[0].getAttribute("hasInstruction")==="false"){$("#instructionButton").css("display","none")}else{$("#instructionButton").css("display","inline")}Game.openMission={};Game.openMission.open=h.childNodes[0].getAttribute("open")!=null&&h.childNodes[0].getAttribute("open")==="true";Game.openMission.time=h.childNodes[0].getAttribute("timeLimit");Game.globalMoney=0;Game.globalXP=0;if(Game.openMission.open){Game.timeSpent=0}else{Game.timeSpent=(d[3]==null?0:parseInt(d[3]))}UserControl.retrieveReward(Game.updatesReward);Game.slider.timesBefore=0;var g=h.childNodes[0].getElementsByTagName("slider");if(g.length>0){Game.slider.timesBefore=parseInt(g[0].getAttribute("timesBefore"))}if(!Game.openMission.open&&Game.howManyRuns>=Game.slider.timesBefore){Game.slider.svg.style.visibility="visible"}var a=h.childNodes[0].getElementsByTagName("commands")[0];var f=nobugspage.toolbox(null,null,{enabled:Explanation.selectCommands(a)});Game.toolbox=f;var b=h.childNodes[0].getElementsByTagName("objectives")[0];Game.verifyButtons(b);hero=new SnackMan(b,h,Game.loginData.avatar);CountXP.config(hero.objective.xpTotalTime/3,Game.timeSpent,hero.objective.xpIndividual,hero.objective.xpFinal,Game.changeStars,true);Game.mission=h;Game.assignIngrid();Game.installMachines(f)};Game.assignIngrid=function(){$("#vars").ingrid({height:250,paging:false,sorting:false,gridClass:"varsgrid",headerClass:"varsgrid-header",colClasses:["varsgrid-col0",""],resizableCols:false,ingridIDPrefix:"_varsgrid",ingridBaseClass:"basevarsgrid"});$("div[class=varsgrid-header]").css("display","none")};Game.blinkPlayerReward=function(){if(Game.blinkPlayerRewardTimes%2===0){$("#playerRewardMission").css("box-shadow","inset 0 0 100px 100px rgba(255, 255, 255, 0.4)")}else{$("#playerRewardMission").css("box-shadow","")}Game.blinkPlayerRewardTimes++;if(Game.blinkPlayerRewardTimes<10){window.setTimeout(Game.blinkPlayerReward,500)}};Game.changeStars=function(b){if(!CountXP.starting){var a=Game.blinkPlayerReward;Game.blinkPlayerRewardTimes=0;window.setTimeout(a,500)}if(Game.loginData.userLogged.flags.MUSIC_DISABLED==="true"){return}if(b>0){Game.tracks[b-1].stop()}Game.tracks[b].play()};Game.afterInstallMachines=function(c){var e=Game.mission;var b=e.childNodes[0].getElementsByTagName("xml")[0];if(Game.previousCode!=null){Game.nextPartOfMissionLoaded(false,c,Game.previousCode,e,Game.timeSpent)}else{var a=b.getAttribute("preload");if(a!=null){UserControl.loadAnswer(a,function(f){f=f.replace(/deletable="false"/g,"");Game.nextPartOfMissionLoaded(true,c,f,e,0)})}else{var d=b.outerHTML||(new XMLSerializer()).serializeToString(b);Game.nextPartOfMissionLoaded(true,c,d,e,0)}}Game.previousCode=null;Game.timeSpent=null};Game.installMachines=function(a){UserControl.loadMachinesFromUser(function(d){for(var e=0;e<d.length;e++){var c="machine"+d[e][0];var g="images/"+c+".png";PreloadImgs.put(c,g,true);hero.installMachine(d[e][0],d[e][1],d[e][2],d[e][3],d[e][4],d[e][5],d[e][6],d[e][7],d[e][8],c,d[e][9],d[e][10])}if(d.length>0){a=Game.loadToolBoxWithMachines(a);var f=Game.mission.childNodes[0].getElementsByTagName("selectMachine");if(f.length>0){var b=f[0].children;if(d.length==b.length){Game.enabledBuy=false;Game.disableButton("buyButton")}if(hero.installedMachines.length==1){Game.speedSlider.setValue(1);Game.speedMultFactor=125}Game.slider.svg.style.visibility="visible"}}Game.afterInstallMachines(a)})};Game.loadToolBoxWithMachines=function(c){var d=BlocklyApps.getMsg("Apps_catYourMachines");var b='<category name="'+d+'">';for(var a=0;a<hero.extendedCommands.length;a++){b=b+'<block type="'+hero.extendedCommands[a].name+'"/>'}b=b+"</category></xml>";return c.replace("</xml>",b)};Game.buyButtonClick=function(){Game.saveMission();var a=Game.mission.childNodes[0].getElementsByTagName("selectMachine")[0];Game.selectMachine(a)};Game.selectMachine=function(a){Game.machines=[];Game.loadMachines(a,0)};Game.continueSelectMachine=function(){var i=[];var g={group:"",groupId:1,levels:[]};i.push(g);var e={name:BlocklyApps.getMsg("Text_Equipments"),id:"x",howManyItems:Game.machines.length,howManyItemsAchieved:-1};g.levels.push(e);var h=function(k){if(Game.selectedMachine!=null){Game.selectedMachine.style.backgroundColor="#7777DD"}Game.selectedMachine=this;this.style.backgroundColor="#FFB347";$("#BuyMachine").removeAttr("disabled")};var f=function(n){n--;var l="machinecom"+Game.machines[n].id;var o="images/"+l+".png";PreloadImgs.put(l,o,true);var m="";UserControl.getMessage(Game.machines[n].name,BlocklyApps.LANG,{callback:function(k){m=k},async:false});return"<img src='"+o+"'/> <br/> "+m+"<br/>"+Game.machines[n].cust+" <img style='vertical-align:middle' src='images/coin2.png'/>"};var d=function(n,l,k){return false};var c=function(n,l,k){return Game.globalMoney>=Game.machines[k-1].cust};var a=new Selector(i,1,180,null,null,null,h,f,d,c);var b=a.build();$("#tt0").tabs({width:"auto",height:"auto"});var j=$("<div/>").append($("#"+b)).append(nobugspage.buyButton(null,null,null));MyBlocklyApps.showDialog(j[0],null,false,true,true,BlocklyApps.getMsg("Text_AddNewEquipment"),null,function(){$("#"+b).remove()});$("#tt0").tabs("resize")};Game.loadMachines=function(c,a){var b=c.children[a].getAttribute("type");UserControl.loadMachine(b,function(d){Game.machines.push({id:b,name:d[0],cust:d[1]});a++;if(a<c.children.length){Game.loadMachines(c,a)}else{Game.selectedMachine=null;UserControl.listMachinesFromUser(function(f){for(var e=Game.machines.length-1;e>=0;e--){if(f.indexOf(Game.machines[e].id)>=0){Game.machines.splice(e,1)}}Game.continueSelectMachine()})}})};Game.buyMachineButtonClick=function(){var a=Game.machines[Game.selectedMachine.getAttribute("iditem")-1].id;UserControl.buyMachine(a,function(){UserControl.loadWholeMachineData([a],function(d){var c="machine"+a;var h="images/"+c+".png";PreloadImgs.put(c,h,true);hero.installMachine(a,d[0][1],d[0][2],d[0][3],d[0][4],d[0][5],d[0][6],d[0][7],d[0][8],c,d[0][9],d[0][10]);var b=Game.loadToolBoxWithMachines(Game.toolbox);if(Game.machines.length==1){Game.enabledBuy=false;Game.disableButton("buyButton")}if(hero.installedMachines.length==1){Game.speedSlider.setValue(1);Game.speedMultFactor=125}else{Game.speedSlider.setValue(0.5);Game.speedMultFactor=0}Game.slider.svg.style.visibility="visible";var g=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);document.getElementById("blockly").innerHTML="";Blockly.inject(document.getElementById("blockly"),{path:"",rtl:Game.rtl,toolbox:b,trashcan:true,comments:false,scrollbars:true,zoom:{enabled:true,controls:true,wheel:true,maxScale:2,minScale:0.1,scaleSpeed:1.1}});document.removeEventListener("keydown",Blockly.onKeyDown_,false);Blockly.bindEvent_(document,"keydown",null,MyBlocklyApps.onKeyDown_);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,g);var e=function(){BlocklyApps.hideDialog(false);Game.display()};window.setTimeout(e,500)})})};Game.nextPartOfMissionLoaded=function(f,b,d,e,c){Game.resizeWindow();Game.speedSlider.setValue(0.5);Game.speedMultFactor=0;document.getElementById("blockly").innerHTML="";Blockly.inject(document.getElementById("blockly"),{media:"media/",rtl:Game.rtl,toolbox:b,trashcan:true,comments:false,scrollbars:true,zoom:{enabled:true,controls:true,wheel:true,maxScale:2,minScale:0.1,scaleSpeed:1.1}});if(Game.zoomLevel>1){while(Blockly.getMainWorkspace().scale<Game.zoomLevel){Blockly.getMainWorkspace().zoomCenter(1)}}else{if(Game.zoomLevel<1){while(Blockly.getMainWorkspace().scale>Game.zoomLevel){Blockly.getMainWorkspace().zoomCenter(-1)}}}document.removeEventListener("keydown",Blockly.onKeyDown_,false);Blockly.bindEvent_(document,"keydown",null,MyBlocklyApps.onKeyDown_);Game.firstTime=f;var a=function(h){var g=Blockly.Xml.textToDom(d);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,g);Game.moveBlocks();Game.tests=h.childNodes[0].getElementsByTagName("tests");if(Game.tests.length==0){Game.tests=0;$("#tests").css("display","none")}else{Game.tests=parseInt(Game.tests[0].textContent);$("#tests").css("display","inline");$("#tests_qtd").html(Game.tests);var i=BlocklyApps.getBBox_(document.getElementById("tests_qtd"));$("#tests_finished").css("top",(i.y+10)+"px").css("left",(i.x+3)+"px")}$("#tests_finished").css("display","none");document.removeEventListener("mousedown",MyBlocklyApps.onMouseDown_,false);Blockly.bindEvent_(Blockly.mainWorkspace.svgGroup_,"mousedown",this,MyBlocklyApps.onMouseDown_);CustomerManager.init(Game.openMission.open,Game.tests,h.childNodes[0].getElementsByTagName("customers")[0],h.childNodes[0].getElementsByTagName("customersSN")[0]);Game.reset();if(Game.openMission.open){Game.bonusTime=Game.openMission.time;Game.bonusTimeReward="0"}else{Game.bonusTime=h.childNodes[0].getElementsByTagName("objectives")[0].getAttribute("bonusTime");Game.bonusTimeReward=h.childNodes[0].getElementsByTagName("objectives")[0].getAttribute("bonusTimeReward")}Game.addCronometro(Game.bonusTime,c);Game.showCountInstructions();Game.changeMusicControlButton(!(Game.loginData.userLogged.flags.MUSIC_DISABLED==="true"));BlocklyApps.bindClick("musicControl",Game.musicControlClick);BlocklyApps.bindClick("runButton",Game.runButtonClick);BlocklyApps.bindClick("resetButton",Game.resetButtonClick);BlocklyApps.bindClick("debugButton",Game.debugButtonClick);BlocklyApps.bindClick("goalButton",Game.goalButtonClick);BlocklyApps.bindClick("instructionButton",Game.instructionButtonClick);BlocklyApps.bindClick("logoffButton",Game.goBackToDashboard);BlocklyApps.bindClick("moveRight",Game.moveRightButtonClick);Game.unlockBlockly();window.setTimeout(BlocklyApps.importPrettify,1);if(Game.firstTime){Explanation.showInfo(e.childNodes[0].getElementsByTagName("explanation")[0],true)}else{Hints.init(Game.mission.getElementsByTagName("hints")[0],!Game.showedWindowRunDisabled);Game.initTime()}};window.setTimeout(function(){a(e)},1)};Game.moveBlocks=function(){var e=Blockly.mainWorkspace.getTopBlocks();var b=0,a=0;for(var c=0;c<e.length;c++){var d=e[c].getRelativeToSurfaceXY();if(b>d.x){b=d.x}if(a>d.y){a=d.y}}b=Math.abs(b);a=Math.abs(a);for(var c=0;c<e.length;c++){e[c].moveBy(b,a)}};Game.verifyButtons=function(a){Game.enabledDebug=a.getAttribute("buttonDebug")!=="false";Game.enabledRun=a.getAttribute("buttonRun")!=="false";Game.qtAttempts=(a.getAttribute("buttonRunQtdAttempts"));if(Game.qtAttempts!=null){Game.qtAttempts=parseInt(Game.qtAttempts);Game.enabledRun=Game.enabledRun&&Game.howManyRuns<=Game.qtAttempts}Game.enabledVarWindow=a.getAttribute("variableWindow")!=="false";Game.enabledBuy=a.getAttribute("buttonBuy")==="true";if(!Game.enabledDebug){Game.disableButton("debugButton")}if(!Game.enabledRun){Game.disableButton("runButton")}if(!Game.enabledBuy){Game.disableButton("buyButton")}Game.resetButtons()};Game.timesUp=function(a,b){if(((a*60+b)+30)==Game.bonusTime){Game.changeCSSAlertCronometro()}else{if(((a*60+b))==Game.bonusTime){Game.changeCSSOverCronometro();Game.finishOpenMission()}}};Game.changeCSSAlertCronometro=function(){var a=$(".digit");a.removeClass("static");a.addClass("alert");a.css("background-color","rgba(230,9,40,1)");Game.cronometro.options.cssDigit="alert"};Game.changeCSSOverCronometro=function(){var a=$(".digit");a.removeClass("alert");a.addClass("over");a.css("background-color","#CFCFC4");Game.cronometro.options.cssDigit="over";Game.cronometro.options.callback=function(){}};Game.beforeFinishMission=function(){Game.victory=true;Game.lastErrorData.iderror=0;Game.lastErrorData.message="";Hints.stopHints();Game.stopCronometro();Game.stopAlertGoalButton();var b=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);var d=Blockly.Xml.domToText(b);var a=new Date().getTime();var c=Math.floor((a-Game.currTime)/1000);return{timeSpent:c,answer:d}};Game.showDialogVictory=function(a){var b=document.getElementById("victoyText");b.innerHTML=a;MyBlocklyApps.showDialog(document.getElementById("dialogVictory"),null,true,true,true,null,{width:"600px"},function(){Game.goBackToDashboard(null,false);Game.init()})};Game.finishOpenMission=function(){};Game.addCronometro=function(a,d){$("#timerCountUp").empty();Game.cronometro=null;if(a!=null){d=parseInt(d);$("#timerCountUp").append("<span></span>");Game.cronometro=CountUp($("#timerCountUp span"),{start:d,stopped:true,callback:Game.timesUp});$("#timerCountUp").css("right",$("#logoffButton").width());$("#timerCountUp").css("right",$("#timerCountUp").width());var c=document.getElementById("logoffButton");var b=c.offsetTop+((c.clientHeight-$(".countdownHolder").height())/2);$("#timerCountUp").css("top",b+"px");if(d>Game.bonusTime){Game.changeCSSOverCronometro()}else{if(d+30>=Game.bonusTime){Game.changeCSSAlertCronometro()}}}};Game.verifyTestsInMission=function(a){if(Game.tests==0){a();return}var c=Game.loginData.userLogged.flags.TALK_RUNTESTS;if(c===undefined||c==="false"){var b=BlocklyApps.getBBox_(document.getElementById("tests_qtd"));$("<img>").attr("id","teachTalk").attr("src","images/teacher.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");new CharacterDialog(b.x+30,b.y-120,false,function(){a();$("#teachTalk").remove()},[{character:"teachTalk",msg:BlocklyApps.getMsg("Intro_RepeatTest1")+" <img src='images/run.png' width='30'/> "+BlocklyApps.getMsg("Intro_RepeatTest2")+" <img src='images/tests.jpg' width='30'/> "+BlocklyApps.getMsg("Intro_RepeatTest3")},{character:"teachTalk",msg:BlocklyApps.getMsg("Intro_RepeatTest4")},{character:"teachTalk",msg:BlocklyApps.getMsg("Intro_RepeatTest5")},{character:"teachTalk",msg:BlocklyApps.getMsg("Intro_RepeatTest6")+"<img src='images/tests_finished.png'/>"+BlocklyApps.getMsg("Intro_RepeatTest7")}]);Game.changeFlag("TALK_RUNTESTS","true")}else{a()}};Game.initTime=function(){CountXP.start();Game.currTime=new Date().getTime();Game.initCronometro();Game.startSaveUserProgress()};Game.initCronometro=function(){if(Game.cronometro!=null){Game.cronometro.restart()}};Game.cleanCronometro=function(){if(Game.cronometro!=null){Game.cronometro.stop();$("#timerCountUp").empty();Game.cronometro=null}};Game.stopCronometro=function(){if(Game.cronometro!=null){Game.cronometro.stop()}};Game.doResizeWindow=function(a){if(Game.variableBox==null){return}if(a!=undefined){Game.variableBox.style.display=a}Game.resizeWindow(null);Blockly.fireUiEvent(window,"resize")};Game.scrollEvent=function(){Hints.hideHintWithTimer();Game.doResizeWindow()};Game.resizeWindow=function(f){var c=document.getElementById("visualization");var d=c.offsetTop;Game.blockly.style.top=Math.max(10,d-window.pageYOffset)+"px";Game.blockly.style.left=Game.rtl?"10px":"380px";var a=window.innerWidth;if(Game.variableBox.style.display==="none"){a-=400}else{document.getElementById("moveRight").style.display="none";Game.blockly.style.height=Game.optResize.blocklyDivH;a-=Game.optResize.blocklyDivW;Game.variableBox.style.top=(Game.optResize.varBoxT?Game.blockly.style.top:(Game.blockly.offsetTop+Game.blockly.offsetHeight+10)+"px");if(Game.optResize.varBoxT){Game.variableBox.style.left=((Game.rtl?10:380)+a+5)+"px";Game.variableBox.style.width="200px"}else{Game.variableBox.style.left=Game.blockly.style.left;Game.variableBox.style.width=Game.blockly.style.width}Game.variableBox.style.height=Game.optResize.varBoxH}Game.blockly.style.width=(a)+"px";var b=document.getElementById("blocklyLock");if(b!==null&&b!=="undefined"&&b!==undefined){b.style.cssText=Game.blockly.style.cssText;b.style.height=Game.blockly.clientHeight+"px";b.style.position="fixed";b.style.backgroundColor="grey";b.style.opacity="0.3"}if(Game.counterInstruction!=null){Game.counterInstruction.style.left=(Game.blockly.offsetLeft+Game.blockly.offsetWidth-Game.counterInstruction.clientWidth-15)+"px"}};Game.moveDownButtonClick=function(){Hints.hideHintWithTimer();Game.varWindow=Game.DOWN;document.getElementById("moveDown").style.display="none";document.getElementById("moveRight").style.display="inline-block";Game.optResize={blocklyDivW:400,blocklyDivH:"70%",varBoxT:false,varBoxH:"20%"};Game.doResizeWindow()};Game.moveRightButtonClick=function(){Hints.hideHintWithTimer();Game.varWindow=Game.RIGHT;Game.optResize={blocklyDivW:600,blocklyDivH:"90%",varBoxT:true,varBoxH:"90%"};Game.doResizeWindow("none")};Game.reset=function(a){Game.victory=false;Game.stopAlertGoalButton();hero.reset();if(a===undefined){CustomerManager.reset()}Game.display();Game.killAll()};Game.killAll=function(){for(var a=0;a<Game.pidList.length;a++){window.clearTimeout(Game.pidList[a])}Game.pidList=[]};Game.display=function(){Game.ctxDisplay.drawImage(Game.imgBackground,0,0);hero.draw(Game.ctxDisplay);CustomerManager.draw(Game.ctxDisplay)};Game.exitCountInstructions;Game.countInstructions=function(g,b){Game.exitCountInstructions=false;var e=0;for(var a=0;a<g.length;a++){var d=g[a];if(d.nextConnection!=null){e++}if(b!=undefined){if(!b(d)){Game.exitCountInstructions=true;return e}}e+=Game.countInstructions(d.childBlocks_,b);if(Game.exitCountInstructions){return e}}return e};Game.goalButtonClick=function(){Hints.stopHints();Blockly.WidgetDiv.hide();Game.stopAlertGoalButton();Explanation.showInfo(Game.mission.childNodes[0].getElementsByTagName("explanation")[0],false,null,false)};Game.instructionButtonClick=function(){Hints.stopHints();Blockly.WidgetDiv.hide();Game.stopAlertGoalButton();Explanation.showInfo(Game.mission.childNodes[0].getElementsByTagName("explanation")[0],false,null,true)};Game.emptyLines=function(){InGrid.emptyLines("#_varsgrid_vars_0 div:nth-child(2) table")};Game.goBackToDashboard=function(a,c){Blockly.hideChaff();Blockly.WidgetDiv.hide();Game.tracks[CountXP.times].stop();var b=Game.closeBlockEditorStuffs();if(c!==false){UserControl.exitMission(b[0],Game.howManyRuns,Game.runningStatus,Blockly.getMainWorkspace().scale,b[1],{callback:function(){},async:false});Game.init()}};Game.closeBlockEditorStuffs=function(){Hints.stopHints();Game.stopAlertGoalButton();BlocklyApps.hideDialog(false);window.removeEventListener("beforeunload",Game.unload);var a=new Date().getTime();Game.cleanCronometro();CountXP.stop();Game.emptyLines();Game.doResizeWindow("none");Game.killAll();Game.runningStatus=0;var c=null;var b=0;if(Game.currTime!=0){c=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.mainWorkspace));b=Math.floor((a-Game.currTime)/1000)}document.getElementById("blockly").innerHTML="";$(".blocklyToolboxDiv").remove();window.removeEventListener("scroll",Game.scrollEvent);window.removeEventListener("resize",Game.resizeWindow);$("#tabs-points").empty();$("#tabs-time").empty();$("#tabs-runs").empty();return[b,c]};Game.logoffButtonClick=function(){LogClick.store("logoffgame");Game.loginData.doingLogoff=true;BlocklyApps.hideDialog(false);CityMap.stopAnimation();LogClick.save(false);UserControl.logoff(function(){Game.loginData=null;Game.init()})};Game.runButtonClick=function(){Game.disableButton("runButton");Game.enableButton("resetButton");Game.disableButton("debugButton");Game.disableButton("buyButton");Game.doResizeWindow("none");Blockly.mainWorkspace.traceOn(true);Game.execute(1)};Game.resetButtonClick=function(){$("#tests_finished").css("display","none");Game.lastErrorData.iderror=0;Game.lastErrorData.message="";Game.lastErrorData.block=null;Hints.stopHints();Game.resetButtons();Game.reset(1);Game.doResizeWindow("none");Game.hideHints=true;Hints.startHints();Game.unlockBlockly();Game.stopAlertGoalButton()};Game.enableButton=function(a){if((a==="debugButton"&&!Game.enabledDebug)||(a==="runButton"&&(!Game.enabledRun||(Game.qtAttempts!=null&&Game.howManyRuns>Game.qtAttempts)))||(a=="buyButton"&&!Game.enabledBuy)){var b=true;if(a==="runButton"&&Game.qtAttempts!=null&&Game.showedWindowRunDisabled==false){b=false;if(Game.qtAttempts<Game.howManyRuns&&!BlocklyApps.isDialogVisible_){b=true;Game.showedWindowRunDisabled=true;var d=$("<div/>").append(BlocklyApps.getMsg("NoBugs_RunButtonDisabled"));Game.disableButton("runButton");Hints.stopHints();MyBlocklyApps.showDialog(d[0],null,true,true,true,"",{width:"500px"},null,function(){Hints.startHints()},true)}}if(b){return}}var c=document.getElementById(a);c.disabled="";c.className="primary"};Game.disableButton=function(a){var b=document.getElementById(a);b.disabled="disabled";b.className="notEnabled"};Game.firstClick=true;Game.debugButtonClick=function(){Game.disableButton("debugButton");if(Game.runningStatus===0){Game.enableButton("resetButton");if(Game.enabledVarWindow){Game.doResizeWindow("inline")}Blockly.mainWorkspace.traceOn(true);Game.firstClick=true}else{Hints.stopHints();Game.firstClick=false;if(!Blockly.mainWorkspace.traceOn_){Blockly.mainWorkspace.traceOn(true)}}Game.execute(2)};Game.musicControlClick=function(){var a=(Game.loginData.userLogged.flags.MUSIC_DISABLED==="true");Game.changeMusicControlButton(a);Game.changeFlag("MUSIC_DISABLED",(a?"false":"true"))};Game.changeFlag=function(a,b){Game.loginData.userLogged.flags[a]=b;UserControl.saveFlag(a,b)};Game.changeMusicControlButton=function(a){if(!a){$("#musicOff").css("display","none");$("#musicOn").css("display","inline");$("#musicControl").attr("title",BlocklyApps.getMsg("NoBugs_enableMusic"));Game.tracks[CountXP.times].stop()}else{$("#musicOn").css("display","none");$("#musicOff").css("display","inline");$("#musicControl").attr("title",BlocklyApps.getMsg("NoBugs_disableMusic"));Game.tracks[CountXP.times].play()}};Game.resetButtons=function(a){Game.disableButton("resetButton");Game.enableButton("debugButton");Game.enableButton("runButton");Game.enableButton("buyButton");if(Blockly.mainWorkspace!=null){Blockly.mainWorkspace.traceOn(false)}Game.runningStatus=0;if(a==undefined||a==true){Game.emptyLines()}};Game.execute=function(b){if(Game.runningStatus===0){$("#tests_finished").css("display","none");Game.highlightPause=false;Blockly.hideChaff();Hints.stopHints();Blockly.WidgetDiv.hide();Game.hideHints=false;BlocklyApps.log=[];BlocklyApps.ticks=10000;Game.emptyLines();Game.reset();Game.runningStatus=b;try{var f=Blockly.JavaScript;Game.howManyRuns++;Game.saveMission();if(Blockly.selected!=null){myIsTargetSvg=true;Blockly.selected.unselect();myIsTargetSvg=false}Game.countInstructions(Blockly.mainWorkspace.getTopBlocks(),Game.semanticAnalysis);var c="var NoBugsJavaScript = {};\n";var a=Game.convertWaits(f.workspaceToCode(Blockly.mainWorkspace));if(Game.openMission.open){c+="NoBugsJavaScript.stop = false; \n while (!NoBugsJavaScript.stop) { \n "+a+"\n } "}else{c+=a}Game.code=c;Game.jsInterpreter=new NoBugsInterpreter(c,Game.initApi);Game.stepSpeed=(1000*Math.pow(1-Game.speedSlider.getValue(),3))+Game.speedMultFactor;Game.lockBlockly()}catch(d){if(d==Infinity){Game.showError(["Error_infinityLoopDetected"]);Game.resetButtons();return}else{if(d.isNoBugs){Blockly.mainWorkspace.highlightBlock(Blockly.selected.id);Game.showError([d.msg]);Game.resetButtons();return}}console.log(d)}}Game.runningStatus=b;Game.pidList.push(window.setTimeout(function(){Game.nextStep()},2))};Game.convertWaits=function(d){var e=1;var b=d.search(/(WAIT_NOBUGS\[[0-9]*\])/g);while(b>-1){var a=d.substring(b+11);a=/(\[[0-9]*\])/g.exec(a)[0];a=a.substring(1,a.length-1);d=d.replace(/(WAIT_NOBUGS\[[0-9]*\])/g,"var f"+e+" = function() { ");d=d+"}; \n NoBugsJavaScript.timeOut=false; mySetTimeout('f"+e+"', "+a+"); while(!NoBugsJavaScript.timeOut);\n";e++;b=d.search(/(WAIT_NOBUGS\[[0-9]*\])/g)}return d};Game.semanticAnalysis=function(a){if(Game.hasEmptyInputs(a)){Blockly.selected=a;throw {isNoBugs:true,msg:"Hints_EmptyInputError"}}return true};Game.hasEmptyInputs=function(c){var a=c.inputList;for(var b=0;b<a.length;b++){if(a[b].connection!=null){if(a[b].sourceBlock_.type!=="controls_if"&&a[b].connection.targetConnection==null){return true}if(a[b].connection.targetConnection!=null){if(Game.hasEmptyInputs(a[b].connection.targetConnection.sourceBlock_)){return true}}}}return false};Game.showCountInstructions=function(){if(hero.hasCommQtd||hero.objective.maxCommands>0){var a=document.createElement("div");a.id="countInstruction";a.style.position="absolute";a.style.top=blockly.offsetTop+"px";a.style.backgroundColor="rgba(153, 152, 152, 0.28)";a.style.opacity="0.3";a.innerHTML=Game.countInstructions(Blockly.mainWorkspace.getTopBlocks())+" blocks";document.getElementById("mainBody").appendChild(a);a.style.left=(Game.blockly.offsetLeft+Game.blockly.offsetWidth-a.clientWidth-15)+"px";Game.counterInstruction=a}else{Game.counterInstruction=null}};Game.updateCounterInstructions=function(a){if(Game.counterInstruction==null){return}Game.counterInstruction.innerHTML=a+" blocks";Game.counterInstruction.style.left=(Game.blockly.offsetLeft+Game.blockly.offsetWidth-Game.clientWidth-15)+"px"};Game.lockBlockly=function(){var a=document.createElement("div");a.id="blocklyLock";a.style.cssText=Game.blockly.style.cssText;a.style.height=Game.blockly.clientHeight+"px";a.style.position="fixed";a.style.backgroundColor="grey";a.style.opacity="0.3";var b=document.getElementById("mainBody");b.appendChild(a)};Game.unlockBlockly=function(){var a=document.getElementById("blocklyLock");if(a!==null&&a!=="undefined"&&a!==undefined){var b=document.getElementById("mainBody");b.removeChild(a)}};Game.verifyMathArithVariable=function(e){var d=Game.jsInterpreter.variables;var a=e.length;e=e.properties;for(var b=0;b<a;b++){var c=e[b].data;for(var b=0;b<d.length;b++){if(d[b].name===c){if(d[b].scope.properties[c].data===undefined){BlocklyApps.log=[];BlocklyApps.log.push(["fail","Error_variableNotInitialized",c]);throw false}return true}}}return true};Game.updateVariables=function(){var a=[];Game.jsInterpreter.variables.forEach(function(c){var d=c.scope.properties[c.name].data;if(d!=undefined){if(d.type!=undefined){d="<div><p style='margin: 0px' class="+d.type+"><img src='images/"+d.descr+".png'/></p>"+(d.sourceType==null?"":"<p style='margin: 0px'>"+BlocklyApps.getMsg("__"+d.sourceType)+" "+CustomerManager.getCustomerPosition(d.source)+"</p>")+"</div>"}else{try{if(d.indexOf('"$$$')==0){d="<img src='images/"+d.substring(2,d.length-1)+".png'/>"}}catch(b){}}a.push({name:c.name,value:d})}});InGrid.createNewTable(a);Game.assignIngrid()};Game.nextStep=function(){if(Game.runningStatus==0){return}while(true){try{if(Game.jsInterpreter.step()){if(BlocklyApps.log.length>0||Game.highlightPause||Game.waitFunction){if(Game.runningStatus!=2||Game.highlightPause===false||Game.waitFunction){if(Game.waitFunction){hero.update("IM",0)}BlocklyApps.log.push(["nextStep"])}else{Game.highlightPause=false;if(Game.firstClick&&Game.runningStatus==2){BlocklyApps.log.push(["nextStep"]);Game.firstClick=false}}Game.pidList.push(window.setTimeout(function(){Game.animate()},10));return}}else{if(Game.waitFunction){hero.update("IM",0);BlocklyApps.log.push(["nextStep"]);Game.pidList.push(window.setTimeout(function(){Game.animate()},10));return}var d=Game.runningStatus==2;Blockly.mainWorkspace.highlightBlock(null);hero.verifyObjectives("deliver",{allCustomers:true});hero.verifyObjectives("varQtd",null);hero.verifyObjectives("commQtd",null);hero.verifyObjectives("notExists",null);hero.verifyObjectives("cashIn",{allCustomers:true});hero.verifyObjectives("giveTheWholeChange",{allCustomers:true});hero.verifyObjectives("giveSomeChange",{allCustomers:true});Game.lastErrorData.block=null;if(hero.allObjectivesAchieved){if(Game.tests>0){$("#tests_finished").css("display","inline").html(CustomerManager.currentTest+1);if(CustomerManager.nextTest()){hero.reset();Game.jsInterpreter=new NoBugsInterpreter(Game.code,Game.initApi);Game.pidList.push(window.setTimeout(function(){Game.nextStep()},2));return}}Game.resetButtons();CountXP.stop();var a=Game.beforeFinishMission();var h=Game.countInstructions(Blockly.mainWorkspace.getTopBlocks());var c=hero.addReward(h,(Game.cronometro==null?0:Game.cronometro.passed),Game.bonusTime,Game.bonusTimeReward);Game.updatesReward([Game.globalXP+c.totalXP,Game.globalMoney+c.totalCoins]);UserControl.saveMission(c.totalXP,c.totalCoins,a.timeSpent,Game.howManyRuns,true,Game.runningStatus,Blockly.getMainWorkspace().scale,a.answer,function(){var q=BlocklyApps.getMsg("NoBugs_goalAchievedVictory");var l="<img style='vertical-align: middle;' src='images/xp.png'/>";var m=q.format(c.totalXP+l)+"<br/>";if(c.baseXP!=c.totalXP||c.bonusCoins!=c.totalCoins){var p;if(c.baseXP!=c.totalXP){p="<table border='2px'  class='tableVictory' >";p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("Victory_XPBaseValue")+" </td><td align='right' style='width: 50px;'> "+c.baseXP+"</td></tr>";p=p+"<tr><td colspan='2'>"+BlocklyApps.getMsg("Victory_Bonus")+"</td></tr>";for(var n=0;n<c.bonusXP.length;n++){var k=BlocklyApps.getMsg(c.bonusXP[n].name);var o=k.format(c.bonusXP[n].extraInfo);p=p+"<tr><td> <img src='images/goal_ok.png'/>&nbsp;"+o+"</td> <td align='right' style='width: 50px;'>"+c.bonusXP[n].value+"</td></tr>"}p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("total")+"</td><td align='right' >"+c.totalXP+"</td></tr>";m=m+p+"</table>"}if(c.bonusCoins!=c.totalCoins){p=BlocklyApps.getMsg("NoBugs_goalAchievedVictoryWithCoins").format(c.totalCoins+"<img style='vertical-align: middle;' src='images/coin2.png'/>")+"<br/>";p=p+"<table border='2px' class='tableVictory' >";p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("Victory_CoinsBaseValue")+" </td><td align='right' style='width: 50px;'> "+c.baseCoins+"</td></tr>";p=p+"<tr><td colspan='2'>"+BlocklyApps.getMsg("Victory_Bonus")+"</td></tr>";for(var n=0;n<c.bonusCoins.length;n++){var k=BlocklyApps.getMsg(c.bonusCoins[n].name);var o=k.format(c.bonusCoins[n].extraInfo);p=p+"<tr><td> <img src='images/goal_ok.png'/>&nbsp;"+o+"</td> <td align='right' style='width: 50px;'>"+c.bonusCoins[n].value+"</td></tr>"}p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("total")+"</td><td align='right' >"+c.totalCoins+"</td></tr>";m=m+p+"</table>"}}Game.showDialogVictory(m)})}else{Game.resetButtons();var g=[];var e=hero.objective.objectives;for(var f=0;f<e.length;f++){g[f]=[Objective.factory(e[f].objective).createExplanationItem(e[f]),e[f].achieved]}UserControl.missionFail(Game.howManyRuns,CustomerManager.currentTest+1,g);if(d){document.getElementById("moveRight").style.display="inline-block"}Game.lastErrorData.iderror="missionFail";Game.lastErrorData.message=document.getElementById("dialogFailText");var b={};b.width="600px";MyBlocklyApps.showDialog(document.getElementById("dialogFail"),null,true,true,true,null,b,function(){Game.hideHints=true;Hints.showErrorHint()})}Game.unlockBlockly();return}}catch(j){console.log(j);if(Game.runningStatus==2){document.getElementById("moveRight").style.display="inline-block"}Game.animate();Game.unlockBlockly();Game.stopAlertGoalButton();Hints.startHints();return}}};Game.logEvent=null;Game.startSaveUserProgress=function(){if(Game.logEvent==null){Game.logEvent=Blockly.mainWorkspace.addChangeListener(function(){if(Blockly.Block.dragMode_!=0){return}var a=new Date().getTime();var c=0;if(Game.currTime!=0){c=Math.floor(((a)-Game.currTime)/1000)}if(c<10){return}var b="<xml></xml>";if(Blockly.mainWorkspace!=null){b=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.mainWorkspace))}UserControl.saveMission(0,0,c,Game.howManyRuns,false,Game.runningStatus,Blockly.getMainWorkspace().scale,b);Game.currTime=a})}};Game.removeChangeListeners=function(){if(Game.scrollEvent!=undefined){window.removeEventListener("scroll",Game.scrollEvent);window.removeEventListener("beforeunload",Game.unload);MyBlocklyApps.unbindClick("musicControl",Game.musicControlClick);MyBlocklyApps.unbindClick("runButton",Game.runButtonClick);MyBlocklyApps.unbindClick("resetButton",Game.resetButtonClick);MyBlocklyApps.unbindClick("debugButton",Game.debugButtonClick);MyBlocklyApps.unbindClick("goalButton",Game.goalButtonClick);MyBlocklyApps.unbindClick("logoffButton",Game.goBackToDashboard)}if(Blockly.mainWorkspace!=null){if(Game.logEvent!=null){Blockly.mainWorkspace.removeChangeListener(Game.logEvent);Game.logEvent=null}if(Hints.evtChangeListener!=null){Blockly.mainWorkspace.removeChangeListener(Hints.evtChangeListener);Hints.evtChangeListener=null}}};Game.initApi=function(a,c){var e=function(){return a.createPrimitive(Game.updateVariables())};a.setProperty(c,"updateVariables",a.createNativeFunction(e));e=function(f){return a.createPrimitive(alert(f))};a.setProperty(c,"alert",a.createNativeFunction(e));e=function(f){f=f?f.toString():"";return a.createPrimitive(Game.highlightBlock(f))};a.setProperty(c,"highlightBlock",a.createNativeFunction(e));e=function(g,f,h){return a.createPrimitive(nobugsComparison(g,f,h))};a.setProperty(c,"nobugsComparison",a.createNativeFunction(e));e=function(g,f,h){return a.createPrimitive(nobugsMathArith(g,f,h))};a.setProperty(c,"nobugsMathArith",a.createNativeFunction(e));e=function(){return a.createPrimitive(NoBugsJavaScript.verifyLogicOperation())};a.setProperty(c,"verifyLogicOperation",a.createNativeFunction(e));e=function(h,g){return a.createPrimitive(Game.setTimeout(h.data,g.data))};a.setProperty(c,"mySetTimeout",a.createNativeFunction(e));e=function(f){return a.createPrimitive(Game.verifyMathArithVariable(f))};a.setProperty(c,"verifyMathArithVariable",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.goToBarCounter(f))};a.setProperty(c,"goToBarCounter",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToDisplay())};a.setProperty(c,"goToDisplay",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToCooler())};a.setProperty(c,"goToCooler",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.isThereACustomer())};a.setProperty(c,"isThereACustomer",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.hasHunger())};a.setProperty(c,"hasHunger",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askForFood())};a.setProperty(c,"askForFood",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askWantHowManyDrinks())};a.setProperty(c,"askWantHowManyDrinks",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askWantHowManyFoods())};a.setProperty(c,"askWantHowManyFoods",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.hasThirsty())};a.setProperty(c,"hasThirsty",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askForDrink())};a.setProperty(c,"askForDrink",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToBoxOfFruits())};a.setProperty(c,"goToBoxOfFruits",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToJuiceMachine())};a.setProperty(c,"goToJuiceMachine",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpFruits(f))};a.setProperty(c,"pickUpFruits",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.prepareAndPickUpJuice(f))};a.setProperty(c,"prepareAndPickUpJuice",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToIceCreamMachine())};a.setProperty(c,"goToIceCreamMachine",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpIceCream(f))};a.setProperty(c,"pickUpIceCream",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askWantHowManyIceCream())};a.setProperty(c,"askWantHowManyIceCream",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askForIceCream())};a.setProperty(c,"askForIceCream",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpHotDog(f))};a.setProperty(c,"pickUpHotDog",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpDrink(f))};a.setProperty(c,"pickUpDrink",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.deliver(f))};a.setProperty(c,"deliver",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.talk(f))};a.setProperty(c,"talk",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.cashIn(f))};a.setProperty(c,"cashIn",a.createNativeFunction(e));e=function(g,f){return a.createPrimitive(hero.giveChange(g,f))};a.setProperty(c,"giveChange",a.createNativeFunction(e));for(var b=0;b<hero.extendedCommands.length;b++){e=function(g){var f=a.stateStack[0].func_.ex;return a.createPrimitive(f.run(f.machine,g))};var d=a.createNativeFunction(e);d.ex=hero.extendedCommands[b];a.setProperty(c,d.ex.nameLang,d)}};Game.waitFunction=false;Game.setTimeout=function(b,a){Game.waitFunction=true;Game.funcName=b;setTimeout(Game.runFunction,a)};Game.runFunction=function(){Game.waitFunction=false;var b={type:"CallExpression",callee:{name:Game.funcName,type:"Identifier"},arguments:[]};Game.jsInterpreter.stateStack.unshift({node:b,components:true});var a=Game.jsInterpreter.getValueFromScope("NoBugsJavaScript");a.properties.timeOut.data=true};Game.highlightPause=false;Game.highlightBlock=function(a){if(!Blockly.mainWorkspace.traceOn_){Blockly.mainWorkspace.traceOn(true)}BlocklyApps.log.push(["IM",0]);CustomerManager.update();Blockly.mainWorkspace.highlightBlock(a);if(Game.runningStatus===2){Game.updateVariables()}Game.highlightPause=true};Game.animate=function(){var a=BlocklyApps.log.shift();if(!a){if(Game.runningStatus==2){Game.enableButton("debugButton");Hints.startHints()}return}var b=a.shift();if(b==="nextStep"){Game.pidList.push(window.setTimeout(Game.nextStep,1));return}if(Game.step(b,a)){Game.stepSpeed=(1000*Math.pow(1-Game.speedSlider.getValue(),3))+Game.speedMultFactor;Game.pidList.push(window.setTimeout(function(){Game.animate()},Game.stepSpeed))}else{Game.resetButtons(false);Blockly.mainWorkspace.highlightBlock(null)}};Game.step=function(b,a){if(b==="fail"){Game.showError(a);return false}hero.animate(b,a);CustomerManager.animation();Game.display();return true};Game.showError=function(c){Hints.stopHintsEx();Game.lastErrorData.iderror=c[0];var e=document.getElementById("dialogError");var a=document.getElementById("dialogErrorText");var f=c[0];if(f.indexOf("$")==0){UserControl.getMessage(f.substring(1),BlocklyApps.LANG,{callback:function(g){f=g},async:false});f=f.replace(/\\nn/g,"<br/>")}else{f=BlocklyApps.getMsg(f)}if(c.length>0){f=f.format(c[1])}a.innerHTML=f;Game.lastErrorData.block=Blockly.selected;Game.lastErrorData.message=a.textContent;UserControl.missionError(Game.howManyRuns,CustomerManager.currentTest+1,c[0],Blockly.selected.id,a.textContent);var d={top:"120px",width:"auto"};d[Blockly.RTL?"right":"left"]="215px";var b=Blockly.mainWorkspace.topBlocks_[Blockly.mainWorkspace.topBlocks_.length-1].getSvgRoot();MyBlocklyApps.showDialog(e,b,true,true,false,"",d,function(){Hints.startHintsEx();Hints.showErrorHint()})};Game.lastErrorHas=function(b){if(Game.lastErrorData.block==null){return}var a=Game.lastErrorData.block.inputList;for(var c=0;c<a.length;c++){if(a[c].connection!=null){if(a[c].connection.targetConnection!=null){if(a[c].connection.targetConnection.sourceBlock_.type===b){return true}}}}return false};Game.alertColor=["#DD4B39","#E07c70","#edcdc9","#E07c70"];Game.handleAlertTimer=0;Game.alertGoalButton=function(){if(Game.handleAlertTimer!=0){return}Game.alertControl=0;Game.handleAlertTimer=window.setInterval(function(){var a=document.getElementById("goalButton");Game.alertControl=(Game.alertControl+1)%4;a.style.backgroundColor=Game.alertColor[Game.alertControl]},300)};Game.stopAlertGoalButton=function(){if(Game.handleAlertTimer==0){return}window.clearInterval(Game.handleAlertTimer);Game.handleAlertTimer=0;var a=document.getElementById("goalButton");a.style.backgroundColor="#DD4B39"};Game.readVariableTest=function(d){var b=Game.mission.childNodes[0].getElementsByTagName("testsvars")[0].getElementsByTagName("test");var c=b[CustomerManager.currentTest].getElementsByTagName("var");for(var a=0;a<c.length;a++){if(c[a].getAttribute("name")===d){return c[a].textContent}}return null};$(document).on("click",function(b){if(b.target.id!=="ButtonLogin"&&(Game.loginData==null||Game.loginData==undefined)){return}var a=b.target;if(a.nodeName==="svg"){return}while(a!=null&&a.id===""){a=a.parentNode}if(a==null){return}if(a.id==="blockly"){if(b.target.nodeName==="image"){LogClick.store(b.target.getAttribute("clip-path").substring(5));return}return}LogClick.store(a.id)});"use strict";var Explanation={};Explanation.selectCommands=function(a){var c={};var d=a.firstElementChild;while(d!=null){var b=d.getAttribute("show");if(b!=null){c[d.getAttribute("name")]=b==="true"}d=d.nextElementSibling}return c};Explanation.showInfo=function(a,h,j,b){a=Explanation.parseUserLogged(a);b=(b===undefined?false:b);Explanation.instruction=b;var e=(b?"instruction":"goal");var d=a.getElementsByTagName("page");Explanation.children=[];for(var f=0;f<d.length;f++){var c=d[f];var g=c.getAttribute("type");if(g===e){Explanation.children.push(c)}}Explanation.firstStatement=0;Explanation.lastStatement=Explanation.children.length-1;Explanation.explanation=a;if(h||b){Explanation.pageNumber=Explanation.firstStatement;Explanation.createDialog(Explanation.firstStatement,j)}else{Explanation.pageNumber=Explanation.lastStatement;Explanation.createDialog(Explanation.lastStatement,j)}Explanation.showHint=h;Explanation.hintNumber=-1};Explanation.nextStatement=function(){BlocklyApps.hideDialog(false);Explanation.pageNumber=Explanation.pageNumber+1;Explanation.createDialog(Explanation.pageNumber)};Explanation.previousStatement=function(){BlocklyApps.hideDialog(false);Explanation.pageNumber=Explanation.pageNumber-1;Explanation.createDialog(Explanation.pageNumber)};Explanation.createDialog=function(h,g){var e=document.getElementById("dialogInfo");var a=document.getElementById("dialogInfoText");var c=Explanation.children;var b=c[h].innerHTML||c[h].textContent;a.innerHTML=changeImgHex(b);var d=document.getElementById("dialogInfoButton");var f=Explanation.firstStatement==Explanation.lastStatement;d.innerHTML=(f?nobugspage.finishButton(null,null,null):(h==Explanation.firstStatement?nobugspage.nextButton(null,null,null):nobugspage.previousButton(null,null,null)+(h==Explanation.lastStatement?nobugspage.finishButton(null,null,null):nobugspage.nextButton(null,null,null))));if(!Explanation.instruction){Explanation.evaluateObjectives(h,a)}MyBlocklyApps.showDialog(e,null,false,true,true,Game.missionTitle,{width:"800px"},g)};Explanation.evaluateObjectives=function(l,c){if(l!=Explanation.lastStatement){return}var j=document.createElement("ul");c.appendChild(j);var f=hero.objective.objectives;for(var h=0;h<f.length;h++){var g=document.createElement("li");var p=f[h].objective;g.className="goal"+(f[h].achieved?"ok":"cancel");g.innerHTML=Objective.factory(p).createExplanationItem(f[h]);if(f[h].notExists==="true"){g.innerHTML="<span style='color:red'>"+BlocklyApps.getMsg("explanation_mustNot")+": </span>"+g.innerHTML}j.appendChild(g)}var q=document.createElement("table");var k=document.createElement("tr");var b=document.createElement("td");b.style.border="1px solid #FF0";b.style.padding="3px";b.style.backgroundColor="#F3F3CA";k.appendChild(b);q.appendChild(k);c.appendChild(q);var d=BlocklyApps.getMsg("rewardExplanation");var o="<img style='vertical-align: middle;' src='images/xp.png'/>";var n="<img style='vertical-align: middle;' src='images/coin2.png'/>";var e=d.format(hero.objective.xpIndividual+o,o,hero.objective.xpFinal+o,hero.objective.xpTotalTime/60)+"<br/>";if(hero.objective.maxCommandsReward>0){d=BlocklyApps.getMsg("commandBonusExplanation");e=e+d.format(hero.objective.maxCommandsReward+o,hero.objective.maxCommands)}else{if(hero.objective.maxCommandsRewardCoins>0){d=BlocklyApps.getMsg("commandBonusExplanation");e=e+d.format(hero.objective.maxCommandsRewardCoins+n,hero.objective.maxCommands)}}if(Game.bonusTime!=null){d=BlocklyApps.getMsg("timeBonusExplanation");var m=Game.bonusTimeReward.split(" ");e=e+d.format(m[m.length-1]+n,Game.bonusTime/60)}b.innerHTML=e};Explanation.finishStatement=function(){BlocklyApps.hideDialog(false);if(!Explanation.showHint){Hints.startHints();return}Game.verifyTestsInMission(function(){Hints.init(Game.mission.getElementsByTagName("hints")[0],true);Game.initTime()})};Explanation.parseUserLogged=function(explanations){if(explanations.getAttribute("done")){return explanations}var children=explanations.getElementsByTagName("page");var userLogged=Game.loginData.userLogged;for(var j=0;j<children.length;j++){var e=children[j].textContent;do{var i=e.indexOf("$${");if(i==-1){break}var e1=e.substring(i+3);var e2=e1.substring(0,e1.indexOf("}"));var e3=eval(e2);e=e.substring(0,i)+e3+e.substring(e.indexOf("}")+1)}while(true);if(children[j].innerHTML){children[j].innerHTML=e}else{children[j].textContent=e}}explanations.setAttribute("done","true");return explanations};"use strict";var Hints={};Hints.Categories=[];Hints.beforeHideChaff=null;Hints.chooseCategoryCalled=false;Hints.bindEvent1=null;Hints.bindEvents=[];Hints.TIMEINTERVAL=3000;Hints.lastTimeSpent=0;Hints.hndlTimer=0;Hints.hintBlockDeleted=null;Hints.evtChangeListener=null;Hints.specialControl=false;Hints.menuOpened=false;Hints.showedIddle=0;Hints.lastInsertedBlock=null;Hints.activeBlock=null;Hints.lastCountBlocks=0;Hints.showedCountInstrutionsHint=false;Hints.dealError=false;var countInstructions,countTopInstructions,menuSelected,showedHint;Hints.init=function(b,c){if(!Game.loginData.userLogged.showHint){return}Hints.hints={sequence:[],whenError:[]};Hints.chooseCategoryCalled=false;Hints.bindEvent1=null;Hints.bindEvents=[];Hints.TIMEINTERVAL=3000;Hints.lastTimeSpent=0;Hints.hndlTimer=0;Hints.hintBlockDeleted=null;Hints.evtChangeListener=null;Hints.specialControl=false;Hints.menuOpened=false;Hints.showedIddle=0;Hints.lastInsertedBlock=null;Hints.activeBlock=null;Hints.lastCountBlocks=Game.countInstructions(Blockly.mainWorkspace.getTopBlocks());Hints.showedCountInstrutionsHint=false;if(Hints.evtChangeListener==null){Hints.evtChangeListener=Blockly.mainWorkspace.addChangeListener(Hints.changeListener)}if(b!=null){var a=b.getElementsByTagName("sequence");if(a!=null&&a.length>0){Hints.hints.sequence=Hints.traverseHints(a[0].firstElementChild,false)}a=b.getElementsByTagName("errors");if(a!=null&&a.length>0){Hints.hints.whenError=Hints.traverseHints(a[0].firstElementChild,true)}}Hints.addDefaultErrorHints();if(c&&Hints.hints.sequence.length>0){Hints.launchTimer(Hints.hints.sequence[0].time)}if(Blockly.mainWorkspace.toolbox_!=undefined){Blockly.bindEvent_(Blockly.mainWorkspace.toolbox_.HtmlDiv,"mousedown",null,Hints.menuEvent)}if(Hints.beforeHideChaff==null){Hints.beforeHideChaff=Blockly.hideChaff;Blockly.hideChaff=Hints.hideChaff}};Hints.menuEvent=function(){Hints.menuOpened=Blockly.mainWorkspace.toolbox_.tree_.selectedItem_!=null};Hints.hideChaff=function(a){Hints.beforeHideChaff(a);Hints.menuOpened=false};Hints.addDefaultErrorHints=function(){var a={};a.content=document.getElementById("Hints_DebugButtonError").innerHTML;a.time=0;a.running=false;a.category="DebugProgram";a.condition="Game.howManyRuns > 2 && "+Hints.Categories[a.category].naturalCondition;Hints.hints.whenError.push(a);a.next=new Object();a=a.next;a.content=document.getElementById("Hints_GoalButtonError").innerHTML;a.time=0;a.condition="true";a.running=false;a.category="GoalButton";Hints.hints.whenError.push(a);a=new Object();a.category="TestBlock";a.content=document.getElementById("Hints_EmptyInputError").innerHTML;a.time=10000;a.running=false;a.condition="Hints.hasEmptyInputs()";Hints.hints.sequence.push(a)};Hints.formatCategory=function(b){var a=b.category;if(a.indexOf("(")>0){b.args=a.substring(a.indexOf("("));b.args=b.args.substring(1,b.args.length-1);b.args=b.args.split(",");b.category=a.substring(0,a.indexOf("("))}};Hints.traverseHints=function(e,b){var a=[];var d=null;var c=null;while(e){c={};c.showed=false;c.type=e.tagName;c.category=e.getAttribute("category");Hints.formatCategory(c);c.content=e.textContent;if(c.content.length==0){c.content=null}c.content=changeImgHex(c.content);c.time=e.getAttribute("time");if(c.time==null){c.time=Hints.TIMEINTERVAL}c.time=parseInt(c.time);c.condition=(e.getAttribute("condition"));if(c.condition==null){c.condition=Hints.Categories[c.category].condition}if(c.condition==undefined){c.condition="true"}if(Hints.Categories[c.category].naturalCondition!=undefined){c.condition=Hints.Categories[c.category].naturalCondition+" && "+c.condition}c.running=e.getAttribute("running");if(c.running==null){c.running=Hints.Categories[c.category].running}if(c.running==null||c.running==undefined){c.running=false}c.modal=e.getAttribute("modal");if(c.modal==null||c.modal==undefined){c.modal=false}else{c.modal=c.modal==="true"}e=e.nextElementSibling;if(c.category==="BlockDeleted"&&Hints.hintBlockDeleted==null){Hints.hintBlockDeleted=c;continue}if(d!=null){d.next=c}d=c;a.push(c)}return a};Hints.showErrorHint=function(){countInstructions=Game.countInstructions(Blockly.mainWorkspace.getTopBlocks());Hints.dealError=true;Hints.hintSelected=null;var hintErrors=Hints.hints.whenError;for(var i=0;i<hintErrors.length;i++){var hint=hintErrors[i];Hints.hintSelected=hint;if(hint.category==="TestBlock"){Hints.foundTestBlock=false;Game.countInstructions(Blockly.mainWorkspace.getTopBlocks(),Hints.visitBlocks);if(Hints.foundTestBlock){return}}else{showedHint=hint.showed;var condition=eval(hint.condition);if(condition){var cat=Hints.Categories[hint.category];hint.showed=true;cat.show(hint.args);Hints.associateHideEvents(null,(cat.specialEvent!=undefined?cat.specialEvent():null));break}}}};Hints.timeIsUp=function(){if(Hints.hndlTimer==0){return}Hints.dealError=false;Hints.hndlTimer=0;var c=Hints.hints.sequence;if(c.length==0){return}if(Blockly.Block.dragMode_>0){Hints.launchTimer(Hints.TIMEINTERVAL);return}var b=Game.hideHints;Game.hideHints=false;var d=Blockly.mainWorkspace.getTopBlocks();countInstructions=Game.countInstructions(d);countTopInstructions=d.length;if(Blockly.mainWorkspace.toolbox_!=undefined){menuSelected=Blockly.mainWorkspace.toolbox_.tree_.selectedItem_}else{menuSelected=null}if(menuSelected!=null){menuSelected=menuSelected.element_}Hints.hintSelected=null;for(var a=0;a<c.length;a++){if(Hints.runHint(c[a])){Game.hideHints=b;return}}Game.hideHints=b;Hints.launchTimer(Hints.TIMEINTERVAL)};Hints.runHint=function(hint){Hints.hintSelected=hint;if(Game.runningStatus>0&&!hint.running){return false}if(hint.category==="TestBlock"){Hints.foundTestBlock=false;Game.countInstructions(Blockly.mainWorkspace.getTopBlocks(),Hints.visitBlocks);if(Hints.foundTestBlock){return true}return false}showedHint=hint.showed;var condition=eval(hint.condition);var cat=Hints.Categories[hint.category];if(condition&&Hints.showOnMenu(cat)){if(Hints.lastTimeSpent<hint.time){Hints.hndlTimer=window.setTimeout(Hints.showHint.bind(window,hint),hint.time-Hints.lastTimeSpent);Hints.lastTimeSpent=hint.time}else{Hints.showHint(hint)}return true}return false};Hints.showHint=function(b){Hints.hintSelected=b;var a=Hints.Categories[b.category];b.showed=true;a.show(b.args);Hints.associateHideEvents(a.bindEvent,(a.specialEvent!=undefined?a.specialEvent():null))};Hints.launchTimer=function(a){if(Hints.hndlTimer==0){Hints.hndlTimer=window.setTimeout(Hints.timeIsUp,a);Hints.lastTimeSpent=a}};Hints.showOnMenu=function(b){if(!Hints.menuOpened){return true}var a=b.hideOnMenu;if(a==undefined){a=true}return !a};Hints.visitBlocks=function(block){Hints.activeBlock=block;var hint=Hints.hintSelected;showedHint=hint.showed;var condition=eval(hint.condition);var cat=Hints.Categories[hint.category];if(condition&&(Hints.dealError||Hints.showOnMenu(cat))){Hints.foundTestBlock=true;hint.showed=true;cat.show(hint.args);Hints.associateHideEvents(cat.bindEvent,(cat.specialEvent!=undefined?cat.specialEvent():null));return false}Hints.activeBlock=null;return true};Hints.associateHideEvents=function(b,a){if(b==undefined||b==null){b=Hints.hideHintWithTimer}Hints.bindEvent1=Blockly.mainWorkspace.addChangeListener(b);if(Blockly.mainWorkspace.toolbox_!=undefined){Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.toolbox_.HtmlDiv,"mousedown",null,b))}Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.svgGroup_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(window,"showWindowPrompt",null,b));if(a!=null){Hints.bindEvents.push(a)}Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.hScroll.svgBackground_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.hScroll.svgKnob_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.vScroll.svgBackground_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.vScroll.svgKnob_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Game.slider.svg,"mousedown",null,b))};Hints.hideHintWithTimer=function(){Hints.stopHints();Hints.launchTimer((Hints.hintSelected==null||Hints.hintSelected.next==null?Hints.TIMEINTERVAL:Hints.hintSelected.next.time))};Hints.hideHints=function(){MyBlocklyApps.hideDialog(false);if(Hints.bindEvent1!=null){Blockly.mainWorkspace.removeChangeListener(Hints.bindEvent1);Hints.bindEvent1=null}while(Hints.bindEvents.length>0){Blockly.unbindEvent_(Hints.bindEvents[0]);Hints.bindEvents.shift()}};Hints.startHints=function(){if(Hints.specialControl){return}Hints.showedErrorHint=false;Hints.launchTimer(Hints.TIMEINTERVAL)};Hints.stopHints=function(){window.clearTimeout(Hints.hndlTimer);Hints.hideHints();Hints.hndlTimer=0};Hints.startHintsEx=function(){Hints.specialControl=false;Hints.startHints()};Hints.stopHintsEx=function(){Hints.stopHints();Hints.specialControl=true};Hints.changeListener=function(){var a=Game.countInstructions(Blockly.mainWorkspace.getTopBlocks());Game.updateCounterInstructions(a);if(a>Hints.lastCountBlocks){Hints.lastInsertedBlock=Blockly.selected}else{if(a<Hints.lastCountBlocks){Hints.lastInsertedBlock=null;if(Hints.hintBlockDeleted!=null){Hints.runHint(Hints.hintBlockDeleted)}}}Hints.activeBlock=Hints.lastInsertedBlock;Hints.lastCountBlocks=a};Hints.countChildren=function(b){var a=[];if(b.type==="controls_if"){a.push(b.childBlocks_[1]);if(b.elseCount_==1){a.push(b.childBlocks_[2])}}else{a.push(b)}return Game.countInstructions(a)};function calcTop(a){return a.offsetTop+a.offsetParent.offsetTop+a.offsetParent.offsetParent.offsetTop}function calcLeft(a){return a.offsetLeft+a.offsetParent.offsetLeft+a.offsetParent.offsetParent.offsetLeft}function createLeftDlg(h,f){document.getElementById("LeftHintText").innerHTML=f;var d=calcTop(h);var g=calcLeft(h);var b=h.clientWidth;var c={};c.width="300px";c.top=d+"px";c.left=(g+b)+"px";var a=document.getElementById("LeftHint");BlocklyApps.showDialog(a,null,false,false,c,null)}function createStyle(g,f,a){var h=BlocklyApps.getBBox_(g);var c=h.y;var d=h.x;var b={};b.width="500px";b.top=(c+f)+"px";b.left=(d-(a.clientWidth/2))+"px";return b}function createStylePosition(d,b,a){var c=Blockly.mainWorkspace.toolbox_.tree_.children_[d].element_;c=Blockly.mainWorkspace.toolbox_.flyout_.workspace_.getTopBlocks(false)[b];if(c==undefined){return[]}Hints.hintSelected.e=c;return[createStyle(c.getSvgRoot(),c.height,a),c.getSvgRoot()]}function createDownDlg(e,d,a){var b=document.getElementById("DownHint");var f=document.getElementById("DownHintText");f.innerHTML=a;var c={};c.top=(d-130)+"px";c.left=e+"px";c.width="550px";BlocklyApps.showDialog(b,null,false,false,c,null)}function createDownDlgByButton(c,a){var b=document.getElementById(c);var d=BlocklyApps.getBBox_(b);createDownDlg(d.x,d.y,a);return b}function createRightDlg(a,g,f,e){var b=document.getElementById("RightHint");var d=document.getElementById("RightHintText");d.innerHTML=f;var c={};c.width="300px";c.top=g+"px";c.left=(a-325)+"px";MyBlocklyApps.showDialog(b,null,false,e,false,Game.missionTitle,c,null,function(){},e)}function createInfoDlg(e,b,f,d){var c=document.getElementById("dialogHint");var a=document.getElementById("dialogHintText");a.innerHTML=e;MyBlocklyApps.showDialog(c,null,true,d,false,f,b,null,function(){},d)}Hints.countInstructions=function(){return countInstructions};Hints.howManyRuns=function(){return Game.howManyRuns};Hints.countTopInstructions=function(){return countTopInstructions};Hints.typeActiveBlock=function(){return Hints.activeBlock.type};Hints.countShowedIddle=function(){return Hints.showedIddle};Hints.countChildrenActiveBlock=function(){return Hints.countChildren(Hints.activeBlock)};Hints.blockTypeLastError=function(){return Game.lastErrorData.block.type};Hints.containsBlockTypeLastError=function(a){return Game.lastErrorHas(a)};Hints.lastErrorId=function(){return Game.lastErrorData.iderror};Hints.fCountVariable=function(a){if(a.type==="variables_set"){Hints.totalVariable++}return true};Hints.countVariable=function(){Hints.totalVariable=0;Game.countInstructions(Blockly.mainWorkspace.getTopBlocks(),Hints.fCountVariable);return Hints.totalVariable};Hints.isVariable=function(){return(Hints.activeBlock!=null&&Hints.activeBlock.type=="variables_set")};Hints.variableName=function(){return Hints.activeBlock.getVars()[0]};Hints.showedHint=function(){return showedHint};Hints.activeBlockHasElse=function(){return Hints.activeBlock.elseCount_>0};Hints.hasEmptyInputs=function(){if(Hints.activeBlock==Hints.lastInsertedBlock){return false}return Game.hasEmptyInputs(Hints.activeBlock)};Hints.hasEmptyInputsEx=function(){return Game.hasEmptyInputs(Hints.activeBlock)};Hints.fCountVariableName=function(b){if(b.type==="variables_set"){var c=b.getVars()[0];for(var a=0;a<Hints.variablesNames.length;a++){if(Hints.variablesNames[a]===c){return true}}Hints.variablesNames.push(c)}return true};Hints.countVariableName=function(){Hints.variablesNames=[];Game.countInstructions(Blockly.mainWorkspace.getTopBlocks(),Hints.fCountVariableName);return Hints.variablesNames.length};Hints.instructionEnabled=function(){return $("#instructionButton").css("display").indexOf("inline")==0};Hints.isGoalNotAchieved=function(a){var b=hero.objective.objectives;return(!b[a-1].achieved)};Hints.Categories.ChooseCategory={show:function(c){Hints.hintSelected.e=Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(c[0])].element_;var b=Hints.hintSelected.e.firstChild.childNodes[2].textContent;var a=null;if(Hints.hintSelected.content==null){Hints.hintSelected.content=BlocklyApps.getMsg("Hints_ChooseCategory");Hints.hintSelected.content=Hints.hintSelected.content.format(b)}a=Hints.hintSelected.content;createLeftDlg(Hints.hintSelected.e,a)},condition:"countInstructions == 0",naturalCondition:"(Hints.chooseCategoryCalled == false) && (Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(Hints.hintSelected.args[0])].element_ != menuSelected)",specialEvent:function(){return Blockly.bindEvent_(Hints.hintSelected.e,"mousedown",null,Hints.Categories.ChooseCategory.onselect)},onselect:function(){Hints.chooseCategoryCalled=true;Hints.hideHintWithTimer()},hideOnMenu:false};Hints.Categories.SelectCommand={show:function(c){var b=document.getElementById("SelectCommand");var a=createStylePosition(parseInt(c[0]),parseInt(c[1]),b);if(a.length>0){BlocklyApps.showDialog(b,null,false,false,a[0],null);Hints.chooseCategoryCalled=true}else{Hints.Categories.SelectCommand.bindEvent()}},condition:"countInstructions == 0",naturalCondition:"(Hints.chooseCategoryCalled == true || (Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(Hints.hintSelected.args[0])].element_ == menuSelected))",bindEvent:function(){Hints.chooseCategoryCalled=false;Hints.hideHintWithTimer()},hideOnMenu:false};Hints.Categories.StackTogether={show:function(e){var b=document.getElementById("StackTogether");var d=Blockly.mainWorkspace.topBlocks_;for(var a=0;a<d.length;a++){if(d[a].type===e[2]){if(d[a].childBlocks_.length>1){return null}else{Blockly.mainWorkspace.toolbox_.tree_.setSelectedItem(Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(e[0])]);var c=createStylePosition(parseInt(e[0]),parseInt(e[1]),b);BlocklyApps.showDialog(b,null,false,false,c[0],null);return c[1]}}}},condition:"countInstructions == 1",hideOnMenu:false};Hints.Categories.RunProgram={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_RunProgram").innerHTML}return createDownDlgByButton("runButton",Hints.hintSelected.content)},condition:"Game.howManyRuns == 0",naturalCondition:"countInstructions > 0"};Hints.Categories.DebugProgram={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_DebugProgram").innerHTML}return createDownDlgByButton("debugButton",Hints.hintSelected.content)},condition:"Game.howManyRuns == 0",naturalCondition:"Game.enabledDebug == true && countInstructions > 0",running:true};Hints.Categories.GoalButton={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_GoalButton").innerHTML}return createDownDlgByButton("goalButton",Hints.hintSelected.content)},condition:"Game.howManyRuns > 2"};Hints.Categories.SourceCode={show:function(a){var b=BlocklyApps.getBBox_(Blockly.mainWorkspace.topBlocks_[0].getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content)},condition:"true"};Hints.Categories.WhileDebugging={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_WhileDebugging").innerHTML}Hints.Categories.SourceCode.show()},naturalCondition:"Game.runningStatus == 2",running:true};Hints.Categories.VariableWindow={show:function(b){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_VariableWindow").innerHTML}var a=parseInt(Game.variableBox.style.left.replace("px",""));var c=parseInt(Game.variableBox.style.top.replace("px",""));if(Game.varWindow==Game.RIGHT){createRightDlg(a,c,Hints.hintSelected.content)}else{createDownDlg(a,c,Hints.hintSelected.content)}},naturalCondition:"Game.runningStatus == 2 && Game.enabledVarWindow == true && Hints.Categories['VariableWindow'].thereAreVariable()",running:true,thereAreVariable:function(){var c=Game.jsInterpreter.variables;for(var a=0;a<c.length;a++){var b=c[a].scope.properties[c[a].name].data;if(b!=undefined){return true}}return false}};Hints.Categories.LastBlockInserted={show:function(a){var b=BlocklyApps.getBBox_(Hints.lastInsertedBlock.getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content)},naturalCondition:"Hints.lastInsertedBlock != null"};Hints.Categories.TestBlock={show:function(a){Blockly.mainWorkspace.traceOn(true);Blockly.mainWorkspace.highlightBlock(Hints.activeBlock.id);var b=BlocklyApps.getBBox_(Hints.activeBlock.getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content,Hints.hintSelected.modal)}};Hints.Categories.Iddle={show:function(b){var c=BlocklyApps.getBBox_(Blockly.mainWorkspace.topBlocks_[0].getSvgRoot());var a={top:"120px"};a[Blockly.RTL?"right":"left"]=(c.x-500)+"px";a.width="440px";createInfoDlg(Hints.hintSelected.content,a,Game.missionTitle,Hints.hintSelected.modal);Hints.showedIddle++},naturalCondition:"(Blockly.mainWorkspace.topBlocks_.length > 0)"};Hints.Categories.BlockDeleted={show:function(b){var a={top:"120px"};a.width="440px";createInfoDlg(Hints.hintSelected.content,a,Game.missionTitle)}};Hints.showedErrorHint=false;Hints.Categories.LastError={show:function(a){var b=BlocklyApps.getBBox_(Game.lastErrorData.block.getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content);Hints.showedErrorHint=true},naturalCondition:"(!Hints.showedErrorHint && Game.lastErrorData.block != null)"};Hints.Categories.ShowCountInstructions={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_ShowCountInstructions").innerHTML}var b=BlocklyApps.getBBox_(Game.counterInstruction);createRightDlg(b.x,b.y,Hints.hintSelected.content);Hints.showedCountInstrutionsHint=true},naturalCondition:"(Game.firstTime && !Hints.showedCountInstrutionsHint)"};Hints.Categories.Slider={show:function(a){Game.slider.svg.style.visibility="visible";if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("NoBugs_slider").innerHTML}var b=BlocklyApps.getBBox_(document.getElementById("divslider"));createDownDlg(b.x,b.y,Hints.hintSelected.content)},naturalCondition:"Game.howManyRuns >= Game.slider.timesBefore && Game.slider.svg.style.visibility == 'hidden'"};Hints.Categories.SliderEx={show:function(a){Game.slider.svg.style.visibility="visible";if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("NoBugs_slider").innerHTML}var b=BlocklyApps.getBBox_(document.getElementById("divslider"));createDownDlg(b.x,b.y,Hints.hintSelected.content)}};"use strict";var MyBlocklyApps={};MyBlocklyApps.showDialog=function(h,n,c,p,i,l,b,q,k,g){if(BlocklyApps.isDialogVisible_){MyBlocklyApps.hideDialog(false)}BlocklyApps.isDialogVisible_=true;BlocklyApps.dialogOrigin_=n;BlocklyApps.dialogDispose_=q;var j=document.getElementById("dialog");j.style.width="80%";j.style.height="auto";var o=document.getElementById("dialogShadow");var e=document.getElementById("dialogBorder");for(var a in b){j.style[a]=b[a]}if(p){o.style.visibility="visible";o.style.opacity=0.3;var f=null;if(g===undefined||g===true){f=document.createElement("div");f.id="dialogHeader";if(l!=null){f.innerHTML="<b style='position:absolute;left:5px'>"+l+"</b>"}if(k!=undefined||k!=null){f.style.textAlign="right";var m=document.createElement("button");m.id="closeDialog";m.style.padding="0px";m.style.margin="0px";m.style.minWidth="0px";m.style.backgroundColor="transparent";m.innerHTML="<img src='images/closedialog.png' style='width:16px;height:16px'/>";m.onclick=function(){k();MyBlocklyApps.hideDialog("false")};f.appendChild(m)}j.appendChild(f);BlocklyApps.dialogMouseDownWrapper_=Blockly.bindEvent_(f,"mousedown",null,BlocklyApps.dialogMouseDown_)}}j.appendChild(h);h.className=h.className.replace("dialogHiddenContent","");if(i){j.style.top=Math.max(0,((window.innerHeight-j.clientHeight)/2))+"px";j.style.left=Math.max(0,((window.innerWidth-j.clientWidth)/2))+"px"}function d(){if(BlocklyApps.isDialogVisible_){j.style.visibility="visible";j.style.zIndex=1;e.style.visibility="hidden"}}if(c&&n){BlocklyApps.matchBorder_(n,false,0.2);BlocklyApps.matchBorder_(j,true,0.8);window.setTimeout(d,175)}else{d()}};MyBlocklyApps.hideDialog=function(f){if(!BlocklyApps.isDialogVisible_){return}BlocklyApps.dialogUnbindDragEvents_();if(BlocklyApps.dialogMouseDownWrapper_){Blockly.unbindEvent_(BlocklyApps.dialogMouseDownWrapper_);BlocklyApps.dialogMouseDownWrapper_=null}BlocklyApps.isDialogVisible_=false;var a=(f===false)?null:BlocklyApps.dialogOrigin_;var c=document.getElementById("dialog");var h=document.getElementById("dialogShadow");var b=document.getElementById("dialogBorder");if(c.style.setAttribute){c.style.setAttribute("cssText","")}else{c.setAttribute("style","")}h.style.opacity=0;function d(){h.style.visibility="hidden";b.style.visibility="hidden"}if(a){BlocklyApps.matchBorder_(c,false,0.8);BlocklyApps.matchBorder_(a,true,0.2);window.setTimeout(d,175)}else{d()}c.style.visibility="hidden";c.style.zIndex=-1;var g=document.getElementById("dialogHeader");if(g){g.parentNode.removeChild(g)}while(c.firstChild){var e=c.firstChild;e.className+=" dialogHiddenContent";document.body.appendChild(e)}BlocklyApps.dialogDispose_&&BlocklyApps.dialogDispose_();BlocklyApps.dialogDispose_=null};MyBlocklyApps.unbindClick=function(a,b){if(typeof a=="string"){a=document.getElementById(a)}a.removeEventListener("click",b);a.removeEventListener("touchend",b)};MyBlocklyApps.newShowModalDialog=function(b){var a=$("<div />").css({width:"800px",height:"600px",zIndex:"1"}).addClass("dialog");a.css("visibility","visible");a.html(b);var d=Math.max(0,((window.innerHeight-a.height())/2));var c=Math.max(0,((window.innerWidth-a.width())/2));a.offset({top:d,left:c});$("body").append(a)};var afterMyPaste=Blockly.WorkspaceSvg.prototype.paste;var beforeMyKeyDown=Blockly.onKeyDown_;var afterMyMouseMove=Blockly.onMouseMove_;var myIsTargetSvg=false;MyBlocklyApps.onKeyDown_=function(a){if(Blockly.isTargetInput_(a)){return}if(a.keyCode==27){Blockly.hideChaff()}else{if(a.keyCode==8||a.keyCode==46){try{Blockly.hideChaff();if(Game.blocksSelected.length==0){Blockly.selected.dispose(true,true)}else{Game.blocksSelected.forEach(function(b){if(b.isDeletable()){b.dispose(true,true)}});Game.blocksSelected=[]}}finally{a.preventDefault()}}else{if(a.altKey||a.ctrlKey||a.metaKey){if(Blockly.selected){Blockly.hideChaff();if(a.keyCode==67){Blockly.copy_(Blockly.selected)}else{if(a.keyCode==88){Blockly.copy_(Blockly.selected);if(Game.blocksSelected.length==0){Blockly.selected.dispose(true,true)}else{Game.blocksSelected.forEach(function(b){if(b.isDeletable()&&b.isMovable()){b.dispose(true,true)}});Game.blocksSelected=[]}}}}if(a.keyCode==86){if(Blockly.clipboardXml_){Blockly.clipboardSource_.paste(Blockly.clipboardXml_)}}}}}};Blockly.BlockSvg.prototype.checkBlocks=function(e,f,d){var h=Blockly.BlockSvg.Game;var c=e.nextConnection.targetConnection!=null;for(var b=0;b<e.childBlocks_.length;b++){var g=e.childBlocks_[b];if((c&&g!=e.nextConnection.targetConnection.sourceBlock_)||!c){while(g!=null){if(f==1){var a=h.blocksSelected.indexOf(g);if(a!=-1){h.blocksSelected[a].unselect();h.blocksSelected.splice(a,1)}else{if(g.type==="controls_if"){this.checkBlocks(g,1)}}}else{if(g==d){return false}}if(g.nextConnection!=null&&g.nextConnection.targetConnection!=null){g=g.nextConnection.targetConnection.sourceBlock_}else{g=null}}}}return true};Blockly.BlockSvg.prototype.select=function(){var c=Blockly.BlockSvg.Game;try{if(c.hideHints){Hints.hideHintWithTimer()}}catch(g){}myIsTargetSvg=false;if(!c.CTRLPRESSED){c.blocksSelected.forEach(function(i){i.unselect()});c.blocksSelected=[];if(Blockly.selected){Blockly.selected.unselect()}}else{if(Blockly.selected&&Blockly.selected!=this&&c.blocksSelected.length==0){c.blocksSelected.push(Blockly.selected)}else{var h=c.blocksSelected.indexOf(this);if(h!=-1){c.blocksSelected.splice(h,1);this.unselect();return}}if(c.blocksSelected.length>0){var b=this.parentBlock_;var a=this;while(b!=null){if(b.type==="controls_if"){if(c.blocksSelected.indexOf(b)==-1){a=b}else{if(!this.checkBlocks(b,2,a)){return}}}b=b.parentBlock_}if(this.type==="controls_if"){this.checkBlocks(this,1)}var k=false;for(var f=0;f<c.blocksSelected.length;f++){var d=c.blocksSelected[f];var e=null;if(f<c.blocksSelected.length-1){e=c.blocksSelected[f+1]}while(d!=null&&d.nextConnection!=null&&d!=e){var j=d.nextConnection.targetConnection;if(j!=null&&j.sourceBlock_.id===this.id){c.blocksSelected.splice(f+1,0,this);k=true;break}if(j==null){d=null}else{d=j.sourceBlock_}}if(k){break}}if(!k){c.blocksSelected.splice(0,0,this)}}}Blockly.selected=this;this.addSelect();Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};Blockly.BlockSvg.prototype.unselect=function(){var a=Blockly.BlockSvg.Game;if(a.blocksSelected.length>0&&myIsTargetSvg){a.blocksSelected.forEach(function(b){b.removeSelect()});a.blocksSelected=[]}else{this.removeSelect()}if(a.blocksSelected.length>0){Blockly.selected=a.blocksSelected[a.blocksSelected.length-1]}else{Blockly.selected=null}Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};Blockly.copy_=function(b){var d=Blockly.BlockSvg.Game;if(d.blocksSelected.length>0){Blockly.clipboard_=[];var a=null;var c=null;d.blocksSelected.forEach(function(f){var g=Blockly.littleCopy_(f);var e=null;if(a!=null){if(a.nextConnection!=null&&a.nextConnection.targetConnection!=null&&a.nextConnection.targetConnection.sourceBlock_.id===f.id){e=c}}Blockly.clipboard_.push({xml:g,previous:e});c=g;a=f})}else{Blockly.clipboard_=[{xml:Blockly.littleCopy_(b),previous:null}]}};Blockly.littleCopy_=function(c){var a=Blockly.Xml.blockToDom_(c);a.removeAttribute("deletable");Blockly.Xml.deleteNext(a);var b=c.getRelativeToSurfaceXY();a.setAttribute("x",Blockly.RTL?-b.x:b.x);a.setAttribute("y",b.y);Blockly.clipboardXml_=a;Blockly.clipboardSource_=c.workspace;return a};Blockly.WorkspaceSvg.prototype.paste=function(d){var e=Blockly.BlockSvg.Game;var a=this;var c=[];var b=null;if(Blockly.selected!=null){Blockly.selected.unselect()}Blockly.clipboard_.forEach(function(g){var f=afterMyPaste.bind(a,g.xml);f();var h=Blockly.mainWorkspace.getBlockById(g.xml.id);if(g.previous!=null){c[c.length-1].nextConnection.connect(Blockly.selected.previousConnection)}c.push(Blockly.selected);b=h});e.blocksSelected=c;e.blocksSelected.forEach(function(f){f.addSelect()})};function unselectAll(){var a=Blockly.BlockSvg.Game;a.blocksSelected.forEach(function(b){if(b!=Blockly.selected){b.removeSelect()}});a.blocksSelected=[]}Blockly.onMouseMove_=function(a){unselectAll();afterMyMouseMove(a)};MyBlocklyApps.onMouseDown_=function(a){if(Blockly.selected){Blockly.selected.unselect()}unselectAll()};Blockly.onKeyDown_=function(a){if(Blockly.isTargetInput_(a)){return}var b=Blockly.BlockSvg.Game;beforeMyKeyDown(a);if(a.ctrlKey&&a.keyCode==88){b.blocksSelected.forEach(function(c){if(c.isDeletable()&&c.isMovable()){c.dispose(true,true)}})}else{if(a.keyCode==8||a.keyCode==46){try{b.blocksSelected.forEach(function(c){if(c.isDeletable()){c.dispose(true,true)}});b.blocksSelected=[]}finally{a.preventDefault()}}}};"use strict";var Graph=(function(f){var h=function(k){var j=[],i=null;for(i in k){Object.prototype.hasOwnProperty.call(k,i)&&j.push(i)}return j};var g=function(j,i){return parseFloat(j)-parseFloat(i)};var e=function(w,k,i,x){x=x||Infinity;var l={},n={"0":[k]},j={},o;var p=function(C,B){var A=""+C;if(!n[A]){n[A]=[]}n[A].push(B)};l[k]=0;while(n){if(!(o=h(n)).length){break}o.sort(g);var y=o[0],z=n[y],r=z.shift(),m=parseFloat(y),q=w[r]||{};if(!z.length){delete n[y]}for(var u in q){if(Object.prototype.hasOwnProperty.call(q,u)){var v=q[u],t=v+m,s=l[u];if((s===f)||(s>t)){l[u]=t;p(t,u);j[u]=r}}}}if(l[i]===f){return null}else{return j}};var a=function(l,i){var j=[],k=i;while(k){j.push(k);k=l[k]}j.reverse();return j};var d=function(l,j){var o=j.shift(),i,n,k=[],m;while(j.length){i=j.shift();n=e(l,o,i);if(n){m=a(n,i);if(j.length){k.push.apply(k,m.slice(0,-1))}else{return k.concat(m)}}else{return null}o=i}};var c=function(n,p){try{return Array.prototype.slice.call(n,p)}catch(o){var k=[];for(var m=p||0,j=n.length;m<j;++m){k.push(n[m])}return k}};var b=function(i){this.map=i};b.prototype.findShortestPath=function(j,i){if(Object.prototype.toString.call(j)==="[object Array]"){return d(this.map,j)}else{if(arguments.length===2){return d(this.map,[j,i])}else{return d(this.map,c(arguments))}}};b.findShortestPath=function(j,k,i){if(Object.prototype.toString.call(k)==="[object Array]"){return d(j,k)}else{if(arguments.length===3){return d(j,[k,i])}else{return d(j,c(arguments,1))}}};return b})();"use strict";var SnackMan={};PreloadImgs.put("cooler","images/cooler_new.png");PreloadImgs.put("display","images/display_new.png");PreloadImgs.put("boxoffruits","images/boxoffruits.png");PreloadImgs.put("juicemachine","images/juicemachine.png");PreloadImgs.put("icecreammachine","images/icecreammachine.png");SnackMan=function(d,q,n){var k=q.childNodes[0].getElementsByTagName("cooker")[0].childNodes[0].nodeValue;this.path={n2:{n1:1,n3:1},n3:{n2:1,n4:1},n4:{n3:1,n5:1},n5:{n4:1,n6:1},n6:{n5:1,n7:1},n7:{n6:1,n8:1},n8:{n7:1,n9:1},n9:{n8:1,n10:1},n10:{n9:1,n11:1},n12:{n11:1,n13:1,nIceCream:1},n13:{n12:1,n14:1},n14:{n13:1,n15:1,nIceCream:1},n15:{n14:1,n16:1},n16:{n15:1,n17:1},n17:{n16:1,n18:1},n18:{n17:1,n19:1},n19:{n18:1,n20:1},n20:{n19:1,n21:1},n22:{n21:0.5,n23:0.5},n23:{n22:0.5,n24:0.5},n24:{n23:0.5,n25:0.5},n25:{n24:0.5,n26:0.5},n26:{n25:0.5,n27:0.5},n27:{n26:0.5,n28:0.5},n28:{n27:0.5,n29:0.5},n29:{n28:0.5,n30:0.5},n30:{n29:0.5,n31:0.5},n32:{n31:1,n33:1},n33:{n32:1,n34:1},n34:{n33:1,n35:1},n35:{n34:1,n36:1},n36:{n35:1,n37:1},n37:{n36:1,n38:1},n38:{n37:1,n39:1},n39:{n38:1,n40:1},n40:{n39:1,n11:1},n41:{n31:0.5,n42:0.5},n42:{n41:0.5,n43:0.5},n43:{n42:0.5,n44:0.5},n44:{n43:0.5,n45:0.5},n45:{n44:0.5,n46:0.5},n46:{n45:0.5,n47:0.5},n47:{n46:0.5,n48:0.5},n48:{n47:0.5,n49:0.5},n49:{n48:0.5,n50:0.5},n50:{n49:0.5,n51:0.5},n51:{n50:0.5,n52:0.5},n52:{n51:0.5,n53:0.5},n53:{n52:0.5,n54:0.5},n54:{n53:0.5,n55:0.5},n55:{n54:0.5,n56:0.5},n56:{n55:0.5,n57:0.5},n57:{n56:0.5,n58:0.5},n58:{n57:0.5,n59:0.5},n59:{n58:0.5,n1:0.5},n60:{n1:1,n61:1},n61:{n60:1,n62:1},n62:{n61:1,n63:1},n63:{n62:1,n64:1},n64:{n63:1,n65:1},n65:{n64:1,n66:1},n66:{n65:1,n67:1},n67:{n66:1,n68:1},n68:{n67:1,n69:1},n70:{n31:0.5,n71:0.5},n71:{n70:0.5,n72:0.5},n72:{n71:0.5,n73:0.5},n73:{n72:0.5,n74:0.5},n74:{n73:0.5,n75:0.5},n75:{n74:0.5,n76:0.5},n76:{n75:0.5,n77:0.5},n77:{n76:0.5,n78:0.5},n78:{n77:0.5,n79:0.5},n80:{n79:0.5,n81:0.5},n81:{n80:0.5,n82:0.5},n82:{n81:0.5,n83:0.5},n83:{n82:0.5,n84:0.5},n84:{n83:0.5,n85:0.5},n85:{n84:0.5,n86:0.5},n86:{n85:0.5,n87:0.5},n87:{n86:0.5,n88:0.5},n88:{n87:0.5,n89:0.5},n89:{n88:0.5,n90:0.5},n90:{n89:0.5,n91:0.5},n91:{n90:0.5,n92:0.5},n92:{n91:0.5,n93:0.5},n93:{n92:0.5,n94:0.5},n94:{n93:0.5,n95:0.5},n95:{n94:0.5,n96:0.5},n96:{n95:0.5,n97:0.5},n97:{n96:0.5,n98:0.5},n98:{n97:0.5,n99:0.5},n99:{n98:0.5,n1:0.5},n100:{n79:1,n101:1},n101:{n100:1,n102:1},n102:{n101:1,n103:1},n103:{n102:1,n104:1},n104:{n103:1,n105:1},n105:{n104:1,n106:1},n107:{n106:1,n108:1},n108:{n107:1,n109:1},n109:{n108:1,n110:1},n110:{n109:1,n111:1},n111:{n110:1,n112:1},n112:{n111:1,n113:1},n113:{n112:1,n114:1},n114:{n113:1,n115:1},n115:{n114:1,n116:1},n116:{n115:1,n1:1},n117:{n106:1,n118:1},n118:{n117:1,n119:1},n119:{n118:1,n120:1},n120:{n119:1,n121:1},n121:{n120:1,n122:1},n122:{n121:1,n123:1},n123:{n122:1,n124:1},n124:{n123:1,n125:1},n125:{n124:1,n126:1},n126:{n125:1,n69:1},n128:{n127:1,n129:1},n129:{n128:1,n130:1},n130:{n129:1,n131:1},n131:{n130:1,n132:1},n132:{n131:1,n133:1},n133:{n132:1,n134:1},n134:{n133:1,n135:1},n135:{n134:1,n136:1},n136:{n135:1,n137:1},n137:{n136:1,n1:1},n138:{n127:1,n139:1},n139:{n138:1,n140:1},n140:{n139:1,n141:1},n141:{n140:1,n142:1},n142:{n141:1,n143:1},n143:{n142:1,n144:1},n144:{n143:1,n145:1},n145:{n144:1,n146:1},n146:{n145:1,n147:1},n147:{n146:1,n11:1},n1:{n2:1,n59:1,n60:1,n99:1,n116:1,n137:1},n11:{n10:1,n12:1,n40:1,n147:1,nIceCream3:1},n21:{n20:1,n22:1},n31:{n30:1,n32:1,n41:1,n70:1},n79:{n78:1,n80:1,n100:1},n106:{n105:1,n107:1,n117:1},n127:{n128:1,n138:1},n69:{n68:1,n126:1},nIceCream3:{n11:1,nIceCream2:1},nIceCream2:{n11:1,nIceCream1:1},nIceCream1:{nIceCream2:1,nIceCream:1},nIceCream:{nIceCream1:1,n14:1,n12:1}};this.nodes={n1:{id:"n1",x:270,y:356},n2:{id:"n2",x:266,y:344},n3:{id:"n3",x:262,y:332},n4:{id:"n4",x:258,y:320},n5:{id:"n5",x:254,y:308},n6:{id:"n6",x:250,y:296},n7:{id:"n7",x:246,y:284},n8:{id:"n8",x:242,y:272},n9:{id:"n9",x:238,y:260},n10:{id:"n10",x:234,y:248},n11:{id:"n11",x:230,y:240},n12:{id:"n12",x:218,y:243},n13:{id:"n13",x:206,y:246},n14:{id:"n14",x:194,y:249},n15:{id:"n15",x:182,y:252},n16:{id:"n16",x:170,y:255},n17:{id:"n17",x:158,y:258},n18:{id:"n18",x:146,y:261},n19:{id:"n19",x:134,y:264},n20:{id:"n20",x:122,y:267},n21:{id:"n21",x:110,y:276},n22:{id:"n22",x:110,y:284},n23:{id:"n23",x:110,y:292},n24:{id:"n24",x:110,y:300},n25:{id:"n25",x:110,y:308},n26:{id:"n26",x:110,y:316},n27:{id:"n27",x:110,y:324},n28:{id:"n28",x:110,y:332},n29:{id:"n29",x:110,y:340},n30:{id:"n30",x:110,y:348},n31:{id:"n31",x:110,y:356},n32:{id:"n32",x:122,y:345},n33:{id:"n33",x:134,y:334},n34:{id:"n34",x:146,y:323},n35:{id:"n35",x:158,y:312},n36:{id:"n36",x:170,y:301},n37:{id:"n37",x:182,y:290},n38:{id:"n38",x:194,y:279},n39:{id:"n39",x:206,y:268},n40:{id:"n40",x:218,y:257},n41:{id:"n41",x:118,y:356},n42:{id:"n42",x:126,y:356},n43:{id:"n43",x:134,y:356},n44:{id:"n44",x:142,y:356},n45:{id:"n45",x:150,y:356},n46:{id:"n46",x:158,y:356},n47:{id:"n47",x:166,y:356},n48:{id:"n48",x:174,y:356},n49:{id:"n49",x:182,y:356},n50:{id:"n50",x:190,y:356},n51:{id:"n51",x:198,y:356},n52:{id:"n52",x:206,y:356},n53:{id:"n53",x:214,y:356},n54:{id:"n54",x:222,y:356},n55:{id:"n55",x:230,y:356},n56:{id:"n56",x:238,y:356},n57:{id:"n57",x:246,y:356},n58:{id:"n58",x:254,y:356},n59:{id:"n59",x:262,y:356},n60:{id:"n60",x:271,y:364},n61:{id:"n61",x:272,y:372},n62:{id:"n62",x:273,y:380},n63:{id:"n63",x:274,y:388},n64:{id:"n64",x:275,y:396},n65:{id:"n65",x:276,y:404},n66:{id:"n66",x:277,y:412},n67:{id:"n67",x:278,y:420},n68:{id:"n68",x:279,y:428},n69:{id:"n69",x:284,y:438},n70:{id:"n70",x:110,y:364},n71:{id:"n71",x:110,y:372},n72:{id:"n72",x:110,y:380},n73:{id:"n73",x:110,y:388},n74:{id:"n74",x:110,y:396},n75:{id:"n75",x:110,y:404},n76:{id:"n76",x:110,y:412},n77:{id:"n77",x:110,y:420},n78:{id:"n78",x:110,y:428},n79:{id:"n79",x:110,y:436},n80:{id:"n80",x:118,y:432},n81:{id:"n81",x:126,y:428},n82:{id:"n82",x:134,y:424},n83:{id:"n83",x:142,y:420},n84:{id:"n84",x:150,y:416},n85:{id:"n85",x:158,y:412},n86:{id:"n86",x:166,y:408},n87:{id:"n87",x:174,y:404},n88:{id:"n88",x:182,y:400},n89:{id:"n89",x:190,y:396},n90:{id:"n90",x:198,y:392},n91:{id:"n91",x:206,y:388},n92:{id:"n92",x:214,y:384},n93:{id:"n93",x:222,y:380},n94:{id:"n94",x:230,y:376},n95:{id:"n95",x:238,y:372},n96:{id:"n96",x:246,y:368},n97:{id:"n97",x:254,y:364},n98:{id:"n98",x:262,y:360},n99:{id:"n99",x:270,y:356},n100:{id:"n100",x:125,y:433},n101:{id:"n101",x:140,y:430},n102:{id:"n102",x:155,y:427},n103:{id:"n103",x:170,y:424},n104:{id:"n104",x:185,y:421},n105:{id:"n105",x:200,y:418},n106:{id:"n106",x:200,y:416},n107:{id:"n107",x:207,y:410},n108:{id:"n108",x:214,y:404},n109:{id:"n109",x:221,y:398},n110:{id:"n110",x:228,y:392},n111:{id:"n111",x:235,y:386},n112:{id:"n112",x:242,y:380},n113:{id:"n113",x:249,y:374},n114:{id:"n114",x:256,y:368},n115:{id:"n115",x:263,y:362},n116:{id:"n116",x:270,y:356},n117:{id:"n117",x:208,y:418},n118:{id:"n118",x:216,y:420},n119:{id:"n119",x:224,y:422},n120:{id:"n120",x:232,y:424},n121:{id:"n121",x:240,y:426},n122:{id:"n122",x:248,y:428},n123:{id:"n123",x:256,y:430},n124:{id:"n124",x:264,y:432},n125:{id:"n125",x:272,y:434},n126:{id:"n126",x:280,y:436},n127:{id:"n127",x:300,y:240},n128:{id:"n128",x:296,y:251},n129:{id:"n129",x:292,y:262},n130:{id:"n130",x:288,y:273},n131:{id:"n131",x:284,y:284},n132:{id:"n132",x:280,y:295},n133:{id:"n133",x:276,y:306},n134:{id:"n134",x:272,y:317},n135:{id:"n135",x:268,y:328},n136:{id:"n136",x:264,y:339},n137:{id:"n137",x:260,y:350},n138:{id:"n138",x:293,y:240},n139:{id:"n139",x:286,y:240},n140:{id:"n140",x:279,y:240},n141:{id:"n141",x:272,y:240},n142:{id:"n142",x:265,y:240},n143:{id:"n143",x:258,y:240},n144:{id:"n144",x:251,y:240},n145:{id:"n145",x:244,y:240},n146:{id:"n146",x:237,y:240},n147:{id:"n147",x:230,y:240},nIceCream:{id:"nIceCream",x:200,y:240},nIceCream1:{id:"nIceCream1",x:208,y:240},nIceCream2:{id:"nIceCream2",x:215,y:240},nIceCream3:{id:"nIceCream3",x:223,y:240}};this.keynodes=["n1","n11","n21","n31","n69","n79","n106","n127","nIceCream"];this.snackManFinalPath=new Array();this.mapGraph={};this.createGraph();this.counter=[this.snackManFinalPath[2],this.snackManFinalPath[3],this.snackManFinalPath[5]];this.displayNode=this.snackManFinalPath[1];this.coolerNode=this.snackManFinalPath[4];this.boxOfFruitsNode=this.snackManFinalPath[6];this.juiceMachineNode=this.snackManFinalPath[7];this.iceCreamMachineNode=this.snackManFinalPath[8];this.heightCooker=76;if(k.indexOf("counter")==0){this.initialPosition=this.counter[parseInt(k.substring(7))-1]}else{if(k==="cooler"){this.initialPosition=this.coolerNode}else{if(k==="display"){this.initialPosition=this.displayNode}else{this.initialPosition=this.snackManFinalPath[0]}}}this.currentNode=this.initialPosition;AvatarImgMaker.createMiniAnimationBody(Game.tempCtxDisplay,n);this.img=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:this.currentNode.x,y:this.currentNode.y-this.heightCooker,width:120,height:this.heightCooker,sourceY:0,img:Game.tempDisplay});this.imgCooker=this.img.image;var g=document.createElement("canvas");g.width=Game.tempDisplay.width;g.height=Game.tempDisplay.height;var l=g.getContext("2d");AvatarImgMaker.createMiniAnimationBodyPlatter(l,n);this.imgPlatter=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:this.currentNode.x,y:this.currentNode.y-this.heightCooker,width:120,height:this.heightCooker,sourceY:0,img:g});this.imgCookerPlatter=this.imgPlatter.image;this.cooler=new Sprite({ticksPerFrame:0,numberOfFrames:4,horzSeq:true,x:280,y:360,width:320,height:80,sourceX:0,sourceY:0,img:PreloadImgs.get("cooler")});this.display=new Sprite({ticksPerFrame:0,numberOfFrames:4,horzSeq:true,x:200,y:200,width:160,height:40,sourceX:0,sourceY:0,img:PreloadImgs.get("display")});var f=q.evaluate("count(//mission/commands/category[@name='goToBoxOfFruits'])",q,null,XPathResult.ANY_TYPE,null);this.showJuice=f.numberValue>0;if(this.showJuice){this.boxOfFruits=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:200,y:408,width:96,height:32,sourceX:0,sourceY:0,img:PreloadImgs.get("boxoffruits")});this.juiceMachine=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:320,y:190,width:120,height:40,sourceX:0,sourceY:0,img:PreloadImgs.get("juicemachine")})}var r=q.evaluate("count(//mission/commands/category[@name='icecream'])",q,null,XPathResult.ANY_TYPE,null);this.showIceCream=r.numberValue>0;if(this.showIceCream){this.iceCreamMachine=new Sprite({ticksPerFrame:0,numberOfFrames:9,horzSeq:false,x:160,y:160,width:40,height:720,sourceX:0,sourceY:0,img:PreloadImgs.get("icecreammachine")})}else{this.iceCreamMachine=null}this.installedMachines=[];this.extendedCommands=[];this.objective={};this.objective.objectives=[];this.objective.ordered=d.getAttribute("ordered")==="true";this.objective.xpIndividual=parseInt(d.getAttribute("xpIndividual"));this.objective.xpFinal=parseInt(d.getAttribute("xpFinal"));this.objective.xpTotalTime=parseInt(d.getAttribute("xpTotalTime"));var e=d.getAttribute("maxCommands");this.objective.maxCommands=parseInt((e==null?"0":e));e=d.getAttribute("maxCommandsReward");this.objective.maxCommandsReward=parseInt((e==null?"0":e));e=d.getAttribute("maxCommandsRewardCoins");this.objective.maxCommandsRewardCoins=parseInt((e==null?"0":e));this.objective.debug=d.getAttribute("debug")==="true";var c=d.getElementsByTagName("objective");for(var j=0;j<c.length;j++){var h=c[j].childNodes[0].nodeValue;var b=Objective.factory(h);var a=b.init(c[j]);this.objective.objectives.push(a)}this.hasVarQtd=this.createAditionalObjective(d,"varQtd");this.hasCommQtd=this.createAditionalObjective(d,"commQtd");this.lastObjectiveAchieved=-1;this.allObjectivesAchieved=false;this.catched=0;this.delivered=0;this.talkText=null};SnackMan.prototype.createAditionalObjective=function(b,c){var a=b.getAttribute(c);if(a!=null){var e=Objective.factory(c);var d=e.init(a);this.objective.objectives.push(d);return true}return false};SnackMan.prototype.createGraph=function(){for(var a=0;a<this.keynodes.length;a++){this.snackManFinalPath[a]=this.nodes[this.keynodes[a]]}this.graph=new Graph(this.path)};SnackMan.prototype.reset=function(){this.currentNode=this.initialPosition;this.catched=0;this.delivered=0;this.talkText=null;this.img.image=this.imgCooker;this.img.x=this.currentNode.x;this.img.y=this.currentNode.y-this.heightCooker;this.img.sourceY=0;this.img.frameIndex=1;this.cooler.sourceX=0;this.cooler.frameIndex=0;if(this.iceCreamMachine!=null){this.iceCreamMachine.frameIndex=0}this.lastObjectiveAchieved=-1;this.allObjectivesAchieved=false;for(var a=0;a<this.objective.objectives.length;a++){this.objective.objectives[a].achieved=false}for(var a=0;a<this.installedMachines.length;a++){this.installedMachines[a].machineCfg.production=[]}};SnackMan.prototype.speechBubble=function(c,f,a,g){var d=c.measureText(f);var b=d.width;if(b<25){b=25}var e=20;c.beginPath();c.strokeStyle="black";c.lineWidth="1";c.fillStyle="rgba(255, 255, 255, 0.8)";c.moveTo(a,g);c.lineTo(a+4,g);c.lineTo(a+9,g+10);c.lineTo(a+9,g);c.lineTo(a+b,g);c.quadraticCurveTo(a+5+b,g,a+5+b,g-(e*0.2));c.lineTo(a+5+b,g-(e*0.8));c.quadraticCurveTo(a+5+b,g-e,a+b,g-e);c.lineTo(a,g-e);c.quadraticCurveTo(a-5,g-e,a-5,g-(e*0.8));c.lineTo(a-5,g-(e*0.2));c.quadraticCurveTo(a-5,g,a,g);c.fill();c.stroke();c.closePath();c.textAlign="left";c.fillStyle="#000";c.fillText(f,a,g-6)};SnackMan.prototype.draw=function(a){this.drawInstalledMachines(a);this.display.draw(a);if(this.showJuice){this.juiceMachine.draw(a)}if(this.showIceCream){this.iceCreamMachine.draw(a)}this.img.draw(a);this.cooler.draw(a);if(this.showJuice){this.boxOfFruits.draw(a)}if(this.talkText!=null){this.speechBubble(a,this.talkText,this.img.x,this.img.y)}};SnackMan.prototype.update=function(){var b=[];for(var a=0;a<arguments.length;a++){b.push(arguments[a])}BlocklyApps.log.push(b);CustomerManager.update()};SnackMan.prototype.goToBarCounter=function(a){if(a<1||a>3){BlocklyApps.log.push(["fail","Error_doesntExistCounter"]);throw false}this.animateSnackMan(this.counter[a-1])};SnackMan.prototype.goToDisplay=function(){this.animateSnackMan(this.displayNode)};SnackMan.prototype.goToCooler=function(){this.animateSnackMan(this.coolerNode)};SnackMan.prototype.alertRun=function(a){alert(a)};SnackMan.prototype.getCustomer=function(){var b=false;for(var a=0;a<this.counter.length;a++){if(this.currentNode.id===this.counter[a].id){b=true;return(CustomerManager.getCustomerCounter(a+1))}}if(!b){BlocklyApps.log.push(["fail","Error_isntCloseToCustomer"]);throw false}return null};SnackMan.prototype.isThereACustomer=function(){var a=this.getCustomer();this.update("XX");this.update("IM",0);this.update("IM",40);this.update("IM",0);return a!=null};SnackMan.prototype.askForDrink=function(){var b=this.getCustomer();if(!b){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var a=b.askForDrink();if(a==null){BlocklyApps.log.push(["fail","Error_isntThirsty"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askForDrink",b);return a};SnackMan.prototype.pickUpDrink=function(a){if(this.currentNode.id!=this.coolerNode.id){BlocklyApps.log.push(["fail","Error_isntFrontCooler"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(a.data.drinkOrFood!="drink"){BlocklyApps.log.push(["fail","Error_doesntOrderDrink"]);throw false}if(a.data.descr.indexOf("coke")==-1){BlocklyApps.log.push(["fail","Error_wrongPlaceForDrink"]);throw false}this.update("OC");this.update("OC");this.update("OC");this.update("CC");this.update("CC");this.update("CC");this.update("IP");var b={type:"item",descr:a.data.descr,drinkOrFood:"drink",source:a.data.source,sourceType:a.data.sourceType};this.verifyObjectives("pickUpDrink",b);this.catched++;return b};SnackMan.prototype.askWantHowManyDrinks=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askWantHowManyDrinks();this.verifyObjectives("askWantHowManyDrinks",a);return b};SnackMan.prototype.hasThirsty=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askHasThirsty",a);return a.hasThirsty()};SnackMan.prototype.askForFood=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askForFood();if(b==null){BlocklyApps.log.push(["fail","Error_isntHunger"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askForFood",a);return b};SnackMan.prototype.askWantHowManyFoods=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askWantHowManyFoods();this.verifyObjectives("askWantHowManyFoods",a);return b};SnackMan.prototype.hasHunger=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askHasHunger",a);return a.hasHunger()};SnackMan.prototype.pickUpHotDog=function(a){if(this.currentNode.id!=this.displayNode.id){BlocklyApps.log.push(["fail","Error_isntFrontDisplay"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(a.data.drinkOrFood!="food"){BlocklyApps.log.push(["fail","Error_doesntOrderFood"]);throw false}if(a.data.descr.indexOf("hotdog")==-1){BlocklyApps.log.push(["fail","Error_onlyHotDog"]);throw false}this.update("OD");this.update("OD");this.update("OD");this.update("CD");this.update("CD");this.update("CD");this.update("IP");var b={type:"item",descr:a.data.descr,drinkOrFood:"food",source:a.data.source,sourceType:a.data.sourceType};this.verifyObjectives("pickUpFood",b);this.catched++;return b};SnackMan.prototype.verifyGenericPickUp=function(a,b){if(this.currentNode.id!=b.node.id){BlocklyApps.log.push(["fail",b.errorIsntFront]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(a.data.drinkOrFood!=b.drinkOrFood){BlocklyApps.log.push(["fail","Error_doesntOrder"+b.drinkOrFood.substring(0,1).toUpperCase()+b.drinkOrFood.substring(1)]);throw false}if(a.data.descr.indexOf(b.produce)==-1){BlocklyApps.log.push(["fail","$Error_only"+b.typeOfDrinkFood.substring(0,1).toUpperCase()+b.typeOfDrinkFood.substring(1)]);throw false}};SnackMan.prototype.finishPickUp=function(a,c){var b={type:"item",descr:"$$"+c.produce,drinkOrFood:c.drinkOrFood,source:a.data.source,sourceType:a.data.sourceType};this.catched++;return b};SnackMan.prototype.genericPickUp=function(b,d){this.verifyGenericPickUp(b,d);var e=d.numberOfFrames-1;for(var a=0;a<e;a++){this.update("OM",d)}for(var a=0;a<e;a++){this.update("CM",d)}this.update("IP");return this.finishPickUp(b,d)};SnackMan.prototype.genericPrepare=function(d,b){if(this.currentNode.id!=d.node.id){BlocklyApps.log.push(["fail",d.errorIsntFront]);throw false}if(d.production.length>0){BlocklyApps.log.push(["fail","$Error_StillHasProductInStock"]);throw false}var f=d.commsProduce[b];var h=[];for(var e=0;e<d.commsProduce[b].qtProduce;e++){h.push({prodX:f.prodX,prodY:f.prodY,prodXDelta:f.prodXDelta,prodYDelta:f.prodYDelta,prodImg:f.prodImg})}var g=d.numberOfFrames;for(var a=0;a<g;a++){this.update("OM",d)}this.update("PM",d,h)};SnackMan.prototype.genericOnlyPickUp=function(a,b){this.verifyGenericPickUp(a,b);if(b.production.length==0){BlocklyApps.log.push(["fail","$Error_DoesntHaveProductInStock"]);throw false}b.production.shift();this.update("KM",b);this.update("IP");var c=this.finishPickUp(a,b);return c};SnackMan.prototype.deliver=function(c){if(c.data===undefined||c.data===null||c.data==="undefined"||c.type==="number"){BlocklyApps.log.push(["fail","Error_variableHaventContentToDeliver"]);throw false}var d=this.getCustomer();if(!d){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=d.deliver(c.data);if(b.happy==Customer.DELIVERED_BAD){BlocklyApps.log.push(["fail",b.reason]);throw false}if(b!=null){this.verifyObjectives("deliver",{allCustomers:false,customer:d})}c.data=null;if(b.happy>=Customer.DELIVERED_PARTIAL){this.delivered++}if(b.happy!=Customer.DELIVERED_PARTIAL){for(var a=0;a<11;a++){this.update("IM",0)}this.update("IO",b.money,this.catched-this.delivered)}else{this.update("IO",null,this.catched-this.delivered)}};SnackMan.prototype.talk=function(a){this.update("TA",a);this.verifyObjectives("talk",a)};SnackMan.prototype.goToBoxOfFruits=function(){this.animateSnackMan(this.boxOfFruitsNode)};SnackMan.prototype.goToJuiceMachine=function(){this.animateSnackMan(this.juiceMachineNode)};SnackMan.prototype.pickUpFruits=function(a){if(this.currentNode.id!=this.boxOfFruitsNode.id){BlocklyApps.log.push(["fail","Error_isntFrontBoxOfFruits"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(!(a.data.type==="order"&&a.data.descr.indexOf("$$juiceof")==0)){BlocklyApps.log.push(["fail","Error_onlyFruits"]);throw false}this.update("SF");this.update("SF");this.update("HF");this.update("HF");this.update("IP");var b={type:"item",descr:"$$"+a.data.descr.substring(9),drinkOrFood:"drink",source:a.data.source,sourceType:a.data.sourceType};return b};SnackMan.prototype.prepareAndPickUpJuice=function(a){if(this.currentNode.id!=this.juiceMachineNode.id){BlocklyApps.log.push(["fail","Error_isntFrontJuiceMachine"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="item"){BlocklyApps.log.push(["fail","Error_doesntHaveItem"]);throw false}if(a.data.descr!="$$orange"){BlocklyApps.log.push(["fail","Error_onlyPutFruits"]);throw false}this.update("MJ");this.update("MJ");this.update("HJ");this.update("HJ");this.update("IP");var b={type:"item",descr:"$$juiceof"+a.data.descr.substring(2),drinkOrFood:"drink",source:a.data.source,sourceType:a.data.sourceType};this.catched++;return b};SnackMan.prototype.animateSnackMan=function(b){var a=this.graph.findShortestPath(this.currentNode.id,b.id);for(var c=0;c<a.length;c++){var d=this.nodes[a[c]];this.update("MS",this.currentNode.x,this.currentNode.y,d.x,d.y);this.currentNode=d}this.update("CO",0)};SnackMan.prototype.cashIn=function(c){if(c==undefined){BlocklyApps.log.push(["fail","Error_variableNotInitialized",varName]);throw false}if(isNaN(c)){BlocklyApps.log.push(["fail","Error_paramIsNotANumber"]);throw false}var b=this.getCustomer();if(!b){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var a=b.cashIn(c);this.verifyObjectives("cashIn",{allCustomers:false,customer:b});return a};SnackMan.prototype.giveChange=function(b,c){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}if(a.giveChange(b,c)){this.verifyObjectives("giveTheWholeChange",{allCustomers:false,customer:a});this.verifyObjectives("giveSomeChange",{allCustomers:false,customer:a})}};SnackMan.prototype.goToIceCreamMachine=function(){this.animateSnackMan(this.iceCreamMachineNode)};SnackMan.prototype.pickUpIceCream=function(b){if(this.currentNode.id!=this.iceCreamMachineNode.id){BlocklyApps.log.push(["fail","Error_isntFrontIceCreamMachine"]);throw false}var a=b.data;if(a==='"$$$chocolate"'||a==='"$$$strawberry"'||a==='"$$$vanilla"'){a={type:"order",descr:"$$icecreamof"+a.substring(4,a.length-1),source:null,sourceType:null}}if(a==null||a===undefined||(a.type!="order")){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(!((a.type==="order"&&a.descr.indexOf("$$icecreamof")==0))){BlocklyApps.log.push(["fail","Error_onlyIceCream"]);throw false}var c=null;switch(a.descr){case"$$icecreamofchocolate":c=0;break;case"$$icecreamofvanilla":c=3;break;case"$$icecreamofstrawberry":c=6;break}this.update("DI",c);this.update("DI",c+1);this.update("DI",c+2);this.update("UI",c+2);this.update("UI",c+1);this.update("UI",c);this.update("IP");var d={type:"item",descr:a.descr,drinkOrFood:"food",source:a.source,sourceType:a.sourceType};this.verifyObjectives("catchFruits",d);this.catched++;return d};SnackMan.prototype.askWantHowManyIceCream=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askWantHowManyIceCream();this.verifyObjectives("askWantHowManyIceCream",a);return b};SnackMan.prototype.askForIceCream=function(){var b=this.getCustomer();if(!b){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var a=b.askForIceCream();if(a==null){BlocklyApps.log.push(["fail","Error_isntHungerForIceCream"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askForIceCream",b);return a};SnackMan.prototype.animate=function(d,a){if(d!=="IM"){this.talkText=null}switch(d){case"AL":this.alertRun(a);break;case"CO":this.checkObjectives();case"IM":this.changeSnackManImage(a);break;case"MS":this.changeSnackManPosition(a.shift(),a.shift(),a.shift(),a.shift());break;case"OC":this.nextOpenCoolerImage();break;case"CC":this.nextCloseCoolerImage();break;case"OD":this.nextOpenDisplayImage();break;case"CD":this.nextCloseDisplayImage();break;case"IP":this.changeImagePlatter();break;case"IO":var c=a.shift();c=a.shift();if(c==0){this.changeImageOriginal()}break;case"SF":this.nextShowFruitImage();break;case"HF":this.nextHideFruitImage();break;case"MJ":this.nextShowJuiceMachineImage();break;case"HJ":this.nextHideJuiceMachineImage();break;case"OM":var b=a.shift().machine;if(b.invert==true){b.invertDirection()}b.update();break;case"CM":var b=a.shift().machine;if(b.invert==false){b.invertDirection()}b.update();break;case"PM":var b=a.shift();b.production=a.shift();break;case"KM":break;case"TA":this.talkText=a.shift();break;case"DI":case"UI":this.showIceCreamMachine(a.shift());break}};SnackMan.prototype.changeSnackManImage=function(a){this.img.sourceY=a;this.img.update()};SnackMan.prototype.changeSnackManPosition=function(c,b,a,d){if(a<c){this.img.sourceY=80}else{if(a>c){this.img.sourceY=160}else{if(d<b){this.img.sourceY=240}else{this.img.sourceY=0}}}this.img.update();this.img.x=a;this.img.y=d-this.heightCooker};SnackMan.prototype.nextOpenCoolerImage=function(){if(this.cooler.invert==true){this.cooler.invertDirection()}this.updateCoolerImage()};SnackMan.prototype.nextCloseCoolerImage=function(){if(this.cooler.invert==false){this.cooler.invertDirection()}this.updateCoolerImage()};SnackMan.prototype.updateCoolerImage=function(){this.cooler.update()};SnackMan.prototype.nextShowFruitImage=function(){if(this.boxOfFruits.invert==true){this.boxOfFruits.invertDirection()}this.updateBoxOfFruitsImage()};SnackMan.prototype.nextHideFruitImage=function(){if(this.boxOfFruits.invert==false){this.boxOfFruits.invertDirection()}this.updateBoxOfFruitsImage()};SnackMan.prototype.updateBoxOfFruitsImage=function(){this.boxOfFruits.update()};SnackMan.prototype.nextShowJuiceMachineImage=function(){if(this.juiceMachine.invert==true){this.juiceMachine.invertDirection()}this.updateJuiceMachineImage()};SnackMan.prototype.nextHideJuiceMachineImage=function(){if(this.juiceMachine.invert==false){this.juiceMachine.invertDirection()}this.updateJuiceMachineImage()};SnackMan.prototype.updateJuiceMachineImage=function(){this.juiceMachine.update()};SnackMan.prototype.nextOpenDisplayImage=function(){if(this.display.invert==true){this.display.invertDirection()}this.updateDisplayImage()};SnackMan.prototype.nextCloseDisplayImage=function(){if(this.display.invert==false){this.display.invertDirection()}this.updateDisplayImage()};SnackMan.prototype.updateDisplayImage=function(){this.display.update()};SnackMan.prototype.changeImagePlatter=function(){this.img.image=this.imgCookerPlatter};SnackMan.prototype.changeImageOriginal=function(){this.img.image=this.imgCooker};SnackMan.prototype.showIceCreamMachine=function(a){this.iceCreamMachine.frameIndex=a};SnackMan.prototype.drawInstalledMachines=function(a){for(var b=0;b<this.installedMachines.length;b++){this.installedMachines[b].drawExt(a)}};SnackMan.prototype.installMachine=function(idmachine,machinename,machinex,machiney,machinepath,machineErrorIsntFront,machineDrinkOrFood,machineTypeOfDrinkFood,commands,machineImg,machineNumberOfFrames,machineHeight){var machineProduce="machine"+idmachine+"-prod";var machine=new Sprite({ticksPerFrame:0,numberOfFrames:machineNumberOfFrames,horzSeq:false,x:parseInt(machinex),y:parseInt(machiney),width:32,height:machineHeight,sourceX:0,sourceY:0,img:PreloadImgs.get(machineImg)});machine.drawExt=function(ctx){this.draw(ctx);for(var i=0;i<this.machineCfg.production.length;i++){var p=this.machineCfg.production[i];var img=PreloadImgs.get(p.prodImg);ctx.drawImage(img,this.x+p.prodX+(i*p.prodXDelta),this.y+p.prodY+(i*p.prodYDelta))}};this.installedMachines.push(machine);var mp=machinepath.split("#$#");var path=JSON.parse(mp[0]);for(var key1 in path){var myObj2=path[key1];this.path[key1]=myObj2;for(var key2 in myObj2){if(this.path[key2]!=undefined){this.path[key2][key1]=myObj2[key2]}}}var nodes=JSON.parse(mp[1]);for(var i=0;i<nodes.length;i++){this.nodes[nodes[i].id]=nodes[i]}var machineCfg={};machineCfg.node=nodes[0];machineCfg.errorIsntFront=machineErrorIsntFront;machineCfg.drinkOrFood=machineDrinkOrFood;machineCfg.typeOfDrinkFood=machineTypeOfDrinkFood;machineCfg.produce=machineProduce;machineCfg.numberOfFrames=machineNumberOfFrames;machineCfg.machine=machine;machineCfg.production=[];PreloadImgs.put("$"+machineProduce,"images/$$"+machineProduce+".png",true);machine.machineCfg=machineCfg;machineCfg.commsProduce=[];for(var i=0;i<commands.length;i++){var com=commands[i];Blockly.Blocks[com[0]]={bodyFunc:com[3],init:new Function(com[2])};Blockly.JavaScript[com[0]]=function(block){var xpt=eval(Blockly.Blocks[block.type].bodyFunc);return xpt};var run=null;switch(com[4]){case"M":run=new Function("machine","hero.animateSnackMan( machine.node );");break;case"C":run=new Function("machine","order","return hero.genericPickUp( order, machine ); ");break;case"P":var confProduce={};confProduce.qtProduce=parseInt(com[5]);confProduce.prodX=parseInt(com[6]);confProduce.prodY=parseInt(com[7]);confProduce.prodXDelta=parseInt(com[8]);confProduce.prodYDelta=parseInt(com[9]);confProduce.prodImg=com[10];machineCfg.commsProduce.push(confProduce);PreloadImgs.put(confProduce.prodImg,"images/machine"+confProduce.prodImg+".png",true);run=new Function("machine","hero.genericPrepare( machine, "+(machineCfg.commsProduce.length-1)+" ); ");break;case"K":run=new Function("machine","order","return hero.genericOnlyPickUp( order, machine ); ");break}this.extendedCommands.push({name:com[0],nameLang:com[1],run:run,machine:machineCfg})}};SnackMan.prototype.hasMachineFor=function(c){if(c==="hotdog"||c==="coke"||c==="juiceoforange"){return true}for(var a=0;a<this.installedMachines.length;a++){var b=this.installedMachines[a].machineCfg;if(b.produce===c){return true}}return false};SnackMan.prototype.checkObjectives=function(){this.verifyObjectives("goesTo",{nx:this.img.x,ny:this.img.y+this.heightCooker})};SnackMan.prototype.verifyObjectives=function(b,a){if(b==="deliver"){this.verifyObjectives("deliverGifts",a);this.verifyObjectives("customDeliver",a)}if(!Objective.verifyObjectives(b,a)){return}$.growl({title:BlocklyApps.getMsg("NoBugs_goalAchieved"),message:BlocklyApps.getMsg("NoBugs_achieved")+" "+(this.lastObjectiveAchieved+1)+" "+BlocklyApps.getMsg("NoBugs_of")+" "+this.objective.objectives.length});Game.alertGoalButton()};SnackMan.prototype.addReward=function(f,k,h,j){var g={totalXP:0,baseXP:0,totalCoins:0,baseCoins:0,bonusXP:[],bonusCoins:[]};if(this.allObjectivesAchieved){var a=3-CountXP.times;if(a==0){g.totalXP=this.objective.xpFinal}else{g.totalXP=this.objective.xpIndividual*a}g.baseXP=g.totalXP;if(f<=this.objective.maxCommands){if(this.objective.maxCommandsReward>0){g.totalXP+=this.objective.maxCommandsReward;g.bonusXP.push({name:"Victory_MaxCommands",value:this.objective.maxCommandsReward,extraInfo:null})}else{g.totalCoins+=this.objective.maxCommandsRewardCoins;g.bonusCoins.push({name:"Victory_MaxCommands",value:this.objective.maxCommandsRewardCoins,extraInfo:null})}}if(h!=null&&k<=h){j=j.split(" ");var e=Math.floor(h/j.length);var b=0;for(var d=1;d<=j.length;d++){if(k<=e*d){b=parseInt(j[d-1]);break}}if(b>0){var c=Math.floor((k/60));var l=k-(c*60);g.bonusCoins.push({name:"Victory_TimeBonus",value:b,extraInfo:(c>0?c+"'":"")+l+'"'});g.totalCoins+=b}}}return g};"use strict";var CustOpt={};CustOpt.path={n2:{n1:1,n3:1},n3:{n2:1,n4:1},n4:{n3:1,n5:1},n5:{n4:1,n6:1},n6:{n5:1,n7:1},n7:{n6:1,n8:1},n8:{n7:1,n9:1},n9:{n8:1,n10:1},n10:{n9:1,n11:1},n11:{n10:1,n12:1},n12:{n11:1,n13:1},n13:{n12:1,n14:1},n14:{n13:1,n15:1},n15:{n14:1,n16:1},n16:{n15:1,n17:1},n17:{n16:1,n18:1},n18:{n17:1,n19:1},n19:{n18:1,n20:1},n20:{n19:1,n21:1},n21:{n20:1,n22:1},n22:{n21:1,n23:1},n23:{n22:1,n24:1},n24:{n23:1,n25:1},n25:{n24:1,n26:1},n26:{n25:1,n27:1},n27:{n26:1,n28:1},n28:{n27:1,n29:1},n29:{n28:1,n30:1},n30:{n29:1,n31:1},n31:{n30:1,n32:1},n32:{n31:1,n33:1},n33:{n32:1,n34:1},n34:{n33:1,n35:1},n35:{n34:1,n36:1},n36:{n35:1,n37:1},n37:{n36:1,n38:1},n38:{n37:1,n39:1},n40:{n39:1,n41:1},n41:{n40:1,n42:1},n42:{n41:1,n43:1},n43:{n42:1,n44:1},n44:{n43:1,n45:1},n45:{n44:1,n46:1},n46:{n45:1,n47:1},n47:{n46:1,n48:1},n48:{n47:1,n49:1},n39:{n38:1,n40:1,n50:1},n50:{n39:1,n51:1},n51:{n50:1,n52:1},n52:{n51:1,n53:1},n53:{n52:1,n54:1},n54:{n53:1,n55:1},n55:{n54:1,n56:1},n56:{n55:1,n57:1},n57:{n56:1,n58:1},n58:{n57:1,n59:1},n59:{n58:1,n60:1},n60:{n59:1,n61:1},n61:{n60:1,n62:1},n62:{n61:1,n63:1},n63:{n62:1,n64:1},n64:{n63:1,n65:1},n65:{n64:1,n66:1},n66:{n65:1,n67:1},n67:{n66:1,n68:1},n68:{n67:1,n69:1},n70:{n69:1,n71:1},n71:{n70:1,n72:1},n72:{n71:1,n73:1},n73:{n72:1,n74:1},n74:{n73:1,n75:1},n75:{n74:1,n76:1},n76:{n75:1,n77:1},n77:{n76:1,n78:1},n78:{n77:1,n79:1},n69:{n68:1,n70:1,n80:1},n80:{n69:1,n81:1},n81:{n80:1,n82:1},n82:{n81:1,n83:1},n83:{n82:1,n84:1},n84:{n83:1,n85:1},n85:{n84:1,n86:1},n86:{n85:1,n87:1},n87:{n86:1,n88:1},n88:{n87:1,n89:1},n89:{n88:1,n90:1},n90:{n89:1,n91:1},n91:{n90:1,n92:1},n92:{n91:1,n93:1},n93:{n92:1,n94:1},n94:{n93:1,n95:1},n95:{n94:1,n96:1},n96:{n95:1,n97:1},n97:{n96:1,n98:1},n98:{n97:1,n99:1},n100:{n99:1,n101:1},n101:{n100:1,n102:1},n102:{n101:1,n103:1},n103:{n102:1,n104:1},n104:{n103:1,n105:1},n105:{n104:1,n106:1},n106:{n105:1,n107:1},n107:{n106:1,n108:1},n108:{n107:1,n109:1},n99:{n98:1,n100:1},n1:{n2:1},n49:{n48:1},n79:{n78:1},n109:{n108:1}};CustOpt.nodes={n1:{id:"n1",x:40,y:105},n2:{id:"n2",x:36,y:105},n3:{id:"n3",x:32,y:105},n4:{id:"n4",x:28,y:105},n5:{id:"n5",x:24,y:105},n6:{id:"n6",x:20,y:105},n7:{id:"n7",x:16,y:105},n8:{id:"n8",x:12,y:105},n9:{id:"n9",x:8,y:105},n10:{id:"n10",x:4,y:105},n11:{id:"n11",x:0,y:105},n12:{id:"n12",x:0,y:111},n13:{id:"n13",x:0,y:117},n14:{id:"n14",x:0,y:123},n15:{id:"n15",x:0,y:129},n16:{id:"n16",x:0,y:135},n17:{id:"n17",x:0,y:141},n18:{id:"n18",x:0,y:147},n19:{id:"n19",x:0,y:153},n20:{id:"n20",x:0,y:159},n21:{id:"n21",x:0,y:165},n22:{id:"n22",x:0,y:171},n23:{id:"n23",x:0,y:177},n24:{id:"n24",x:0,y:183},n25:{id:"n25",x:0,y:189},n26:{id:"n26",x:0,y:195},n27:{id:"n27",x:0,y:201},n28:{id:"n28",x:0,y:207},n29:{id:"n29",x:0,y:213},n30:{id:"n30",x:0,y:219},n31:{id:"n31",x:0,y:225},n32:{id:"n32",x:0,y:231},n33:{id:"n33",x:0,y:237},n34:{id:"n34",x:0,y:243},n35:{id:"n35",x:0,y:249},n36:{id:"n36",x:0,y:255},n37:{id:"n37",x:0,y:261},n38:{id:"n38",x:0,y:267},n39:{id:"n39",x:0,y:273},n40:{id:"n40",x:3,y:276},n41:{id:"n41",x:6,y:276},n42:{id:"n42",x:9,y:276},n43:{id:"n43",x:12,y:276},n44:{id:"n44",x:15,y:276},n45:{id:"n45",x:18,y:276},n46:{id:"n46",x:21,y:276},n47:{id:"n47",x:24,y:276},n48:{id:"n48",x:27,y:276},n49:{id:"n49",x:44,y:276},n50:{id:"n50",x:0,y:280},n51:{id:"n51",x:0,y:284},n52:{id:"n52",x:0,y:288},n53:{id:"n53",x:0,y:292},n54:{id:"n54",x:0,y:296},n55:{id:"n55",x:0,y:300},n56:{id:"n56",x:0,y:304},n57:{id:"n57",x:0,y:308},n58:{id:"n58",x:0,y:312},n59:{id:"n59",x:0,y:316},n60:{id:"n60",x:0,y:320},n61:{id:"n61",x:0,y:324},n62:{id:"n62",x:0,y:328},n63:{id:"n63",x:0,y:332},n64:{id:"n64",x:0,y:336},n65:{id:"n65",x:0,y:340},n66:{id:"n66",x:0,y:344},n67:{id:"n67",x:0,y:348},n68:{id:"n68",x:0,y:352},n69:{id:"n69",x:0,y:356},n70:{id:"n70",x:3,y:356},n71:{id:"n71",x:6,y:356},n72:{id:"n72",x:9,y:356},n73:{id:"n73",x:12,y:356},n74:{id:"n74",x:15,y:356},n75:{id:"n75",x:18,y:356},n76:{id:"n76",x:21,y:356},n77:{id:"n77",x:24,y:356},n78:{id:"n78",x:27,y:356},n79:{id:"n79",x:44,y:356},n80:{id:"n80",x:0,y:360},n81:{id:"n81",x:0,y:364},n82:{id:"n82",x:0,y:368},n83:{id:"n83",x:0,y:372},n84:{id:"n84",x:0,y:376},n85:{id:"n85",x:0,y:380},n86:{id:"n86",x:0,y:384},n87:{id:"n87",x:0,y:388},n88:{id:"n88",x:0,y:392},n89:{id:"n89",x:0,y:396},n90:{id:"n90",x:0,y:400},n91:{id:"n91",x:0,y:404},n92:{id:"n92",x:0,y:408},n93:{id:"n93",x:0,y:412},n94:{id:"n94",x:0,y:416},n95:{id:"n95",x:0,y:420},n96:{id:"n96",x:0,y:424},n97:{id:"n97",x:0,y:428},n98:{id:"n98",x:0,y:432},n99:{id:"n99",x:0,y:436},n100:{id:"n100",x:3,y:436},n101:{id:"n101",x:6,y:436},n102:{id:"n102",x:9,y:436},n103:{id:"n103",x:12,y:436},n104:{id:"n104",x:15,y:436},n105:{id:"n105",x:18,y:436},n106:{id:"n106",x:21,y:436},n107:{id:"n107",x:24,y:436},n108:{id:"n108",x:27,y:436},n109:{id:"n109",x:44,y:436}};CustOpt.keynodes=["n1","n49","n79","n109"];CustOpt.counter=[CustOpt.keynodes[1],CustOpt.keynodes[2],CustOpt.keynodes[3]];CustOpt.door="n1";CustOpt.customerFinalPath=new Array();PreloadImgs.put("$customer01","images/$customer01.png");PreloadImgs.put("$customer01_anger","images/$customer01_anger.png");PreloadImgs.put("$customer02","images/$customer02.png");PreloadImgs.put("$customer02_anger","images/$customer02_anger.png");PreloadImgs.put("$customer03","images/$customer03.png");PreloadImgs.put("$customer03_anger","images/$customer03_anger.png");PreloadImgs.put("coin","images/coin.png");PreloadImgs.put("anger","images/anger.png");PreloadImgs.put("duvida","images/duvida.png");PreloadImgs.put("heart","images/heart.png");PreloadImgs.put("$coke","images/$$coke.png");PreloadImgs.put("$hotdog","images/$$hotdog.png");PreloadImgs.put("$juiceoforange","images/$$juiceoforange.png");PreloadImgs.put("$orange","images/$$orange.png");PreloadImgs.put("baloon_1","images/baloon_1.png");PreloadImgs.put("baloonr_1","images/baloonr_1.png");PreloadImgs.put("baloon_2","images/baloon_2.png");PreloadImgs.put("baloonr_2","images/baloonr_2.png");PreloadImgs.put("baloon_3","images/baloon_3.png");PreloadImgs.put("baloonr_3","images/baloonr_3.png");CustOpt.createCustomerPath=function(){for(var a=0;a<CustOpt.keynodes.length;a++){CustOpt.customerFinalPath[a]=CustOpt.nodes[CustOpt.keynodes[a]]}CustOpt.graph=new Graph(CustOpt.path)};CustOpt.createCustomerPath();var Customer={};Customer=function(a){this.pay=a.pay;this.limitedChanges=a.limitedChanges.split(",");for(var b=0;b<this.limitedChanges.length;b++){this.limitedChanges[b]=parseInt(this.limitedChanges[b])}this.randomType=a.randomType;this.hasRandom=a.hasRandom;this.drinks=a.drinks;this.dUnfulfilled=0;this.foods=a.foods;this.fUnfulfilled=0;this.currentNode=CustOpt.nodes[a.init];this.reallyCurrentNode=this.currentNode;this.dest=CustOpt.nodes[a.place.id];this.place=a.place.id;this.placeType=a.place.type;this.state=(this.currentNode.id===CustOpt.customerFinalPath[0].id?0:8);this.showCustomer=this.state!==0;this.showDoor=!this.showCustomer;this.log=[];this.custHeight=76;this.img=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:this.currentNode.x,y:this.currentNode.y-this.custHeight,width:120,height:77,sourceY:0,img:PreloadImgs.get("$customer"+a.id)});if(this.state===8){this.img.update()}this.id=a.id;this.imgCustAnger=PreloadImgs.get("$customer"+a.id+"_anger");this.door=new Sprite({ticksPerFrame:0,numberOfFrames:4,horzSeq:false,x:0,y:0,width:120,height:480,img:PreloadImgs.get("doors")});this.coin=new Sprite({ticksPerFrame:0,numberOfFrames:10,horzSeq:true,width:440,height:40,sourceY:0,img:PreloadImgs.get("coin")});this.showCoin=false;this.fire=new Sprite({ticksPerFrame:0,numberOfFrames:10,horzSeq:true,width:160,height:32,sourceY:0,img:PreloadImgs.get("anger")});this.showFire=false;this.heart=new Sprite({ticksPerFrame:0,numberOfFrames:5,horzSeq:true,width:200,height:40,sourceY:0,img:PreloadImgs.get("heart")});this.showLove=false;this.openMission=a.openMission;this.idxPattern=a.idxPattern;this.baloonLeft=a.baloonLeft;this.amountPaid=0;this.amountChangeReceived=0;this.amountChangeExpected=0;this.changeReceived=[];this.deliveredItems=[]};Customer.prototype.afterConstruct=function(){this.wishesDrinks=[];this.wishesDrinks=this.wishesDrinks.concat(this.drinks);this.wishesFoods=[];this.wishesFoods=this.wishesFoods.concat(this.foods)};Customer.prototype.randomizeFoodAndDrink=function(){var a=(Math.floor(Math.random()*100)%3);switch(a){case 0:this.drinks=[];break;case 1:this.foods=[];break}};Customer.prototype.update=function(){switch(this.state){case 0:case 1:case 2:this.log.push(["UD"]);case 3:break;case 4:this.log.push(["SC",true]);this.state=50;return;case 50:case 51:case 52:this.log.push(["CD"]);if(this.state==52){this.state=5;return}break;case 5:this.log.push(["SD",false]);this.path=CustOpt.graph.findShortestPath(this.currentNode.id,this.dest.id);break;case 6:if(this.moveToSomePlace()){return}else{break}case 7:this.log.push(["MF",this.currentNode.x,this.currentNode.y,this.currentNode.x,this.currentNode.y,this.currentNode.id]);break;case 8:if(this.drinks.length==this.dUnfulfilled&&this.foods.length==this.fUnfulfilled&&this.openMission){this.state=32}return;case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:this.log.push(["UC",true]);break;case 20:this.log.push(["UC",false]);this.state=8;return;case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:this.log.push(["UF",true]);break;case 31:this.log.push(["UF",false]);this.state=8;return;case 32:this.log.push(["SD",true]);this.path=CustOpt.graph.findShortestPath(this.dest.id,CustOpt.door);break;case 33:if(this.moveToSomePlace()){return}else{break}case 34:case 35:case 36:this.log.push(["UD"]);break;case 37:this.log.push(["SC",false]);this.log.push(["UD"]);this.log.push(["SD",false]);break;case 38:if(this.log.length==0){CustomerManager.removeCustomer(this);if(this.openMission){CustomerManager.createCustomerByPattern(this.idxPattern,CustOpt.door)}}break;case 39:case 41:case 42:case 43:case 44:this.log.push(["UH",true]);break;case 45:this.log.push(["UH",false]);break;case 46:return}this.state++};Customer.prototype.moveToSomePlace=function(){var a=this.path.shift();if(a){a=CustOpt.nodes[a];this.log.push(["MC",this.currentNode.x,this.currentNode.y,a.x,a.y,a.id]);this.currentNode=a;return true}return false};Customer.prototype.animate=function(){var a=this.log.shift();if(a){var b=a.shift();switch(b){case"MF":this.img.frameIndex=0;case"MC":this.changeCustomerPosition(a);break;case"SC":this.showCustomer=a.shift();break;case"SD":this.showDoor=a.shift();break;case"CD":this.door.invert=true;this.door.update();break;case"UD":this.door.invert=false;this.door.update();break;case"UC":this.showCoin=a.shift();this.coin.update();break;case"UF":this.showFire=a.shift();this.fire.update();break;case"UH":this.showLove=a.shift();this.heart.update();break}}};Customer.prototype.changeCustomerPosition=function(a){if(a[2]<a[0]){this.img.sourceY=80}else{if(a[2]>a[0]){this.img.sourceY=160}else{if(a[3]<a[1]){this.img.sourceY=240}else{this.img.sourceY=0}}}this.img.update();this.img.x=a[2];this.img.y=a[3]-this.custHeight;this.reallyCurrentNode=CustOpt.nodes[a[4]]};Customer.prototype.draw=function(b){if(this.showDoor){this.door.draw(b)}if(this.showCustomer){if(this.showFire){b.drawImage(this.imgCustAnger,this.img.x,this.img.y)}else{this.img.draw(b);var e=[];var a=(CustomerManager.randomization.length>0)||(this.hasRandom);var d=(!a)||(Game.runningStatus!==0)||(Game.victory);if(d){for(var c=this.fUnfulfilled;c<this.foods.length;c++){e.push(PreloadImgs.get("$"+this.foods[c].item))}for(var c=this.dUnfulfilled;c<this.drinks.length;c++){e.push(PreloadImgs.get("$"+this.drinks[c].item))}}else{e.push(PreloadImgs.get("duvida"))}if(e.length>0){Baloon.draw(b,this.img.x,this.img.y+20,e,this.baloonLeft)}}}if(this.showCoin){this.coin.draw(b,22,20)}else{if(this.showFire){this.fire.draw(b)}else{if(this.showLove){this.heart.draw(b)}}}};Customer.prototype.askWantHowManyFoods=function(){return this.wishesFoods.length};Customer.prototype.askHowMuchInFoodsIfSell=function(){var a=0;for(var b=0;b<this.wishesFoods.length;b++){a+=this.wishesFoods[b].price}return a};Customer.prototype.askWantHowManyDrinks=function(){return this.wishesDrinks.length};Customer.prototype.askHowMuchInDrinksIfSell=function(){var a=0;for(var b=0;b<this.wishesDrinks.length;b++){a+=this.wishesDrinks[b].price}return a};Customer.prototype.askForDrink=function(){if(this.dUnfulfilled>=this.drinks.length){return null}var a=this.drinks[this.dUnfulfilled];return{type:"order",descr:"$$"+a.item,drinkOrFood:"drink",source:this.currentNode.id,sourceType:this.placeType}};Customer.prototype.hasThirsty=function(){return(this.dUnfulfilled<this.drinks.length)};Customer.prototype.askForFood=function(){if(this.fUnfulfilled>=this.foods.length){return null}var a=this.foods[this.fUnfulfilled];return{type:"order",descr:"$$"+a.item,drinkOrFood:"food",source:this.currentNode.id,sourceType:this.placeType}};Customer.prototype.hasHunger=function(){return(this.fUnfulfilled<this.foods.length)};Customer.prototype.askForIceCream=function(){if(this.fUnfulfilled>=this.foods.length){return null}for(var a=this.fUnfulfilled;a<this.foods.length;a++){var b=this.foods[a];if(b.descr.indexOf("icecreamof")==0){return{type:"order",descr:"$$"+b.item,drinkOrFood:"food",source:this.currentNode.id,sourceType:this.placeType}}}return null};Customer.prototype.askWantHowManyIceCream=function(){var b=0;for(var a=0;a<this.wishesFoods.length;a++){if(this.wishesFoods[a].item.indexOf("icecreamof")===0){b++}}return b};Customer.DELIVERED_BAD=0;Customer.DELIVERED_PARTIAL=1;Customer.DELIVERED_TOTAL=2;Customer.DELIVERED_THANK_YOU=4;Customer.prototype.deliver=function(c){var b=0;var g=Customer.DELIVERED_BAD;var e=null;if(c.source==null){g=Customer.DELIVERED_THANK_YOU;this.showLove=true;this.heart.x=this.img.x+5;this.heart.y=this.img.y-20;this.state=39}else{if((c.type==="item")&&((c.drinkOrFood==="drink"&&(this.dUnfulfilled<this.drinks.length))||(c.drinkOrFood==="food"&&(this.fUnfulfilled<this.foods.length)))){if(c.source===this.currentNode.id){var f=(c.drinkOrFood==="drink"?this.drinks[this.dUnfulfilled]:this.foods[this.fUnfulfilled]);if(c.descr==="$$"+f.item){if(c.drinkOrFood==="drink"){this.dUnfulfilled++}else{this.fUnfulfilled++}g=((this.dUnfulfilled==this.drinks.length)&&(this.fUnfulfilled==this.foods.length)?Customer.DELIVERED_TOTAL:Customer.DELIVERED_PARTIAL)}else{e="Error_deliveredWrongRequest"}}else{e="Error_doesntMatchPosition"}}else{e="Error_deliveredWrongRequest"}if(g===Customer.DELIVERED_TOTAL){var a=function(d){b+=d.price};this.foods.forEach(a);this.drinks.forEach(a);this.showCoin=true;this.coin.x=this.img.x+5;this.coin.y=this.img.y-20;this.state=9}else{if(g==Customer.DELIVERED_BAD){this.showFire=true;this.fire.x=this.img.x+8;this.fire.y=this.img.y-32;this.state=21}}}if(g!=Customer.DELIVERED_BAD){this.deliveredItems.push((c.descr==undefined?c:c.descr))}return{money:b,happy:g,reason:e}};Customer.prototype.totalOfFoodDelivered=function(){return this.fUnfulfilled};Customer.prototype.totalOfDrinksDelivered=function(){return this.dUnfulfilled};Customer.prototype.qtdDeliveredOf=function(b){var a=0;this.deliveredItems.forEach(function(c){if(c.indexOf(b)==0){a++}});return a};Customer.prototype.hasReceivedGift=function(b){for(var a=0;a<this.deliveredItems.length;a++){if(this.deliveredItems[a]===b){return true}}return false};Customer.prototype.hasReceivedItem=function(c,b){if(c==null||c==="food"){for(var a=0;a<this.fUnfulfilled;a++){if(this.foods[a].descr==b){return true}}}if(c==null||c==="drink"){for(var a=0;a<this.dUnfulfilled;a++){if(this.drinks[a].descr==b){return true}}}return false};Customer.typesOfMoney=[10,20];Customer.prototype.cashIn=function(c){var d=this.askHowMuchInDrinksIfSell()+this.askHowMuchInFoodsIfSell();if(this.amountPaid!=0){BlocklyApps.log.push(["fail","Error_alreadyPaid"]);throw false}if(d!=c){BlocklyApps.log.push(["fail","Error_incorrectAccount"]);throw false}if(this.pay==null){var b=[].concat(Customer.typesOfMoney);if(d>10){b.splice(0,1)}var a=Math.floor(Math.random()*b.length);this.amountPaid=b[a]}else{this.amountPaid=parseInt(this.pay)}this.amountChangeExpected=this.amountPaid-d;return{type:"money",descr:"$$banknote"+this.amountPaid,value:this.amountPaid,source:this.currentNode.id,sourceType:this.placeType}};Customer.prototype.isPaid=function(){return this.amountPaid>0};Customer.prototype.isChangeReceived=function(){return this.amountChangeExpected==this.amountChangeReceived};Customer.prototype.isTheBestChange=function(){var b=this.amountChangeExpected;var c=this.limitedChanges;for(var a=0;a<c.length;a++){var g=c[a];var i=Math.floor(b/g);var h=null;var e=function(f){if(f.type==g){h=f.qtd}};this.changeReceived.forEach(e);var d=!(i==0||(h!=null&&h==i));if(d){return false}b-=(i*g)}return true};Customer.prototype.receivedChange=function(b,c){var a=0;b=this.convertMoney(b);this.changeReceived.forEach(function(d){if(d.type===b){a+=d.qtd}});return(c==a)};Customer.prototype.convertMoney=function(b){var a="";switch(b){case'"$$$money20"':a=20;break;case'"$$$money10"':a=10;break;case'"$$$money5"':a=5;break;case'"$$$money2"':a=2;break;case'"$$$money1"':a=1;break}return a};Customer.prototype.giveChange=function(c,d){if(c===undefined||c.data===undefined||isNaN(c.data)){BlocklyApps.log.push(["fail","Error_qtyOfMoneyInvalid"]);throw false}c=parseInt(c.data);var a=0;if(d!=undefined&&d.data!=undefined){a=this.convertMoney(d.data)}if(a==0){BlocklyApps.log.push(["fail","Error_typeOfMoneyInvalid"]);throw false}var b=a*c;if(this.amountChangeReceived+b>this.amountChangeExpected){BlocklyApps.log.push(["fail","Error_changeExceeded"]);throw false}this.amountChangeReceived+=b;this.changeReceived.push({qtd:c,type:a});return this.amountChangeExpected==this.amountChangeReceived};"use strict";var CustomerManager={};var customers=[];PreloadImgs.put("banco","images/banco.png");CustomerManager.init=function(c,b,a,d){this.banco=PreloadImgs.get("banco");this.openMission=c;this.tests=b;this.currentTest=0;this.optCustomers=a;this.randomization=[];if(d!=undefined){this.parseSN(d)}};CustomerManager.nextTest=function(){this.currentTest++;if(this.currentTest==this.tests){return false}customers=[];CustomerManager.createCustomers();return true};CustomerManager.parseSN=function(e){var a=e.getElementsByTagName("randomization");for(var b=0;b<a.length;b++){var d=a[b];var c={};c.qtd=d.getAttribute("qtd");c.type=d.textContent.toString();c.set=d.getAttribute("set");if(c.set==null){c.set="new"}this.randomization[b]=c}};CustomerManager.reset=function(){this.patterns=[];customers=[];this.currentTest=0;var n=this.optCustomers.firstElementChild;while(n!=null){var r=n.getElementsByTagName("init")[0].textContent.toString();if(r==="door"){r=CustOpt.door}else{if(r.indexOf("counter")==0){r=CustOpt.counter[parseInt(r.substring(7))-1]}}var q=n.getElementsByTagName("dest")[0];if(q!=null){q=q.textContent.toString();if(q.indexOf("counter")==0){q={id:CustOpt.counter[parseInt(q.substring(7))-1],type:"counter"}}}var g=n.getElementsByTagName("pay")[0];if(g!=null){g=g.textContent.toString()}var d=n.getElementsByTagName("limitedChanges")[0];if(d==null){d="20, 10, 5, 2, 1"}else{d=d.textContent.toString()}var c=n.getElementsByTagName("id")[0].textContent.toString();var h=n.getElementsByTagName("orders")[0].getElementsByTagName("order");var k=[];for(var j=0;j<h.length;j++){var a=h[j].getAttribute("randomType");var p=h[j].getElementsByTagName("foods")[0];var m=h[j].getElementsByTagName("drinks")[0];var l=CustomerManager.extractItems("food",p,null,a);var b=CustomerManager.extractItems("drink",m,l.length,a);if(a==="random"){var o=CustomerManager.randomOrder(parseInt(h[j].getAttribute("randomMin")),parseInt(h[j].getAttribute("randomMax")),l,b);l=o[0];b=o[1]}var e=p.getAttribute("randomMin");var f=m.getAttribute("randomMin");k.push({hasRandom:a!=null||(e!==null)||(f!==null),randomType:a,foods:l,drinks:b})}if(k.length>0){this.patterns.push({init:r,place:q,id:c,pay:g,limitedChanges:d,pattern:k,idxCustPattern:0})}n=n.nextElementSibling}CustomerManager.createCustomers()};CustomerManager.createCustomers=function(){this.createCustomersBasedOnPattern();this.transformSN();customers.forEach(function(a){a.afterConstruct()})};CustomerManager.transformSN=function(){if(this.randomization.length>0){var d=null;for(var b=0;b<this.randomization.length;b++){var a;if(this.randomization[b].qtd==="random"){a=Math.floor((Math.random()*(customers.length+1)))}else{a=this.randomization[b].qtd}switch(this.randomization[b].set){case"new":d=this.selectCustomers(customers.length-a,[]);break;case"notTheSame":d=this.selectCustomers(customers.length-a,d);break}switch(this.randomization[b].type){case"thirsty":for(var c=0;c<d.length;c++){customers[d[c]].drinks=[]}break;case"hungry":for(var c=0;c<d.length;c++){customers[d[c]].foods=[]}break}}}};CustomerManager.createCustomersBasedOnPattern=function(){for(var b=0;b<this.patterns.length;b++){var a=this.patterns[b].place;var c=false;for(var b=0;b<customers.length;b++){if(customers[b].id===a.id&&customers[b].type===a.type){c=true;break}}if(!c){CustomerManager.createCustomerByPattern(b,this.patterns[b].init)}}};CustomerManager.createCustomerByPattern=function(b,f){var c=b;var a=this.patterns[c].pattern[this.patterns[c].idxCustPattern];this.patterns[c].idxCustPattern=(this.patterns[c].idxCustPattern+1)%this.patterns[c].pattern.length;var e=a.foods;var d=a.drinks;customers.push(new Customer({init:f,place:this.patterns[c].place,id:this.patterns[c].id,hasRandom:a.hasRandom,randomType:a.randomType,foods:e,drinks:d,openMission:this.openMission,idxPattern:c,baloonLeft:customers.length%2==0,pay:this.patterns[c].pay,limitedChanges:this.patterns[c].limitedChanges}))};CustomerManager.selectCustomers=function(d,f){var g=[];var b=0;for(var c=0;c<customers.length;c++){if(f.indexOf(c)==-1){g[b]=c;b++}}var a=[];for(var c=0;c<d;c++){var e=Math.floor((Math.random()*(g.length)));a[c]=g[e];g.splice(e,1)}return a};CustomerManager.randomOrder=function(g,d,f,e){var c=Math.floor((Math.random()*((d-g)+1)))+g;var b=f.length+e.length;while(b>c){var a=Math.floor((Math.random()*(b)));if(a<f.length){f.splice(a,1)}else{e.splice(a-f.length,1)}b--}return[f,e]};CustomerManager.extractItems=function(v,t,q,b){var c=q!=null;var h=t.getAttribute("randomMin");h=parseInt(h==null?"-1":h);if(c&&b==="atLeastOne"&&q==0){h=1}var e=t.getAttribute("differentFromPrevious")==="true";var d=t.getElementsByTagName(v);var k=[];for(var o=0;o<d.length;o++){k[o]=o}if(h>-1){var m=parseInt(t.getAttribute("randomMax"));var r=Math.floor((Math.random()*((m-h)+1)))+h;if(q==0&&r==0){r=1}if(e){for(var p=0;p<customers.length;p++){var n;if(c){n=customers[p].drinks}else{n=customers[p].foods}n.forEach(function(s){for(var i=d.length-1;i>=0;i--){if(d[i].childNodes[0].nodeValue===s.item){k.splice(i,1);break}}})}}while(k.length>r){var f=Math.floor((Math.random()*(k.length)));k.splice(f,1)}}var g=[];for(var o=0;o<k.length;o++){var u=d[k[o]];var l=u.childNodes[0].nodeValue;if(hero.hasMachineFor(l)){var a=parseInt(u.getAttribute("price"));g.push({item:l,price:a})}}return g};CustomerManager.removeCustomer=function(a){var b=customers.indexOf(a);customers.splice(b,1)};CustomerManager.update=function(){for(var a=0;a<customers.length;a++){customers[a].update()}};CustomerManager.animation=function(){for(var a=0;a<customers.length;a++){customers[a].animate()}};CustomerManager.draw=function(b){var e=[true,true,true];for(var d=0;d<customers.length;d++){var a=customers[d].reallyCurrentNode.id;for(var c=0;c<CustOpt.counter.length;c++){if(a===CustOpt.counter[c]){e[c]=false;break}}}CustomerManager.drawCounters(b,e);for(var d=0;d<customers.length;d++){customers[d].draw(b)}};CustomerManager.drawCounters=function(a,c){for(var b=0;b<c.length;b++){if(c[b]){var d=CustOpt.nodes[CustOpt.counter[b]];a.drawImage(this.banco,d.x,d.y-40)}}};CustomerManager.getCustomerCounter=function(b){b=b-1;for(var a=0;a<customers.length;a++){if(customers[a].currentNode.id===CustOpt.counter[b]){return customers[a]}}return null};CustomerManager.getCustomerPosition=function(b){for(var a=0;a<CustOpt.counter.length;a++){if(b===CustOpt.counter[a]){return a+1+" "}}return"0"};CustomerManager.totalOfFood=function(){var a=0;for(var b=0;b<customers.length;b++){a+=customers[b].askWantHowManyFoods()}return a};CustomerManager.totalOfDrink=function(){var a=0;for(var b=0;b<customers.length;b++){a+=customers[b].askWantHowManyDrinks()}return a};CustomerManager.totalOfMoneyIfSell=function(){var a=0;for(var b=0;b<customers.length;b++){a+=customers[b].askHowMuchInFoodsIfSell();a+=customers[b].askHowMuchInDrinksIfSell()}return a};CustomerManager.customerMoneyIfSell=function(a){return customers[a].askHowMuchInFoodsIfSell()+customers[a].askHowMuchInDrinksIfSell()};CustomerManager.totalOfMoneyGave=function(){var a=0;for(var b=0;b<customers.length;b++){if(customers[b].isPaid()){a+=customers[b].amountPaid}else{a-=100}}return a};CustomerManager.customerMoneyGave=function(a){if(customers[a].isPaid()){return customers[a].amountPaid}else{return -100}};CustomerManager.totalOfFoodDelivered=function(){var a=0;for(var b=0;b<customers.length;b++){a+=customers[b].totalOfFoodDelivered()}return a};CustomerManager.totalOfDrinksDelivered=function(){var a=0;for(var b=0;b<customers.length;b++){a+=customers[b].totalOfDrinksDelivered()}return a};CustomerManager.qtdDeliveredOf=function(c){var a=0;for(var b=0;b<customers.length;b++){a+=customers[b].qtdDeliveredOf(c)}return a};"use strict";var Sprite={};Sprite=function(a){this.frameIndex=0;this.tickCount=0;if(a.ticksPerFrame===undefined){this.ticksPerFrame=1}else{this.ticksPerFrame=a.ticksPerFrame}this.numberOfFrames=a.numberOfFrames||1;this.horzSeq=a.horzSeq;this.x=a.x;this.y=a.y;this.sourceX=a.sourceX||0;this.sourceY=a.sourceY||0;this.width=a.width;this.height=a.height;if(a.img){this.image=a.img}else{this.image=new Image();this.image.src=a.imgSrc}this.invert=false};Sprite.prototype.update=function(){this.tickCount+=1;if(this.tickCount>this.ticksPerFrame){this.tickCount=1;if((!this.invert&&this.frameIndex<this.numberOfFrames-1)||(this.invert&&this.frameIndex>0)){if(this.invert){this.frameIndex-=1}else{this.frameIndex+=1}}else{if(this.invert){this.frameIndex=this.numberOfFrames-1}else{this.frameIndex=0}}}};Sprite.prototype.invertDirection=function(){this.invert=!this.invert;this.tickCount=0;this.frameIndex=(this.invert?this.numberOfFrames-1:0)};Sprite.prototype.draw=function(i,a,e){var d=this.numberOfFrames;var b=this.frameIndex;var g,f,h,c;if(this.horzSeq){g=b*this.width/d;f=this.sourceY;h=this.width/d;c=this.height;if(a===undefined){a=this.width/d;e=this.height}}else{g=this.sourceX;f=b*this.height/d;h=this.width;c=this.height/d;if(a===undefined){a=this.width;e=this.height/d}}i.drawImage(this.image,g,f,h,c,this.x,this.y,a,e)};"use strict";NoBugsInterpreter.prototype=new Interpreter;NoBugsInterpreter.prototype.constructor=NoBugsInterpreter;NoBugsInterpreter.prototype.parent=Interpreter.prototype;function NoBugsInterpreter(b,a){this.creatingScope=false;this.variables=[];this.base=Interpreter;this.base(b,a)}NoBugsInterpreter.prototype.populateScope_=function(b,a){this.creatingScope=true;this.parent.populateScope_.call(this,b,a);this.creatingScope=false};NoBugsInterpreter.prototype.setProperty=function(e,b,d,a,c){this.parent.setProperty.call(this,e,b,d,a,c);if(this.creatingScope){this.scope=e;this.variables.push({scope:e,name:b})}};"use strict";var NoBugsJavaScript={};NoBugsJavaScript.oldVarSet=null;NoBugsJavaScript.oldLogicCompare=null;NoBugsJavaScript.varName=null;NoBugsJavaScript.oldMathArith=null;NoBugsJavaScript.typeComparison="function nobugsComparison(arg0, arg1, operator) {if (arg0.type != undefined ) {arg0 = arg0.descr; } else if (arg1.type != undefined) {arg1 = arg1.descr;}var OPERATORS={'EQ': '==','NEQ': '!=','LT': '<','LTE': '<=','GT': '>','GTE': '>='};return eval(arg0 + ' ' + OPERATORS[operator] + ' ' + arg1);};";NoBugsJavaScript.redefine=function(){Blockly.Msg.CONTROLS_IF_MSG_THEN=BlocklyApps.getMsg("Blockly_ifThen");if(NoBugsJavaScript.oldVarSet==null){NoBugsJavaScript.oldVarSet=Blockly.JavaScript.variables_set;Blockly.JavaScript.variables_set=NoBugsJavaScript.newVarSet;NoBugsJavaScript.oldMathArith=Blockly.JavaScript.math_arithmetic;Blockly.JavaScript.math_arithmetic=NoBugsJavaScript.newMathArith}if(NoBugsJavaScript.oldLogicCompare==null){NoBugsJavaScript.oldLogicCompare=Blockly.JavaScript.logic_compare;Blockly.JavaScript.logic_compare=NoBugsJavaScript.newLogicCompare}if(NoBugsJavaScript.oldLogicOperation==null){NoBugsJavaScript.oldLogicOperation=Blockly.JavaScript.logic_operation;Blockly.JavaScript.logic_operation=NoBugsJavaScript.newLogicOperation}};NoBugsJavaScript.newVarSet=function(b){var a=NoBugsJavaScript.oldVarSet(b);return'NoBugsJavaScript.varName="'+b.getFieldValue("VAR")+'";\n'+a+"\nNoBugsJavaScript.varName=null;\n"};NoBugsJavaScript.ARITH_OPERATORS={ADD:[" + ",Blockly.JavaScript.ORDER_ADDITION],MINUS:[" - ",Blockly.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.JavaScript.ORDER_DIVISION],POWER:[null,Blockly.JavaScript.ORDER_COMMA]};NoBugsJavaScript.newMathArith=function(g){var f="";if(g.inputList[0].connection.targetConnection!=null&&g.inputList[0].connection.targetConnection.sourceBlock_.type==="variables_get"){f='"'+g.inputList[0].connection.targetConnection.sourceBlock_.inputList[0].fieldRow[0].text_+'"'}if(g.inputList[1].connection.targetConnection!=null&&g.inputList[1].connection.targetConnection.sourceBlock_.type==="variables_get"){f=f+(f===""?"":",")+'"'+g.inputList[1].connection.targetConnection.sourceBlock_.inputList[0].fieldRow[0].text_+'"'}var b=g.getFieldValue("OP");var a=NoBugsJavaScript.ARITH_OPERATORS[b][1];var e=Blockly.JavaScript.valueToCode(g,"A",a)||"0";var d=Blockly.JavaScript.valueToCode(g,"B",a)||"0";var c='nobugsMathArith(%0, %1, "%2")'.format(e,d,b);return["(verifyMathArithVariable(["+f+"])?"+c+":null)",Blockly.JavaScript.ORDER_FUNCTION_CALL]};function nobugsMathArith(arg0,arg1,operator){operator=NoBugsJavaScript.ARITH_OPERATORS[(operator.data==null?operator:operator.data)][0];if(isNaN(parseInt(arg0))){arg0=arg0.data;if(arg0==undefined){BlocklyApps.log.push(["fail","Error_variableDoesntInitialized"]);throw false}if(arg0.type!=undefined){arg0=arg0.value}}if(isNaN(parseInt(arg1))){arg1=arg1.data;if(arg1==undefined){BlocklyApps.log.push(["fail","Error_variableDoesntInitialized"]);throw false}if(arg1.type!=undefined){arg1=arg1.value}}if(arg0==undefined||arg1==undefined){BlocklyApps.log.push(["fail","Error_onceVariableIsNotANumber"]);throw false}if(!operator){var code="Math.pow("+arg0+", "+arg1+")";return eval(code)}else{if(operator===NoBugsJavaScript.ARITH_OPERATORS.DIVIDE[0]){return eval("Math.floor("+arg0+" / "+arg1+")")}}return eval(arg0+" "+operator+" "+arg1)}NoBugsJavaScript.OPERATORS={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="};NoBugsJavaScript.newLogicCompare=function(f){var g=f.getFieldValue("OP");var b=NoBugsJavaScript.OPERATORS[g];var a=(b=="=="||b=="!=")?Blockly.JavaScript.ORDER_EQUALITY:Blockly.JavaScript.ORDER_RELATIONAL;var e=Blockly.JavaScript.valueToCode(f,"A",a)||"0";var d=Blockly.JavaScript.valueToCode(f,"B",a)||"0";var c='nobugsComparison(%0, %1, "%2")'.format(e,d,g);return[c,a]};function nobugsComparison(arg0,arg1,operator){if(hero!==null&&hero!==undefined){hero.verifyObjectives("useBlock","logic_compare")}operator=NoBugsJavaScript.OPERATORS[(operator.data==null?operator:operator.data)];if(!isNaN(parseInt(arg0))){return eval(arg0+" "+operator+" "+arg1)}if(arg0===true||arg0===false||arg0==="true"||arg0==="false"){return eval(arg0+" "+operator+" "+arg1)}arg0=arg0.data;arg1=arg1.data;if(arg0==undefined||arg1==undefined){BlocklyApps.log.push(["fail","Error_variableDoesntInitialized"]);throw false}if(arg0.type!=undefined){arg0='"'+arg0.descr+'"'}else{if(arg1.type!=undefined){arg1='"'+arg1.descr+'"'}}var ret=eval(arg0+" "+operator+" "+arg1);return ret}NoBugsJavaScript.verifyLogicOperation=function(){if(hero!==null&&hero!==undefined){hero.verifyObjectives("useBlock","logic_operation")}return true};NoBugsJavaScript.newLogicOperation=function(b){var a=NoBugsJavaScript.oldLogicOperation(b);a[0]="(verifyLogicOperation() && "+a[0]+")";return a};"use strict";function loadMission(c){var a=new window.XMLHttpRequest();a.open("GET",c,false);a.setRequestHeader("Content-Type","text/xml");a.send("");var b=a.responseXML;return b}function transformStrToXml(a){if(window.DOMParser){return(new window.DOMParser()).parseFromString(a,"text/xml")}else{if(typeof window.ActiveXObject!="undefined"&&new window.ActiveXObject("Microsoft.XMLDOM")){var b=new window.ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(xmlStr);return b}else{return null}}};"use strict";function findVariable(){var c=Game.jsInterpreter.variables;var a=c[0].scope.properties.NoBugsJavaScript.properties.varName.data;for(var b=1;b<c.length;b++){if(c[b].name===a){return c[b].scope.properties[a].data}}return null}var Objective={factories:[]};Objective.init=function(b,a){return{objective:b.childNodes[0].nodeValue,notExists:b.getAttribute("notExists"),achieved:false,trata:a}};Objective.verifyObjectives=function(e,c){if((hero.allObjectivesAchieved||(hero.objective.debug&&Game.runningStatus!=2))){return false}if(e==="notExists"){Objective.notExists();return}var b=Objective.factory(e);var a=false;if(hero.objective.ordered){if(!hero.objective.objectives[hero.lastObjectiveAchieved+1].objective===e){return false}if(hero.objective.objectives[hero.lastObjectiveAchieved+1].notExists==="true"){return false}if(b.checkObjective(c,hero.objective.objectives[hero.lastObjectiveAchieved+1])){Objective.markAchieved(hero.objective.objectives[hero.lastObjectiveAchieved+1]);return true}}else{for(var d=0;d<hero.objective.objectives.length;d++){if(hero.objective.objectives[d].objective===e&&!hero.objective.objectives[d].achieved){if(hero.objective.objectives[d].notExists==null&&b.checkObjective(c,hero.objective.objectives[d])){Objective.markAchieved(hero.objective.objectives[d]);if((e==="deliver"||e==="giveTheWholeChange"||e==="giveSomeChange")&&c.allCustomers){a=true}else{return true}}}}}return a};Objective.notExists=function(){for(var a=0;a<hero.objective.objectives.length;a++){if(hero.objective.objectives[a].notExists==="true"){Objective.markAchieved(hero.objective.objectives[a])}}};Objective.markAchieved=function(a){a.achieved=true;hero.lastObjectiveAchieved++;hero.allObjectivesAchieved=(hero.lastObjectiveAchieved+1)==hero.objective.objectives.length};Objective.factory=function(a){var b=this.factories[a];if(b!=undefined){return b}switch(a){case"goesTo":this.factories[a]=new Objective.Counter();break;case"askForFood":this.factories[a]=new Objective.AskForFood();break;case"pickUpFood":this.factories[a]=new Objective.PickUpFood();break;case"askHasHunger":this.factories[a]=new Objective.AskSomething("explanation_askHasHunger");break;case"askForDrink":this.factories[a]=new Objective.AskSomething("explanation_askForDrink");break;case"askWantHowManyFoods":this.factories[a]=new Objective.AskSomething("explanation_askWantHowManyFoods");break;case"askWantHowManyDrinks":this.factories[a]=new Objective.AskSomething("explanation_askWantHowManyDrinks");break;case"askForIceCream":this.factories[a]=new Objective.AskSomething("explanation_askForIceCream");break;case"askWantHowManyIceCream":this.factories[a]=new Objective.AskSomething("explanation_askWantHowManyIceCream");break;case"pickUpDrink":this.factories[a]=new Objective.PickUpDrink();break;case"askHasThirsty":this.factories[a]=new Objective.AskSomething("explanation_askHasThirsty");break;case"deliver":this.factories[a]=new Objective.Deliver();break;case"deliverGifts":this.factories[a]=new Objective.DeliverGifts();break;case"customDeliver":this.factories[a]=new Objective.CustomDeliver();break;case"varQtd":this.factories[a]=new Objective.VarQtd();break;case"commQtd":this.factories[a]=new Objective.CommsQtd();break;case"talk":this.factories[a]=new Objective.Talk();break;case"cashIn":this.factories[a]=new Objective.CashIn();break;case"giveTheWholeChange":this.factories[a]=new Objective.GiveTheWholeChange();break;case"giveSomeChange":this.factories[a]=new Objective.GiveSomeChange();break;case"useBlock":this.factories[a]=new Objective.UseBlock();break}return this.factories[a]};Objective.createExplanationItemPlacePos=function(f,d,c,a){var b=BlocklyApps.getMsg("_"+d.place);var e=BlocklyApps.getMsg(f);return e.format(b+" "+d.pos,c,a)};Objective.Counter=function(){};Objective.Counter.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");return b};Objective.Counter.prototype.checkObjective=function(a,b){var c=hero.counter[b.pos-1];if(a.nx==c.x&&a.ny==c.y){return true}return false};Objective.Counter.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_counter");return b.format(a.pos)};Objective.AskForFood=function(){};Objective.AskForFood.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.distinct=a.getAttribute("distinct")==="true";return b};Objective.AskForFood.prototype.checkObjective=function(c,b){if(b.distinct){var a=findVariable();if(a!=undefined){return false}}if(b.place==="counter"){if(c.currentNode.id===CustOpt.counter[b.pos-1]){return true}}return false};Objective.AskForFood.prototype.createExplanationItem=function(a){if(a.distinct){return Objective.createExplanationItemPlacePos("explanation_askForFoodDistinctVar",a)}return Objective.createExplanationItemPlacePos("explanation_askForFood",a)};Objective.CatchSomething=function(a){this.key=a};Objective.CatchSomething.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.CatchSomething.prototype.checkObjective=function(c,b){var d=null;if(b.place==="counter"){d=CustomerManager.getCustomerCounter(b.pos)}if(d==null){return false}var a=this.askSomething(d);return c.descr===a.descr};Objective.CatchSomething.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos(this.key,a)};Objective.CatchSomething.prototype.askSomething=function(a){return{descr:"nothing"}};Objective.PickUpFood=function(){Objective.CatchSomething.call(this,"explanation_catchFood")};inherits(Objective.CatchSomething,Objective.PickUpFood);Objective.PickUpFood.prototype.askSomething=function(a){return a.askForFood()};Objective.PickUpDrink=function(){Objective.CatchSomething.call(this,"explanation_catchDrink")};inherits(Objective.CatchSomething,Objective.PickUpDrink);Objective.PickUpDrink.prototype.askSomething=function(a){return a.askForDrink()};Objective.AskSomething=function(a){Objective.AskForFood.call(this);this.keyExplanation=a};inherits(Objective.AskForFood,Objective.AskSomething);Objective.AskSomething.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos(this.keyExplanation,a)};Objective.AskForDrink=function(){Objective.AskForFood.call(this)};inherits(Objective.AskForFood,Objective.AskForDrink);Objective.AskForDrink.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_askForDrink",a)};Objective.AskHasThirsty=function(){Objective.AskForFood.call(this)};inherits(Objective.AskForFood,Objective.AskHasThirsty);Objective.AskHasThirsty.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_askHasThirsty",a)};Objective.Deliver=function(){};Objective.Deliver.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.Deliver.prototype.checkObjective=function(a,b){var c=null;if(b.place==="counter"){if(a.allCustomers){c=CustomerManager.getCustomerCounter(b.pos)}else{if(a.customer.currentNode.id===CustOpt.counter[b.pos-1]){c=a.customer}}}if(c==null){return false}return !(c.hasThirsty()||c.hasHunger())};Objective.Deliver.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_deliver",a)};Objective.DeliverGifts=function(){};Objective.DeliverGifts.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.value=a.getAttribute("value");b.gift=a.getAttribute("gift");return b};Objective.DeliverGifts.prototype.checkObjective=function(options,objective){var cust=null;if(objective.place==="counter"){if(options.allCustomers){cust=CustomerManager.getCustomerCounter(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.counter[objective.pos-1]){cust=options.customer}}}if(cust==null){return false}var typeOfGift=eval(objective.value);return(cust.hasReceivedGift(typeOfGift))};Objective.DeliverGifts.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_delivergifts",a,a.gift)};Objective.CustomDeliver=function(){};Objective.CustomDeliver.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.value=a.getAttribute("value");b.text=a.getAttribute("text");return b};Objective.CustomDeliver.prototype.checkObjective=function(options,objective){var cust=null;if(objective.place==="counter"){if(options.allCustomers){cust=CustomerManager.getCustomerCounter(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.counter[objective.pos-1]){cust=options.customer}}}if(cust==null){return false}var typeOfItem=eval(objective.value);var foodOrDrink=null;var itemId=typeOfItem;if(typeOfItem.indexOf("#")>0){var ti=typeOfItem.split("#");foodOrDrink=ti[0];itemId=ti[1]}return(cust.hasReceivedItem(foodOrDrink,itemId))};Objective.CustomDeliver.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_customdeliver",a,a.text)};Objective.CashIn=function(){};Objective.CashIn.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.CashIn.prototype.checkObjective=function(a,b){var c=null;if(b.place==="counter"){if(a.allCustomers){c=CustomerManager.getCustomerCounter(b.pos)}else{if(a.customer.currentNode.id===CustOpt.counter[b.pos-1]){c=a.customer}}}if(c==null){return false}return(c.isPaid())};Objective.CashIn.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_cashin",a)};Objective.GiveTheWholeChange=function(){};Objective.GiveTheWholeChange.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.GiveTheWholeChange.prototype.checkObjective=function(a,b){var c=null;if(b.place==="counter"){if(a.allCustomers){c=CustomerManager.getCustomerCounter(b.pos)}else{if(a.customer.currentNode.id===CustOpt.counter[b.pos-1]){c=a.customer}}}if(c==null){return false}return(c.isPaid()&&c.isChangeReceived()&&c.isTheBestChange())};Objective.GiveTheWholeChange.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_givethewholechange",a)};Objective.GiveSomeChange=function(){};Objective.GiveSomeChange.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.type=a.getAttribute("type");b.qtd=a.getAttribute("qtd");return b};Objective.GiveSomeChange.prototype.checkObjective=function(options,objective){var cust=null;if(objective.place==="counter"){if(options.allCustomers){cust=CustomerManager.getCustomerCounter(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.counter[objective.pos-1]){cust=options.customer}}}if(cust==null){return false}var q=eval(objective.qtd);return(cust.isPaid()&&cust.receivedChange('"'+objective.type+'"',q))};Objective.GiveSomeChange.prototype.createExplanationItem=function(c){var b="",a="";if(c.type==="$$$money20"){b="_banknotes";a=20}else{if(c.type==="$$$money10"){b="_banknotes";a=10}else{if(c.type==="$$$money5"){b="_banknotes";a=5}else{if(c.type==="$$$money2"){b="_coins";a=2}else{b="_coins";a=1}}}}return Objective.createExplanationItemPlacePos("explanation_givesomechange",c,BlocklyApps.getMsg(b),a)};Objective.VarQtd=function(){};Objective.VarQtd.prototype.init=function(b){var a={objective:"varQtd",achieved:false,trata:this};a.qtd=b;return a};Objective.VarQtd.prototype.checkObjective=function(a,b){return(Game.jsInterpreter.variables.length-1)<=b.qtd};Objective.VarQtd.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_varQtd");return b.format(a.qtd)};Objective.CommsQtd=function(){};Objective.CommsQtd.prototype.init=function(b){var a={objective:"commQtd",achieved:false,trata:this};a.qtd=b;return a};Objective.CommsQtd.prototype.checkObjective=function(a,b){var c=Game.countInstructions(Blockly.mainWorkspace.getTopBlocks());return c<=b.qtd};Objective.CommsQtd.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_commsQtd");return b.format(a.qtd)};Objective.Talk=function(){};Objective.Talk.prototype.init=function(a){var b=Objective.init(a,this);b.text=a.getAttribute("text");b.value=a.getAttribute("value");return b};Objective.Talk.prototype.checkObjective=function(options,objective){var value=eval(objective.value);return value===options.data};Objective.Talk.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_talk");return b.format(a.text)};Objective.UseBlock=function(){};Objective.UseBlock.prototype.init=function(a){var b=Objective.init(a,this);b.type=a.getAttribute("type");return b};Objective.UseBlock.prototype.checkObjective=function(a,b){return(b.type===a)};Objective.UseBlock.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_useblock");return b.format(BlocklyApps.getMsg("descr_"+a.type))};"use strict";var Questionnaire={};Questionnaire.createForm=function(questionnaire){var form=document.createElement("form");var div=document.createElement("div");div.style.height="480px";div.style.overflow="scroll";div.id="questions";var table=document.createElement("table");div.appendChild(table);form.appendChild(div);var input=document.createElement("input");var questionNumber=1;var missions=Game.loginData.missionHist;for(var j=0;j<questionnaire.length;j++){if(missions!=null&&questionnaire[j].showRules!=null){Game.finishedMissionId=0;for(var i=missions.length-1;i>=0;i--){if(questionnaire[j].classId==missions[i][4]){Game.finishedMissionId+=missions[i][3]}}var condition=eval(questionnaire[j].showRules);if(!condition){continue}}var trQ=document.createElement("tr");var tdQ=document.createElement("td");tdQ.className="questionnaireDiv";trQ.appendChild(tdQ);tdQ.innerHTML=questionnaire[j].description;table.appendChild(trQ);for(var i=0;i<questionnaire[j].questions.length;i++){var tr=document.createElement("tr");if(questionnaire[j].questions[i].type[0].toUpperCase()!="L"){tr.setAttribute("questionId",questionnaire[j].questions[i].id)}var td=document.createElement("td");tr.appendChild(td);if(questionnaire[j].questions[i].type[0].toUpperCase()!="L"){td.innerHTML="<b>"+(questionNumber++)+"</b> - "+questionnaire[j].questions[i].description}else{td.innerHTML="<b>"+(questionNumber++)+"</b> - "}td=document.createElement("td");tr.appendChild(td);table.appendChild(tr);tr=document.createElement("tr");if(questionnaire[j].questions[i].type[0].toUpperCase()!="L"){tr.setAttribute("questionId",questionnaire[j].questions[i].id)}td=document.createElement("td");switch(questionnaire[j].questions[i].type[0].toUpperCase()){case"N":input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="number";input.min="0";input.max="130";input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype",questionnaire[j].questions[i].type[0].toUpperCase());input.onkeypress=function(event){return((event.charCode>=48&&event.charCode<=57)||event.charCode==0)};input.addEventListener("change",Questionnaire.closeDrop,false);td.appendChild(input);break;case"S":var identifier="a";for(var x=0;x<questionnaire[j].questions[i].options.length;x++){input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="radio";input.value=questionnaire[j].questions[i].options[x].value;input.id=questionnaire[j].id+"_"+questionnaire[j].questions[i].id+"_"+x;input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype",questionnaire[j].questions[i].type[0].toUpperCase());input.addEventListener("change",Questionnaire.closeDrop,false);var label=document.createElement("label");label.innerHTML=identifier+") ";identifier=Questionnaire.nextChar(identifier);td.appendChild(label);td.appendChild(input);label=document.createElement("label");label.htmlFor=input.id;label.innerHTML=questionnaire[j].questions[i].options[x].description;td.appendChild(label);var br=document.createElement("br");td.appendChild(br)}break;case"T":if(questionnaire[j].questions[i].type.length==1){input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="text";input.style.width="100%";input.maxLength="150";input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.addEventListener("change",Questionnaire.closeDrop,false);input.setAttribute("qtype","T");td.appendChild(input)}else{var cont=questionnaire[j].questions[i].type.substring(1,questionnaire[j].questions[i].type.length);var identifier="a";var maxLen=Math.floor(150/cont);for(var x=0;x<cont;x++){input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="text";input.style.width="300px";input.maxLength=maxLen;input.style.marginTop="5px";input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype","T");input.addEventListener("change",Questionnaire.closeDrop,false);var label=document.createElement("label");label.innerHTML=identifier+") ";identifier=Questionnaire.nextChar(identifier);td.appendChild(label);td.appendChild(input);var br=document.createElement("br");td.appendChild(br)}}break;case"L":var box=document.createElement("table");box.style.borderWidth="1px";box.style.borderCollapse="collapse";box.border="1";var boxHead=document.createElement("thead");var boxTr=document.createElement("tr");var boxTd=document.createElement("td");boxTr.appendChild(boxTd);var options=questionnaire[j].questions[i].options;if(questionnaire[j].questions[i].options!=null){for(var x=0;x<questionnaire[j].questions[i].options.length;x++){boxTd=document.createElement("th");boxTd.style.textAlign="center";boxTd.style.padding="5px";boxTd.innerHTML=questionnaire[j].questions[i].options[x].description;boxTr.appendChild(boxTd);boxHead.appendChild(boxTr)}}var boxBody=document.createElement("tbody");while(i<questionnaire[j].questions.length&&questionnaire[j].questions[i].type[0].toUpperCase()==="L"){boxTr=document.createElement("tr");boxTr.setAttribute("questionId",questionnaire[j].questions[i].id);boxTd=document.createElement("td");boxTd.innerHTML=questionnaire[j].questions[i].description;boxTd.style.padding="5px";boxTr.appendChild(boxTd);for(var x=0;x<options.length;x++){boxTd=document.createElement("td");boxTd.style.textAlign="center";input=document.createElement("input");input.type="radio";input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype",questionnaire[j].questions[i].type[0].toUpperCase());input.addEventListener("change",Questionnaire.closeDrop,false);input.id=questionnaire[j].id+"_"+questionnaire[j].questions[i].id+"_"+x;input.value=options[x].value;boxTd.appendChild(input);boxTr.appendChild(boxTd);boxBody.appendChild(boxTr)}i++}i--;box.appendChild(boxHead);box.appendChild(boxBody);td.appendChild(box);break;default:}tr.appendChild(td);table.appendChild(tr)}}if(questionNumber==1){return null}else{return form}};Questionnaire.closeDrop=function(){if(Questionnaire.drop!=null&&Questionnaire.drop!=undefined){Questionnaire.drop.remove();Questionnaire.drop=null}};Questionnaire.nextChar=function(a){return String.fromCharCode(a.charCodeAt(0)+1)};Questionnaire.handlingQuestionnaire=function(a){var e=document.getElementsByClassName("answer");var h=[];for(var d=0;d<e.length;d++){var k=e[d];var j=k.name.split("_")[0];var b=k.name.split("_")[1];switch(k.getAttribute("qtype").toUpperCase()){case"N":h.push([j,b,k.value]);break;case"L":case"S":var g=document.getElementsByName(k.name);for(var f=0;f<g.length;f++){if(g[f].checked){h.push([j,b,g[f].value])}if(f!=g.length-1){d++}}break;case"T":var g=document.getElementsByName(k.name);var c="";for(var f=0;f<g.length;f++){if(g[f].value!=""){c=c+"<answer><![CDATA["+g[f].value+"]]></answer>"}if(f!=g.length-1){d++}}if(c.length>0){h.push([j,b,c])}break;default:}}a(h)};Questionnaire.consistQuestionnaire=function(){Questionnaire.closeDrop();var c=false;var d=document.getElementsByClassName("answer");for(var b=0;b<d.length;b++){var n=d[b];var m=n.name.split("_")[0];var a=n.name.split("_")[1];var k=false;var l=n.getAttribute("qtype").toUpperCase();switch(l){case"N":if(n.getAttribute("questionrequired").toUpperCase()=="TRUE"){if(n.value!=""){k=true}}else{k=true}break;case"L":case"S":var j=document.getElementsByName(n.name);if(j[0].getAttribute("questionrequired").toUpperCase()=="TRUE"){for(var g=0;g<j.length;g++){if(j[g].checked){k=true}if(g!=j.length-1){b++}}}else{k=true}break;case"T":var j=document.getElementsByName(n.name);if(j[0].getAttribute("questionrequired").toUpperCase()=="TRUE"){for(var g=0;g<j.length;g++){if(j[g].value==""){break}if(g!=j.length-1){b++}k=true}}else{k=true}break}if(!k){c=true;var e=Questionnaire.getTrsByQuestionId(a);for(var g=0;g<e.length;g++){e[g].style.color="red"}var f=Questionnaire.getInputByQuestionId(a);f.focus();if(f.type=="radio"){if((f.labels!=undefined&&f.labels.length>0)||(f.previousElementSibling!=null&&f.previousElementSibling.nodeName.toUpperCase()=="LABEL")){f=f.parentElement}else{f=Questionnaire.getTrsByQuestionId(a)[0].childNodes[0]}}Questionnaire.drop=new Drop({target:f,content:BlocklyApps.getMsg("NoBugs_requiredField"),position:"left middle",classes:"drop-theme-arrows",openOn:""});Questionnaire.drop.open();return}else{var h=Questionnaire.getTrsByQuestionId(a);for(var g=0;g<h.length;g++){h[g].style.color="black"}}}return !c};Questionnaire.getTrsByQuestionId=function(a){var d=[];var c=document.getElementsByTagName("tr");for(var b=0;b<c.length;b++){if(c[b].getAttribute("questionId")==a){d.push(c[b])}}return d};Questionnaire.getInputByQuestionId=function(a){var c=document.getElementsByClassName("answer");for(var b=0;b<c.length;b++){if(c[b].getAttribute("questionId")==a){return c[b]}}return null};"use strict";var VariableNames={};var regex=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|null|this|true|void|with|break|catch|class|const|false|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[\x24A-Z\x5Fa-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC][\x240-9A-Z\x5Fa-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0\u08A2-\u08AC\u08E4-\u08FE\u0900-\u0963\u0966-\u096F\u0971-\u0977\u0979-\u097F\u0981-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C01-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C82\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191C\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1D00-\u1DE6\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA697\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7B\uAA80-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE26\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]*$/;VariableNames.validate=function(b){var d=[];var c=Blockly.JavaScript.workspaceToCode(Blockly.mainWorkspace);a();return regex.test(b)&&d.indexOf(b)==-1;function a(){while(c.length>0){if(c.indexOf("var ")>-1){c=c.substring(c.indexOf("var "));var e=c.substring(0,c.indexOf(";"));d.push(e.substring("var".length).trim());c=c.substring(c.indexOf(";")+1)}else{c=""}}}};"use strict";var Selector={};Selector=function(e,f,b,l,d,c,g,a,k,h,j,i){this.data=e;this.clickTarget=k;this.genContent=h;this.enabledCssClass=d;this.disabledCssClass=c;this.generalTabCss=g;this.tabCss=a;this.fMissionEnabled=j;this.fMissionTarget=i;this.width=b;this.height=l;this.tamCell=f};Selector.prototype.build=function(){var f=this.data;if(document.getElementById("tt0")!=null){$("#tt0").remove()}var l=0;for(var g=0;g<f.length;g++){var p=true;var q="body";var h="tt"+g;var k=$('<div id = "'+h+'"/>').addClass("tab-container").appendTo(q);var m=$("<ul>").addClass(this.generalTabCss).appendTo(k);var c="";for(var e=0;e<f[g].levels.length;e++){var b="selectMissionPanel"+g+e;var a=$('<div id = "'+b+'"/>').addClass("selectMissionPanel").appendTo(k);var d=parseInt(f[g].levels[e].howManyItems);var o=parseInt((p?f[g].levels[e].howManyItemsAchieved:"-1"));var n=$('<li id = "l'+b+'"/>').addClass(this.tabCss).appendTo(m);$("<a/>").attr("href","#"+b).appendTo(n).html(f[g].levels[e].name);if(o<d&&p){c="li#l"+b}f[g].levels[e].lastAllAchieved=p;this.createGridView(g,e,"#"+b,d,o,f[g].groupId,f[g].levels[e].id);p=o==d;l=this.width}$("#"+h).easytabs({defaultTab:c,updateHash:false})}return("tt0")};Selector.prototype.createGridView=function(m,b,j,g,c,e,k){var d=5;for(var f=1;f<=g;f++){var n=Math.floor((f-1)/d);var h=(f-1)%d;var a=$("<div />").attr("id","mission_l"+k+"_m"+f).attr("idgroup",e).attr("iditem",f).attr("idlevel",k).addClass("gridViewChild").addClass("missionSquare").css("height",this.tamCell).css("width",this.tamCell).css("left",(35*h)+10+(h*this.tamCell)).css("top",(35*n)+60+(n*this.tamCell)).html(this.genContent(f));if(this.fMissionEnabled(m,b,f)){a.addClass(this.enabledCssClass);a.addClass("missionEnabled")}else{if(this.fMissionTarget(m,b,f)){a.addClass(this.disabledCssClass);a.addClass("missionTarget");a.addClass("missionTargetFlat")}else{a.addClass(this.disabledCssClass);a.addClass("missionDisabled")}}$(j).append(a)}$(".missionTarget").unbind("click").click(this.clickTarget)};var Baloon={};Baloon.draw=function(l,k,j,e,d){if(l){var h=0,m=0;var c,b,a;if(d){c="baloon_1";b="baloon_2";a="baloon_3";h=k-32}else{c="baloonr_1";b="baloonr_2";a="baloonr_3";h=k+32;m=2}var g=j-30;switch(e.length){case 1:l.drawImage(PreloadImgs.get(c),h,g);l.drawImage(e[0],h+m+5,g+5,20,20);break;case 2:l.drawImage(PreloadImgs.get(b),h,g);for(var f=0;f<e.length;f++){l.drawImage(e[f],h+m+6,g+2+(18*f),18,18)}break;case 3:l.drawImage(PreloadImgs.get(a),h,g);if(d){h+=3}else{h+=10}for(var f=0;f<e.length;f++){l.drawImage(e[f],h+m+5,g+2+(16*f),16,16)}break}}};"use strict";var leaderBoardCreated=false;var version=0;function addTooltip(){if(leaderBoardCreated){return}new Tooltip({target:document.getElementById("leaderpoints"),position:"top left",content:BlocklyApps.getMsg("Tooltip_TabMoney")});new Tooltip({target:document.getElementById("leadertime"),position:"top left",content:BlocklyApps.getMsg("Tooltip_TabTime")});new Tooltip({target:document.getElementById("leaderruns"),position:"top left",content:BlocklyApps.getMsg("Tooltip_TabRun")})}function createTable(a){a.ingrid({height:250,paging:false,resizableCols:false,sorting:false,gridClass:"leaderboard-table",headerClass:"leaderboard-table-header",colWidths:[25,74,140],colClasses:["leaderboard-table-col-position","leaderboard-table-col-picture","leaderboard-table-col-name"]})}function populateLBTables(c,d){var a=$("<tbody/>");var b=1;d.forEach(function(g){var h=$("<tr id = "+c+"_"+g.id+"/>");h.append($("<td>").html(b));h.append($("<td>").html("<img height='64px' src='userPhoto?u="+g.id+"&v="+version+"'/>"));h.append($("<td>").html(g.name+"<br/>"+g.value));a.append(h);b++});var e=$("<table id = "+c+"/>");var f=$("<tr/>");f.append($("<th/>"));f.append($("<th/>"));f.append($("<th/>"));e.append($("<thead/>").append(f));e.append(a);return e}function goToLine(a,b){$(a+" .mCustomScrollbar").mCustomScrollbar("scrollTo",$(b),{scrollInertia:0})}function highlightCurrentUser(a){$(a).addClass("leaderboard-row-me")}function createsLeaderBoard(){version++;addTooltip();var b=Game.loginData.leaderBoard;var e=[],d=[],a=[];b.forEach(function(j){e.push({id:j[0],name:j[1],value:j[2]});var i=j[3];var f=Math.floor(i/60);i=i-(f*60);var g;if(f>60){g=Math.floor(f/60);f=f-(g*60);g=g+"h "}else{g=""}d.push({id:j[0],name:j[1],value:g+addZeros(f,2)+"min "+addZeros(i,2)+"s",missionDone:j[5],timeSeconds:j[3]});a.push({id:j[0],name:j[1],value:j[4],missionDone:j[5]})});e.sort(function(g,f){return f.value-g.value});d.sort(function(g,f){var h=f.missionDone-g.missionDone;if(h==0){return g.timeSeconds-f.timeSeconds}else{return h}});a.sort(function(g,f){var h=f.missionDone-g.missionDone;if(h==0){return g.value-f.value}else{return h}});if(leaderBoardCreated){$("#tabs-points").empty();$("#tabs-time").empty();$("#tabs-runs").empty()}$("#tabs-points").append(populateLBTables("table_points",e));$("#tabs-time").append(populateLBTables("table_time",d));$("#tabs-runs").append(populateLBTables("table_runs",a));var c="#table_points_"+Game.loginData.userLogged.id;$("#tabs-points").attr("rowId",c);$("#tabs-time").attr("rowId","#table_time_"+Game.loginData.userLogged.id);$("#tabs-runs").attr("rowId","#table_runs_"+Game.loginData.userLogged.id);$("#leaderboard").easytabs({updateHash:false,animate:false});$("#leaderboard").easytabs("select","#tabs-points");$("#leaderboard").bind("easytabs:after",function(g,h,f){goToLine(f.selector,f.attr("rowId"))});createTable($("#table_points"));highlightCurrentUser(c);createTable($("#table_time"));highlightCurrentUser($("#tabs-time").attr("rowId"));createTable($("#table_runs"));highlightCurrentUser($("#tabs-runs").attr("rowId"));$(".ingrid > div:nth-child(2)").addClass("mCustomScrollbar").mCustomScrollbar({theme:"nobug"});goToLine("#tabs-points",c);leaderBoardCreated=true}function createNoLeaderBoardInfo(){version++;addTooltip();var a=[{id:Game.loginData.userLogged.id,name:BlocklyApps.getMsg("Text_NotEnabledToSeeLeaderBoard").format(Game.loginData.leaderBoard[0][1]),value:""}];if(leaderBoardCreated){$("#tabs-points").empty();$("#tabs-time").empty();$("#tabs-runs").empty()}$("#tabs-points").append(populateLBTables("table_points",a));$("#tabs-time").append(populateLBTables("table_time",a));$("#tabs-runs").append(populateLBTables("table_runs",a));$("#leaderboard").easytabs({updateHash:false,animate:false});$("#leaderboard").easytabs("select","#tabs-points");createTable($("#table_points"));createTable($("#table_time"));createTable($("#table_runs"));$(".ingrid > div:nth-child(2)").addClass("mCustomScrollbar").mCustomScrollbar({theme:"nobug"});leaderBoardCreated=true};PreloadImgs.put("bus","images/bus.png");PreloadImgs.put("city_map1","images/city_map.png");PreloadImgs.put("busback","images/bus_back.png");PreloadImgs.put("middleBuildings","images/middleBuildings.png");PreloadImgs.put("signs","images/signs.png");PreloadImgs.put("blinkSchool","images/blinkSchool.png");PreloadImgs.put("school","images/school.png");PreloadImgs.put("trees","images/trees.png");PreloadImgs.put("carred","images/car_red.png");PreloadImgs.put("carredback","images/car_red_back.png");PreloadImgs.put("cargreen","images/car_green.png");PreloadImgs.put("cargreendown","images/car_green_down.png");var CityMap={};CityMap.init=function(a){CityMap.flagBusDir=false;CityMap.flagCarRedDir=true;CityMap.flagCarGreenDir=false;CityMap.onclick=a.onclick;CityMap.blinkSchool=false;CityMap.bus={left:0,top:100};CityMap.bus.img=new Sprite({ticksPerFrame:1,numberOfFrames:2,horzSeq:true,x:403,y:-73,width:160,height:59,sourceY:0,img:PreloadImgs.get("bus")});CityMap.busBack={left:0,top:100};CityMap.busBack.img=new Sprite({ticksPerFrame:1,numberOfFrames:2,horzSeq:true,x:400,y:212,width:160,height:59,sourceY:0,img:PreloadImgs.get("busback")});CityMap.car_red={left:0,top:100};CityMap.car_red.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:-280,y:-152,width:160,height:59,sourceY:0,img:PreloadImgs.get("carred")});CityMap.car_red_back={left:0,top:100};CityMap.car_red_back.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:-161,y:280,width:160,height:59,sourceY:0,img:PreloadImgs.get("carredback")});CityMap.car_green={left:0,top:100};CityMap.car_green.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:-280,y:-152,width:160,height:59,sourceY:0,img:PreloadImgs.get("cargreen")});CityMap.car_green_down={left:0,top:100};CityMap.car_green_down.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:703,y:-240,width:160,height:59,sourceY:0,img:PreloadImgs.get("cargreendown")});CityMap.map1=PreloadImgs.get("city_map1");CityMap.middleBuildings=PreloadImgs.get("middleBuildings");CityMap.signs=PreloadImgs.get("signs");CityMap.school_hoover=PreloadImgs.get("blinkSchool");CityMap.school=PreloadImgs.get("school");CityMap.trees=PreloadImgs.get("trees");CityMap.canvas=document.getElementById("city_map");CityMap.canvasCtx=CityMap.canvas.getContext("2d");CityMap.canvas.addEventListener("mousemove",function(c){var b=CityMap.getMousePos(c);CityMap.blinkSchool=CityMap.testMouseOver(b.x,b.y)},false);CityMap.canvas.addEventListener("click",function(b){if(CityMap.blinkSchool){CityMap.onclick(b)}},false)};CityMap.getMousePos=function(a){var b=CityMap.canvas.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}};CityMap.testMouseOver=function(a,d){var b=[190,230,233,241,198,172,184,172,160,142,159,160];var c=[163,187,228,233,262,250,238,232,241,229,216,178];return CityMap.pnpoly(b.length,b,c,a,d)};CityMap.pnpoly=function(b,g,f,a,k){var e,d,h=false;for(e=0,d=b-1;e<b;d=e++){if(((f[e]>k)!=(f[d]>k))&&(a<(g[d]-g[e])*(k-f[e])/(f[d]-f[e])+g[e])){h=!h}}return h};CityMap.startAnimation=function(){CityMap.animate=true;window.setTimeout(CityMap.animateMap,75)};CityMap.stopAnimation=function(){CityMap.animate=false};CityMap.animateMap=function(){if(!CityMap.animate){return}CityMap.canvas.style.cursor=(CityMap.blinkSchool?"pointer":"default");CityMap.canvasCtx.drawImage((CityMap.map1),0,0,400,300);CityMap.animateBus();CityMap.animateCarRed();CityMap.animateCarGreen();CityMap.canvasCtx.drawImage((CityMap.signs),0,0,400,300);CityMap.canvasCtx.drawImage((CityMap.middleBuildings),0,0,400,300);CityMap.canvasCtx.drawImage((CityMap.trees),0,0,400,300);CityMap.canvasCtx.drawImage((CityMap.blinkSchool?CityMap.school_hoover:CityMap.school),0,0,400,300);window.setTimeout(CityMap.animateMap,75)};CityMap.animateBus=function(){if(!CityMap.flagBusDir){CityMap.bus.img.draw(CityMap.canvasCtx);CityMap.bus.img.update();CityMap.flagBusDir=(CityMap.bus.img.x+CityMap.bus.img.width)>0?false:true;CityMap.bus.img.x-=1+Math.cos(60*Math.PI/180);CityMap.bus.img.y+=Math.sin(60*Math.PI/180);CityMap.busBack.img.x=400;CityMap.busBack.img.y=212}else{CityMap.bus.img.x=403;CityMap.bus.img.y=-73;CityMap.busBack.img.draw(CityMap.canvasCtx);CityMap.busBack.img.update();CityMap.flagBusDir=(CityMap.busBack.img.x+CityMap.busBack.img.width)<=0?false:true;CityMap.busBack.img.x-=1+Math.cos(60*Math.PI/180);CityMap.busBack.img.y-=Math.sin(60*Math.PI/180)}};CityMap.animateCarRed=function(){if(!CityMap.flagCarRedDir){CityMap.car_red.img.draw(CityMap.canvasCtx);CityMap.car_red.img.update();CityMap.flagCarRedDir=CityMap.car_red.img.x>=400?true:false;CityMap.car_red.img.x+=1+Math.cos(60*Math.PI/180);CityMap.car_red.img.y+=Math.sin(60*Math.PI/180);CityMap.car_red_back.img.x=-161;CityMap.car_red_back.img.y=280}else{CityMap.car_red.img.x=-280;CityMap.car_red.img.y=-152;CityMap.car_red_back.img.draw(CityMap.canvasCtx);CityMap.car_red_back.img.update();CityMap.flagCarRedDir=CityMap.car_red_back.img.x<=400?true:false;CityMap.car_red_back.img.x+=1+Math.cos(60*Math.PI/180);CityMap.car_red_back.img.y-=Math.sin(60*Math.PI/180)}};CityMap.animateCarGreen=function(){if(!CityMap.flagCarGreenDir){CityMap.car_green.img.draw(CityMap.canvasCtx);CityMap.car_green.img.update();CityMap.flagCarGreenDir=CityMap.car_green.img.x<=400?false:true;CityMap.car_green.img.x+=1+Math.cos(60*Math.PI/180);CityMap.car_green.img.y+=Math.sin(60*Math.PI/180);CityMap.car_green_down.img.x=703;CityMap.car_green_down.img.y=-240}else{CityMap.car_green.img.x=-280;CityMap.car_green.img.y=-152;CityMap.car_green_down.img.draw(CityMap.canvasCtx);CityMap.car_green_down.img.update();CityMap.flagCarGreenDir=(CityMap.car_green_down.img.x+CityMap.car_green_down.img.width)<0?false:true;CityMap.car_green_down.img.x-=1+Math.cos(60*Math.PI/180);CityMap.car_green_down.img.y+=Math.sin(60*Math.PI/180)}};var SelectMission={};SelectMission.generateBoard=function(b){$("#selectMissionBoard").empty();var d=false;Game.loginData.missionHist.forEach(function(e){d=d||e[2]!=e[3]});if(!d){MyBlocklyApps.showDialog(document.getElementById("dialogNoMoreMissions"),null,true,true,true,null,{width:"600px"},null);return}var a=SelectMission.missionsRetrieved(Game.loginData.missionHist);$("#selectMissionBoard").append($("#"+a));$("#"+a).append($('<div id="bbLineSeparator">'));Cufon.set("fontFamily","DK Crayon Crumble");Cufon(".bbtabs");var c=function(){$("#selectMissionBoard").empty()};MyBlocklyApps.showDialog(document.getElementById("dialogSelectMission"),null,false,true,true,BlocklyApps.getMsg("Text_SelectMission"),{width:"480px",height:"470px"},null,c);SelectMission.stopAnimation=false;window.setTimeout(SelectMission.blinkTarget,50)};SelectMission.missionsRetrieved=function(b){var p=[];var m=[];for(var n=0;n<b.length;n++){var g=null;var o=p.indexOf(b[n][0]);if(o==-1){p.push(b[n][0]);g={group:b[n][0],groupId:b[n][4],levels:[]};m.push(g)}else{g=m[o]}var e={name:b[n][1],id:b[n][5],howManyItems:b[n][2],howManyItemsAchieved:b[n][3],repeateable:[],cust:[]};for(var k=0;k<b[n][6].length;k++){e.repeateable.push(b[n][6][k][0]);e.cust.push(b[n][6][k][1])}g.levels.push(e)}var h=function(i){var l=this.getAttribute("idgroup");var q=this.getAttribute("iditem");var j=this.getAttribute("idlevel");$("#selectMissionBoard").empty();MyBlocklyApps.hideDialog(true);SelectMission.stopAnimation=true;Game.missionSelected(l,j,q)};var f=function(l){var q=generateImages(l,2);var j=$.each(q,function(r){q[r]="<img src='images/bb"+this+"' width='16' height='16'/>"});return j};var d=function(s,r,l){if(m[s].levels[r].repeateable.indexOf(l)>-1){return false}var t=parseInt((m[s].levels[r].lastAllAchieved?m[s].levels[r].howManyItemsAchieved:"-1"));var q=t+1;return l<q};var c=function(t,s,q){var l=m[t].levels[s].repeateable.indexOf(q);var u=parseInt((m[t].levels[s].lastAllAchieved?m[t].levels[s].howManyItemsAchieved:"-1"));var r=u+1;return(l==-1&&q==r)||(l>-1&&q<=r)};var a=new Selector(m,50,385,250,"unlockBack","lockBack","bbtabs","bbtab",h,f,d,c);return a.build()};SelectMission.blinkTarget=function(){if(SelectMission.stopAnimation){return}$(".missionTargetFlat").addClass("missionTargetBlind").removeClass("missionTargetFlat");window.setTimeout(SelectMission.unblinkTarget,700)};SelectMission.unblinkTarget=function(){if(SelectMission.stopAnimation){return}$(".missionTargetBlind").addClass("missionTargetFlat").removeClass("missionTargetBlind");window.setTimeout(SelectMission.blinkTarget,700)};var InGrid={};InGrid.emptyLines=function(b){var a=$(b+" tbody");a.empty()};InGrid.loadLines=function(c,b){InGrid.emptyLines(c);var a=$(c+" tbody");b.forEach(function(d){var e=$("<tr/>");e.append($("<td>").html(d.name));e.append($("<td>").html(d.value));a.append(e)})};InGrid.createNewTable=function(e){$(".var-content").empty();var b=$("<table>").attr("id","vars");var d=$("<thead>");var c=$("<tr>");c.append($("<th>").html(BlocklyApps.getMsg("NoBugs_VarName")));c.append($("<th>").html(BlocklyApps.getMsg("NoBugs_VarValue")));d.append(c);b.append(d);$(".var-content").append(b);var a=$("<tbody>");e.forEach(function(f){var g=$("<tr/>");g.append($("<td>").html(f.name));g.append($("<td>").html(f.value));a.append(g)});b.append(a)};"use strict";PreloadImgs.put("body","images/cooker-body.png",false);PreloadImgs.put("mouth","images/cooker-mouth.png",false);PreloadImgs.put("eyes","images/cooker-eyes.png",false);PreloadImgs.put("head","images/cooker-head.png",false);PreloadImgs.put("Hat-1","images/cooker-hat-1.png",false);PreloadImgs.put("Hat-2","images/cooker-hat-2.png",false);PreloadImgs.put("Clothes-1","images/cooker-clothes-1.png",false);PreloadImgs.put("mini-body","images/mini-cooker-body.png",false);PreloadImgs.put("mini-mouth","images/mini-cooker-mouth.png",false);PreloadImgs.put("mini-eyes","images/mini-cooker-eyes.png",false);PreloadImgs.put("mini-head","images/mini-cooker-head.png",false);PreloadImgs.put("mini-Hat-1","images/mini-cooker-hat-1.png",false);PreloadImgs.put("mini-Hat-2","images/mini-cooker-hat-2.png",false);PreloadImgs.put("mini-Clothes-1","images/mini-cooker-clothes-1.png",false);PreloadImgs.put("0#0.mini-Clothes-1","images/mini-cooker-clothes-1-r0c0.png",false);PreloadImgs.put("0#1.mini-Clothes-1","images/mini-cooker-clothes-1.png",false);PreloadImgs.put("0#2.mini-Clothes-1","images/mini-cooker-clothes-1-r0c2.png",false);PreloadImgs.put("0#0.mini-body","images/mini-cooker-body-r0c0.png",false);PreloadImgs.put("0#1.mini-body","images/mini-cooker-body.png",false);PreloadImgs.put("0#2.mini-body","images/mini-cooker-body-r0c2.png",false);PreloadImgs.put("0#0.mini-hand","images/mini-cooker-body-r0c0-hand.png",false);PreloadImgs.put("0#1.mini-hand","",false);PreloadImgs.put("0#2.mini-hand","images/mini-cooker-body-r0c2-hand.png",false);PreloadImgs.put("1#0.mini-Clothes-1","images/mini-cooker-clothes-1-r1c0.png",false);PreloadImgs.put("1#1.mini-Clothes-1","images/mini-cooker-clothes-1-r1c1.png",false);PreloadImgs.put("1#2.mini-Clothes-1","images/mini-cooker-clothes-1-r1c2.png",false);PreloadImgs.put("1#0.mini-body","images/mini-cooker-body-r1c0.png",false);PreloadImgs.put("1#1.mini-body","images/mini-cooker-body-r1c1.png",false);PreloadImgs.put("1#2.mini-body","images/mini-cooker-body-r1c2.png",false);PreloadImgs.put("1#0.mini-hand","images/mini-cooker-body-r1c0-hand.png",false);PreloadImgs.put("1#1.mini-hand","images/mini-cooker-body-r1c1-hand.png",false);PreloadImgs.put("1#2.mini-hand","images/mini-cooker-body-r1c2-hand.png",false);PreloadImgs.put("1.mini-mouth","images/mini-cooker-mouth-r1.png",false);PreloadImgs.put("1.mini-head","images/mini-cooker-head-r1.png",false);PreloadImgs.put("1.mini-eyes","images/mini-cooker-eyes-r1.png",false);PreloadImgs.put("2#0.mini-Clothes-1","images/mini-cooker-clothes-1-r2c0.png",false);PreloadImgs.put("2#1.mini-Clothes-1","images/mini-cooker-clothes-1-r2c1.png",false);PreloadImgs.put("2#2.mini-Clothes-1","images/mini-cooker-clothes-1-r2c2.png",false);PreloadImgs.put("2#0.mini-body","images/mini-cooker-body-r2c0.png",false);PreloadImgs.put("2#1.mini-body","images/mini-cooker-body-r2c1.png",false);PreloadImgs.put("2#2.mini-body","images/mini-cooker-body-r2c2.png",false);PreloadImgs.put("2#0.mini-hand","images/mini-cooker-body-r2c0-hand.png",false);PreloadImgs.put("2#1.mini-hand","images/mini-cooker-body-r2c1-hand.png",false);PreloadImgs.put("2#2.mini-hand","images/mini-cooker-body-r2c2-hand.png",false);PreloadImgs.put("2.mini-mouth","images/mini-cooker-mouth-r2.png",false);PreloadImgs.put("2.mini-head","images/mini-cooker-head-r2.png",false);PreloadImgs.put("2.mini-eyes","images/mini-cooker-eyes-r2.png",false);PreloadImgs.put("3#0.mini-Clothes-1","images/mini-cooker-clothes-1-r3c0.png",false);PreloadImgs.put("3#1.mini-Clothes-1","images/mini-cooker-clothes-1-r3c1.png",false);PreloadImgs.put("3#2.mini-Clothes-1","images/mini-cooker-clothes-1-r3c2.png",false);PreloadImgs.put("3#0.mini-body","images/mini-cooker-body-r0c0.png",false);PreloadImgs.put("3#1.mini-body","images/mini-cooker-body.png",false);PreloadImgs.put("3#2.mini-body","images/mini-cooker-body-r0c2.png",false);PreloadImgs.put("3.mini-head","images/mini-cooker-head.png",false);PreloadImgs.put("3#0.mini-hand","",false);PreloadImgs.put("3#1.mini-hand","",false);PreloadImgs.put("3#2.mini-hand","",false);PreloadImgs.put("3.mini-eyes","",false);PreloadImgs.put("mini-Hat-1-back","images/mini-cooker-hat-1-back.png",false);PreloadImgs.put("mini-Hat-2-back","images/mini-cooker-hat-2-back.png",false);PreloadImgs.put("0#0.mini-platter","images/platter-r0.png",false);PreloadImgs.put("0#1.mini-platter","images/platter-r0.png",false);PreloadImgs.put("0#2.mini-platter","images/platter-r0c2.png",false);PreloadImgs.put("1#0.mini-platter","images/platter-r0.png",false);PreloadImgs.put("1#1.mini-platter","images/platter-r0.png",false);PreloadImgs.put("1#2.mini-platter","images/platter-r0.png",false);PreloadImgs.put("2#0.mini-platter","images/platter-r2c0.png",false);PreloadImgs.put("2#1.mini-platter","images/platter-r2c1.png",false);PreloadImgs.put("2#2.mini-platter","images/platter-r2c2.png",false);PreloadImgs.put("3#0.mini-platter","images/platter-r0.png",false);PreloadImgs.put("3#1.mini-platter","images/platter-r0.png",false);PreloadImgs.put("3#2.mini-platter","images/platter-r0.png",false);var AvatarEditor={};var AvatarImgMaker={};var ae_Width=288,ae_Height=464,ae_TopHead=118;function filterChangeColor(t,s,l,q,j,c){var f=t.getImageData(0,0,s,l);var o=null;if(c!=undefined){o=c.getImageData(0,0,s,l)}else{c=t;o=f}var e=j;for(var k=0;k<f.data.length;k+=4){if(f.data[k+3]<230){continue}var a=f.data[k];var m=f.data[k+1];var p=f.data[k+2];var n=Math.sqrt((a-q.r)*(a-q.r)+(m-q.g)*(m-q.g)+(p-q.b)*(p-q.b));if(n<200){o.data[k]=e.r;o.data[k+1]=e.g;o.data[k+2]=e.b}}c.putImageData(o,0,0)}var CreateItems={};CreateItems.hat=function(a,c,b){return{id:c,img:(c===""?c:PreloadImgs.get(a+c)),x:0,y:0,width:ae_Width,height:320,baseColor:{r:255,g:255,b:255},color:b}};CreateItems.clothes=function(d,e,b,a){var c={img:PreloadImgs.get(d+e),x:0,y:228,width:ae_Width,height:179,baseColor:{r:255,g:255,b:255},color:b,baseColor2:{r:255,g:0,b:0},color2:a};c.id=e;return c};CreateItems.eyes=function(b,a){return{img:PreloadImgs.get(b),x:0,y:ae_TopHead,width:ae_Width,height:172,baseColor:{r:255,g:255,b:0},color:a}};CreateItems.head=function(b,a){return{img:PreloadImgs.get(b),x:0,y:ae_TopHead,width:ae_Width,height:172,baseColor:{r:255,g:255,b:0},color:a}};CreateItems.body=function(b,a){return{img:PreloadImgs.get(b),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:0},color:a}};CreateItems.platter=function(a){return{img:PreloadImgs.get(a),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:0,b:0},color:{r:255,g:0,b:0}}};AvatarImgMaker.init=function(){if(AvatarImgMaker.initialized===true){return}AvatarImgMaker.initialized=true;AvatarImgMaker.canvasTemp=document.getElementById("avatarTemp");AvatarImgMaker.canvasTempCtx=AvatarImgMaker.canvasTemp.getContext("2d");AvatarImgMaker.canvasTemp2=document.getElementById("avatarTemp2");AvatarImgMaker.canvasTemp2Ctx=AvatarImgMaker.canvasTemp2.getContext("2d");AvatarImgMaker.canvas=document.getElementById("avatar");AvatarImgMaker.canvasCtx=AvatarImgMaker.canvas.getContext("2d");AvatarImgMaker.mouth=PreloadImgs.get("mouth");AvatarImgMaker.miniMouth=PreloadImgs.get("mini-mouth");AvatarImgMaker.keys=[];AvatarImgMaker.keys.push("body");AvatarImgMaker.keys.push("clothes");AvatarImgMaker.keys.push("head");AvatarImgMaker.keys.push("eyes");AvatarImgMaker.keys.push("hat")};function cloneArray(b){var a=new Array();b.forEach(function(c){a.push(c.slice())});return a}AvatarImgMaker.createBody=function(e,c,a,d){var b=cloneArray(c);AvatarImgMaker.createItems(b,"");AvatarImgMaker._draw(AvatarImgMaker.canvasCtx,0,0,ae_Width,ae_Height,1,AvatarImgMaker.mouth,ae_TopHead,AvatarImgMaker.keys,AvatarImgMaker.items,a,d);e.clearRect(0,0,a,d);e.drawImage(AvatarImgMaker.canvas,0,0,a,d)};AvatarImgMaker.createMiniBody=function(c,b){var a=cloneArray(b);AvatarImgMaker.createItems(a,"mini-");AvatarImgMaker._draw(c,0,0,50,80,6,AvatarImgMaker.miniMouth,0,AvatarImgMaker.keys,AvatarImgMaker.items)};AvatarImgMaker.createMiniAnimationBody=function(h,e){var c=cloneArray(e);AvatarImgMaker.createItems(c,"mini-");var f=[];f.push("body");f.push("clothes");f.push("head");f.push("eyes");f.push("hat");h.clearRect(0,0,120,320);AvatarImgMaker._draw(h,40,0,0,0,6,AvatarImgMaker.miniMouth,ae_TopHead,f,AvatarImgMaker.items);f.splice(2,0,"hand");AvatarImgMaker.createRowItems("0#0.mini-");AvatarImgMaker._draw(h,0,0,0,0,6,AvatarImgMaker.miniMouth,ae_TopHead,f,AvatarImgMaker.items);AvatarImgMaker.createRowItems("0#2.mini-");AvatarImgMaker._draw(h,80,0,0,0,6,AvatarImgMaker.miniMouth,ae_TopHead,f,AvatarImgMaker.items);for(var b=1;b<=3;b++){var a=null;if(b<3){a=PreloadImgs.get(b+".mini-mouth")}else{f.splice(4,1);if(AvatarImgMaker.items.hat.id!==""){AvatarImgMaker.items.hat.img=PreloadImgs.get("mini-"+AvatarImgMaker.items.hat.id+"-back")}}AvatarImgMaker.items.head.img=PreloadImgs.get(b+".mini-head");AvatarImgMaker.items.eyes.img=PreloadImgs.get(b+".mini-eyes");for(var d=0;d<=2;d++){var g=b+"#"+d+".mini-";AvatarImgMaker.createRowItems(g);AvatarImgMaker._draw(h,d*40,80*b,0,0,6,a,ae_TopHead,f,AvatarImgMaker.items)}}};AvatarImgMaker.createMiniAnimationBodyPlatter=function(g,c){AvatarImgMaker.createItems(c,"mini-");var e=[];e.push("body");e.push("clothes");e.push("platter");e.push("head");e.push("eyes");e.push("hat");g.clearRect(0,0,120,320);AvatarImgMaker.items.platter=CreateItems.platter("0#1.mini-platter");AvatarImgMaker._draw(g,40,0,0,0,6,AvatarImgMaker.miniMouth,ae_TopHead,e,AvatarImgMaker.items);e.splice(2,0,"hand");AvatarImgMaker.createRowItems("0#0.mini-");AvatarImgMaker._draw(g,0,0,0,0,6,AvatarImgMaker.miniMouth,ae_TopHead,e,AvatarImgMaker.items);AvatarImgMaker.items.platter=CreateItems.platter("0#2.mini-platter");AvatarImgMaker.createRowItems("0#2.mini-");AvatarImgMaker._draw(g,80,0,0,0,6,AvatarImgMaker.miniMouth,ae_TopHead,e,AvatarImgMaker.items);for(var b=1;b<=3;b++){var a=null;if(b<3){a=PreloadImgs.get(b+".mini-mouth")}else{e.splice(5,1);if(AvatarImgMaker.items.hat.id!==""){AvatarImgMaker.items.hat.img=PreloadImgs.get("mini-"+AvatarImgMaker.items.hat.id+"-back")}}AvatarImgMaker.items.head.img=PreloadImgs.get(b+".mini-head");AvatarImgMaker.items.eyes.img=PreloadImgs.get(b+".mini-eyes");if(b==1||b==3){e.splice(3,1);e.splice(0,0,"platter")}else{e.splice(0,1);e.splice(3,0,"platter")}for(var d=0;d<=2;d++){var f=b+"#"+d+".mini-";AvatarImgMaker.createRowItems(f);AvatarImgMaker.items.platter=CreateItems.platter(f+"platter");AvatarImgMaker._draw(g,d*40,80*b,0,0,6,a,ae_TopHead,e,AvatarImgMaker.items)}}};AvatarImgMaker.createRowItems=function(a){AvatarImgMaker.items.clothes.img=PreloadImgs.get(a+AvatarImgMaker.items.clothes.id);AvatarImgMaker.items.body.img=PreloadImgs.get(a+"body");AvatarImgMaker.items.hand=CreateItems.body(a+"hand",AvatarImgMaker.items.body.color)};AvatarImgMaker.createItems=function(a,b){AvatarImgMaker.items=[];a.forEach(function(c){var d=null;switch(c[0]){case"clothes":d=CreateItems[c[0]](b,c[1],hexToRgb(c[2]),hexToRgb(c[3]));break;case"body":case"skin":AvatarImgMaker.items.head=CreateItems.head(b+"head",hexToRgb(c[2]));d=CreateItems.body(b+"body",hexToRgb(c[2]));c[0]="body";break;case"hat":d=CreateItems.hat(b,c[1],hexToRgb(c[2]));break;default:d=CreateItems[c[0]](b+c[1],hexToRgb(c[2]))}AvatarImgMaker.items[c[0]]=d})};AvatarImgMaker._draw=function(g,i,e,j,c,a,b,f,k,d){g.clearRect(i,e,j,c);k.forEach(function(h){var m=d[h];if(m.img===""){return}var l=(m.width/a)+1;var o=(m.height/a)+1;var n=m.img;if(n.currentSrc===""){return}AvatarImgMaker.canvasTemp.width=l;AvatarImgMaker.canvasTemp.height=o;AvatarImgMaker.canvasTempCtx.clearRect(0,0,l,o);AvatarImgMaker.canvasTempCtx.drawImage(n,0,0);if(m.color2==undefined){filterChangeColor(AvatarImgMaker.canvasTempCtx,l,o,m.baseColor,m.color)}else{AvatarImgMaker.canvasTemp2.width=l;AvatarImgMaker.canvasTemp2.height=o;AvatarImgMaker.canvasTemp2Ctx.clearRect(0,0,j,c);AvatarImgMaker.canvasTemp2Ctx.drawImage(n,0,0);filterChangeColor(AvatarImgMaker.canvasTemp2Ctx,l,o,m.baseColor,m.color,AvatarImgMaker.canvasTempCtx);filterChangeColor(AvatarImgMaker.canvasTemp2Ctx,l,o,m.baseColor2,m.color2,AvatarImgMaker.canvasTempCtx)}g.drawImage(AvatarImgMaker.canvasTemp,i+(m.x/a),e+(m.y/a))});if(b!=null){g.drawImage(b,i,e+(f/a))}};AvatarEditor.initialized=false;AvatarEditor.init=function(){if(AvatarEditor.initialized){return}$("#avatar-tabs").easytabs({animate:false,updateHash:false,tabActiveClass:"selected-tab",panelActiveClass:"displayed"});$("#avatar-tabs ul li a").addClass("nobugs_font_light");AvatarEditor.itemColor={r:255,g:255,b:255};AvatarEditor.items=[];AvatarEditor.miniItems=[];AvatarEditor.keys=[];AvatarEditor.canvasTemp=document.getElementById("avatarTemp");AvatarEditor.canvasTempCtx=AvatarEditor.canvasTemp.getContext("2d");AvatarEditor.canvasTemp2=document.getElementById("avatarTemp2");AvatarEditor.canvasTemp2Ctx=AvatarEditor.canvasTemp2.getContext("2d");AvatarEditor.canvas=document.getElementById("avatar");AvatarEditor.canvasCtx=AvatarEditor.canvas.getContext("2d");$(".avatar-item").click(AvatarEditor.selectItem);AvatarEditor.hatColor={r:255,g:255,b:255};$("#cpHat").colorpicker({history:false,displayIndicator:false});$("#cpHat").on("change.color",function(b,a){AvatarEditor.hatColor=hexToRgb(a);AvatarEditor.changeColor(AvatarEditor.hatColor,"#tab-hats",{r:255,g:255,b:255});AvatarEditor.selectHat(AvatarEditor.hat);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpHat");$("#cpHat div:first-child").css("width","0px");AvatarEditor.drawTab("#tab-hats");$("#cpEyes").colorpicker({history:false,displayIndicator:false});$("#cpEyes").on("change.color",function(b,a){AvatarEditor.selectEye(a);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpEyes");AvatarEditor.choicesOfColor("#cpEyes",["#000000","#5977FF","#188242"]);$("#cpEyes div:first-child").css("width","0px");$("#cpSkin").colorpicker({history:false,displayIndicator:false});$("#cpSkin").on("change.color",function(b,a){AvatarEditor.selectSkin(a);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpSkin");AvatarEditor.choicesOfColor("#cpSkin",["#F39C7A","#AF876D","#544035"]);$("#cpSkin div:first-child").css("width","0px");AvatarEditor.scarfColor={r:255,g:0,b:0};AvatarEditor.coatColor={r:255,g:255,b:255};$("#cpCoat").colorpicker({history:false,displayIndicator:false});$("#cpCoat").on("change.color",function(b,a){AvatarEditor.coatColor=hexToRgb(a);AvatarEditor.changeColor2Elements("#tab-clothes",AvatarEditor.coatColor,{r:255,g:255,b:255},AvatarEditor.scarfColor,{r:255,g:0,b:0});AvatarEditor.selectClothes(AvatarEditor.clothes);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpCoat");$("#cpScarf").colorpicker({history:false,displayIndicator:false});$("#cpScarf").on("change.color",function(b,a){AvatarEditor.scarfColor=hexToRgb(a);AvatarEditor.changeColor2Elements("#tab-clothes",AvatarEditor.coatColor,{r:255,g:255,b:255},AvatarEditor.scarfColor,{r:255,g:0,b:0});AvatarEditor.selectClothes(AvatarEditor.clothes);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpScarf");AvatarEditor.drawTab("#tab-clothes");BlocklyApps.bindClick("avatarEditorOK",AvatarEditor.okClick);BlocklyApps.bindClick("avatarEditorCancel",AvatarEditor.cancelClick);$(".evo-more").remove();$("#cpHat .evo-palette tr").append($("<td>").css("background-color","#ffffff"));$("#cpCoat .evo-palette tr").append($("<td>").css("background-color","#ffffff"));$("#cpScarf .evo-palette tr").append($("<td>").css("background-color","#ffffff"));AvatarEditor.initialized=true};AvatarEditor.cancelClick=function(){if(document.getElementById("blockhats")!=null){$("#blockhats").remove()}if(document.getElementById("blockclothes")!=null){$("#blockclothes").remove()}MyBlocklyApps.hideDialog(true);if(AvatarEditor.afterCloseFunc!==undefined&&AvatarEditor.afterCloseFunc!==null){AvatarEditor.afterCloseFunc()}};AvatarEditor.okClick=function(){var a=Game.loginData.avatar;a[0]=["skin","",rgbToHex(AvatarEditor.skinColor)];a[1]=["eyes","eyes",rgbToHex(AvatarEditor.eyeColor)];a[2]=["hat",AvatarEditor.hat,rgbToHex(AvatarEditor.hatColor)];a[3]=["clothes",AvatarEditor.clothes,rgbToHex(AvatarEditor.coatColor),rgbToHex(AvatarEditor.scarfColor)];AvatarEditor.cancelClick();Game.drawMiniAvatar();UserControl.saveAvatar(document.getElementById("avatarPlayer").toDataURL(),Game.loginData.avatar,Game.createsLeaderboard)};AvatarEditor.show=function(b,c,i,h,e,f,d,j){$("#avatar-tabs").easytabs("select","#tab-body");AvatarEditor.hatColor=hexToRgb(d);AvatarEditor.scarfColor=hexToRgb(i);AvatarEditor.coatColor=hexToRgb(c);var g="";if(f.indexOf("blocked")==0){g=f.split(":")[1];f=""}var a="";if(b.indexOf("blocked")==0){a=b.split(":")[1];b=b.split(":")[2]}AvatarEditor.clothes=b;AvatarEditor.hat=f;if(AvatarEditor.keys.indexOf("body")==-1){AvatarEditor.keys.push("body")}AvatarEditor.changeColor2Elements("#tab-clothes",AvatarEditor.coatColor,{r:255,g:255,b:255},AvatarEditor.scarfColor,{r:255,g:0,b:0});AvatarEditor.selectClothes(b);if(AvatarEditor.keys.indexOf("head")==-1){AvatarEditor.keys.push("head")}AvatarEditor.selectSkin(h);AvatarEditor.selectEye(e);AvatarEditor.changeColor(AvatarEditor.hatColor,"#tab-hats",{r:255,g:255,b:255});AvatarEditor.selectHat(f);$("#avatar-tabs").css("display","block");AvatarEditor.afterCloseFunc=j;AvatarEditor.draw();MyBlocklyApps.showDialog(document.getElementById("profileditor"),null,false,true,true,BlocklyApps.getMsg("Avatar_EditorTitle"),{width:"auto"},null);if(g!==""){AvatarEditor.blockTab(g,"hats")}if(a!==""){AvatarEditor.blockTab(a,"clothes")}};AvatarEditor.blockTab=function(a,c){$("<div id ='block"+c+"'>").css("height","450px").css("width","272px").css("margin-top","-7px").css("position","fixed").css("backgroundColor","grey").css("opacity","0.9").prependTo("#tab-"+c);var b=$("<table width='100%' height='100%'>").append($("<tr>").append($("<td align='center' id='avatar_info_"+c+"'>")));$("#block"+c).append(b);$("#avatar_info_"+c).append($("<span>").html(BlocklyApps.getMsg("Avatar_EnableByXp")+a+"<img style='vertical-align: middle;' src='images/xp.png'/>").addClass("nobugs_font"))};AvatarEditor.removeColorLines=function(b){var a=$(b+" .evo-palette tr");a.splice(a.length-1,1);a.remove()};AvatarEditor.choicesOfColor=function(b,a){var c=$(b+" .evo-palette tr");c.empty();a.forEach(function(d){c.append($("<td/>").css("background-color",d))})};AvatarEditor.draw=function(){AvatarImgMaker._draw(AvatarImgMaker.canvasCtx,0,0,ae_Width,ae_Height,1,AvatarImgMaker.mouth,ae_TopHead,AvatarEditor.keys,AvatarEditor.items);AvatarImgMaker._draw(AvatarImgMaker.canvasCtx,ae_Width-50,ae_Height-85,50,80,6,AvatarImgMaker.miniMouth,ae_TopHead,AvatarEditor.keys,AvatarEditor.miniItems)};AvatarEditor.selectItem=function(a){var b=this.id.split("-");AvatarEditor["select"+b[0]](this.id);AvatarEditor.draw()};AvatarEditor.selectHat=function(a){if(a===""){return}if(AvatarEditor.keys.indexOf("hat")==-1){AvatarEditor.keys.push("hat")}AvatarEditor.hat=a;AvatarEditor.items.hat=CreateItems.hat("",a,AvatarEditor.itemColor);AvatarEditor.miniItems.hat=CreateItems.hat("mini-",a,AvatarEditor.itemColor)};AvatarEditor.selectClothes=function(a){if(AvatarEditor.keys.indexOf("clothes")==-1){AvatarEditor.keys.push("clothes")}AvatarEditor.clothes=a;AvatarEditor.items.clothes=CreateItems.clothes("",a,AvatarEditor.coatColor,AvatarEditor.scarfColor);AvatarEditor.miniItems.clothes=CreateItems.clothes("mini-",a,AvatarEditor.coatColor,AvatarEditor.scarfColor)};AvatarEditor.selectEye=function(a){AvatarEditor.eyeColor=hexToRgb(a);if(AvatarEditor.keys.indexOf("eyes")==-1){AvatarEditor.keys.push("eyes")}AvatarEditor.items.eyes=CreateItems.eyes("eyes",AvatarEditor.eyeColor);AvatarEditor.miniItems.eyes=CreateItems.eyes("mini-eyes",AvatarEditor.eyeColor)};AvatarEditor.selectSkin=function(a){AvatarEditor.skinColor=hexToRgb(a);AvatarEditor.items.head=CreateItems.head("head",AvatarEditor.skinColor);AvatarEditor.items.body=CreateItems.body("body",AvatarEditor.skinColor);AvatarEditor.miniItems.head=CreateItems.head("mini-head",AvatarEditor.skinColor);AvatarEditor.miniItems.body=CreateItems.body("mini-body",AvatarEditor.skinColor)};AvatarEditor.drawTab=function(h,f,c,d){var g=$(h+" .avatar-item");for(var e=0;e<g.length;e++){var a=g[e].getContext("2d");var b=PreloadImgs.get(g[e].id);a.drawImage(b,0,0,g[e].width,g[e].height);if(f!==undefined){f(a,g[e].width,g[e].height,c,d)}}};AvatarEditor.changeColor=function(b,c,a){AvatarEditor.itemColor=b;AvatarEditor.drawTab(c,filterChangeColor,a,b)};AvatarEditor.changeColor2Elements=function(b,a,h,l,g){var j=$(b+" .avatar-item");for(var f=0;f<j.length;f++){var c=j[f].width;var d=j[f].height;AvatarEditor.canvasTemp2.width=c;AvatarEditor.canvasTemp2.height=d;AvatarEditor.canvasTemp2Ctx.clearRect(0,0,c,d);var e=PreloadImgs.get(j[f].id);AvatarEditor.canvasTemp2Ctx.drawImage(e,0,0,c,d);var k=j[f].getContext("2d");k.drawImage(e,0,0,c,d);filterChangeColor(AvatarEditor.canvasTemp2Ctx,c,d,h,a,k);filterChangeColor(AvatarEditor.canvasTemp2Ctx,c,d,g,l,k)}};"use strict";var CharacterDialog={};CharacterDialog=function(c,l,i,b,h){var a=$("<div>").attr("id","talkDlg").addClass("dlgTalk").appendTo("body");var k=$("<div>").addClass("dlgTalkBaloon");k.append($("<button id='dlgClose'>").addClass("dlgTalkClose"));k.append($("<div>").addClass("dlgTalkText"));var g=$("<button id='dlgPrevious'>").addClass("dlgTalkButton").addClass("nobugs_button").append($("<img>").attr("src","images/talkprevious.png"));k.append(g);var n=$("<button id='dlgNext'>").addClass("dlgTalkButton").addClass("nobugs_button").append($("<img>").attr("src","images/talknext.png"));k.append(n);var m=$("<button id='dlgCloseOK'>").addClass("dlgTalkButton").addClass("nobugs_button").append($("<img>").attr("src","images/talknextclose.png"));k.append(m);a.append(k);var j=document.getElementById("talkDlg");j.style.display="inline";j.style.left=c+"px";j.style.top=l+"px";var e={top:"200px",left:"700px"};var d={top:"200px",left:"600px"};this.dlg=j;this.conversation=h;this.idx=0;this.previousChar=null;this.evtClose=b;this.leftChar=(c-3)+"px";this.topChar=(l-96)+"px";this.txt=this.dlg.getElementsByClassName("dlgTalkText")[0];this.updateText();this.nextButton=n.get(0);this.nextButton.onclick=this.next.bind(this);this.nextButton.style.top=e.top;this.nextButton.style.left=e.left;this.nextCloseButton=m.get(0);this.nextCloseButton.onclick=this.nextClose.bind(this);this.nextCloseButton.style.top=e.top;this.nextCloseButton.style.left=e.left;if(this.conversation.length==1){var f=h[0].nextButton;if(f===undefined){f="close"}if(f==="close"){this.nextCloseButton.style.display="inline"}else{if(f==="next"){this.nextButton.style.display="inline";this.nextButton.onclick=this.nextClose.bind(this)}else{}}}else{this.nextButton.style.display="inline"}this.prevButton=g.get(0);this.prevButton.onclick=this.previous.bind(this);this.prevButton.style.top=d.top;this.prevButton.style.left=d.left;this.closeButton=this.dlg.getElementsByClassName("dlgTalkClose")[0];if(i){this.closeButton.onclick=this.nextClose.bind(this)}else{this.closeButton.style.display="none"}Cufon(".dlgTalkText")};CharacterDialog.prototype.show=function(){this.dlg.style.display="inline"};CharacterDialog.prototype.nextClose=function(){$("#talkDlg").remove();if(this.previousChar!=null){this.previousChar.css("display","none")}if(this.evtClose!=null){this.evtClose()}};CharacterDialog.prototype.next=function(){this.idx++;this.updateText();if(this.idx==this.conversation.length-1){this.nextButton.style.display="none";this.nextCloseButton.style.display="inline"}this.prevButton.style.display="inline"};CharacterDialog.prototype.previous=function(){this.idx--;this.updateText();if(this.idx==0){this.prevButton.style.display="none"}this.nextCloseButton.style.display="none";this.nextButton.style.display="inline"};CharacterDialog.prototype.updateText=function(){if(this.previousChar!=null){this.previousChar.css("display","none")}var a=this.conversation[this.idx].character;if(a!=null){this.previousChar=$("#"+a).css("display","inline").css("left",this.leftChar).css("top",this.topChar)}this.txt.innerHTML=this.conversation[this.idx].msg;Cufon(".dlgTalkText")};"use strict";PreloadImgs.put("intro-background","images/family_dinner.png",false);var IntroGame={};IntroGame.start=function(){IntroGame.track=new PlayAudio(["music/DailyBeetle.mp3"]);$("<div>").attr("id","introback").append($("<img>").css("width","700px").attr("src","images/family_dinner.png")).appendTo("body");$("<img>").attr("id","dadTalk").attr("src","images/father.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");$("<img>").attr("id","youTalk").attr("src","images/you.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");$("<img>").attr("id","momTalk").attr("src","images/mother.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");$("<img>").attr("id","grandmomTalk").attr("src","images/grandmother.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");MyBlocklyApps.showDialog(document.getElementById("introback"),null,false,true,true,null,{width:"auto"},null,null,false);var b=document.getElementById("dialog");var a=new CharacterDialog(b.offsetLeft-50,(b.offsetTop+340),false,IntroGame.finish,[{character:"dadTalk",msg:BlocklyApps.getMsg("Intro_Dlg1")},{character:"momTalk",msg:BlocklyApps.getMsg("Intro_Dlg2")},{character:"youTalk",msg:BlocklyApps.getMsg("Intro_Dlg3")},{character:"dadTalk",msg:BlocklyApps.getMsg("Intro_Dlg4")},{character:"grandmomTalk",msg:BlocklyApps.getMsg("Intro_Dlg5")},{character:"momTalk",msg:BlocklyApps.getMsg("Intro_Dlg6")},{character:"youTalk",msg:BlocklyApps.getMsg("Intro_Dlg7")},{character:"dadTalk",msg:BlocklyApps.getMsg("Intro_Dlg8")},{character:"youTalk",msg:BlocklyApps.getMsg("Intro_Dlg9")}]);IntroGame.track.play();a.show()};IntroGame.finish=function(){$("#introback").remove();$("#dadTalk").remove();$("#youTalk").remove();$("#momTalk").remove();$("#grandmomTalk").remove();MyBlocklyApps.hideDialog(true);Game.logged();IntroGame.track.stop();IntroGame.track.clear()};IntroGame.createDiv=function(b){var a=$("<div id ='"+b+"'>").css("height","100%").css("width","100%").css("position","fixed").css("backgroundColor","grey").css("opacity","0.5").css("z-index","1000").prependTo("body");return a};IntroGame.presentTeacher=function(b){IntroGame.createDiv("presentTeacher");var a=$("<img>").attr("id","imgTeacher").attr("src","images/teacher_info.png").css("width","25%").css("position","absolute").css("z-index","2001").css("left","150px").css("top","50px");a.prependTo("body");var c=new CharacterDialog(375,200,false,IntroGame.closePresentTeacher,[{character:null,msg:BlocklyApps.getMsg("Intro_PresentTeacher").format($("#playerName").html()),nextButton:"next"}]);$("#talkDlg").css("z-index","2000");c.show();IntroGame.fRet=b};IntroGame.closePresentTeacher=function(){$("#presentTeacher").remove();$("#imgTeacher").remove();IntroGame.fRet()};IntroGame.focusAvatar=function(){var e=IntroGame.createDiv("focusAvatar");var a=$("<img>").attr("id","imgTeacher").attr("src","images/teacher_point_hand.png").css("width","30%").css("position","absolute").css("z-index","2001").css("left","100px").css("top","50px");a.prependTo("body");var c=$("#avatarEditorButton").position();var b=$("<button>").addClass("nobugs_button").attr("id","focusButton").css("font-size","14px").css("width","80px").css("position","relative").css("top",c.top).css("left","10px").html("Avatar");b.click(IntroGame.closeFocusAvatar);e.append(b);var d=new CharacterDialog(375,200,false,null,[{character:null,msg:BlocklyApps.getMsg("Intro_AvatarEditor"),nextButton:null}]);$("#talkDlg").css("z-index","2000");d.show();IntroGame.cDialog=d};IntroGame.closeFocusAvatar=function(){IntroGame.cDialog.nextClose();$("#focusButton").remove();$("#focusAvatar").remove();$("#imgTeacher").remove();Game.openAvatarEditor(null,IntroGame.closeAvatarEditor)};IntroGame.closeAvatarEditor=function(){IntroGame.createDiv("closeAvatarEditor1").css("left","526px");IntroGame.createDiv("closeAvatarEditor2").css("height","100px").css("width","518px");IntroGame.createDiv("closeAvatarEditor3").css("width","110px").css("height","305px").css("top","100px");IntroGame.createDiv("closeAvatarEditor4").css("top","405px").css("width","518px");var a=$("<img>").attr("id","imgTeacher-hand").attr("src","images/teacher_attention_hand-hand.png").css("width","105px%").css("position","absolute").css("z-index","2001").css("left","291px").css("top","347px").css("height","135px");a.prependTo("body");a=$("<img>").attr("id","imgTeacher-body").attr("src","images/teacher_attention_hand-body.png").css("width","296px").css("position","absolute").css("z-index","2001").css("left","396px").css("top","250px");a.prependTo("body");var b=new CharacterDialog(400,200,false,IntroGame.closePresentTeacher,[{character:null,msg:BlocklyApps.getMsg("Intro_ClickSchool"),nextButton:null}]);$("#talkDlg").css("z-index","2000");b.show()};IntroGame.closeBeforeCity=function(){IntroGame.cDialog.nextClose();$("#closeAvatarEditor1").remove();$("#closeAvatarEditor2").remove();$("#closeAvatarEditor3").remove();$("#closeAvatarEditor4").remove();$("#imgTeacher-hand").remove();$("#imgTeacher-body").remove()};"use strict";var noBugsAudio=document.createElement("audio");var PlayAudio=function(b){this.files=b;this.index=0;try{noBugsAudio.pause()}catch(a){}this.playing=false};PlayAudio.prototype.playNext=function(){if(!window.Audio){return}if(this.index==this.files.length){this.index=0}noBugsAudio.src=this.files[this.index];this.index+=1;noBugsAudio.play()};PlayAudio.prototype.shuffle=function(){for(var c=this.files.length-1;c>0;c--){var b=Math.floor(Math.random()*(c+1));var a=this.files[c];this.files[c]=this.files[b];this.files[b]=a}};PlayAudio.prototype.play=function(){if(this.playing||!window.Audio){return}noBugsAudio.addEventListener("ended",this.playNext.bind(this));this.playNext();this.playing=true};PlayAudio.prototype.stop=function(){this.playing=false;this.clear();try{noBugsAudio.pause()}catch(a){}};PlayAudio.prototype.clear=function(){noBugsAudio.removeEventListener("ended",this.playNext)};"use strict";var CountXP={};CountXP.init=function(a){if(CountXP.ctx!=null){CountXP.stop()}CountXP.ctx=document.getElementById(a).getContext("2d")};CountXP.config=function(f,d,e,c,b,a){CountXP.eventChangeStars=b;CountXP.showPoints=a;CountXP.umaFracao=f;CountXP.current=d%f;CountXP.times=Math.floor(d/f);CountXP.times=(CountXP.times>3?3:CountXP.times);CountXP.pointsFinal=c;CountXP.starting=true;CountXP.changeImgs();if((CountXP.times<3)&&(CountXP.showPoints)){$("#xpPoints").html("X "+e);CountXP.draw()}CountXP.starting=false};CountXP.start=function(){if(CountXP.times<3){CountXP.tick();CountXP.handler=setInterval(CountXP.tick,1000)}};CountXP.stop=function(){if(CountXP.ctx!=null){CountXP.ctx.clearRect(0,0,32,32)}clearInterval(CountXP.handler)};CountXP.tick=function(){CountXP.draw();CountXP.current++;if(CountXP.current>CountXP.umaFracao){CountXP.times++;CountXP.changeImgs();CountXP.current=0}};CountXP.draw=function(){var a=CountXP.ctx;a.clearRect(0,0,32,32);a.beginPath();a.arc(16,18,10,0,2*Math.PI);a.lineWidth=2;a.strokeStyle="#000000";a.rect(15,4,2,2);a.rect(13,2,6,2);a.stroke();a.beginPath();a.arc(16,18,5,1.5*Math.PI,(1.5+((CountXP.current/CountXP.umaFracao)*2))*Math.PI,false);a.lineWidth=10;a.strokeStyle="#ad2323";a.stroke()};CountXP.changeImgs=function(){if(!CountXP.showPoints){return}for(var a=0;a<3;a++){document.getElementById("missionXP"+(a+1)).style.backgroundImage="url(images/"+(CountXP.times>=(a+1)?"xp_disabled.png":"xp.png")+")"}if(CountXP.eventChangeStars){CountXP.eventChangeStars(CountXP.times)}if(CountXP.times>=3){CountXP.ctx.clearRect(0,0,32,32);$("#xpPoints").html("+ "+CountXP.pointsFinal);CountXP.stop()}};"use strict";var Tests={};var TestRT={};Tests.createForm=function(g){Tests.test=g;Tests.idx=-1;Tests.dropShowed=false;Tests.dropExpand=null;var f=document.createElement("div");f.id="testquestions";f.style.height="100%";var c=document.createElement("table");var d=document.createElement("tr");c.appendChild(d);var a=document.createElement("img");a.src="images/teacher_info.png";a.style.margin="10px";a.style.height="350px";var e=document.createElement("td");e.appendChild(a);d.appendChild(e);var b=document.createElement("span");b.innerHTML=g.description+"<br/><br/>";var e=document.createElement("td");e.appendChild(b);d.appendChild(e);f.appendChild(c);b=document.createElement("span");b.innerHTML="Acrescer/descontar do b&ocirc;nus: "+g.timeRewardXP+" <img src='images/xp.png' style='vertical-align:middle'/> a cada "+g.timeXP+" segundos antecipados/extras.";b.style.padding="10px";b.style.border="1px solid black";b.style.width="95%";b.style.display="block";b.style.textAlign="center";e.appendChild(b);$("#testsStart").css("display","inline");$("#testsLogoff").css("display","inline");$("#testsNextQuestion").css("display","none");$("#testsLetBlank").css("display","none");$("#testsPlay").css("display","none");$("#continueTestAnotherDay").css("display","none");window.addEventListener("resize",Tests.resizeWindow);window.addEventListener("beforeunload",Tests.stopNow);return f};Tests.start=function(){$("#testsStart").css("display","none");$("#testsLogoff").css("display","none");$("#testsNextQuestion").css("display","inline");$("#testsLetBlank").css("display","inline");$("#testsPlay").css("display","none");Tests.idx=0;Tests.drawQuestion()};Tests.nextQuestion=function(){confirm("Deseja realmente executar essa a&#231;&#227;o ?",function(){Tests.performQuestion(null,null)})};Tests.performQuestion=function(blankValue,finished){Tests.closeDrop();if(Tests.dropExpand!=null){Tests.dropExpand.close()}Blockly.WidgetDiv.hide();var finishTest=(finished==true||finished==null);var answer=document.getElementById("answerQuestion");var valueAnswer=null;if(answer.type==="number"){if(finishTest){valueAnswer=(blankValue!=null?blankValue:answer.value.trim());if(valueAnswer===""){Tests.drop=new Drop({target:answer,content:BlocklyApps.getMsg("NoBugs_requiredField"),position:"left middle",classes:"drop-theme-arrows",constrainToScrollParent:false,openOn:""});Tests.drop.open();return}}else{valueAnswer="?"}}else{if(blankValue!=null){valueAnswer=blankValue}else{valueAnswer=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.mainWorkspace));if(finishTest){BlocklyApps.log=[];var js=Blockly.JavaScript;var newLogicCompare=Blockly.JavaScript.logic_compare;var newLogicOperation=Blockly.JavaScript.logic_operation;Blockly.JavaScript.logic_compare=NoBugsJavaScript.oldLogicCompare;Blockly.JavaScript.logic_operation=function(block){var r=NoBugsJavaScript.oldLogicOperation(block);r[0]="("+r[0]+")";return r};var code="function highlightBlock(c){};var NoBugsJavaScript = {};"+js.workspaceToCode(Blockly.mainWorkspace);var question=Tests.test.questions[Tests.idx];var result="F";try{result=(eval(question.answer)?"T":"F")}catch(ex){}Blockly.JavaScript.logic_compare=newLogicCompare;Blockly.JavaScript.logic_operation=newLogicOperation}else{result="?"}valueAnswer=result+valueAnswer}}var timeSpent=0;if(valueAnswer==-1){timeSpent=CountXP.umaFracao}else{timeSpent=(CountXP.times*CountXP.umaFracao)+CountXP.current}UserControl.saveTestQuestionAnswer(parseInt(answer.testId),parseInt(answer.questionId),timeSpent,valueAnswer,{async:false,callback:function(){}});if(finishTest){Tests.idx++;if(Tests.idx==Tests.test.questions.length){UserControl.retrieveTestRewards(answer.testId,Tests.drawFinal)}else{Tests.drawQuestion()}}};Tests.drawFinal=function(c){$("#testquestions").empty();var d=document.createElement("table");var e=document.createElement("tr");d.appendChild(e);var f=document.createElement("td");e.appendChild(f);var a=document.createElement("img");a.src="images/teacher_info.png";a.style.margin="10px";a.style.height="350px";f.rowSpan="3";f.appendChild(a);f=document.createElement("td");e.appendChild(f);f.innerHTML="Agora que voc&ecirc; encerrou essas quest&otilde;es de b&ocirc;nus, vamos avaliar quanto voc&ecirc; ganhou :";e=document.createElement("tr");d.appendChild(e);f=document.createElement("td");f.style.verticalAlign="top";e.appendChild(f);var b=document.createElement("table");f.appendChild(b);b.style.border="1px solid yellow";b.style.borderRadius="10px";b.style.padding="10px";b.style.backgroundColor="#F8D686";b.style.margin="0 auto";e=document.createElement("tr");b.appendChild(e);f=document.createElement("td");e.appendChild(f);f.innerHTML="Pontos de XP";f=document.createElement("td");e.appendChild(f);f.innerHTML=c[0]+"<img src='images/xp.png' style='vertical-align:middle'/>";f.style.textAlign="right";e=document.createElement("tr");b.appendChild(e);f=document.createElement("td");e.appendChild(f);f.innerHTML="Moedas";f.style.textAlign="right";f=document.createElement("td");e.appendChild(f);f.innerHTML=c[1]+"<img src='images/coin2.png' style='vertical-align:middle'/>";f.style.textAlign="right";e=document.createElement("tr");d.appendChild(e);f=document.createElement("td");e.appendChild(f);if(c[0]==0&&c[1]==0){f.innerHTML="Existir&atilde;o no futuro outras oportunidades para receber b&ocirc;nus. Mais aten&ccedil;&atilde;o da pr&oacute;xima vez."}else{f.innerHTML="Parab&eacute;ns pelo seu desempenho, e continue a jogar."}$("#testquestions").append(d);UserControl.addRewardsToCurrentUser(c[0],c[1]);$("#testsStart").css("display","none");$("#testsLogoff").css("display","none");$("#testsNextQuestion").css("display","none");$("#testsLetBlank").css("display","none");$("#testsPlay").css("display","inline");$("#continueTestAnotherDay").css("display","none");Game.hideHints=true};Tests.drawQuestion=function(){var question=Tests.test.questions[Tests.idx];$("#testquestions").empty();var stopWatch=document.createElement("div");stopWatch.style.position="fixed";stopWatch.style.right="0px";var canvas=document.createElement("canvas");canvas.id="stopWatchTests";canvas.width="40";canvas.height="32";stopWatch.appendChild(canvas);stopWatch.innerHTML=stopWatch.innerHTML+"<br/>"+question.timeLimit+" s";$("#testquestions").append(stopWatch);CountXP.init("stopWatchTests");var current=0;if(question.previousAnswer!=null){current=question.previousAnswer.timeSpend}CountXP.config(question.timeLimit,current,0,0,null,false);CountXP.start();var table=document.createElement("table");table.id="testTableContent";table.width="100%";table.style.borderCollapse="collapse";var tr=document.createElement("tr");var td=document.createElement("td");td.id="tdContent";td.innerHTML=changeImgHex(question.description);table.appendChild(tr);tr.appendChild(td);$("#testquestions").append(table);var mainDiv=document.createElement("div");mainDiv.id="testAnswerId";mainDiv.style.borderTop="1px solid black";$("#testquestions").append(mainDiv);var div=document.createElement("div");mainDiv.appendChild(div);div.style["float"]="left";div.style.padding="10px";div.style.fontSize="14px";div.innerHTML=question.question;Tests.dropExpand=null;var input=null;switch(question.answerType){case"N":input=document.createElement("input");input.id="answerQuestion";input.type="number";input.value="";input.style.borderColor="red";input.style.margin="10px";input.addEventListener("change",Tests.closeDrop,false);input.onkeypress=function(event){return((event.charCode>=48&&event.charCode<=57)||event.charCode==0)};mainDiv.appendChild(input);$("#continueTestAnotherDay").css("display","none");break;case"C":var movePanel=document.createElement("div");movePanel.className="move-panel";movePanel.style.right="10px";movePanel.style.position="fixed";movePanel.style.top="auto";movePanel.style.backgroundColor="white";var b=document.createElement("a");b.id="testExpandWorkspace";b.className="move-up";b.onclick=Tests.hideElements;movePanel.appendChild(b);var tdButton=document.createElement("td");tdButton.style.borderBottom="1px solid red";tdButton.style.verticalAlign="bottom";tdButton.appendChild(movePanel);mainDiv.appendChild(tdButton);input=document.createElement("div");input.id="answerQuestion";input.type="blockly";input.style.width="98%";mainDiv.appendChild(input);TestRT={};eval(question.language);var sizeBlockly=$("#testquestions").height()-$("#testTableContent").height()-35;$("#answerQuestion").css("height",sizeBlockly+"px");Blockly.inject(input,{media:"media/",rtl:false,toolbox:question.toolbox,trashcan:true,comments:false,scrollbars:true,zoom:{enabled:true,controls:true,wheel:true,maxScale:2,minScale:0.1,scaleSpeed:1.1}});Game.hideHints=false;var toolBox=$(".blocklyToolboxDiv");if(toolBox.length>0){$("body").detach(".blocklyToolboxDiv");$("#answerQuestion").append(toolBox)}if(!Tests.dropShowed){Tests.dropExpand=new Drop({target:movePanel,content:"Clique aqui para expandir",position:"left bottom",classes:"drop-theme-arrows",constrainToScrollParent:false,tetherOptions:{offset:"0 25"},remove:true,openOn:""})}var answerBlocks=null;if(question.previousAnswer==null){answerBlocks=question.blocks}else{answerBlocks=question.previousAnswer.answer}Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,Blockly.Xml.textToDom(answerBlocks));break}input.testId=Tests.test.id;input.questionId=question.id;$("#testsNextQuestion").html(BlocklyApps.getMsg("Tests_Done")+" ["+question.xpReward+" <img src='images/xp.png' style='vertical-align:middle;width:20px'/>]");$("#testsLetBlank").html(BlocklyApps.getMsg("Tests_LetBlank")+" ["+question.xpRewardBlank+" <img src='images/xp.png' style='vertical-align:middle;width:20px'/>]");$("#continueTestAnotherDay").css("display","inline")};Tests.resizeWindow=function(b){if(document.getElementById("answerQuestion").type!=="blockly"){return}var a=$("#testquestions").height()-$("#testTableContent").height()-35;$("#answerQuestion").css("height",a+"px");if(Tests.dropExpand!=null&&!Tests.dropShowed){Tests.dropExpand.open();Tests.dropShowed=true}};Tests.hideElements=function(){if(Tests.dropExpand!=null){Tests.dropExpand.close()}var d=document.getElementById("tdContent");var c=d.firstElementChild;while(c!=null){c.style.display="none";c=c.nextElementSibling}var b=document.getElementById("testExpandWorkspace");b.className="move-down";b.onclick=Tests.showElements;Blockly.fireUiEvent(window,"resize")};Tests.showElements=function(){var d=document.getElementById("tdContent");var c=d.firstElementChild;while(c!=null){c.style.display="inline";c=c.nextElementSibling}var b=document.getElementById("testExpandWorkspace");b.className="move-up";b.onclick=Tests.hideElements;Blockly.fireUiEvent(window,"resize")};Tests.closeDrop=function(){if(Tests.drop!=null&&Tests.drop!=undefined){Tests.drop.remove();Tests.drop=null}};Tests.letBlank=function(){confirm("Deseja realmente executar essa a&#231;&#227;o ?",function(){Tests.performQuestion("-1",true)})};Tests.stopNow=function(){window.removeEventListener("resize",Tests.resizeWindow);window.removeEventListener("beforeunload",Tests.stopNow);if(Tests.dropExpand!=null){Tests.dropExpand.close()}if(Tests.idx>=0){Tests.performQuestion(null,false)}Game.logoffButtonClick()};Tests.play=function(){window.removeEventListener("resize",Tests.resizeWindow);window.removeEventListener("beforeunload",Tests.stopNow);$("#testsPlay").css("display","none");$("#testquestions").remove();MyBlocklyApps.hideDialog(false);BlocklyApps.dialogDispose_=Game.afterTestDialog.f};