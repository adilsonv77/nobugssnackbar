"use strict";var nav={};nav.onload=function(f){if(c()||d()){return}window.location.href="error.html";function b(){return navigator.appVersion.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1}function c(){return navigator.appVersion.indexOf("Chrome")>-1}function d(){return navigator.userAgent.indexOf("Firefox")>-1}function a(){return navigator.userAgent.indexOf("Safari")>-1}function g(){return navigator.userAgent.indexOf("Opera")>-1}};"use strict";Blockly.genUid.soup_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";Blockly.Blocks.controls_if.oldControlsIfInit=Blockly.Blocks.controls_if.init;Blockly.Blocks.controls_if.init=function(){this.oldControlsIfInit();if(Blockly.Blocks.controls_if.useMutator){this.setMutator(new Blockly.Mutator(["controls_if_else"]))}else{this.setMutator(null)}};function initBasedOnMissionConfig(b){var a=true;var c=b;if(Game.toolbox){if(Game.missionType==="fixBugs"){c.showNewVar=Game.allowsCreateVars==="true"}else{if(Game.toolbox==='<xml id="toolbox" style="display: none"></xml>'){if(c.inputList[0].fieldRow.length>0){c.inputList[0].fieldRow[0].menuGenerator_=function(){return[[this.getText(),this.getText()]]}}}else{a=false}}if(a){c.contextMenuMsg_=null;c.contextMenuType_=null;c.customContextMenu=null}}return !a}Blockly.Blocks.variables_get.oldVariablesGetInit=Blockly.Blocks.variables_get.init;Blockly.Blocks.variables_get.init=function(){this.oldVariablesGetInit();initBasedOnMissionConfig(this)};Blockly.Blocks.variables_set.init=function(){this.setHelpUrl(Blockly.Msg.VARIABLES_SET_HELPURL);this.jsonInit({message0:BlocklyApps.getMsg("Blockly_variableSet"),args0:[{type:"input_value",name:"VALUE"},{type:"field_variable",name:"VAR",variable:Blockly.Msg.VARIABLES_DEFAULT_NAME}],colour:Blockly.Blocks.variables.HUE});this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(Blockly.Msg.VARIABLES_SET_TOOLTIP);var a=initBasedOnMissionConfig(this);this.contextMenuMsg_=(a?Blockly.Msg.VARIABLES_SET_CREATE_GET:null);this.contextMenuType_=(a?"variables_get":null)};Blockly.Connection.prototype.checkType_=function(c){var d=this.targetBlock();if(d&&!d.isMovable()&&!this.sourceBlock_.isMovable()){return true}var b=c.targetBlock();if(b&&!b.isMovable()&&!c.sourceBlock_.isMovable()){return true}if(!this.check_||!c.check_){return true}for(var a=0;a<this.check_.length;a++){if(c.check_.indexOf(this.check_[a])!=-1){return true}}return false};Blockly.Blocks.controls_whileUntil.oldInit=Blockly.Blocks.controls_whileUntil.init;Blockly.Blocks.controls_whileUntil.init=function(){this.oldInit();this.inputList.shift();this.appendValueInput("BOOL").setCheck("Boolean").appendField(new Blockly.FieldLabel(Blockly.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE));var a=this.inputList[0];this.inputList[0]=this.inputList[1];this.inputList[1]=a;this.inputList[0].fieldRow[0].name="MODE";this.inputList[0].fieldRow[0].value="WHILE"};Blockly.FieldTextInput.prototype.oldShowEditor_=Blockly.FieldTextInput.prototype.showEditor_;Blockly.FieldTextInput.prototype.showEditor_=function(a){if(Game.toolbox==='<xml id="toolbox" style="display: none"></xml>'&&Game.missionType!=="fixBugs"){return}this.oldShowEditor_(a)};Blockly.Blocks.math_arithmetic.init=function(){this.jsonInit({message0:"(%1 %2 %3)",colour:Blockly.Blocks.math.HUE,args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[[Blockly.Msg.MATH_ADDITION_SYMBOL,"ADD"],[Blockly.Msg.MATH_SUBTRACTION_SYMBOL,"MINUS"],[Blockly.Msg.MATH_MULTIPLICATION_SYMBOL,"MULTIPLY"],[Blockly.Msg.MATH_DIVISION_SYMBOL,"DIVIDE"],[Blockly.Msg.MATH_POWER_SYMBOL,"POWER"]]},{type:"input_value",name:"B",check:"Number"}]});this.setHelpUrl(Blockly.Msg.MATH_ARITHMETIC_HELPURL);this.setOutput(true,"Number");this.setInputsInline(true);var a=this;this.setTooltip(function(){var c=a.getFieldValue("OP");var b={ADD:Blockly.Msg.MATH_ARITHMETIC_TOOLTIP_ADD,MINUS:Blockly.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS,MULTIPLY:Blockly.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY,DIVIDE:Blockly.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE,POWER:Blockly.Msg.MATH_ARITHMETIC_TOOLTIP_POWER};return b[c]});if(Game.toolbox==='<xml id="toolbox" style="display: none"></xml>'&&Game.missionType!=="fixBugs"){this.inputList[1].fieldRow[0].options_=this.inputList[1].fieldRow[0].menuGenerator_;this.inputList[1].fieldRow[0].menuGenerator_=function(){var c=this.getText();for(var b=0;b<this.options_.length;b++){if(this.options_[b][1]===this.getValue()){c=this.options_[b][0];break}}return[[c,this.getValue()]]}}};Blockly.Blocks.logic_operation.init=function(){var b=[[Blockly.Msg.LOGIC_OPERATION_AND,"AND"],[Blockly.Msg.LOGIC_OPERATION_OR,"OR"]];this.setHelpUrl(Blockly.Msg.LOGIC_OPERATION_HELPURL);this.setColour(Blockly.Blocks.logic.HUE);this.setOutput(true,"Boolean");this.appendDummyInput().appendField("(");this.appendValueInput("A").setCheck("Boolean");this.appendValueInput("B").setCheck("Boolean").appendField(new Blockly.FieldDropdown(b),"OP");this.appendDummyInput().appendField(")");this.setInputsInline(true);var a=this;this.setTooltip(function(){var d=a.getFieldValue("OP");var c={AND:Blockly.Msg.LOGIC_OPERATION_TOOLTIP_AND,OR:Blockly.Msg.LOGIC_OPERATION_TOOLTIP_OR};return c[d]})};Blockly.Blocks.logic_compare.oldInit=Blockly.Blocks.logic_compare.init;Blockly.Blocks.logic_compare.init=function(){this.oldInit();if(Game.toolbox==='<xml id="toolbox" style="display: none"></xml>'&&Game.missionType!=="fixBugs"){this.inputList[1].fieldRow[0].options_=this.inputList[1].fieldRow[0].menuGenerator_;this.inputList[1].fieldRow[0].menuGenerator_=function(){var b=this.getText();for(var a=0;a<this.options_.length;a++){if(this.options_[a][1]===this.getValue()){b=this.options_[a][0];break}}return[[b,this.getValue()]]}}};Blockly.JavaScript.controls_for=function(h){var b=Blockly.JavaScript.variableDB_.getName(h.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE);var g=Blockly.JavaScript.valueToCode(h,"FROM",Blockly.JavaScript.ORDER_ASSIGNMENT)||"0";var f=Blockly.JavaScript.valueToCode(h,"TO",Blockly.JavaScript.ORDER_ASSIGNMENT)||"0";var a=Blockly.JavaScript.valueToCode(h,"BY",Blockly.JavaScript.ORDER_ASSIGNMENT)||"1";var c=Blockly.JavaScript.statementToCode(h,"DO");c=Blockly.JavaScript.addLoopTrap(c,h.id);var e;e="for ("+b+" = "+g+"; "+b+" <= "+f+"; "+b;var d=Math.abs(parseFloat(a));e+=" += "+d;e+=") {\n"+c+"}\n";return e};Blockly.FieldVariable.dropdownChange=function(g){function f(j,i,h){Blockly.hideChaff();var k=function(l){if(l){l=l.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"");if(l==Blockly.Msg.RENAME_VARIABLE||l==Blockly.Msg.NEW_VARIABLE){l=null}}Hints.startHints();h(l)};window.prompt(j,i,k)}Game.sourceBlock_=this.sourceBlock_;var b=this.sourceBlock_.workspace;var c=this;if(g==Blockly.Msg.RENAME_VARIABLE){var d=this.getText();var a=function(h){if(h){Blockly.Variables.renameVariable(d,h,b)}};g=f(Blockly.Msg.RENAME_VARIABLE_TITLE.replace("%1",d),d,a);return null}else{if(g==Blockly.Msg.NEW_VARIABLE){var e=function(h){if(h){Blockly.Variables.renameVariable(h,h,b);c.setValue(h)}};f(Blockly.Msg.NEW_VARIABLE_TITLE,"",e);return null}}return undefined};Blockly.FieldVariable.getVars=function(d){var b=[];if(d.getVars){var a=d.getVars();for(var c=a.length-1;c>=0;c--){b.push(a[c])}}if(d.childBlocks_){d.childBlocks_.forEach(function(e){Blockly.FieldVariable.getVars(e).forEach(function(f){b.push(f)})})}return b};Blockly.FieldVariable.dropdownCreate=function(){var e=(this.sourceBlock_==null?true:this.sourceBlock_.showNewVar);var b=[];if(this.sourceBlock_&&this.sourceBlock_.workspace){b=Blockly.Variables.procVariables(this.sourceBlock_)}var d=this.getText();if(d&&b.indexOf(d)==-1){b.push(d)}b.sort(goog.string.caseInsensitiveCompare);if(e==undefined||e){b.push(Blockly.Msg.RENAME_VARIABLE);b.push(Blockly.Msg.NEW_VARIABLE)}var c=[];for(var a=0;a<b.length;a++){c[a]=[b[a],b[a]]}return c};Blockly.Blocks.lists_create_limited={init:function(){this.jsonInit({message0:BlocklyApps.getMsg("Blockly_listsCreate")+" [%1]",args0:[{type:"input_value",name:"SIZE",check:"Number"}],output:"Array",colour:Blockly.Blocks.lists.HUE})}};Blockly.JavaScript.lists_create_limited=function(b){var a=Blockly.JavaScript.valueToCode(b,"SIZE",Blockly.JavaScript.ORDER_NONE)||"";return["arrayCreate("+a+")",Blockly.JavaScript.ORDER_ATOMIC]};Blockly.Blocks.lists_get={init:function(){this.jsonInit({message0:BlocklyApps.getMsg("Blockly_listsGet"),args0:[{type:"input_value",name:"ARRAY",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"}],colour:Blockly.Blocks.lists.HUE});this.setOutput(true);this.setInputsInline(true)}};Blockly.JavaScript.lists_get=function(b){var c=Blockly.JavaScript.valueToCode(b,"ARRAY",Blockly.JavaScript.ORDER_NONE)||"null";var a=Blockly.JavaScript.valueToCode(b,"INDEX",Blockly.JavaScript.ORDER_NONE)||"-1";return["arrayGetValue("+c+", "+a+")",Blockly.JavaScript.ORDER_ATOMIC]};Blockly.Blocks.lists_set={init:function(){this.jsonInit({message0:BlocklyApps.getMsg("Blockly_listsSet"),args0:[{type:"input_value",name:"ARRAY",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"},{type:"input_value",name:"VALUE"}],colour:Blockly.Blocks.lists.HUE});this.setInputsInline(true);this.setPreviousStatement(true);this.setNextStatement(true)}};Blockly.JavaScript.lists_set=function(c){var d=Blockly.JavaScript.valueToCode(c,"ARRAY",Blockly.JavaScript.ORDER_NONE)||"null";var a=Blockly.JavaScript.valueToCode(c,"INDEX",Blockly.JavaScript.ORDER_NONE)||"-1";var b=Blockly.JavaScript.valueToCode(c,"VALUE",Blockly.JavaScript.ORDER_NONE)||"-1";return"arraySetValue("+d+","+a+","+b+");\n"};Blockly.JavaScript.lists_length=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_FUNCTION_CALL)||"[]";return["arrayLength("+a+")",Blockly.JavaScript.ORDER_MEMBER]};Blockly.Blocks.procedures_callnoreturn.oldInit=Blockly.Blocks.procedures_callnoreturn.init;Blockly.Blocks.procedures_callnoreturn.init=function(){this.oldInit();this.setInputsInline(true)};Blockly.Blocks.procedures_callnoreturn.oldRenderArgs_=Blockly.Blocks.procedures_callnoreturn.renderArgs_;Blockly.Blocks.procedures_callnoreturn.renderArgs_=function(){this.oldRenderArgs_()};Blockly.Blocks.procedures_callreturn.oldInit=Blockly.Blocks.procedures_callreturn.init;Blockly.Blocks.procedures_callreturn.init=function(){this.oldInit();this.setInputsInline(true)};Blockly.Block.prototype.setColour=function(b){var a=parseFloat(b);if(!isNaN(a)){this.colour_=Blockly.hueToRgb(a)}else{if(goog.isString(b)&&b.match(/^#[0-9a-fA-F]{6}$/)){this.colour_=b}else{throw"Invalid colour: "+b}}if(this.rendered){this.updateColour()}};"use strict";Blockly.Snippets={};Blockly.Blocks.move_goToBarCounter={init:function(){this.setColour(160);this.appendValueInput("VALUE").setCheck("Number").appendField("goToBarCounter");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToBarCounterTooltip"))}};Blockly.JavaScript.move_goToBarCounter=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"goToBarCounter("+a+");\n"};Blockly.Snippets.move_goToBarCounter={completer:{caption:"goToBarCounter",snippet:"goToBarCounter(${1:1});",meta:"snackman",type:"snackman"},registeredName:"goToBarCounter"};Blockly.Blocks.move_goToTable={init:function(){this.setColour(160);this.appendValueInput("VALUE").setCheck("Number").appendField("goToTable");this.setPreviousStatement(true);this.setNextStatement(true)}};Blockly.JavaScript.move_goToTable=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"goToTable("+a+");\n"};Blockly.Blocks.do_talk={init:function(){this.setColour(160);this.appendValueInput("VALUE").appendField("talk");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_talkTooltip"))}};Blockly.JavaScript.do_talk=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"talk("+a+");\n"};Blockly.Blocks.do_deliver={init:function(){this.setColour(160);this.appendValueInput("VALUE").appendField("deliver");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_deliverTooltip"))}};Blockly.JavaScript.do_deliver=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"deliver("+a+");\n updateVariables(); \n "};Blockly.Blocks.ask_isThereACustomer={init:function(){this.setColour(160);this.setOutput(true,"Boolean");this.appendDummyInput().appendField("isThereACustomer");this.setTooltip(BlocklyApps.getMsg("SnackMan_isThereACustomerTooltip"))}};Blockly.JavaScript.ask_isThereACustomer=function(a){return["isThereACustomer( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.do_wait={init:function(){this.jsonInit({message0:"wait %1 s",args0:[{type:"input_value",name:"VALUE"}],colour:Blockly.Blocks.variables.HUE});this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("SnackMan_waitTooltip")}};Blockly.JavaScript.do_wait=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"0";return"WAIT_NOBUGS["+(parseInt(a)*1000)+"]"};Blockly.Blocks.money_cashIn={init:function(){this.setColour(160);this.setOutput(true);this.appendValueInput("VALUE").appendField("cashIn");this.setTooltip(BlocklyApps.getMsg("SnackMan_cashInTooltip"))}};Blockly.JavaScript.money_cashIn=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["cashIn( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.money_giveChange={init:function(){this.jsonInit({message0:"giveChange %1 "+BlocklyApps.getMsg("_with")+" %2 ",args0:[{type:"input_value",name:"VALUE"},{type:"input_value",name:"COINSBANKNOTES"}],colour:160});this.setInputsInline(true);this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_giveChangeTooltip"))}};Blockly.JavaScript.money_giveChange=function(c){var b=Blockly.JavaScript.valueToCode(c,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";var a=Blockly.JavaScript.valueToCode(c,"COINSBANKNOTES",Blockly.JavaScript.ORDER_NONE)||"null";return"giveChange( "+b+","+a+" );\n"};Blockly.Blocks.const_money1={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_coin")+" 1")}};Blockly.JavaScript.const_money1=function(a){return['"\\"$$$money1\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money2={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_coin")+" 2")}};Blockly.JavaScript.const_money2=function(a){return['"\\"$$$money2\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money5={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_banknote")+" 5")}};Blockly.JavaScript.const_money5=function(a){return['"\\"$$$money5\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money10={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_banknote")+" 10")}};Blockly.JavaScript.const_money10=function(a){return['"\\"$$$money10\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_money20={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_banknote")+" 20")}};Blockly.JavaScript.const_money20=function(a){return['"\\"$$$money20\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToDisplay={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToDisplay");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToDisplayTooltip"))}};Blockly.JavaScript.move_goToDisplay=function(a){return"goToDisplay();\n"};Blockly.Blocks.ask_askForFood={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askForFood");this.setTooltip(BlocklyApps.getMsg("SnackMan_askForFoodTooltip"))}};Blockly.JavaScript.ask_askForFood=function(a){if(Game!==undefined){Game.addCallTimes("askForFood")}return["askForFood()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askHasHunger={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askHasHunger");this.setTooltip(BlocklyApps.getMsg("SnackMan_askHasHungerTooltip"))}};Blockly.JavaScript.ask_askHasHunger=function(a){return["hasHunger( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.prepare_pickUpHotDog={init:function(){this.setColour(160);this.setOutput(true,"Foods");this.appendValueInput("VALUE").setCheck("FoodOrder").appendField("pickUpHotDog");this.setTooltip(BlocklyApps.getMsg("SnackMan_catchFoodTooltip"))}};Blockly.JavaScript.prepare_pickUpHotDog=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpHotDog( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askWantHowManyFoods={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askWantHowManyFoods");this.setTooltip(BlocklyApps.getMsg("SnackMan_askWantHowManyFoodsTooltip"))}};Blockly.JavaScript.ask_askWantHowManyFoods=function(a){if(Game!==undefined){Game.addCallTimes("askWantHowManyFoods")}return["askWantHowManyFoods()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Snippets.ask_askWantHowManyFoods={completer:{caption:"askWantHowManyFoods",snippet:"askWantHowManyFoods()",meta:"snackman",type:"snackman"}};Blockly.Blocks.move_goToCooler={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToCooler");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToCoolerTooltip"))}};Blockly.JavaScript.move_goToCooler=function(a){return"goToCooler();\n"};Blockly.Blocks.move_goToBoxOfFruits={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToBoxOfFruits");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToBoxOfFruitsTooltip"))}};Blockly.JavaScript.move_goToBoxOfFruits=function(a){return"goToBoxOfFruits();\n"};Blockly.Blocks.prepare_pickUpFruits={init:function(){this.setColour(160);this.setOutput(true);this.appendValueInput("VALUE").appendField("pickUpFruits");this.setTooltip(BlocklyApps.getMsg("SnackMan_catchFruitsTooltip"))}};Blockly.JavaScript.prepare_pickUpFruits=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpFruits("+a+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToJuiceMachine={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToJuiceMachine");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToJuiceMachineTooltip"))}};Blockly.JavaScript.move_goToJuiceMachine=function(a){return"goToJuiceMachine();\n"};Blockly.Blocks.prepare_prepareAndPickUpJuice={init:function(){this.setColour(160);this.setOutput(true);this.appendValueInput("VALUE").appendField("prepareAndPickUpJuice");this.setTooltip(BlocklyApps.getMsg("SnackMan_prepareAndCatchJuiceTooltip"))}};Blockly.JavaScript.prepare_prepareAndPickUpJuice=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["prepareAndPickUpJuice("+a+")",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askForDrink={init:function(){this.setColour(160);this.setOutput(true,"DrinkOrder");this.appendDummyInput().appendField("askForDrink");this.setTooltip(BlocklyApps.getMsg("SnackMan_askForDrinkTooltip"))}};Blockly.JavaScript.ask_askForDrink=function(a){if(Game!==undefined){Game.addCallTimes("askForDrink")}return["askForDrink( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askHasThirsty={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askHasThirsty");this.setTooltip(BlocklyApps.getMsg("SnackMan_askHasThirstyTooltip"))}};Blockly.JavaScript.ask_askHasThirsty=function(a){return["hasThirsty( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.prepare_pickUpDrink={init:function(){this.setColour(160);this.setOutput(true,"Drinks");this.appendValueInput("VALUE").setCheck("DrinkOrder").appendField("pickUpDrink");this.setTooltip(BlocklyApps.getMsg("SnackMan_catchDrinkTooltip"))}};Blockly.JavaScript.prepare_pickUpDrink=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpDrink( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askWantHowManyDrinks={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askWantHowManyDrinks");this.setTooltip(BlocklyApps.getMsg("SnackMan_askWantHowManyDrinksTooltip"))}};Blockly.JavaScript.ask_askWantHowManyDrinks=function(a){if(Game!==undefined){Game.addCallTimes("askWantHowManyDrinks")}return["askWantHowManyDrinks()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Snippets.ask_askWantHowManyDrinks={completer:{caption:"askWantHowManyDrinks",snippet:"askWantHowManyDrinks()",meta:"snackman",type:"snackman"}};Blockly.Blocks.const_juiceOfOrange={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("juiceOfOrange");this.setTooltip(BlocklyApps.getMsg("SnackMan_constjuiceOfOrangeTooltip"))}};Blockly.JavaScript.const_juiceOfOrange=function(a){return['"\\"$$$juiceoforange\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_softDrink={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("softDrink");this.setTooltip(BlocklyApps.getMsg("SnackMan_constSoftDrinkTooltip"))}};Blockly.JavaScript.const_softDrink=function(a){return['"\\"$$$coke\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_hotdog={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("hotdog")}};Blockly.JavaScript.const_hotdog=function(a){return['"\\"$$$hotdog\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.move_goToIceCreamMachine={init:function(){this.setColour(160);this.appendDummyInput().appendField("goToIceCreamMachine");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip(BlocklyApps.getMsg("SnackMan_goToIceCreamMachineTooltip"))}};Blockly.JavaScript.move_goToIceCreamMachine=function(a){return"goToIceCreamMachine(); \n"};Blockly.Blocks.prepare_pickUpIceCream={init:function(){this.setColour(160);this.setOutput(true,"Foods");this.appendValueInput("VALUE").setCheck("FoodOrder").appendField("preparePickUpIceCream");this.setTooltip(BlocklyApps.getMsg("SnackMan_pickUpIceCreamTooltip"))}};Blockly.JavaScript.prepare_pickUpIceCream=function(b){var a=Blockly.JavaScript.valueToCode(b,"VALUE",Blockly.JavaScript.ORDER_NONE)||"null";return["pickUpIceCream( "+a+" )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_chocolate={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField("Chocolate")}};Blockly.JavaScript.const_chocolate=function(a){return['"\\"$$$icecreamofchocolate\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_strawberry={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_strawberry"))}};Blockly.JavaScript.const_strawberry=function(a){return['"\\"$$$icecreamofstrawberry\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.const_vanilla={init:function(){this.setColour(50);this.setOutput(true);this.appendDummyInput().appendField(BlocklyApps.getMsg("_vanilla"))}};Blockly.JavaScript.const_vanilla=function(a){return['"\\"$$$icecreamofvanilla\\""',Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Blocks.ask_askWantHowManyIceCream={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askWantHowManyIceCream");this.setTooltip(BlocklyApps.getMsg("SnackMan_askWantHowManyIceCreamTooltip"))}};Blockly.JavaScript.ask_askWantHowManyIceCream=function(a){if(Game!==undefined){Game.addCallTimes("askWantHowManyIceCream")}return["askWantHowManyIceCream()",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Snippets.ask_askWantHowManyIceCream={completer:{caption:"askWantHowManyIceCream",snippet:"askWantHowManyIceCream()",meta:"snackman",type:"snackman"}};Blockly.Blocks.ask_askForIceCream={init:function(){this.setColour(160);this.setOutput(true);this.appendDummyInput().appendField("askForIceCream");this.setTooltip(BlocklyApps.getMsg("SnackMan_askForIceCreamTooltip"))}};Blockly.JavaScript.ask_askForIceCream=function(a){return["askForIceCream( )",Blockly.JavaScript.ORDER_FUNCTION_CALL]};Blockly.Snippets.controls_if={completer:{caption:"if",snippet:"if (${1:true}) {\n ${0}\n}\n",meta:"condicional",type:"condicional"}};Blockly.Snippets.controls_for={completer:{caption:"for",snippet:"for (var ${1:i} = 1; $1 < ${2:3}; $1++) {\n \n}\n",meta:"ciclo",type:"ciclo"}};Blockly.Snippets["var"]={completer:{caption:"var",snippet:"var ${1:pedido} = ${2:0};",meta:"variaveis",type:"variaveis"}};Blockly.Blocks.switch_case={init:function(){this.setColour(180);this.setPreviousStatement(true);this.setNextStatement(true);this.appendValueInput("CONDITION").appendField("the case is");this.appendValueInput("CASECONDITION0").appendField("in case of");this.appendStatementInput("CASE0").appendField("do");this.setMutator(new Blockly.Mutator(["case_incaseof","case_default"]));this.setTooltip("Does something if the condition is true. If there isn't a matching case the default function will be executed.");this.caseCount_=0;this.defaultCount_=0},mutationToDom:function(){if(!this.caseCount_&&!this.defaultCount_){return null}var a=document.createElement("mutation");if(this.caseCount_){a.setAttribute("case",this.caseCount_)}if(this.defaultCount_){a.setAttribute("default",1)}return a},domToMutation:function(b){this.caseCount_=parseInt(b.getAttribute("case"),10);this.defaultCount_=parseInt(b.getAttribute("default"),10);for(var a=1;a<=this.caseCount_;a++){this.appendValueInput("CASECONDITION"+a).appendField("in case of");this.appendStatementInput("CASE"+a).appendField("do")}if(this.defaultCount_){this.appendStatementInput("ONDEFAULT").appendField("default")}},decompose:function(d){var b=Blockly.Block.obtain(d,"control_case");b.initSvg();var c=b.getInput("STACK").connection;for(var a=1;a<=this.caseCount_;a++){var f=Blockly.Block.obtain(d,"case_incaseof");f.initSvg();c.connect(f.previousConnection);c=f.nextConnection}if(this.defaultCount_){var e=Blockly.Block.obtain(d,"case_default");e.initSvg();c.connect(e.previousConnection)}return b},compose:function(b){if(this.defaultCount_){this.removeInput("ONDEFAULT")}this.defaultCount_=0;for(var a=this.caseCount_;a>0;a--){this.removeInput("CASECONDITION"+a);this.removeInput("CASE"+a)}this.caseCount_=0;var d=b.getInputTargetBlock("STACK");while(d){switch(d.type){case"case_incaseof":this.caseCount_++;var c=this.appendValueInput("CASECONDITION"+this.caseCount_).appendField("in case of");var f=this.appendStatementInput("CASE"+this.caseCount_).appendField("do");if(d.valueConnection_){c.connection.connect(d.valueConnection_)}if(d.statementConnection_){f.connection.connect(d.statementConnection_)}break;case"case_default":this.defaultCount_++;var e=this.appendStatementInput("ONDEFAULT").appendField("default");if(d.statementConnection_){e.connection.connect(d.statementConnection_)}break;default:throw"Unknown block type."}d=d.nextConnection&&d.nextConnection.targetBlock()}},saveConnections:function(b){var d=b.getInputTargetBlock("STACK");var a=1;while(d){switch(d.type){case"case_incaseof":var c=this.getInput("CASECONDITION"+a);var f=this.getInput("CASE"+a);d.valueConnection_=c&&c.connection.targetConnection;d.statementConnection_=f&&f.connection.targetConnection;a++;break;case"case_default":var e=this.getInput("ONDEFAULT");d.satementConnection_=e&&e.connection.targetConnection;break;default:throw"Unknown block type"}d=d.nextConnection&&d.nextConnection.targetBlock()}}};Blockly.Blocks.control_case={init:function(){this.setColour(180);this.appendDummyInput().appendField("the case is");this.appendStatementInput("STACK");this.setTooltip("--Placeholder--");this.contextMenu=false}};Blockly.Blocks.case_incaseof={init:function(){this.setColour(180);this.appendDummyInput().appendField("in case of");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("--Placeholder--");this.contextMenu=false}};Blockly.Blocks.case_default={init:function(){this.setColour(180);this.appendDummyInput().appendField("default");this.setPreviousStatement(true);this.setNextStatement(false);this.setTooltip("This function will run if there aren't any matching cases.");this.contextMenu=false}};Blockly.JavaScript.switch_case=function(e){var b="";var d;var a;var h=Blockly.JavaScript.valueToCode(e,"CONDITION",Blockly.JavaScript.ORDER_NONE)||null;if(h){var f=/^([a-zA-Z_]+(\d|[a-zA-Z_])*)$/g;if(f.test(h)){b="\nswitch ("+h+"){\n";var g=Blockly.JavaScript.valueToCode(e,"CASECONDITION0",Blockly.JavaScript.ORDER_NONE)||null;var i=Blockly.JavaScript.statementToCode(e,"CASE0");b+="\tcase "+g+":\n"+i+"\n\t\tbreak;\n";for(var c=1;c<=e.caseCount_;c++){a=Blockly.JavaScript.valueToCode(e,"CASECONDITION"+c,Blockly.JavaScript.ORDER_NONE)||null;if(a){d=Blockly.JavaScript.statementToCode(e,"CASE"+c);b+="\tcase "+a+":\n"+d+"\n\t\tbreak;\n"}}if(e.defaultCount_){d=Blockly.JavaScript.statementToCode(e,"ONDEFAULT");b+="\tdefault:\n"+d+"\n\t\tbreak;\n"}b+="}\n"}else{alert("switch_case: "+h+" is not a variable name")}}return b};"use strict";var Slider=function(h,f,b,e,i){this.KNOB_Y_=f-12;this.KNOB_MIN_X_=h+8;this.KNOB_MAX_X_=h+b-8;this.TARGET_OVERHANG_=20;this.value_=0.5;this.changeFunc_=i;this.animationTasks_=[];var d=document.createElementNS(Slider.SVG_NS_,"line");d.setAttribute("class","sliderTrack");d.setAttribute("x1",h);d.setAttribute("y1",f);d.setAttribute("x2",h+b);d.setAttribute("y2",f);e.appendChild(d);this.track_=d;var g=document.createElementNS(Slider.SVG_NS_,"rect");g.setAttribute("style","opacity: 0");g.setAttribute("x",h-this.TARGET_OVERHANG_);g.setAttribute("y",f-this.TARGET_OVERHANG_);g.setAttribute("width",b+2*this.TARGET_OVERHANG_);g.setAttribute("height",2*this.TARGET_OVERHANG_);g.setAttribute("rx",this.TARGET_OVERHANG_);g.setAttribute("ry",this.TARGET_OVERHANG_);e.appendChild(g);this.trackTarget_=g;var c=document.createElementNS(Slider.SVG_NS_,"path");c.setAttribute("class","sliderKnob");c.setAttribute("d","m 0,0 l -8,8 v 12 h 16 v -12 z");e.appendChild(c);this.knob_=c;var a=document.createElementNS(Slider.SVG_NS_,"circle");a.setAttribute("style","opacity: 0");a.setAttribute("r",this.TARGET_OVERHANG_);a.setAttribute("cy",f);e.appendChild(a);this.knobTarget_=a;this.setValue(0.5);while(e&&e.nodeName.toLowerCase()!="svg"){e=e.parentNode}this.SVG_=e;Slider.bindEvent_(this.knobTarget_,"mousedown",this,this.knobMouseDown_);Slider.bindEvent_(this.knobTarget_,"touchstart",this,this.knobMouseDown_);Slider.bindEvent_(this.trackTarget_,"mousedown",this,this.rectMouseDown_);Slider.bindEvent_(this.SVG_,"mouseup",null,Slider.knobMouseUp_);Slider.bindEvent_(this.SVG_,"touchend",null,Slider.knobMouseUp_);Slider.bindEvent_(this.SVG_,"mousemove",null,Slider.knobMouseMove_);Slider.bindEvent_(this.SVG_,"touchmove",null,Slider.knobMouseMove_);Slider.bindEvent_(document,"mouseover",null,Slider.mouseOver_)};Slider.SVG_NS_="http://www.w3.org/2000/svg";Slider.activeSlider_=null;Slider.startMouseX_=0;Slider.startKnobX_=0;Slider.prototype.knobMouseDown_=function(c){if(c.type=="touchstart"){if(c.changedTouches.length!=1){return}Slider.touchToMouse_(c)}Slider.activeSlider_=this;Slider.startMouseX_=this.mouseToSvg_(c).x;Slider.startKnobX_=0;var a=this.knob_.getAttribute("transform");if(a){var b=a.match(/translate\(\s*([-\d.]+)/);if(b){Slider.startKnobX_=Number(b[1])}}c.preventDefault()};Slider.knobMouseUp_=function(a){Slider.activeSlider_=null};Slider.mouseOver_=function(b){if(!Slider.activeSlider_){return}var a=b.target;do{if(a==Slider.activeSlider_.SVG_){return}}while(a=a.parentNode);Slider.knobMouseUp_(b)};Slider.knobMouseMove_=function(c){var b=Slider.activeSlider_;if(!b){return}if(c.type=="touchmove"){if(c.changedTouches.length!=1){return}Slider.touchToMouse_(c)}var a=b.mouseToSvg_(c).x-Slider.startMouseX_+Slider.startKnobX_;b.setValue((a-b.KNOB_MIN_X_)/(b.KNOB_MAX_X_-b.KNOB_MIN_X_))};Slider.prototype.rectMouseDown_=function(b){if(b.type=="touchstart"){if(b.changedTouches.length!=1){return}Slider.touchToMouse_(b)}var a=this.mouseToSvg_(b).x;this.animateValue((a-this.KNOB_MIN_X_)/(this.KNOB_MAX_X_-this.KNOB_MIN_X_))};Slider.prototype.getValue=function(){return this.value_};Slider.prototype.animateValue=function(f){while(this.animationTasks_.length){clearTimeout(this.animationTasks_.pop())}var g=200;var b=10;var c=this.getValue();var e=this;var a=function(h){return function(){var i=h*(f-c)/(b-1)+c;e.setValue(i)}};for(var d=0;d<b;d++){this.animationTasks_.push(setTimeout(a(d),d*g/b))}};Slider.prototype.setValue=function(b){this.value_=Math.min(Math.max(b,0),1);var a=this.KNOB_MIN_X_+(this.KNOB_MAX_X_-this.KNOB_MIN_X_)*this.value_;this.knob_.setAttribute("transform","translate("+a+","+this.KNOB_Y_+")");this.knobTarget_.setAttribute("cx",a);this.changeFunc_&&this.changeFunc_(this.value_)};Slider.prototype.mouseToSvg_=function(c){var b=this.SVG_.createSVGPoint();b.x=c.clientX;b.y=c.clientY;var a=this.SVG_.getScreenCTM().inverse();return b.matrixTransform(a)};Slider.bindEvent_=function(e,c,b,d){var a=function(f){d.apply(b,arguments)};e.addEventListener(c,a,false)};Slider.touchToMouse_=function(b){var a=b.changedTouches[0];b.clientX=a.clientX;b.clientY=a.clientY};"use strict";String.prototype.format=function(){var b=this;for(var a=0;a<arguments.length;a++){b=b.replace("%"+a,arguments[a])}return b};var window_prompt=window.prompt;var window_prompt_onclose,window_prompt_second_parameter;function performWindowPrompt(d){var c=null;try{if(d!=null){d=d.trim()}if(d===window_prompt_second_parameter){window_prompt_onclose(window_prompt_second_parameter);return null}var b=d==null||VariableNames.validate(d);if(b){window_prompt_onclose(d);return null}if(b==false){c=BlocklyApps.getMsg("Error_variableName")}}catch(a){c=BlocklyApps.getMsg("Error_showPrompt")}return c}window.prompt=function(b,a,c){window_prompt_onclose=c;window_prompt_second_parameter=a;Blockly.fireUiEventNow(window,"showWindowPrompt");Hints.stopHints();NoBugsWindowPrompt(b,a,performWindowPrompt,null)};var inherits=function(c,a){var b=Object.create(c.prototype);a.prototype=b;a.prototype.constructor=a};function innerXML(d){var e="";for(var c=0;c<d.childNodes.length;c++){var b=d.childNodes.item(c);var a=b.xml||(new XMLSerializer()).serializeToString(b);e+=a}return e}function convertImgHex(b,f){var a=[];var e=[];var d=[];for(var c=0;c<b.length;c++){a.push(b[c].getAttribute("id"));e.push(b[c].textContent);d.push(b[c].getAttribute("style"))}UserControl.existsImageKey(a,{async:false,callback:function(h){for(var j=0;j<h.length;j++){if(!h[j]){UserControl.convertHexToImage(a[j],e[j],{async:false,callback:function(){}})}var k=d[j];k=(k!=null?' style="'+k+'"':"");var g=' <img src="hintimg?i='+a[j]+'" '+k+"/>";f(a[j],e[j],g,k)}}})}function changeImgHex(c){if(c==null){return c}var e=c;var b=new DOMParser();var f=[];do{var h=c.indexOf("<imghex id=");if(h==-1){break}var d=c.indexOf("</imghex>")+9;var a=c.substring(h,d);var g=b.parseFromString(a,"text/xml");f.push(g.firstChild);c=c.substring(d+1)}while(true);c=e;convertImgHex(f,function(l,j,i,k){c=c.replace('<imghex id="'+l+'"'+k+">"+j+"</imghex>",i)});return c}function addZeros(a,b){a=a+"";while(a.length<b){a="0"+a}return a}function generateImages(a,b){a=addZeros(a,b);var c=new Array(b);$.each(c,function(d){c[d]=a[d]+".png"});return c}function componentToHex(b){var a=b.toString(16);return a.length==1?"0"+a:a}function rgbToHex(){var d,c,a;if(arguments.length==1){d=arguments[0].r;c=arguments[0].g;a=arguments[0].b}else{d=arguments[0];c=arguments[1];a=arguments[2]}return"#"+componentToHex(d)+componentToHex(c)+componentToHex(a)}function hexToRgb(b){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};"use strict";var PreloadImgs={};PreloadImgs.imgs={};PreloadImgs.keys=[];PreloadImgs.loaded=false;PreloadImgs.totalImgs=0;PreloadImgs.put=function(a,c,b){if(PreloadImgs.keys.indexOf(a)>-1){return}PreloadImgs.keys.push(a);PreloadImgs.imgs[a]={src:c,img:null};if(b!=undefined&&b){PreloadImgs.imgs[a].img=new Image();PreloadImgs.imgs[a].img.src=PreloadImgs.imgs[a].src}else{if(c!==""){PreloadImgs.totalImgs++}}};PreloadImgs.get=function(a){return PreloadImgs.imgs[a].img};PreloadImgs.loadImgs=function(d){var c=document.getElementById("preloadimgsxx");var e=0;for(var b=0;b<PreloadImgs.keys.length;b++){var a=PreloadImgs.imgs[PreloadImgs.keys[b]];if(a.img==null){c.style.background="url("+a.src+")";a.img=new Image();a.img.onload=function(){e++;if(e==PreloadImgs.totalImgs){PreloadImgs.loaded=true;d()}};a.img.src=a.src}}};"use strict";var LogClick={};LogClick.clicks=[];LogClick.store=function(a){var b=Date.now();LogClick.clicks.push([a,b]);if(LogClick.clicks.length>10){LogClick.save(true)}};LogClick.save=function(a){var b={callback:function(){},async:a};UserControl.saveClicks(LogClick.clicks,b);LogClick.clicks=[]};"use strict";var Game={};Game.runningStatus=0;Game.howManyRuns=0;Game.loadingMission=false;var hero;Game.mission=null;Game.hideHints=true;Game.pidList=[];Game.globalMoney;Game.globalXP;Game.lastErrorData;Game.jsInterpreter;Game.variableBox=null;Game.tipBox=null;Game.DOWN=1;Game.RIGHT=2;Game.varWindow=Game.RIGHT;Game.counterInstruction=null;Game.callTimes={};PreloadImgs.put("fundo","images/fundo_new.png");PreloadImgs.put("doors","images/door_new.png");Game.useCodeEditor=false;Game.editor=null;Game.clickReseting=false;Game.generalInit=function(){BlocklyApps.init();NoBugsJavaScript.redefine();Game.rtl=BlocklyApps.isRtl();Game.optResize={blocklyDivW:600,blocklyDivH:"90%",varBoxT:true,varBoxH:"90%"};Blockly.Generator.prototype.STATEMENT_PREFIX="highlightBlock(%1);\n";Blockly.JavaScript.addReservedWords("Game, code, NoBugsJavaScript");BlocklyApps.bindClick("selectMissionLogoffButton",Game.logoffButtonClick);BlocklyApps.bindClick("selectMissionLogoffButtonIntoMission",Game.intoTheMissionLogoffButtonClick);Game.playingTrack=-1;Game.tracks=[];Game.tracks[0]=new PlayAudio(["music/bensound-buddy.mp3"]);Game.tracks[1]=new PlayAudio(["music/bensound-energy.mp3"]);Game.tracks[2]=new PlayAudio(["music/di-evantile_savage-law.mp3"]);Game.tracks[3]=new PlayAudio(["music/Carefree.mp3","music/Wallpaper.mp3","music/bensound-cute.mp3"]);Game.tracks[3].shuffle();PreloadImgs.loadImgs(function(){Game.ctxDisplay=document.getElementById("display").getContext("2d");Game.tempDisplay=document.getElementById("displayTemp");Game.tempCtxDisplay=Game.tempDisplay.getContext("2d");Game.imgBackground=PreloadImgs.get("fundo");Game.ctxDisplay.drawImage(Game.imgBackground,0,0);Blockly.BlockSvg.Game=Game;AvatarImgMaker.init();Game.init()})};Game.init=function(){Game.currTime=0;window.removeEventListener("resize",Game.resizeMainWindow);window.removeEventListener("keydown",Game.keyDown);window.removeEventListener("keyup",Game.keyUp);document.removeEventListener("keydown",MyBlocklyApps.onKeyDown_,false);window.addEventListener("resize",Game.resizeMainWindow);window.addEventListener("keydown",Game.keyDown);window.addEventListener("keyup",Game.keyUp);Game.CTRLPRESSED=false;Game.SHIFTPRESSED=false;Game.blocksSelected=[];Game.lastDeletedBlocks=[];UserControl.verifyLogged(function(a){if(a[0]){Game.renderQuestionnaire(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12])}else{window.removeEventListener("beforeunload",Game.unload);document.getElementById("mainBody").style.display="none";document.getElementById("selectMission").style.display="none";document.getElementById("initialBackground").style.display="inline";Game.resizeMainWindow()}})};window.addEventListener("load",Game.generalInit);Game.resizeMainWindow=function(){};Game.keyDown=function(a){Game.CTRLPRESSED=a.ctrlKey;Game.SHIFTPRESSED=a.shiftKey};Game.keyUp=function(a){Game.CTRLPRESSED=false;Game.SHIFTPRESSED=false};Game.login=function(){document.getElementById("ButtonLogin").disabled="disabled";var a=document.getElementById("loginuser").value;var b=document.getElementById("loginpassw").value;UserControl.login(a,b,function(d){document.getElementById("ButtonLogin").disabled="";var c=document.getElementById("errorLogin");if(d[0]==null){document.getElementById("loginuser").value="";document.getElementById("loginpassw").value="";c.innerHTML="";Game.renderQuestionnaire(d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])}else{c.innerHTML=BlocklyApps.getMsg(d[0])}})};Game.renderQuestionnaire=function(l,f,e,i,a,m,k,c,d,j,g,b){Game.loginData={userLogged:l,doingLogoff:false,missionHist:f,leaderBoard:e,avatar:i,clazzId:d,levelId:j,missionIdx:g,missionView:b,xpToHat:parseInt(a),xpToClothes:parseInt(m),xpToSpecialSkin:parseInt(k),xpToAdd:parseInt(c)};AvatarImgMaker.configGender(Game.loginData.userLogged.sex);try{UserControl.retrieveQuestionnaire(function(n){if(n!=null){if(!Game.showQuestionnaire(n)){Game.continueLoginProcess()}}else{Game.continueLoginProcess()}})}catch(h){Game.init()}};Game.showQuestionnaire=function(b){var a=Questionnaire.createForm(b);if(a!=null){$("#contentQuestionnaire").html("");$("#contentQuestionnaire").append(a);MyBlocklyApps.showDialog(document.getElementById("dialogQuestionnaire"),null,false,true,true,$("#questionnaire").get(0).firstChild.data,null,null)}return a!=null};Game.finishQuestionnaire=function(){var a=Questionnaire.consistQuestionnaire();if(a){Questionnaire.handlingQuestionnaire(function(b){UserControl.saveQuestionnaire(b)});MyBlocklyApps.hideDialog(false);Game.continueLoginProcess()}};Game.continueLoginProcess=function(){try{UserControl.loadTests(function(b){if(b!=null){if(!Game.showTests(b[0],b[1])){Game.continueLoginProcessEx()}}else{Game.continueLoginProcessEx()}})}catch(a){Game.init()}};Game.showTests=function(c,b){var a=Tests.createForm(c);Game.afterTestDialog={};Game.afterTestDialog.nextTest=b;Game.afterTestDialog.f=null;if(a!=null){$("#contentTest").html("");$("#contentTest").append(a);Game.afterTestDialog.f=function(){if(!Game.loginData.doingLogoff){if(Game.afterTestDialog.nextTest!=null){if(!Game.showTests(Game.afterTestDialog.nextTest,null)){Game.continueLoginProcessEx()}}else{Game.continueLoginProcessEx()}}};MyBlocklyApps.showDialog(document.getElementById("dialogTest"),null,false,true,true,"Ganhe b&ocirc;nus",{width:"100%",height:"100%"},Game.afterTestDialog.f)}return a!=null};Game.continueLoginProcessEx=function(){if(Game.loginData.userLogged.lastTime==null){IntroGame.start()}else{Game.logged()}};Game.logged=function(){$("#playerNameInMission").html(Game.loginData.userLogged.name);if(Game.loginData.clazzId==undefined||Game.loginData.clazzId==0){AvatarEditor.init();UserControl.retrieveReward(Game.updatesReward);$("#playerName").html(Game.loginData.userLogged.name);$("#avatarEditor_playerName").html(Game.loginData.userLogged.name);Game.drawMiniAvatar();UserControl.updateUserLastTime();if(Game.variableBox!=null){Game.variableBox.style.display="none"}if(Game.tipBox!=null){Game.tipBox.style.display="none"}window.removeEventListener("beforeunload",Game.unload);document.getElementById("mainBody").style.display="none";document.getElementById("initialBackground").style.display="none";document.getElementById("selectMission").style.display="inline";Game.resizeMainWindow();BlocklyApps.bindClick("avatarEditorButton",Game.openAvatarEditor);BlocklyApps.bindClick("profileEditorButton",Game.openProfileEditor);BlocklyApps.bindClick("achievementsButton",Game.openAchievementList);BlocklyApps.bindClick("infotabButton",Game.openInfoTab);CityMap.init({onclick:Game.cityClick});Game.createsLeaderboard();CityMap.startAnimation();if(Game.loginData.userLogged.lastTime==null){IntroGame.presentTeacher(function(){IntroGame.focusAvatar()})}else{if(Game.loginData.userLogged.mail==null&&parseInt(Game.loginData.missionHist[0][3])>4){$("#profile_mail").attr("placeHolder",BlocklyApps.getMsg("Profile_PlaceHolder"));Game.openProfileEditor()}}}else{Game.missionSelected(Game.loginData.clazzId,Game.loginData.levelId,Game.loginData.missionIdx,Game.loginData.missionView)}};Game.openInfoTab=function(){var a=$("#explaintr").css("display");if(a=="none"){$("#explaintr").css("display","table-row");$("#imgInfoTab").attr("src","images/iconlessinfo.png")}else{$("#explaintr").css("display","none");$("#imgInfoTab").attr("src","images/iconmoreinfo.png")}};Game.createsLeaderboard=function(){if(Game.loginData.leaderBoard.length>0&&Game.loginData.leaderBoard[0][0]==null){createNoLeaderBoardInfo()}else{createsLeaderBoard()}};Game.updatesReward=function(a){document.getElementById("yourXP").innerHTML=a[0];document.getElementById("yourCash").innerHTML=a[1];document.getElementById("yourXPInMission").innerHTML=a[0];document.getElementById("yourCashInMission").innerHTML=a[1];Game.globalXP=parseInt(a[0]);Game.globalMoney=parseInt(a[1])};Game.cityClick=function(){if(Game.loginData.userLogged.lastTime==null){IntroGame.closeBeforeCity()}SelectLevel.generateBoard()};Game.drawMiniAvatar=function(){$("#avatarPlayer").css("width","100%");AvatarImgMaker.createBody(document.getElementById("avatarPlayer").getContext("2d"),Game.loginData.avatar,288,464);$("#avatarPlayer").css("width","72px")};Game.openAvatarEditor=function(a,l){var f="",b="",o="",i="",n="",j="",h="",m="",g="";Game.loginData.avatar.forEach(function(q){switch(q[0]){case"clothes":f=q[1];b=q[2];o=q[3];break;case"skin":n=q[2];break;case"hat":j=q[1];h=q[2];break;case"add":m=q[1];g=q[2];break;case"mouth":break;default:i=q[2]}});var e=parseInt(document.getElementById("yourXP").innerHTML);var k=(e<Game.loginData.xpToHat?"blocked:"+Game.loginData.xpToHat+":":"")+j;var d=(e<Game.loginData.xpToClothes?"blocked:"+Game.loginData.xpToClothes+":":"")+f;var c=(e<Game.loginData.xpToSpecialSkin?"blocked:"+Game.loginData.xpToSpecialSkin+":":"")+n;var p=(e<Game.loginData.xpToAdd?"blocked:"+Game.loginData.xpToAdd+":":"")+m;AvatarEditor.show(d,b,o,c,i,k,h,p,g,l)};Game.openProfileEditor=function(){var a=Game.loginData.userLogged;$("#profile_user_nick").html(a.nick);$("#profile_user_name").html(a.name);$("input[name=profile_user_mail]").val(a.mail);$("input[name=profile_user_password]").val("");$("input[name=profile_user_retypepassword]").val("");$("#profile_user_checkbox").attr("checked",false);$("input[name=profile_user_password]").attr("disabled","disabled");$("input[name=profile_user_retypepassword]").attr("disabled","disabled");$("#profile_user_save").removeAttr("disabled");$("#popenMissionrofileErrorRetypePassw").html("");MyBlocklyApps.showDialog(document.getElementById("dialogEditProfile"),null,false,true,true,$("#profileEditorButton").html(),{width:"600px"},function(){$("#profile_mail").attr("placeHolder","")})};Game.openAchievementList=function(){var a=new AchievementWindow();a.show()};Game.reloadInitialBlocksClick=function(){var a=function(){var d=Game.mission;var b=d.childNodes[0].getElementsByTagName("answers")[0];if(b==null){b=d.childNodes[0].getElementsByTagName("xml")[0]}var c=b.outerHTML||(new XMLSerializer()).serializeToString(b);Game.editor.cleanCode();Game.loadCode(c)};Hints.stopHints();confirm(BlocklyApps.getMsg("confirm_reloadblocks"),function(){a()},function(){Hints.startHints()},{height:"180px"})};Game.enablePasswordFields=function(){if($("#profile_user_checkbox").is(":checked")){$("input[name=profile_user_password]").removeAttr("disabled");$("input[name=profile_user_retypepassword]").removeAttr("disabled");Game.verifyRetypePassword()}else{$("input[name=profile_user_password]").attr("disabled","disabled");$("input[name=profile_user_retypepassword]").attr("disabled","disabled");$("#profile_user_save").removeAttr("disabled");$("#profileErrorRetypePassw").html("")}};Game.verifyRetypePassword=function(){if($("input[name=profile_user_password]").val().trim()!==""&&$("input[name=profile_user_password]").val()===$("input[name=profile_user_retypepassword]").val()){$("#profileErrorRetypePassw").html("");$("#profile_user_save").removeAttr("disabled")}else{$("#profileErrorRetypePassw").html(BlocklyApps.getMsg("Profile_WrongPassword"));$("#profile_user_save").attr("disabled","disabled")}};Game.saveProfile=function(){var a=Game.loginData.userLogged;var b=null;a.mail=$("input[name=profile_user_mail]").val();if($("#profile_user_checkbox").is(":checked")){b=$("input[name=profile_user_password]").val().trim()}UserControl.changeUser(a.mail,b);MyBlocklyApps.hideDialog(false)};Game.moveBlocksToZero=function(){var b=Blockly.mainWorkspace.getTopBlocks();for(var a=0;a<b.length;a++){b[a].moveBy(0,0)}};Game.startPlaying=function(a){Game.tracks[a].play();Game.playingTrack=a};Game.stopPlaying=function(){if(Game.playingTrack==-1){return}Game.tracks[Game.playingTrack].stop();Game.playingTrack=-1};Game.nextMission=function(b,d,f,e){var a=b==undefined;if(a){if(Game.loginData.missionIdx==Game.loginData.missionHist[Game.loginData.levelId-1][2]){Game.goBackToDashboard(null,false);Game.init();return}b=Game.loginData.clazzId;d=Game.loginData.levelId;f=Game.loginData.missionIdx+1;e=false;Game.loginData.missionHist[d-1][3]++}Game.stopPlaying();Game.missionSelection.dispose();var c=Game.closeBlockEditorStuffs();Game.editor.dispose();if(!a){Game.exitMission(c[0],c[1])}Game.missionSelected(b,d,f,e)};Game.missionSelected=function(a,c,e,d){Blockly.clipboard_=[];Game.loadingMission=true;Game.loginData.clazzId=parseInt(a);Game.loginData.levelId=parseInt(c);Game.loginData.missionIdx=parseInt(e);document.getElementById("initialBackground").style.display="none";document.getElementById("selectMission").style.display="none";CityMap.stopAnimation();$("#playerRewardMission").css("display","none");document.getElementById("mainBody").style.display="inline";if(Game.loginData.userLogged.showSound){$("#musicControl").css("display","inline");CountXP.resetTimes();Game.changeMusicControlButton(!(Game.loginData.userLogged.flags.MUSIC_DISABLED==="true"))}else{$("#musicControl").css("display","none")}if(Game.counterInstruction!=null){mainBody.removeChild(Game.counterInstruction);Game.counterInstruction=null}Game.removeChangeListeners();window.addEventListener("scroll",Game.scrollEvent);window.addEventListener("resize",Game.resizeWindow);window.addEventListener("beforeunload",Game.unload);Game.slider={};Game.slider.svg=document.getElementById("slider");Game.slider.svg.style.visibility="hidden";if(Game.speedSlider==undefined){Game.speedSlider=new Slider(10,20,130,Game.slider.svg)}Game.variableBox=document.getElementById("variableBox");Game.tipBox=document.getElementById("tipBox");CountXP.init("stopWatch",!d);Game.imgDoor=PreloadImgs.get("doors");Game.lastErrorData=new Object();Game.lastErrorData.iderror=0;Game.lastErrorData.message="";Game.lastErrorData.block=null;$("#missionIdentification").html(Game.loginData.missionHist[parseInt(c)-1][1]);Game.missionSelection=new MissionSelection(c);try{UserControl.loadMission(a,c,e,Game.missionLoaded)}catch(b){Game.init()}};Game.unload=function(a){LogClick.save(false);Game.saveMission();return null};Game.workspaceAnswer=function(){var a="<xml></xml>";if(Blockly.mainWorkspace!=null){a="<answers>"+Game.editor.getXmlValue()+"</answers>"}return a};Game.getTimeSpend=function(){var a=0;if(Game.currTime!=0){a=Math.floor(((new Date().getTime())-Game.currTime)/1000)}return a};Game.saveMission=function(){if(Game.missionView){return}var b=Game.workspaceAnswer();var a=Game.getTimeSpend();UserControl.saveMission(0,0,a,Game.howManyRuns,false,Game.runningStatus,(Blockly.mainWorkspace?Blockly.getMainWorkspace().scale:1),b,{callback:function(){},async:false});Game.currTime=new Date().getTime()};Game.missionLoaded=function(j){Game.showedWindowRunDisabled=false;Game.howManyRuns=parseInt(j[4]);Game.previousCode=j[2];Game.zoomLevel=parseFloat(j[5]);Game.missionView=j[6]==="T";var g=j[1];var l=transformStrToXml(g);Game.missionType=l.getElementsByTagName("objectives")[0].getAttribute("missionType");if(Game.missionType==null){Game.missionType="createsFromScracth"}else{if(Game.missionType=="fixBugs"){Game.allowsCreateVars=l.getElementsByTagName("objectives")[0].getAttribute("allowsCreateVars")}}Blockly.Blocks.controls_if.useMutator=!(l.childNodes[0].getAttribute("useIfMutator")==="false");var m=BlocklyApps.getMsg("_mission");Game.missionTitle=m.charAt(0).toUpperCase()+m.substring(1)+" "+j[0];if(!Game.loginData.userLogged.showInstruction||l.getElementsByTagName("explanation")[0].getAttribute("hasInstruction")==="false"){$("#instructionButton").css("display","none")}else{$("#instructionButton").css("display","inline")}Game.openMission={};Game.openMission.open=l.childNodes[0].getAttribute("open")!=null&&l.childNodes[0].getAttribute("open")==="true";Game.pointsInThisMission=l.childNodes[0].getAttribute("points")==null||l.childNodes[0].getAttribute("points")==="true";if(!Game.pointsInThisMission){CountXP.init("stopWatch",false)}Game.missionFinishable=l.childNodes[0].getAttribute("finishable")==null||l.childNodes[0].getAttribute("finishable")==="true";Game.globalMoney=0;Game.globalXP=0;Game.timeSpent=(j[3]==null?0:parseInt(j[3]));UserControl.retrieveReward(Game.updatesReward);Game.wizardFreeContent=l.childNodes[0].getElementsByTagName("help");if(Game.missionView||Game.wizardFreeContent.length==0){$("#wizardFreeButton").css("display","none");$("#wizardPayButton").css("display","none")}else{$("#wizardFreeButton").css("display","inline");Game.wizardPayContent=l.childNodes[0].getElementsByTagName("solution")}Game.slider.timesBefore=0;var b=l.childNodes[0].getElementsByTagName("slider");if(b.length>0){Game.slider.timesBefore=parseInt(b[0].getAttribute("timesBefore"))}if(Game.howManyRuns>=Game.slider.timesBefore){Game.slider.svg.style.visibility="visible"}var e=l.childNodes[0].getElementsByTagName("commands")[0];var k=nobugspage.toolbox(null,null,{enabled:Explanation.selectCommands(e)});Game.toolbox=k;var f=e.innerHTML.indexOf('name="function"')>-1;Game.editor=(Game.useCodeEditor?new CodeEditor():(f?new MultiBlockEditor():new BlocklyEditor("blockly",0)));var a=e.innerHTML.indexOf('name="array"')>-1;Game.redimDiv=Game.editor.editArea;var d=l.childNodes[0].getElementsByTagName("objectives")[0];Game.verifyButtons(d);hero=new SnackMan(a,d,l,Game.loginData.avatar);Game.onObjectiveAccomplished([0,hero.objective.objectives.length]);hero.addListener("ObjectiveAccomplished",Game);var c=true;var h={};var i;if(d.getAttribute("noXP")==null){if(hero.objective.xpTotalRun==null){h={aFraction:hero.objective.xpTotalTime/3,current:Game.timeSpent}}else{c=false;h={aFraction:hero.objective.xpTotalRun/3,current:Game.howManyRuns}}if(Game.missionType==="fixBugs"){h.dif=-1}else{h.dif=0}h.freeWizardConsumed=j[7]==="T";i=hero.objective.xpIndividual}else{c=false;h={aFraction:hero.objective.xpFinal,current:3};i=hero.objective.xpFinal;h.freeWizardConsumed=false}$("#playerRewardMission").css("display",(Game.missionView||!Game.pointsInThisMission?"none":"inline"));CountXP.config(c,h,i,hero.objective.xpFinal,Game.changeStars,true,null,d.getAttribute("noXP"));Game.noXP=d.getAttribute("noXP")!==null;Game.mission=l;Game.assignIngrid();Game.installMachines(k)};Game.assignIngrid=function(){var b=$("#variableBox .move-header")[0].clientHeight;var a=(Game.variableBox.clientHeight-b);$("#vars").ingrid({height:a,paging:false,sorting:false,gridClass:"varsgrid",headerClass:"varsgrid-header",colClasses:["varsgrid-col0",""],resizableCols:false,ingridIDPrefix:"_varsgrid",ingridBaseClass:"basevarsgrid"});$("div[class=varsgrid-header]").css("display","none")};Game.blinkPlayerReward=function(){var a=Game.blinkPlayerStop;if(!a&&Game.blinkPlayerRewardTimes%2===0){$("#playerRewardMission").css("box-shadow","inset 0 0 100px 100px #ffd89d")}else{$("#playerRewardMission").css("box-shadow","")}Game.blinkPlayerRewardTimes++;if(!a&&Game.blinkPlayerRewardTimes<10){window.setTimeout(Game.blinkPlayerReward,500)}else{CountXP.updateStars()}Game.blinkPlayerStop=false};Game.changeStars=function(b){if(!CountXP.starting){Game.blinkPlayerStop=false;var a=Game.blinkPlayerReward;Game.blinkPlayerRewardTimes=0;window.setTimeout(a,500)}if(Game.loginData.userLogged.flags.MUSIC_DISABLED==="true"||Game.loginData.userLogged.showSound==false){return}Game.stopPlaying();Game.startPlaying(b)};Game.afterInstallMachines=function(c){var e=Game.mission;if(Game.previousCode!=null){Game.nextPartOfMissionLoaded(false,c,Game.previousCode,e,Game.timeSpent)}else{var b=e.childNodes[0].getElementsByTagName("answers")[0];if(b==null){b=e.childNodes[0].getElementsByTagName("xml")[0]}var a=b.getAttribute("preload");if(a!=null){UserControl.loadAnswer(a,function(f){if(f!=null){f=f.replace(/deletable="false"/g,"")}else{f="<xml></xml>"}Game.nextPartOfMissionLoaded(true,c,f,e,0)})}else{var d=b.outerHTML||(new XMLSerializer()).serializeToString(b);Game.nextPartOfMissionLoaded(true,c,d,e,0)}}Game.previousCode=null;Game.timeSpent=null};Game.installMachines=function(a){UserControl.loadMachinesFromUser(function(d){for(var e=0;e<d.length;e++){var c="machine"+d[e][0];var g="images/"+c+".png";PreloadImgs.put(c,g,true);hero.installMachine(d[e][0],d[e][1],d[e][2],d[e][3],d[e][4],d[e][5],d[e][6],d[e][7],d[e][8],c,d[e][9],d[e][10])}if(d.length>0){a=Game.loadToolBoxWithMachines(a);var f=Game.mission.childNodes[0].getElementsByTagName("selectMachine");if(f.length>0){var b=f[0].children;if(d.length==b.length){Game.enabledBuy=false;Game.disableButton("buyButton")}if(hero.installedMachines.length==1){Game.speedSlider.setValue(1);Game.speedMultFactor=125}Game.slider.svg.style.visibility="visible"}}Game.afterInstallMachines(a)})};Game.loadToolBoxWithMachines=function(c){var d=BlocklyApps.getMsg("Apps_catYourMachines");var b='<category name="'+d+'">';for(var a=0;a<hero.extendedCommands.length;a++){b=b+'<block type="'+hero.extendedCommands[a].name+'"/>'}b=b+"</category></xml>";return c.replace("</xml>",b)};Game.buyButtonClick=function(){Game.saveMission();var a=Game.mission.childNodes[0].getElementsByTagName("selectMachine")[0];Game.selectMachine(a)};Game.selectMachine=function(a){Game.machines=[];Game.loadMachines(a,0)};Game.continueSelectMachine=function(){var i=[];var g={group:"",groupId:1,levels:[]};i.push(g);var e={name:BlocklyApps.getMsg("Text_Equipments"),id:"x",howManyItems:Game.machines.length,howManyItemsAchieved:-1};g.levels.push(e);var h=function(k){if(Game.selectedMachine!=null){Game.selectedMachine.style.backgroundColor="#7777DD"}Game.selectedMachine=this;this.style.backgroundColor="#FFB347";$("#BuyMachine").removeAttr("disabled")};var f=function(n){n--;var l="machinecom"+Game.machines[n].id;var o="images/"+l+".png";PreloadImgs.put(l,o,true);var m="";UserControl.getMessage(Game.machines[n].name,BlocklyApps.LANG,{callback:function(k){m=k},async:false});return"<img src='"+o+"'/> <br/> "+m+"<br/>"+Game.machines[n].cust+" <img style='vertical-align:middle' src='images/coin2.png'/>"};var d=function(n,l,k){return false};var c=function(n,l,k){return Game.globalMoney>=Game.machines[k-1].cust};var a=new Selector(i,1,180,null,null,null,h,f,d,c);var b=a.build();$("#tt0").tabs({width:"auto",height:"auto"});var j=$("<div/>").append($("#"+b)).append(nobugspage.buyButton(null,null,null));MyBlocklyApps.showDialog(j[0],null,false,true,true,BlocklyApps.getMsg("Text_AddNewEquipment"),null,function(){$("#"+b).remove()});$("#tt0").tabs("resize")};Game.loadMachines=function(c,a){var b=c.children[a].getAttribute("type");UserControl.loadMachine(b,function(d){Game.machines.push({id:b,name:d[0],cust:d[1]});a++;if(a<c.children.length){Game.loadMachines(c,a)}else{Game.selectedMachine=null;UserControl.listMachinesFromUser(function(f){for(var e=Game.machines.length-1;e>=0;e--){if(f.indexOf(Game.machines[e].id)>=0){Game.machines.splice(e,1)}}Game.continueSelectMachine()})}})};Game.nextPartOfMissionLoaded=function(g,c,e,f,d){Game.resizeWindow();Game.speedSlider.setValue(0.5);Game.speedMultFactor=0;var a={media:"media/",rtl:Game.rtl,trashcan:true,comments:false,scrollbars:true,toolbox:c,zoom:{enabled:true,controls:true,wheel:true,maxScale:2,minScale:0.1,scaleSpeed:1.1}};Game.selectedTab="";Game.editor.initialize(a);Game.editor.backgroundColor(Game.missionType==="fixBugs"?"#F5DAD4":(Game.missionType==="sort"?"#AFD8C1":"#FFF"));Game.editor.addCommands(c);Game.editor.zoom();document.removeEventListener("keydown",Blockly.onKeyDown_,false);Blockly.bindEvent_(document,"keydown",null,MyBlocklyApps.onKeyDown_);Game.firstTime=g;var b=function(i){Game.loadCode(e);Game.tests=i.childNodes[0].getElementsByTagName("tests");if(Game.tests.length==0){Game.tests=0;$("#tests").css("display","none")}else{Game.tests=parseInt(Game.tests[0].textContent);$("#tests").css("display","inline");$("#tests_qtd").html(Game.tests);var j=BlocklyApps.getBBox_(document.getElementById("tests_qtd"));$("#tests_finished").css("top",(j.y+10)+"px").css("left",(j.x+3)+"px")}$("#tests_finished").css("display","none");document.removeEventListener("mousedown",MyBlocklyApps.onMouseDown_,false);Game.editor.bindMouseDownSvgGroupEvent(this,MyBlocklyApps.onMouseDown_);CustomerManager.init(Game.openMission.open,Game.tests,i.childNodes[0].getElementsByTagName("customers")[0],i.childNodes[0].getElementsByTagName("customersSN")[0]);Game.reset();Game.bonusTime=i.childNodes[0].getElementsByTagName("objectives")[0].getAttribute("bonusTime");Game.bonusTimeReward=i.childNodes[0].getElementsByTagName("objectives")[0].getAttribute("bonusTimeReward");Game.addCronometro(Game.bonusTime,d);Game.showCountInstructions();BlocklyApps.bindClick("musicControl",Game.musicControlClick);BlocklyApps.bindClick("runButton",Game.runButtonClick);BlocklyApps.bindClick("resetButton",Game.resetButtonClick);BlocklyApps.bindClick("debugButton",Game.debugButtonClick);BlocklyApps.bindClick("openGoalsButton",Game.openGoalsButtonClick);BlocklyApps.bindClick("closeGoalsButton",Game.closeGoalsButtonClick);BlocklyApps.bindClick("goalButton",Game.goalButtonClick);BlocklyApps.bindClick("instructionButton",Game.instructionButtonClick);BlocklyApps.bindClick("restartBlocksButton",Game.reloadInitialBlocksClick);BlocklyApps.bindClick("showBadgesButton",Game.openAchievementList);BlocklyApps.bindClick("logoffButton",Game.goBackToDashboard);BlocklyApps.bindClick("wizardFreeButton",Game.wizardFreeButtonClick);BlocklyApps.bindClick("wizardPayButton",Game.wizardPayButtonClick);BlocklyApps.bindClick("moveRight",Game.moveRightButtonClick);BlocklyApps.bindClick("moveRightTipBox",Game.moveRightTipBoxButtonClick);if(Game.missionType==="fixBugs"&&!Game.missionView){$("#restartBlocksButton").css("display","inline")}else{$("#restartBlocksButton").css("display","none")}Game.unlockBlockly();window.setTimeout(BlocklyApps.importPrettify,1);Game.loadingMission=false;if(Game.firstTime){Explanation.showInfo(f.childNodes[0].getElementsByTagName("explanation")[0],true)}else{Hints.init(Game.mission.getElementsByTagName("hints")[0],!Game.showedWindowRunDisabled);Game.initTime();if(Game.missionView){Game.alertMissionView()}else{var h=function(){var k=function(){Game.hideShadow()};Game.alertStarsByAttempt(k)};Game.alertWizardFree(h)}}};window.setTimeout(function(){b(f)},1)};Game.loadCode=function(d){var b=transformStrToXml(d);var a=b.firstElementChild;if(a.localName==="xml"){Game.editor.loadCode(d)}else{var f=a.firstElementChild;while(f!=null){var e=parseInt(f.getAttribute("id"));Game.editor.loadCode(f.innerHTML,e);f=f.nextElementSibling}}};Game.moveBlocks=function(){var e=Blockly.mainWorkspace.getTopBlocks();var b=0,a=0;for(var c=0;c<e.length;c++){var d=e[c].getRelativeToSurfaceXY();if(b>d.x){b=d.x}if(a>d.y){a=d.y}}b=Math.abs(b);a=Math.abs(a);for(var c=0;c<e.length;c++){e[c].moveBy(b,a)}};Game.verifyButtons=function(a){Game.enabledDebug=a.getAttribute("buttonDebug")!=="false";Game.enabledRun=a.getAttribute("buttonRun")!=="false";Game.qtAttempts=(a.getAttribute("buttonRunQtdAttempts"));if(Game.qtAttempts!=null){Game.qtAttempts=parseInt(Game.qtAttempts);Game.enabledRun=Game.enabledRun&&Game.howManyRuns<=Game.qtAttempts}Game.enabledVarWindow=a.getAttribute("variableWindow")!=="false";Game.enabledBuy=a.getAttribute("buttonBuy")==="true";if(!Game.enabledDebug){Game.disableButton("debugButton")}if(!Game.enabledRun){Game.disableButton("runButton")}if(!Game.enabledBuy){Game.disableButton("buyButton")}Game.resetButtons()};Game.timesUp=function(a,b){if(((a*60+b)+30)==Game.bonusTime){Game.changeCSSAlertCronometro()}else{if(((a*60+b))==Game.bonusTime){Game.changeCSSOverCronometro()}}};Game.changeCSSAlertCronometro=function(){var a=$(".digit");a.removeClass("static");a.addClass("alert");a.css("background-color","rgba(230,9,40,1)");Game.cronometro.options.cssDigit="alert"};Game.changeCSSOverCronometro=function(){var a=$(".digit");a.removeClass("alert");a.addClass("over");a.css("background-color","#CFCFC4");Game.cronometro.options.cssDigit="over";Game.cronometro.options.callback=function(){}};Game.beforeFinishMission=function(){Game.victory=true;Game.lastErrorData.iderror=0;Game.lastErrorData.message="";Hints.stopHints();Game.stopCronometro();Game.stopAlertGoalButton();var c=Game.workspaceAnswer();var a=new Date().getTime();var b=Math.floor((a-Game.currTime)/1000);return{timeSpent:b,answer:c}};Game.showDialogVictory=function(a){var b=document.getElementById("victoyText");b.innerHTML=a;MyBlocklyApps.showDialog(document.getElementById("dialogVictory"),null,true,true,true,null,{width:"600px"},function(){Game.nextMission()})};Game.addCronometro=function(a,d){$("#timerCountUp").empty();Game.cronometro=null;if(Game.missionView||!Game.pointsInThisMission){return}if(a!=null){d=parseInt(d);$("#timerCountUp").append("<span></span>");Game.cronometro=CountUp($("#timerCountUp span"),{start:d,stopped:true,callback:Game.timesUp});$("#timerCountUp").css("right",$("#logoffButton").width());$("#timerCountUp").css("right",$("#timerCountUp").width());var c=document.getElementById("logoffButton");var b=c.offsetTop+((c.clientHeight-$(".countdownHolder").height())/2);$("#timerCountUp").css("top",b+"px");if(d>Game.bonusTime){Game.changeCSSOverCronometro()}else{if(d+30>=Game.bonusTime){Game.changeCSSAlertCronometro()}}}};Game.showShadow=function(){var a=document.getElementById("dialogShadow");a.style.visibility="visible";a.style.opacity=0.3};Game.hideShadow=function(){var a=document.getElementById("dialogShadow");a.style.visibility="hidden";a.style.opacity=0};Game.alertWizardFree=function(a){var f=Game.loginData.userLogged.flags.TALK_WIZARDFREE;if(!Game.missionView&&Game.wizardFreeContent.length>0&&(f===undefined||f==="false")){var b=$("<div/>").append("<img src='images/help_free.png' style='float:left;padding-right: 15px'/>").append(BlocklyApps.getMsg("explanation_wizard"));Hints.stopHints();var e=BlocklyApps.getBBox_(document.getElementById("wizardFreeButton"));var c=100;var d=e.x-450;MyBlocklyApps.showDialog(b[0],null,true,true,false,"",{width:"500px",left:d+"px",top:c+"px"},function(){a()},function(){},true);Game.changeFlag("TALK_WIZARDFREE","true")}else{a()}};Game.verifyTestsInMission=function(a){var e=function(){var g=function(){Game.hideShadow();a()};Game.alertStarsByAttempt(g)};if(Game.tests==0){e();return}var d=Game.loginData.userLogged.flags.TALK_RUNTESTS;if(d===undefined||d==="false"){var c=BlocklyApps.getBBox_(document.getElementById("tests_qtd"));var b=[];b.push(BlocklyApps.getMsg("Intro_RepeatTest1")+" <img src='images/iconplay.png'/> "+BlocklyApps.getMsg("Intro_RepeatTest2")+" <img src='images/tests.png' width='32'/> "+BlocklyApps.getMsg("Intro_RepeatTest3"));b.push(BlocklyApps.getMsg("Intro_RepeatTest4"));b.push(BlocklyApps.getMsg("Intro_RepeatTest5"));b.push(BlocklyApps.getMsg("Intro_RepeatTest6")+"<img src='images/tests_finished.png'/>"+BlocklyApps.getMsg("Intro_RepeatTest7"));Game.showShadow();CharacterDialog.creates(c.x+30,c.y-140,e,b);Game.changeFlag("TALK_RUNTESTS","true")}else{e()}};Game.alertStarsByAttempt=function(a){if(hero.objective.xpTotalRun==null){a();return}var d=Game.loginData.userLogged.flags.TALK_STARSBYATTEMPT;if(d===undefined||d==="false"){var c=BlocklyApps.getBBox_(document.getElementById("missionIdentification"));var b=[];b.push(BlocklyApps.getMsg("Intro_StarsByRun1"));b.push(BlocklyApps.getMsg("Intro_StarsByRun2"));b.push(BlocklyApps.getMsg("Intro_StarsByRun3"));Game.showShadow();CharacterDialog.creates(c.x-130,c.y+80,a,b);Game.changeFlag("TALK_STARSBYATTEMPT","true")}else{a()}};Game.alertMissionView=function(){if(!Game.missionView){return}var b=Game.loginData.userLogged.flags.TALK_MISSIONVIEW;if(b===undefined||b==="false"){var a=$("<div/>").append(BlocklyApps.getMsg("NoBugs_ReviewMission"));Hints.stopHints();MyBlocklyApps.showDialog(a[0],null,true,true,true,"",{width:"500px"},null,function(){Hints.startHints()},true);Game.changeFlag("TALK_MISSIONVIEW","true")}};Game.alertSuccessMissionView=function(){if(!Game.missionView){return}var a=$("<div/>").append(BlocklyApps.getMsg("NoBugs_AfterSuccessMissionView"));Hints.stopHints();MyBlocklyApps.showDialog(a[0],null,true,true,true,"",{width:"500px"},null,function(){Game.resetButtonClick()},true)};Game.initTime=function(){CountXP.start();Game.currTime=new Date().getTime();Game.initCronometro();Game.startSaveUserProgress()};Game.initCronometro=function(){if(Game.cronometro!=null){Game.cronometro.restart()}};Game.cleanCronometro=function(){if(Game.cronometro!=null){Game.cronometro.stop();$("#timerCountUp").empty();Game.cronometro=null}};Game.stopCronometro=function(){if(Game.cronometro!=null){Game.cronometro.stop()}};Game.doResizeWindow=function(a){if(Game.variableBox==null){return}Game.resizeWindow(null);Blockly.fireUiEvent(window,"resize")};Game.scrollEvent=function(){Hints.hideHintWithTimer();Game.doResizeWindow()};Game.resizeWindow=function(f){var k=document.getElementById("visualization");var g=k.offsetTop;Game.redimDiv.style.top=Math.max(10,g-window.pageYOffset)+"px";Game.redimDiv.style.left=Game.rtl?"10px":"380px";var j=window.innerWidth;if(Game.variableBox.style.display==="none"&&Game.tipBox.style.display==="none"){j-=400}else{document.getElementById("moveRight").style.display="none";Game.redimDiv.style.height=Game.optResize.blocklyDivH;j-=Game.optResize.blocklyDivW;var c=null;if(Game.variableBox.style.display!=="none"){c=Game.variableBox}else{c=Game.tipBox}c.style.top=(Game.redimDiv.style.top);c.style.left=((Game.rtl?10:380)+j+5)+"px";c.style.width="200px";c.style.height=Game.optResize.varBoxH;if(Game.tipBox.style.display!=="none"){var b=$("#tipBox .move-header")[0].clientHeight;$("#tips_content").css("height",(c.clientHeight-b)+"px")}else{var b=$("#variableBox .move-header")[0].clientHeight;var d=(c.clientHeight-b)+"px";$("#var_content").css("height",d);var a=$("#var_content .basevarsgrid div:nth(2)");if(a.length>0){a.css("height",d)}}}Game.redimDiv.style.width=(j)+"px";var l=Game.redimDiv.style.top;l=parseInt(l.substr(0,l.length-2));Game.editor.resize(l);var i=document.getElementById("blocklyLock");if(i!==null&&i!=="undefined"&&i!==undefined){i.style.cssText=Game.redimDiv.style.cssText;i.style.height=Game.redimDiv.clientHeight+"px";i.style.position="fixed";i.style.backgroundColor="grey";i.style.opacity="0.3"}if(Game.counterInstruction!=null){Game.counterInstruction.style.left=(Game.redimDiv.offsetLeft+Game.redimDiv.offsetWidth-Game.counterInstruction.clientWidth-15)+"px"}};Game.moveDownButtonClick=function(){Hints.hideHintWithTimer();Game.varWindow=Game.DOWN;document.getElementById("moveDown").style.display="none";document.getElementById("moveRight").style.display="inline-block";Game.optResize={blocklyDivW:400,blocklyDivH:"70%",varBoxT:false,varBoxH:"20%"};Game.doResizeWindow()};Game.moveRightButtonClick=function(){Hints.hideHintWithTimer();Game.varWindow=Game.RIGHT;Game.optResize={blocklyDivW:600,blocklyDivH:"90%",varBoxT:true,varBoxH:"90%"};Game.variableBox.style.display="none";Game.doResizeWindow()};Game.moveRightTipBoxButtonClick=function(){Hints.hideHintWithTimer();Game.tipBox.style.display="none";Game.doResizeWindow()};Game.reset=function(a){Game.victory=false;Game.stopAlertGoalButton();hero.reset();if(a===undefined){CustomerManager.reset()}Game.display();Game.killAll()};Game.killAll=function(){for(var a=0;a<Game.pidList.length;a++){window.clearTimeout(Game.pidList[a])}Game.pidList=[]};Game.display=function(){Game.ctxDisplay.drawImage(Game.imgBackground,0,0);hero.draw(Game.ctxDisplay);CustomerManager.draw(Game.ctxDisplay)};Game.exitCountInstructions;Game.countInstructions=function(g,b){Game.exitCountInstructions=false;var e=0;for(var a=0;a<g.length;a++){var d=g[a];if(d.nextConnection!=null){e++}if(b!=undefined){if(!b(d)){Game.exitCountInstructions=true;return e}}e+=Game.countInstructions(d.childBlocks_,b);if(Game.exitCountInstructions){return e}}return e};Game.openGoalsButtonClick=function(){$("#goalsAccomplished").css("display","none");$("#goalsAccomplishedWindow").css("display","inline");if(Game.dialogMouseDownWrapper_){Blockly.unbindEvent_(Game.dialogMouseDownWrapper_);Game.dialogMouseDownWrapper_=null}Game.dialogMouseDownWrapper_=Blockly.bindEvent_(document.getElementById("goalsAccomplishedWindowHeader"),"mousedown",null,Game.dialogMouseDown_)};Game.dialogUnbindDragEvents_=function(){if(Game.dialogMouseUpWrapper_){Blockly.unbindEvent_(Game.dialogMouseUpWrapper_);Game.dialogMouseUpWrapper_=null}if(Game.dialogMouseMoveWrapper_){Blockly.unbindEvent_(Game.dialogMouseMoveWrapper_);Game.dialogMouseMoveWrapper_=null}};Game.dialogMouseMove_=function(d){var c=document.getElementById("goalsAccomplishedWindow");var a=Game.dialogStartX_+d.clientX;var b=Game.dialogStartY_+d.clientY;b=Math.max(b,0);b=Math.min(b,window.innerHeight-c.offsetHeight);a=Math.max(a,0);a=Math.min(a,window.innerWidth-c.offsetWidth);c.style.left=a+"px";c.style.top=b+"px"};Game.dialogMouseDown_=function(b){Game.dialogUnbindDragEvents_();if(Blockly.isRightButton(b)){return}var a=document.getElementById("goalsAccomplishedWindow");Game.dialogStartX_=a.offsetLeft-b.clientX;Game.dialogStartY_=a.offsetTop-b.clientY;Game.dialogMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",null,Game.dialogUnbindDragEvents_);Game.dialogMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",null,Game.dialogMouseMove_);b.stopPropagation()};Game.closeGoalsButtonClick=function(){$("#goalsAccomplished").css("display","inline");$("#goalsAccomplishedWindow").css("display","none");if(Game.dialogMouseDownWrapper_){Blockly.unbindEvent_(Game.dialogMouseDownWrapper_);Game.dialogMouseDownWrapper_=null}};Game.goalButtonClick=function(){Hints.stopHints();Blockly.WidgetDiv.hide();Game.stopAlertGoalButton();Explanation.showInfo(Game.mission.childNodes[0].getElementsByTagName("explanation")[0],false,null,false)};Game.instructionButtonClick=function(){Hints.stopHints();Blockly.WidgetDiv.hide();Game.stopAlertGoalButton();Explanation.showInfo(Game.mission.childNodes[0].getElementsByTagName("explanation")[0],false,null,true,{width:"900px"})};Game.emptyLines=function(){InGrid.emptyLines("#_varsgrid_vars_0 div:nth-child(2) table")};Game.goBackToDashboard=function(a,d,b){Game.editor.hideChaff();Blockly.WidgetDiv.hide();Game.stopPlaying();var c=Game.closeBlockEditorStuffs();Game.editor.dispose();Game.missionSelection.dispose();if(d!==false){Game.exitMission(c[0],c[1]);if(b||b==undefined){Game.init()}}};Game.exitMission=function(a,b){UserControl.exitMission(a,Game.howManyRuns,Game.runningStatus,(Blockly.mainWorkspace?Blockly.getMainWorkspace().scale:1),b,{callback:function(){},async:false})};Game.wizardFreeButtonClick=function(){var a=function(e){Game.closeBoxes();if(e==1){CountXP.setConsumedMaxStars();UserControl.askWizardFree(Game.howManyRuns,Game.getTimeSpend());Game.saveMission()}var f=[];var g=0;var c=Game.wizardFreeContent[0].getElementsByTagName("line");for(var d=0;d<c.length;d++){var b=c[d].getAttribute("indent");if(b!=null&&g<parseInt(b)){g=parseInt(b)}f.push({text:c[d].textContent.toString(),indent:(b==null?0:parseInt(b))})}InGrid.createNewTipTable(g,f);Game.tipBox.style.display="inline";Game.doResizeWindow();Hints.startHints()};if(CountXP.getEnabledStars()>0){Hints.stopHints();confirm("Deseja realmente ver a dica para resolver a miss&#227;o ? <br/> Ao confirmar ser&#227;o consumidas todas as estrelas.",function(){a(1)},function(){Hints.startHints()},{height:"180px"})}else{a(0)}};Game.wizardPayButtonClick=function(){};Game.closeBoxes=function(){Game.variableBox.style.display="none";Game.tipBox.style.display="none"};Game.closeBlockEditorStuffs=function(){Game.unlockBlockly();Hints.stopHints();$("#tests").css("display","none");Game.stopAlertGoalButton();MyBlocklyApps.hideDialog(false);window.removeEventListener("beforeunload",Game.unload);var a=new Date().getTime();Game.cleanCronometro();CountXP.stop(true);Game.emptyLines();Game.closeBoxes();Game.doResizeWindow();Game.killAll();Game.runningStatus=0;var c=null;var b=0;if(Game.currTime!=0){c=Game.workspaceAnswer();b=Math.floor((a-Game.currTime)/1000)}document.getElementById("blockly").innerHTML="";$(".blocklyToolboxDiv").remove();window.removeEventListener("scroll",Game.scrollEvent);window.removeEventListener("resize",Game.resizeWindow);$("#tabs-points").empty();$("#tabs-time").empty();$("#tabs-runs").empty();return[b,c]};Game.intoTheMissionLogoffButtonClick=function(){Game.goBackToDashboard(null,true,false);Game.logoffButtonClick()};Game.logoffButtonClick=function(){LogClick.store("logoffgame");Game.loginData.doingLogoff=true;MyBlocklyApps.hideDialog(false);CityMap.stopAnimation();LogClick.save(false);UserControl.logoff({callback:function(){Game.loginData=null;Game.init()},async:false})};Game.runButtonClick=function(){Game.disableButton("runButton");Game.enableButton("resetButton");Game.disableButton("debugButton");Game.disableButton("buyButton");Game.disableButton("wizardFreeButton","");Game.closeBoxes();Game.doResizeWindow();Game.editor.traceOn(true);Game.execute(1)};Game.resetButtonClick=function(){Game.clickReseting=true;Game.finishedRun();$("#tests_finished").css("display","none");Game.lastErrorData.iderror=0;Game.lastErrorData.message="";Game.lastErrorData.block=null;Hints.stopHints();Game.resetButtons();Game.reset(1);Game.closeBoxes();Game.doResizeWindow();Game.hideHints=true;Hints.startHints();Game.unlockBlockly();Game.stopAlertGoalButton();Game.clickReseting=false};Game.enableButton=function(a,d){if(a==="debugButton"&&!Game.editor.hasDebug()){Game.disableButton(a);return}if((a==="debugButton"&&!Game.enabledDebug)||(a==="runButton"&&(!Game.enabledRun||(Game.qtAttempts!=null&&Game.howManyRuns>Game.qtAttempts)))||(a=="buyButton"&&!Game.enabledBuy)){var b=true;if(a==="runButton"&&Game.qtAttempts!=null&&Game.showedWindowRunDisabled==false){b=false;if(Game.qtAttempts<Game.howManyRuns&&!BlocklyApps.isDialogVisible_){b=true;Game.showedWindowRunDisabled=true;var e=$("<div/>").append(BlocklyApps.getMsg("NoBugs_RunButtonDisabled"));Game.disableButton("runButton");Hints.stopHints();MyBlocklyApps.showDialog(e[0],null,true,true,true,"",{width:"500px"},null,function(){Hints.startHints()},true)}}if(b){return}}var c=document.getElementById(a);c.disabled="";c.className=(d!=undefined?d:"buttonIDE")};Game.disableButton=function(a,c){var b=document.getElementById(a);b.disabled="disabled";b.className=(c!=undefined?c:"buttonIDENotEnabled")};Game.firstClick=true;Game.debugButtonClick=function(){Game.disableButton("debugButton");if(Game.runningStatus===0){Game.enableButton("resetButton");if(Game.enabledVarWindow){Game.closeBoxes();Game.variableBox.style.display="inline";Game.doResizeWindow();Game.disableButton("wizardFreeButton","")}Game.editor.traceOn(true);Game.firstClick=true}else{Hints.stopHints();Game.firstClick=false;if(!Blockly.mainWorkspace.traceOn_){Game.editor.traceOn(true)}}Game.execute(2)};Game.musicControlClick=function(){var a=(Game.loginData.userLogged.flags.MUSIC_DISABLED==="true");Game.changeMusicControlButton(a);Game.changeFlag("MUSIC_DISABLED",(a?"false":"true"))};Game.changeFlag=function(a,b){Game.loginData.userLogged.flags[a]=b;UserControl.saveFlag(a,b)};Game.changeMusicControlButton=function(a){if(!a){if(!Game.loadingMission&&hero){hero.verifyObjectives("music",{status:"off"});if(hero.allObjectivesAchieved){Game.verifyVictory()}}$("#musicOff").css("display","none");$("#musicOn").css("display","inline");$("#musicControl").attr("title",BlocklyApps.getMsg("NoBugs_enableMusic"));Game.stopPlaying()}else{if(!Game.loadingMission&&hero){hero.verifyObjectives("music",{status:"on"});if(hero.allObjectivesAchieved){Game.verifyVictory()}}$("#musicOn").css("display","none");$("#musicOff").css("display","inline");$("#musicControl").attr("title",BlocklyApps.getMsg("NoBugs_disableMusic"));if(CountXP.getTimes()!=undefined){Game.startPlaying(CountXP.getTimes())}}};Game.resetButtons=function(a){Game.disableButton("resetButton");Game.enableButton("debugButton");Game.enableButton("runButton");Game.enableButton("buyButton");Game.enableButton("wizardFreeButton","");if(Blockly.mainWorkspace!=null){Game.editor.traceOn(false)}Game.runningStatus=0;if(a==undefined||a==true){Game.emptyLines()}};Game.finishedRun=function(){CountXP.newRun()};Game.showTabs=function(a){Game.editor.hideChaff();Blockly.WidgetDiv.hide();Game.editor.visibleTabs(a);Blockly.fireUiEvent(window,"resize")};Game.selectTab=function(a){if(a==="blockly"){return}Game.selectedTab=a;Game.showTabs(a);$("#multiBlockly").easytabs("select","#"+(a));Blockly.fireUiEvent(window,"resize");if(Game.counterInstruction!=null){Game.counterInstruction.style.display=(a==="blockly1"?"inline":"none");Game.updateCounterInstructions(-1)}};Game.changeTab=function(b,a){if(b==="blockly"){return}a=(a!==undefined&&a!==null?(a.data!==undefined?a.data:a):a);b=(b.data?b.data:b);if(Game.selectedTab===b){Game.editor.traceOn(true);return a}Game.selectTab(b);Game.editor.traceOn(true);return a};Game.verifyFunctionTabs=function(){Game.editor.verifyFunctionTabs()};Game.execute=function(a){if(Game.runningStatus===0){try{Game.howManyRuns++;Game.callTimes={};Game.verifyFunctionTabs();Game.editor.changeToFirstTab();$("#tests_finished").css("display","none");Game.blinkPlayerStop=true;Game.highlightPause=false;Game.editor.hideChaff();Hints.stopHints();Blockly.WidgetDiv.hide();Game.hideHints=false;BlocklyApps.log=[];BlocklyApps.ticks=10000;Game.emptyLines();Game.reset();Game.runningStatus=a;Game.saveMission();if(Blockly.selected!=null){myIsTargetSvg=true;Blockly.selected.unselect();myIsTargetSvg=false}Game.editor.semanticAnalysis();var b=Game.editor.getJsCode();b="var NoBugsJavaScript = {};\n"+b;Game.code=b;Game.jsInterpreter=new NoBugsInterpreter(b,Game.initApi);Game.stepSpeed=(1000*Math.pow(1-Game.speedSlider.getValue(),3))+Game.speedMultFactor;Game.lockBlockly()}catch(c){if(c==Infinity){Game.showError(["Error_infinityLoopDetected"]);Game.resetButtons();Game.closeBoxes();Game.doResizeWindow();return}else{if(c.isNoBugs){Game.editor.traceOn(true);Game.editor.highlightBlock(Blockly.selected.id);Game.showError([c.msg]);Game.resetButtons();Game.closeBoxes();Game.doResizeWindow();return}}console.log(c)}}Game.runningStatus=a;Game.pidList.push(window.setTimeout(function(){Game.nextStep()},2))};Game.convertWaits=function(d){var e=1;var b=d.search(/(WAIT_NOBUGS\[[0-9]*\])/g);while(b>-1){var a=d.substring(b+11);a=/(\[[0-9]*\])/g.exec(a)[0];a=a.substring(1,a.length-1);d=d.replace(/(WAIT_NOBUGS\[[0-9]*\])/g,"var f"+e+" = function() { ");d=d+"}; \n NoBugsJavaScript.timeOut=false; mySetTimeout('f"+e+"', "+a+"); while(!NoBugsJavaScript.timeOut);\n";e++;b=d.search(/(WAIT_NOBUGS\[[0-9]*\])/g)}return d};Game.semanticAnalysis=function(a){if(Game.hasEmptyInputs(a)){Game.selectTab(a.workspace.id);Blockly.selected=Game.blockWithEmptyInputs;throw {isNoBugs:true,msg:"Hints_EmptyInputError"}}return true};Game.hasEmptyInputs=function(c){var a=c.inputList;for(var b=0;b<a.length;b++){if(a[b].connection!=null){if(!((a[b].sourceBlock_.type==="controls_for"||a[b].sourceBlock_.type==="controls_whileUntil"||a[b].sourceBlock_.type==="controls_if")&&(a[b].name.indexOf("DO")===0||a[b].name==="ELSE"))&&a[b].connection.targetConnection==null){Game.blockWithEmptyInputs=c;return true}if(a[b].connection.targetConnection!=null){if(Game.hasEmptyInputs(a[b].connection.targetConnection.sourceBlock_)){return true}}}}return false};Game.showCountInstructions=function(){if(Game.editor.editArea&&Game.editor.showCountInstructions()&&(hero.hasCommQtd||hero.objective.maxCommands>0)){var a=Game.editor.getFirstEditArea();var c=a.offsetTop+Game.editor.getOffsetTop();var b=document.createElement("div");b.id="countInstruction";b.style.position="absolute";b.style.top=c+"px";b.style.backgroundColor="rgba(153, 152, 152, 0.28)";b.style.opacity="0.3";b.innerHTML=Game.editor.countInstructions();document.getElementById("mainBody").appendChild(b);b.style.left=(Game.redimDiv.offsetLeft+Game.redimDiv.offsetWidth-b.clientWidth-15)+"px";Game.counterInstruction=b}else{Game.counterInstruction=null}};Game.updateCounterInstructions=function(a){if(Game.counterInstruction==null){return}Game.counterInstruction.innerHTML=(a>-1?a+" blocks":Game.counterInstruction.innerHTML);Game.counterInstruction.style.left=(Game.redimDiv.offsetLeft+Game.redimDiv.offsetWidth-Game.counterInstruction.clientWidth-15)+"px"};Game.lockBlockly=function(){var a=document.getElementById("blocklyLock");if(a!=null){return}a=document.createElement("div");a.id="blocklyLock";a.style.cssText=Game.editor.editArea.style.cssText;a.style.height=Game.editor.editArea.clientHeight+"px";a.style.position="fixed";a.style.backgroundColor="grey";a.style.opacity="0.3";var b=document.getElementById("mainBody");b.appendChild(a)};Game.unlockBlockly=function(){var a=document.getElementById("blocklyLock");if(a!==null&&a!=="undefined"&&a!==undefined){var b=document.getElementById("mainBody");b.removeChild(a)}};Game.verifyVariableInitialized=function(f){var e=null;for(var b=0;b<Game.jsInterpreter.stateStack.length;b++){if(Game.jsInterpreter.stateStack[b].scope){e=Game.jsInterpreter.stateStack[b].scope;break}}if(e==null){BlocklyApps.log=[];BlocklyApps.log.push(["fail","Impossivel"]);throw false}var a=f.length;f=f.properties;for(var c=0;c<a;c++){var d=f[c].data;if(e.properties[d]!==undefined){if(e.properties[d].data===undefined){BlocklyApps.log=[];BlocklyApps.log.push(["fail","Error_variableNotInitialized",d]);throw false}}}return true};Game.updateVariables=function(){var n=[];var b=Game.jsInterpreter;for(var h=b.variables.length-1;h>=0;h--){var o=false;var m=b.variables[h];for(var f=0;f<b.stateStack.length;f++){if(b.stateStack[f].scope){o=m.scope==b.stateStack[f].scope;break}}if(o){if(Game.runningStatus==2){var g=m.scope.properties[m.name].data;if(g!=undefined){var l=function(k){var j=k;if(k!=null){if(k.type!=undefined){j="<div><p style='margin: 0px' class="+k.type+"><img src='images/"+k.descr+".png'/></p>"+(k.sourceType==null?"":"<p style='margin: 0px'>"+BlocklyApps.getMsg("__"+k.sourceType)+" "+CustomerManager.getCustomerPosition(k.source)+"</p>")+"</div>"}else{try{if(k.indexOf('"$$$')==0){j="<img src='images/"+k.substring(2,k.length-1)+".png'/>"}}catch(i){}}}return j};if(Array.isArray(g)){var d="[";for(var e=0;e<g.length;e++){var c=g[e];if(d.length>1){d=d+","}var a=l(c);if(a===undefined){a="0"}d=d+a}g=d+"]"}else{g=l(g)}n.push({name:m.name,value:g+""})}}}else{if(h==b.variables.length-1){b.variables.splice(h,1)}}}InGrid.createNewVarTable(n);Game.assignIngrid()};Game.nextStep=function(){if(Game.runningStatus==0){return}while(true){try{if(Game.jsInterpreter.step()){if(BlocklyApps.log.length>0||Game.highlightPause||Game.waitFunction){if(Game.runningStatus!=2||Game.highlightPause===false||Game.waitFunction){if(Game.waitFunction){hero.update("IM",0)}BlocklyApps.log.push(["nextStep"])}else{Game.highlightPause=false;if(Game.firstClick&&Game.runningStatus==2){BlocklyApps.log.push(["nextStep"]);Game.firstClick=false}}Game.pidList.push(window.setTimeout(function(){Game.animate()},10));return}}else{Game.verifyVictory();return}}catch(a){console.log(a);if(Game.runningStatus==2){document.getElementById("moveRight").style.display="inline-block"}Game.animate();Game.unlockBlockly();Game.stopAlertGoalButton();Hints.startHints();Game.finishedRun();return}}};Game.verifyVictory=function(){if(Game.waitFunction){hero.update("IM",0);BlocklyApps.log.push(["nextStep"]);Game.pidList.push(window.setTimeout(function(){Game.animate()},10));return}var c=Game.runningStatus==2;Game.editor.highlightBlock(null);hero.verifyObjectives("deliver",{allCustomers:true});hero.verifyObjectives("varQtd",null);hero.verifyObjectives("commQtd",null);hero.verifyObjectives("notExists",null);hero.verifyObjectives("cashIn",{allCustomers:true});hero.verifyObjectives("giveTheWholeChange",{allCustomers:true});hero.verifyObjectives("giveSomeChange",{allCustomers:true});hero.verifyObjectives("countTalk",{allCustomers:true});hero.verifyObjectives("conditional",{allCustomers:true});hero.verifyObjectives("callTimes",{allCustomers:true});hero.verifyObjectives("ordered",null);Game.lastErrorData.block=null;if(hero.allObjectivesAchieved){if(Game.tests>0){$("#tests_finished").css("display","inline").html(CustomerManager.currentTest+1);if(CustomerManager.nextTest()){hero.reset();Game.jsInterpreter=new NoBugsInterpreter(Game.code,Game.initApi);Game.pidList.push(window.setTimeout(function(){Game.nextStep()},2));return}}Game.resetButtons();CountXP.stop(true);var e=Game.beforeFinishMission();if(Game.missionView){Game.alertSuccessMissionView();return}var g;if(Game.pointsInThisMission){if(Game.noXP){g=hero.addReward(-1,0,0,0)}else{var d=Game.editor.countInstructions();g=hero.addReward(d,(Game.cronometro==null?0:Game.cronometro.passed),Game.bonusTime,Game.bonusTimeReward)}Game.updatesReward([Game.globalXP+g.totalXP,Game.globalMoney+g.totalCoins])}else{g={totalXP:0,totalCoins:0,baseXP:0,bonusCoins:0}}UserControl.saveMission(g.totalXP,g.totalCoins,e.timeSpent,Game.howManyRuns,Game.missionFinishable,Game.runningStatus,Blockly.getMainWorkspace().scale,e.answer,function(o){var k=BlocklyApps.getMsg("Achievement_Title");o.forEach(function(i){var s=AchievementWindow.fillFields(BlocklyApps.getMsg(i.TITLE),i);$.growl($.extend({title:k,style:"notice",duration:5000},{message:s}))});var j=BlocklyApps.getMsg("NoBugs_goalAchievedVictory");var q="<img style='vertical-align: middle; padding-left: 3px' src='images/xp.png'/>";if(g.totalXP==0){j=j.substring(0,j.indexOf("<br/>"))}var l=j.format((g.totalXP==0?"":g.totalXP+q+"<br/>"));if(g.baseXP!=g.totalXP||g.bonusCoins!=g.totalCoins){var p;if(g.baseXP!=g.totalXP){p="<table border='2px'  class='tableVictory' >";p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("Victory_XPBaseValue")+" </td><td align='right' style='width: 50px;'> "+g.baseXP+"</td></tr>";p=p+"<tr><td colspan='2'>"+BlocklyApps.getMsg("Victory_Bonus")+"</td></tr>";for(var m=0;m<g.bonusXP.length;m++){var n=BlocklyApps.getMsg(g.bonusXP[m].name);var r=n.format(g.bonusXP[m].extraInfo);p=p+"<tr><td> <img src='images/goal_ok.png'/>&nbsp;"+r+"</td> <td align='right' style='width: 50px;'>"+g.bonusXP[m].value+"</td></tr>"}p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("total")+"</td><td align='right' >"+g.totalXP+"</td></tr>";l=l+p+"</table>"}if(g.bonusCoins!=g.totalCoins){p=BlocklyApps.getMsg("NoBugs_goalAchievedVictoryWithCoins").format(g.totalCoins+"<img style='vertical-align: middle; padding-left: 3px' src='images/coin2.png'/>")+"<br/>";p=p+"<table border='2px' class='tableVictory' >";p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("Victory_CoinsBaseValue")+" </td><td align='right' style='width: 50px;'> "+g.baseCoins+"</td></tr>";p=p+"<tr><td colspan='2'>"+BlocklyApps.getMsg("Victory_Bonus")+"</td></tr>";for(var m=0;m<g.bonusCoins.length;m++){var n=BlocklyApps.getMsg(g.bonusCoins[m].name);var r=n.format(g.bonusCoins[m].extraInfo);p=p+"<tr><td> <img src='images/goal_ok.png'/>&nbsp;"+r+"</td> <td align='right' style='width: 50px;'>"+g.bonusCoins[m].value+"</td></tr>"}p=p+"<tr style='font-weight:bold'><td>"+BlocklyApps.getMsg("total")+"</td><td align='right' >"+g.totalCoins+"</td></tr>";l=l+p+"</table>"}}Game.showDialogVictory(l)})}else{Game.finishedRun();Game.resetButtons();var h=[];var f=hero.objective.objectives;for(var a=0;a<f.length;a++){h[a]=[Objective.factory(f[a].objective).createExplanationItem(f[a]),f[a].achieved]}if(!Game.missionView){UserControl.missionFail(Game.howManyRuns,CustomerManager.currentTest+1,h)}if(c){document.getElementById("moveRight").style.display="inline-block"}Game.lastErrorData.iderror="missionFail";Game.lastErrorData.message=document.getElementById("dialogFailText");var b={};b.width="600px";MyBlocklyApps.showDialog(document.getElementById("dialogFail"),null,true,true,true,null,b,function(){Game.hideHints=true;Hints.showErrorHint()})}Game.unlockBlockly()};Game.logEvent=null;Game.startSaveUserProgress=function(){if(Game.logEvent==null){Game.logEvent=Game.editor.addChangeListener(function(){if(Game.missionView){return}if(Blockly.Block.dragMode_!=0){return}var a=new Date().getTime();var c=0;if(Game.currTime!=0){c=Math.floor(((a)-Game.currTime)/1000)}if(c<10){return}var b=Game.workspaceAnswer();UserControl.saveMission(0,0,c,Game.howManyRuns,false,Game.runningStatus,Blockly.getMainWorkspace().scale,b);Game.currTime=a})}};Game.removeChangeListeners=function(){if(Game.scrollEvent!=undefined){window.removeEventListener("scroll",Game.scrollEvent);window.removeEventListener("beforeunload",Game.unload);MyBlocklyApps.unbindClick("musicControl",Game.musicControlClick);MyBlocklyApps.unbindClick("runButton",Game.runButtonClick);MyBlocklyApps.unbindClick("resetButton",Game.resetButtonClick);MyBlocklyApps.unbindClick("debugButton",Game.debugButtonClick);MyBlocklyApps.unbindClick("openGoalsButton",Game.openGoalsButtonClick);MyBlocklyApps.unbindClick("closeGoalsButton",Game.closeGoalsButtonClick);MyBlocklyApps.unbindClick("goalButton",Game.goalButtonClick);MyBlocklyApps.unbindClick("logoffButton",Game.goBackToDashboard);MyBlocklyApps.unbindClick("instructionButton",Game.instructionButtonClick);MyBlocklyApps.unbindClick("restartBlocksButton",Game.reloadInitialBlocksClick);MyBlocklyApps.unbindClick("showBadgesButton",Game.openAchievementList);MyBlocklyApps.unbindClick("wizardFreeButton",Game.wizardFreeButtonClick);MyBlocklyApps.unbindClick("wizardPayButton",Game.wizardPayButtonClick)}if(Blockly.mainWorkspace!=null){if(Game.logEvent!=null){Blockly.mainWorkspace.removeChangeListener(Game.logEvent);Game.logEvent=null}if(Hints.evtChangeListener!=null){Blockly.mainWorkspace.removeChangeListener(Hints.evtChangeListener);Hints.evtChangeListener=null}}};Game.initApi=function(a,c){var e=function(){return a.createPrimitive(Game.updateVariables())};a.setProperty(c,"updateVariables",a.createNativeFunction(e));e=function(f){return a.createPrimitive(alert(f))};a.setProperty(c,"alert",a.createNativeFunction(e));e=function(f){f=f?f.toString():"";return a.createPrimitive(Game.highlightBlock(f))};a.setProperty(c,"highlightBlock",a.createNativeFunction(e));e=function(g,f,h){return a.createPrimitive(nobugsComparison(g,f,h))};a.setProperty(c,"nobugsComparison",a.createNativeFunction(e));e=function(g,f,h){return a.createPrimitive(nobugsMathArith(g,f,h))};a.setProperty(c,"nobugsMathArith",a.createNativeFunction(e));e=function(f){return a.createPrimitive(NoBugsJavaScript.verifyLogicOperation(f))};a.setProperty(c,"verifyLogicOperation",a.createNativeFunction(e));e=function(h,g){return a.createPrimitive(Game.setTimeout(h.data,g.data))};a.setProperty(c,"mySetTimeout",a.createNativeFunction(e));e=function(f){return a.createPrimitive(Game.verifyVariableInitialized(f))};a.setProperty(c,"verifyVariableInitialized",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.goToBarCounter(f))};a.setProperty(c,"goToBarCounter",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.goToTable(f))};a.setProperty(c,"goToTable",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToDisplay())};a.setProperty(c,"goToDisplay",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToCooler())};a.setProperty(c,"goToCooler",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.isThereACustomer())};a.setProperty(c,"isThereACustomer",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.hasHunger())};a.setProperty(c,"hasHunger",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askForFood())};a.setProperty(c,"askForFood",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askWantHowManyDrinks())};a.setProperty(c,"askWantHowManyDrinks",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askWantHowManyFoods())};a.setProperty(c,"askWantHowManyFoods",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.hasThirsty())};a.setProperty(c,"hasThirsty",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askForDrink())};a.setProperty(c,"askForDrink",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToBoxOfFruits())};a.setProperty(c,"goToBoxOfFruits",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToJuiceMachine())};a.setProperty(c,"goToJuiceMachine",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpFruits(f))};a.setProperty(c,"pickUpFruits",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.prepareAndPickUpJuice(f))};a.setProperty(c,"prepareAndPickUpJuice",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.goToIceCreamMachine())};a.setProperty(c,"goToIceCreamMachine",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpIceCream(f))};a.setProperty(c,"pickUpIceCream",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askWantHowManyIceCream())};a.setProperty(c,"askWantHowManyIceCream",a.createNativeFunction(e));e=function(){return a.createPrimitive(hero.askForIceCream())};a.setProperty(c,"askForIceCream",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpHotDog(f))};a.setProperty(c,"pickUpHotDog",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.pickUpDrink(f))};a.setProperty(c,"pickUpDrink",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.deliver(f))};a.setProperty(c,"deliver",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.talk(f))};a.setProperty(c,"talk",a.createNativeFunction(e));e=function(f){return a.createPrimitive(hero.cashIn(f))};a.setProperty(c,"cashIn",a.createNativeFunction(e));e=function(g,f){return a.createPrimitive(hero.giveChange(g,f))};a.setProperty(c,"giveChange",a.createNativeFunction(e));e=function(f){return a.createPrimitive(NoBugsJavaScript.arrayCreate(f))};a.setProperty(c,"arrayCreate",a.createNativeFunction(e));e=function(f,g){return a.createPrimitive(NoBugsJavaScript.arrayGetValue(f,g))};a.setProperty(c,"arrayGetValue",a.createNativeFunction(e));e=function(f,h,g){return a.createPrimitive(NoBugsJavaScript.arraySetValue(f,h,g))};a.setProperty(c,"arraySetValue",a.createNativeFunction(e));e=function(f){return a.createPrimitive(NoBugsJavaScript.arrayLength(f))};a.setProperty(c,"arrayLength",a.createNativeFunction(e));e=function(g,h){return a.createPrimitive(Game.changeTab(g,h))};a.setProperty(c,"changeTab",a.createNativeFunction(e));for(var b=0;b<hero.extendedCommands.length;b++){e=function(g){var f=a.stateStack[0].func_.ex;return a.createPrimitive(f.run(f.machine,g))};var d=a.createNativeFunction(e);d.ex=hero.extendedCommands[b];a.setProperty(c,d.ex.nameLang,d)}};Game.waitFunction=false;Game.setTimeout=function(b,a){Game.waitFunction=true;Game.funcName=b;setTimeout(Game.runFunction,a)};Game.runFunction=function(){Game.waitFunction=false;var b={type:"CallExpression",callee:{name:Game.funcName,type:"Identifier"},arguments:[]};Game.jsInterpreter.stateStack.unshift({node:b,components:true});var a=Game.jsInterpreter.getValueFromScope("NoBugsJavaScript");a.properties.timeOut.data=true};Game.highlightPause=false;Game.highlightBlock=function(a){if(!Blockly.mainWorkspace.traceOn_){Game.editor.traceOn(true)}BlocklyApps.log.push(["IM",0]);BlocklyApps.log.push(["IM",0]);BlocklyApps.log.push(["IM",0]);BlocklyApps.log.push(["IM",0]);BlocklyApps.log.push(["IM",0]);CustomerManager.update(5);Game.editor.highlightBlock(a);Game.updateVariables();Game.highlightPause=true};Game.animate=function(){var a=BlocklyApps.log.shift();if(!a){if(Game.runningStatus==2){Game.enableButton("debugButton");Hints.startHints()}return}var b=a.shift();if(b==="nextStep"){Game.pidList.push(window.setTimeout(Game.nextStep,1));return}if(Game.step(b,a)){Game.stepSpeed=(1000*Math.pow(1-Game.speedSlider.getValue(),3))+Game.speedMultFactor;Game.pidList.push(window.setTimeout(function(){Game.animate()},Game.stepSpeed))}else{Game.resetButtons(false);Game.editor.highlightBlock(null)}};Game.step=function(b,a){if(b==="fail"){Game.showError(a);return false}hero.animate(b,a);CustomerManager.animation();Game.display();return true};Game.showError=function(d){Game.finishedRun();Hints.stopHintsEx();Game.lastErrorData.iderror=d[0];var f=document.getElementById("dialogError");var b=document.getElementById("dialogErrorText");var g=d[0];if(g.indexOf("$")==0){UserControl.getMessage(g.substring(1),BlocklyApps.LANG,{callback:function(h){g=h},async:false});g=g.replace(/\\nn/g,"<br/>")}else{g=BlocklyApps.getMsg(g)}if(d.length>0){g=g.format(d[1])}b.innerHTML=g;Game.lastErrorData.block=Blockly.selected;Game.lastErrorData.message=b.textContent;var a=(Blockly.selected==null?0:Blockly.selected.id);if(!Game.missionView){UserControl.missionError(Game.howManyRuns,CustomerManager.currentTest+1,d[0],a,b.textContent)}var e={top:"120px",width:"auto"};e[Blockly.RTL?"right":"left"]="215px";var c=Blockly.mainWorkspace.topBlocks_[Blockly.mainWorkspace.topBlocks_.length-1].getSvgRoot();MyBlocklyApps.showDialog(f,c,true,true,false,"",e,function(){Hints.startHintsEx();Hints.showErrorHint()})};Game.lastErrorHas=function(b){if(Game.lastErrorData.block==null){return}var a=Game.lastErrorData.block.inputList;for(var c=0;c<a.length;c++){if(a[c].connection!=null){if(a[c].connection.targetConnection!=null){if(a[c].connection.targetConnection.sourceBlock_.type===b){return true}}}}return false};Game.alertOpacity=[0.25,0.5,0.75,1];Game.handleAlertTimer=0;Game.alertGoalButton=function(){if(Game.handleAlertTimer!=0){return}Game.alertControl=0;Game.handleAlertTimer=window.setInterval(function(){var a=document.getElementById("goalButton");a=a.getElementsByTagName("img")[0];Game.alertControl=(Game.alertControl+1)%4;a.style.opacity=Game.alertOpacity[Game.alertControl]},300)};Game.stopAlertGoalButton=function(){if(Game.handleAlertTimer==0){return}window.clearInterval(Game.handleAlertTimer);Game.handleAlertTimer=0;var a=document.getElementById("goalButton");a=a.getElementsByTagName("img")[0];a.style.opacity=""};Game.readVariableTest=function(d){var b=Game.mission.childNodes[0].getElementsByTagName("testsvars")[0].getElementsByTagName("test");var c=b[CustomerManager.currentTest].getElementsByTagName("var");for(var a=0;a<c.length;a++){if(c[a].getAttribute("name")===d){return c[a].textContent.trim()}}return null};Game.addCallTimes=function(a){if(Game.callTimes[a]===undefined){Game.callTimes[a]=0}Game.callTimes[a]++};$(document).on("click",function(c){if(c.target.id!=="ButtonLogin"&&(Game.loginData==null||Game.loginData==undefined)){return}var a=c.target;if(a.nodeName==="svg"){return}while(a!=null&&a.id===""){a=a.parentNode}if(a==null){return}if(a.id==="blockly"){if(c.target.nodeName==="image"){var b=c.target.getAttribute("clip-path");if(b!=null){LogClick.store(b.substring(5))}return}return}LogClick.store(a.id)});Game.onObjectiveAccomplished=function(e){if(Game.clickReseting){return}var c=e[0],b=e[1];var d=BlocklyApps.getMsg("NoBugs_GoalsAccomplished");d=d.format(c,b);$("#goalsAccomplishedText").html(d);$("#goalsAccomplishedTextHeader").html(d);var a=document.getElementById("goalsAccomplishedWindowText");var f=a.innerHTML==="";a.innerHTML="";Explanation.createGoals(a);if(f){$("#goalsAccomplishedWindow").css("top",$("#goalsAccomplished").position().top-$("#goalsAccomplishedWindow").height())}};"use strict";var Explanation={};Explanation.selectCommands=function(a){var c={};var d=a.firstElementChild;while(d!=null){var b=d.getAttribute("show");if(b!=null){c[d.getAttribute("name")]=b==="true"}d=d.nextElementSibling}return c};Explanation.showInfo=function(a,k,l,b,c){a=Explanation.parseUserLogged(a);Explanation.style=(c===undefined?{width:"800px"}:c);b=(b===undefined?false:b);Explanation.instruction=b;var g=(b?"instruction":"goal");Explanation.isDialog=(b?false:a.getAttribute("dialog"));var j=[];var e=a.getElementsByTagName("page");Explanation.children=[];for(var f=0;f<e.length;f++){var d=e[f];var h=d.getAttribute("type");if(Explanation.isDialog){j.push(changeImgHex(d.innerHTML))}else{if(h===g){Explanation.children.push(d)}}}Explanation.showHint=k;Explanation.hintNumber=-1;if(Explanation.isDialog){MyBlocklyApps.lockWindow();CharacterDialog.creates($("#"+Game.editor.id).position().left,$(document).height()-250,Explanation.finishTalk,j);return}Explanation.firstStatement=0;Explanation.lastStatement=Explanation.children.length-1;Explanation.explanation=a;if(k||b){Explanation.pageNumber=Explanation.firstStatement;Explanation.createDialog(Explanation.firstStatement,l)}else{Explanation.pageNumber=Explanation.lastStatement;Explanation.createDialog(Explanation.lastStatement,l)}};Explanation.nextStatement=function(){MyBlocklyApps.hideDialog(false);Explanation.pageNumber=Explanation.pageNumber+1;Explanation.createDialog(Explanation.pageNumber)};Explanation.previousStatement=function(){MyBlocklyApps.hideDialog(false);Explanation.pageNumber=Explanation.pageNumber-1;Explanation.createDialog(Explanation.pageNumber)};Explanation.createDialog=function(h,g){var e=document.getElementById("dialogInfo");var a=document.getElementById("dialogInfoText");var c=Explanation.children;var b=c[h].innerHTML||c[h].textContent;a.innerHTML=changeImgHex(b);var d=document.getElementById("dialogInfoButton");var f=Explanation.firstStatement==Explanation.lastStatement;d.innerHTML=(f?nobugspage.finishButton(null,null,null):(h==Explanation.firstStatement?nobugspage.nextButton(null,null,null):nobugspage.previousButton(null,null,null)+(h==Explanation.lastStatement?nobugspage.finishButton(null,null,null):nobugspage.nextButton(null,null,null))));if(!Explanation.instruction){Explanation.evaluateObjectives(h,a)}MyBlocklyApps.showDialog(e,null,false,true,true,Game.missionTitle,Explanation.style,g)};Explanation.createGoal=function(a){var b=document.createElement("li");var c=a.objective;b.className="goal"+(a.achieved?"ok":"cancel");b.innerHTML=Objective.factory(c).createExplanationItem(a);if(a.notExists==="true"){b.innerHTML="<span style='color:red'>"+BlocklyApps.getMsg("explanation_mustNot")+": </span>"+b.innerHTML}return b};Explanation.evaluateObjectives=function(h,d){if(h!=Explanation.lastStatement){return}Explanation.createGoals(d);if(Game.pointsInThisMission){var m=document.createElement("table");var g=document.createElement("tr");var c=document.createElement("td");c.style.border="1px solid #FF0";c.style.padding="3px";c.style.backgroundColor="#F3F3CA";g.appendChild(c);m.appendChild(g);d.appendChild(m);var e;var b=0;var l;if(Game.noXP){e=BlocklyApps.getMsg("rewardSimpleExplanation");l=hero.objective.xpFinal}else{l=hero.objective.xpIndividual;if(hero.objective.xpTotalRun==null){e=BlocklyApps.getMsg("rewardExplanation");b=hero.objective.xpTotalTime/60}else{e=BlocklyApps.getMsg("rewardExplanationByRun");b=hero.objective.xpTotalRun}}var k="<img style='vertical-align: middle; padding-left: 3px' src='images/xp.png'/>";var j="<img style='vertical-align: middle; padding-left: 3px;' src='images/coin2.png'/>";var f=e.format(l+k,k,hero.objective.xpFinal+k,b)+"<br/>";if(hero.objective.maxCommandsReward>0){e=BlocklyApps.getMsg("commandBonusExplanation");f=f+e.format(hero.objective.maxCommandsReward+k,hero.objective.maxCommands)}else{if(hero.objective.maxCommandsRewardCoins>0){e=BlocklyApps.getMsg("commandBonusExplanation");f=f+e.format(hero.objective.maxCommandsRewardCoins+j,hero.objective.maxCommands)}}if(Game.bonusTime!=null){e=BlocklyApps.getMsg("timeBonusExplanation");var i=Game.bonusTimeReward.split(" ");f=f+e.format(i[i.length-1]+j,Game.bonusTime/60)}c.innerHTML=f}};Explanation.createGoals=function(a){var c=document.createElement("ul");a.appendChild(c);var d=hero.objective.objectives;for(var b=0;b<d.length;b++){var e=Explanation.createGoal(d[b]);c.appendChild(e)}};Explanation.finishStatement=function(){MyBlocklyApps.hideDialog(false);if(!Explanation.showHint){Hints.startHints();return}var a=function(){Game.verifyTestsInMission(function(){Hints.init(Game.mission.getElementsByTagName("hints")[0],true);Game.initTime()})};Game.alertWizardFree(a)};Explanation.parseUserLogged=function(explanations){if(explanations.getAttribute("done")){return explanations}var children=explanations.getElementsByTagName("page");var userLogged=Game.loginData.userLogged;for(var j=0;j<children.length;j++){var e=children[j].textContent;do{var i=e.indexOf("$${");if(i==-1){break}var e1=e.substring(i+3);var e2=e1.substring(0,e1.indexOf("}"));var e3=eval(e2);e=e.substring(0,i)+e3+e.substring(e.indexOf("}")+1)}while(true);if(children[j].innerHTML){children[j].innerHTML=e}else{children[j].textContent=e}}explanations.setAttribute("done","true");return explanations};Explanation.finishTalk=function(){MyBlocklyApps.unlockWindow();Explanation.finishStatement()};"use strict";var Hints={};Hints.Categories=[];Hints.beforeHideChaff=null;Hints.chooseCategoryCalled=false;Hints.bindEvent1=null;Hints.bindEvents=[];Hints.TIMEINTERVAL=3000;Hints.lastTimeSpent=0;Hints.hndlTimer=0;Hints.hintBlockDeleted=null;Hints.evtChangeListener=null;Hints.specialControl=false;Hints.noHints=false;Hints.menuOpened=false;Hints.showedIddle=0;Hints.lastInsertedBlock=null;Hints.activeBlock=null;Hints.lastCountBlocks=0;Hints.showedCountInstrutionsHint=false;Hints.dealError=false;var countInstructions,countTopInstructions,menuSelected,showedHint;Hints.init=function(b,c){if(!Game.loginData.userLogged.showHint||Hints.noHints){return}Hints.hints={sequence:[],whenError:[]};Hints.chooseCategoryCalled=false;Hints.bindEvent1=null;Hints.bindEvents=[];Hints.TIMEINTERVAL=3000;Hints.lastTimeSpent=0;Hints.hndlTimer=0;Hints.hintBlockDeleted=null;Hints.evtChangeListener=null;Hints.specialControl=false;Hints.menuOpened=false;Hints.showedIddle=0;Hints.lastInsertedBlock=null;Hints.activeBlock=null;Hints.lastCountBlocks=Game.editor.countInstructions();Hints.showedCountInstrutionsHint=false;if(Hints.evtChangeListener==null){Hints.evtChangeListener=Game.editor.addChangeListener(Hints.changeListener)}if(b!=null){var a=b.getElementsByTagName("sequence");if(a!=null&&a.length>0){Hints.hints.sequence=Hints.traverseHints(a[0].firstElementChild,false)}a=b.getElementsByTagName("errors");if(a!=null&&a.length>0){Hints.hints.whenError=Hints.traverseHints(a[0].firstElementChild,true)}}Hints.addDefaultErrorHints();if(c&&Hints.hints.sequence.length>0){Hints.launchTimer(Hints.hints.sequence[0].time)}if(Blockly.mainWorkspace&&Blockly.mainWorkspace.toolbox_!=undefined){Blockly.bindEvent_(Blockly.mainWorkspace.toolbox_.HtmlDiv,"mousedown",null,Hints.menuEvent)}if(Hints.beforeHideChaff==null){Hints.beforeHideChaff=Blockly.hideChaff;Blockly.hideChaff=Hints.hideChaff}};Hints.menuEvent=function(){Hints.menuOpened=Blockly.mainWorkspace.toolbox_.tree_.selectedItem_!=null};Hints.hideChaff=function(a){Hints.beforeHideChaff(a);Hints.menuOpened=false};Hints.addDefaultErrorHints=function(){var a={};a.content=document.getElementById("Hints_DebugButtonError").innerHTML;a.time=0;a.running=false;a.category="DebugProgram";a.condition="Game.howManyRuns > 2 && "+Hints.Categories[a.category].naturalCondition;Hints.hints.whenError.push(a);a=new Object();a.category="TestBlock";a.content=document.getElementById("Hints_EmptyInputError").innerHTML;a.time=10000;a.running=false;a.condition="Hints.hasEmptyInputs()";Hints.hints.sequence.push(a)};Hints.formatCategory=function(b){var a=b.category;if(a.indexOf("(")>0){b.args=a.substring(a.indexOf("("));b.args=b.args.substring(1,b.args.length-1);b.args=b.args.split(",");b.category=a.substring(0,a.indexOf("("))}};Hints.traverseHints=function(e,b){var a=[];var d=null;var c=null;while(e){c={};c.showed=false;c.type=e.tagName;c.category=e.getAttribute("category");Hints.formatCategory(c);c.content=e.textContent;if(c.content.length==0){c.content=null}c.content=changeImgHex(c.content);c.time=e.getAttribute("time");if(c.time==null){c.time=Hints.TIMEINTERVAL}c.time=parseInt(c.time);c.condition=(e.getAttribute("condition"));if(c.condition==null){c.condition=Hints.Categories[c.category].condition}if(c.condition==undefined){c.condition="true"}if(Hints.Categories[c.category].naturalCondition!=undefined){c.condition=Hints.Categories[c.category].naturalCondition+" && "+c.condition}c.running=e.getAttribute("running");if(c.running==null){c.running=Hints.Categories[c.category].running}if(c.running==null||c.running==undefined){c.running=false}c.modal=e.getAttribute("modal");if(c.modal==null||c.modal==undefined){c.modal=false}else{c.modal=c.modal==="true"}e=e.nextElementSibling;if(c.category==="BlockDeleted"&&Hints.hintBlockDeleted==null){Hints.hintBlockDeleted=c;continue}if(d!=null){d.next=c}d=c;a.push(c)}return a};Hints.showErrorHint=function(){if(Hints.noHints){return}countInstructions=Game.editor.countInstructions();Hints.dealError=true;Hints.hintSelected=null;var hintErrors=Hints.hints.whenError;for(var i=0;i<hintErrors.length;i++){var hint=hintErrors[i];Hints.hintSelected=hint;if(hint.category==="TestBlock"){Hints.foundTestBlock=false;Game.editor.countInstructions(Hints.visitBlocks);if(Hints.foundTestBlock){return}}else{showedHint=hint.showed;var condition=eval(hint.condition);if(condition){var cat=Hints.Categories[hint.category];hint.showed=true;cat.show(hint.args);Hints.associateHideEvents(null,(cat.specialEvent!=undefined?cat.specialEvent():null));break}}}};Hints.timeIsUp=function(){if(Hints.hndlTimer==0){return}Hints.dealError=false;Hints.hndlTimer=0;var c=Hints.hints.sequence;if(c.length==0){return}if(Blockly.Block.dragMode_>0){Hints.launchTimer(Hints.TIMEINTERVAL);return}var b=Game.hideHints;Game.hideHints=false;countInstructions=Game.editor.countInstructions();countTopInstructions=Game.editor.lengthTopBlocks();if(Blockly.mainWorkspace&&Blockly.mainWorkspace.toolbox_!=undefined){menuSelected=Blockly.mainWorkspace.toolbox_.tree_.selectedItem_;menuSelected=(menuSelected!=null?menuSelected.element_:null)}else{menuSelected=null}Hints.hintSelected=null;for(var a=0;a<c.length;a++){if(Hints.runHint(c[a])){Game.hideHints=b;return}}Game.hideHints=b;Hints.launchTimer(Hints.TIMEINTERVAL)};Hints.runHint=function(hint){Hints.hintSelected=hint;if(Game.runningStatus>0&&!hint.running){return false}if(hint.category==="TestBlock"){Hints.foundTestBlock=false;Game.editor.countInstructions(Hints.visitBlocks);if(Hints.foundTestBlock){return true}return false}showedHint=hint.showed;var condition=eval(hint.condition);var cat=Hints.Categories[hint.category];if(condition&&Hints.showOnMenu(cat)){if(Hints.lastTimeSpent<hint.time){Hints.hndlTimer=window.setTimeout(Hints.showHint.bind(window,hint),hint.time-Hints.lastTimeSpent);Hints.lastTimeSpent=hint.time}else{Hints.showHint(hint)}return true}return false};Hints.showHint=function(b){Hints.hintSelected=b;var a=Hints.Categories[b.category];b.showed=true;a.show(b.args);Hints.associateHideEvents(a.bindEvent,(a.specialEvent!=undefined?a.specialEvent():null))};Hints.launchTimer=function(a){if(Hints.hndlTimer==0&&!Hints.noHints){Hints.hndlTimer=window.setTimeout(Hints.timeIsUp,a);Hints.lastTimeSpent=a}};Hints.showOnMenu=function(b){if(!Hints.menuOpened){return true}var a=b.hideOnMenu;if(a==undefined){a=true}return !a};Hints.visitBlocks=function(block){Hints.activeBlock=block;var hint=Hints.hintSelected;showedHint=hint.showed;var condition=eval(hint.condition);var cat=Hints.Categories[hint.category];if(condition&&(Hints.dealError||Hints.showOnMenu(cat))){Hints.foundTestBlock=true;hint.showed=true;cat.show(hint.args);Hints.associateHideEvents(cat.bindEvent,(cat.specialEvent!=undefined?cat.specialEvent():null));return false}Hints.activeBlock=null;return true};Hints.associateHideEvents=function(b,a){if(b==undefined||b==null){b=Hints.hideHintWithTimer}Hints.bindEvent1=Game.editor.addChangeListener(b);if(Blockly.mainWorkspace&&Blockly.mainWorkspace.toolbox_!=undefined){Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.toolbox_.HtmlDiv,"mousedown",null,b))}if(Blockly.mainWorkspace){Hints.bindEvents.push(Game.editor.bindMouseDownSvgGroupEvent(null,b))}Hints.bindEvents.push(Blockly.bindEvent_(window,"showWindowPrompt",null,b));if(a!=null){Hints.bindEvents.push(a)}if(Blockly.mainWorkspace){Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.hScroll.svgBackground_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.hScroll.svgKnob_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.vScroll.svgBackground_,"mousedown",null,b));Hints.bindEvents.push(Blockly.bindEvent_(Blockly.mainWorkspace.scrollbar.vScroll.svgKnob_,"mousedown",null,b))}Hints.bindEvents.push(Blockly.bindEvent_(Game.slider.svg,"mousedown",null,b))};Hints.hideHintWithTimer=function(){Hints.stopHints();Hints.launchTimer((Hints.hintSelected==null||Hints.hintSelected.next==null?Hints.TIMEINTERVAL:Hints.hintSelected.next.time))};Hints.hideHints=function(){MyBlocklyApps.hideDialog(false);if(Hints.bindEvent1!=null){Game.editor.removeChangeListener(Hints.bindEvent1);Hints.bindEvent1=null}while(Hints.bindEvents.length>0){Blockly.unbindEvent_(Hints.bindEvents[0]);Hints.bindEvents.shift()}};Hints.startHints=function(){if(Hints.specialControl||Hints.noHints){return}Hints.showedErrorHint=false;Hints.launchTimer(Hints.TIMEINTERVAL)};Hints.stopHints=function(){window.clearTimeout(Hints.hndlTimer);Hints.hideHints();Hints.hndlTimer=0};Hints.startHintsEx=function(){if(Hints.noHints){return}Hints.specialControl=false;Hints.startHints()};Hints.stopHintsEx=function(){Hints.stopHints();Hints.specialControl=true};Hints.changeListener=function(){var a=Game.editor.countInstructions();Game.updateCounterInstructions(a);if(a>Hints.lastCountBlocks){Hints.lastInsertedBlock=Blockly.selected}else{if(a<Hints.lastCountBlocks){Hints.lastInsertedBlock=null;if(Hints.hintBlockDeleted!=null){Hints.runHint(Hints.hintBlockDeleted)}}}Hints.activeBlock=Hints.lastInsertedBlock;Hints.lastCountBlocks=a};Hints.countChildren=function(b){var a=[];if(b.type==="controls_if"){a.push(b.childBlocks_[1]);if(b.elseCount_==1){a.push(b.childBlocks_[2])}}else{a.push(b)}return Game.editor.countInstructions(null,a)};function calcTop(a){return a.offsetTop+a.offsetParent.offsetTop+a.offsetParent.offsetParent.offsetTop}function calcLeft(a){return a.offsetLeft+a.offsetParent.offsetLeft+a.offsetParent.offsetParent.offsetLeft}function HintShowDialog(c,b,a,d){MyBlocklyApps.showDialog(c,null,false,false,a==true,BlocklyApps.getMsg("Hints_Title"),b,null,function(){if(d){d()}Hints.hideHintWithTimer()},true)}function HintShowModalDialog(c,b,a,d){MyBlocklyApps.showDialog(c,null,false,true,a==true,BlocklyApps.getMsg("Hints_Title"),b,null,function(){if(d){d()}Hints.hideHintWithTimer()},true)}function createLeftDlg(h,f){document.getElementById("LeftHintText").innerHTML=f;var d=calcTop(h);var g=calcLeft(h);var b=h.clientWidth;var c={};c.width="300px";c.top=d+"px";c.left=(g+b)+"px";var a=document.getElementById("LeftHint");HintShowDialog(a,c)}function createStyle(g,f,a){var h=BlocklyApps.getBBox_(g);var c=h.y;var d=h.x;var b={};b.width="500px";b.top=(c+f)+"px";b.left=(d-(a.clientWidth/2))+"px";return b}function createStylePosition(d,b,a){var c=Blockly.mainWorkspace.toolbox_.tree_.children_[d].element_;c=Blockly.mainWorkspace.toolbox_.flyout_.workspace_.getTopBlocks(false)[b];if(c==undefined){return[]}Hints.hintSelected.e=c;return[createStyle(c.getSvgRoot(),c.height,a),c.getSvgRoot()]}function createDownDlg(e,d,a){var b=document.getElementById("DownHint");var f=document.getElementById("DownHintText");f.innerHTML=a;var c={};c.top=(d-155)+"px";c.left=(e-10)+"px";c.width="550px";HintShowDialog(b,c)}function createDownDlgByButton(c,a){var b=document.getElementById(c);var d=BlocklyApps.getBBox_(b);createDownDlg(d.x,d.y,a);return b}function createRightDlg(a,g,f,e){var b=document.getElementById("RightHint");var d=document.getElementById("RightHintText");d.innerHTML=f;var c={};c.width="300px";c.top=g+"px";c.left=(a-325)+"px";if(e){HintShowModalDialog(b,c)}else{HintShowDialog(b,c)}}function createInfoDlg(e,b,f,d){var c=document.getElementById("dialogHint");var a=document.getElementById("dialogHintText");a.innerHTML=e;if(d){HintShowModalDialog(c,b,true)}else{HintShowDialog(c,b,true)}}Hints.countInstructions=function(){return countInstructions};Hints.howManyRuns=function(){return Game.howManyRuns};Hints.countTopInstructions=function(){return countTopInstructions};Hints.typeActiveBlock=function(){return Hints.activeBlock.type};Hints.countShowedIddle=function(){return Hints.showedIddle};Hints.countChildrenActiveBlock=function(){return Hints.countChildren(Hints.activeBlock)};Hints.blockTypeLastError=function(){return Game.lastErrorData.block.type};Hints.containsBlockTypeLastError=function(a){return Game.lastErrorHas(a)};Hints.lastErrorId=function(){return Game.lastErrorData.iderror};Hints.fCountVariable=function(a){if(a.type==="variables_set"){Hints.totalVariable++}return true};Hints.countVariable=function(){Hints.totalVariable=0;Game.editor.countInstructions(Hints.fCountVariable);return Hints.totalVariable};Hints.isVariable=function(){return(Hints.activeBlock!=null&&Hints.activeBlock.type=="variables_set")};Hints.variableName=function(){return Hints.activeBlock.getVars()[0]};Hints.showedHint=function(){return showedHint};Hints.activeBlockHasElse=function(){return Hints.activeBlock.elseCount_>0};Hints.hasEmptyInputs=function(){if(Hints.activeBlock==Hints.lastInsertedBlock){return false}return Game.hasEmptyInputs(Hints.activeBlock)};Hints.hasEmptyInputsEx=function(){return Game.hasEmptyInputs(Hints.activeBlock)};Hints.fCountVariableName=function(b){if(b.type==="variables_set"){var c=b.getVars()[0];for(var a=0;a<Hints.variablesNames.length;a++){if(Hints.variablesNames[a]===c){return true}}Hints.variablesNames.push(c)}return true};Hints.countVariableName=function(){Hints.variablesNames=[];Game.editor.countInstructions(Hints.fCountVariableName);return Hints.variablesNames.length};Hints.instructionEnabled=function(){return $("#instructionButton").css("display").indexOf("inline")==0};Hints.isGoalNotAchieved=function(a){var b=hero.objective.objectives;return(!b[a-1].achieved)};Hints.lastTalkText=function(){var a=hero.talkText;if(a!=null){return a.data}else{return null}};Hints.Categories.ChooseCategory={show:function(c){Hints.hintSelected.e=Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(c[0])].element_;var b=Hints.hintSelected.e.firstChild.childNodes[2].textContent;var a=null;if(Hints.hintSelected.content==null){Hints.hintSelected.content=BlocklyApps.getMsg("Hints_ChooseCategory");Hints.hintSelected.content=Hints.hintSelected.content.format(b)}a=Hints.hintSelected.content;createLeftDlg(Hints.hintSelected.e,a)},condition:"countInstructions == 0",naturalCondition:"(Hints.chooseCategoryCalled == false) && (Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(Hints.hintSelected.args[0])].element_ != menuSelected)",specialEvent:function(){return Blockly.bindEvent_(Hints.hintSelected.e,"mousedown",null,Hints.Categories.ChooseCategory.onselect)},onselect:function(){Hints.chooseCategoryCalled=true;Hints.hideHintWithTimer()},hideOnMenu:false};Hints.Categories.SelectCommand={show:function(c){var b=document.getElementById("SelectCommand");var a=createStylePosition(parseInt(c[0]),parseInt(c[1]),b);if(a.length>0){HintShowDialog(b,a[0]);Hints.chooseCategoryCalled=true}else{Hints.Categories.SelectCommand.bindEvent()}},condition:"countInstructions == 0",naturalCondition:"(Hints.chooseCategoryCalled == true || (Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(Hints.hintSelected.args[0])].element_ == menuSelected))",bindEvent:function(){Hints.chooseCategoryCalled=false;Hints.hideHintWithTimer()},hideOnMenu:false};Hints.Categories.StackTogether={show:function(e){var b=document.getElementById("StackTogether");b.getElementsByTagName("img").HelpStack.style.display="inline";var d=Blockly.mainWorkspace.topBlocks_;for(var a=0;a<d.length;a++){if(d[a].type===e[2]){if(d[a].childBlocks_.length>1){return null}else{Blockly.mainWorkspace.toolbox_.tree_.setSelectedItem(Blockly.mainWorkspace.toolbox_.tree_.children_[parseInt(e[0])]);var c=createStylePosition(parseInt(e[0]),parseInt(e[1]),b);HintShowDialog(b,c[0]);return c[1]}}}},condition:"countInstructions == 1",hideOnMenu:false};Hints.Categories.StackTogetherTwo={show:function(c){var a=document.getElementById("StackTogether");a.getElementsByTagName("img").HelpStack.style.display="none";var b=Blockly.mainWorkspace.topBlocks_;HintShowDialog(a,createStyle(b[1].getSvgRoot(),50,a))},condition:"Blockly.mainWorkspace.topBlocks_.length == 2"};Hints.Categories.RunProgram={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_RunProgram").innerHTML}return createDownDlgByButton("runButton",Hints.hintSelected.content)},condition:"Game.howManyRuns == 0",naturalCondition:"countInstructions > 0"};Hints.Categories.DebugProgram={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_DebugProgram").innerHTML}return createDownDlgByButton("debugButton",Hints.hintSelected.content)},condition:"Game.howManyRuns == 0",naturalCondition:"Game.enabledDebug == true && countInstructions > 0",running:true};Hints.Categories.GoalButton={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_GoalButton").innerHTML}return createDownDlgByButton("goalButton",Hints.hintSelected.content)},condition:"Game.howManyRuns > 2"};Hints.Categories.SourceCode={show:function(a){var b=BlocklyApps.getBBox_(Blockly.mainWorkspace.topBlocks_[0].getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content)},condition:"true"};Hints.Categories.WhileDebugging={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_WhileDebugging").innerHTML}Hints.Categories.SourceCode.show()},naturalCondition:"Game.runningStatus == 2",running:true};Hints.Categories.VariableWindow={show:function(b){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_VariableWindow").innerHTML}var a=parseInt(Game.variableBox.style.left.replace("px",""));var c=parseInt(Game.variableBox.style.top.replace("px",""));if(Game.varWindow==Game.RIGHT){createRightDlg(a,c,Hints.hintSelected.content)}else{createDownDlg(a,c,Hints.hintSelected.content)}},naturalCondition:"Game.runningStatus == 2 && Game.enabledVarWindow == true && Hints.Categories['VariableWindow'].thereAreVariable()",running:true,thereAreVariable:function(){var c=Game.jsInterpreter.variables;for(var a=0;a<c.length;a++){var b=c[a].scope.properties[c[a].name].data;if(b!=undefined){return true}}return false}};Hints.Categories.LastBlockInserted={show:function(a){var b=BlocklyApps.getBBox_(Hints.lastInsertedBlock.getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content)},naturalCondition:"Hints.lastInsertedBlock != null"};Hints.Categories.TestBlock={show:function(a){Blockly.mainWorkspace.traceOn(true);Blockly.mainWorkspace.highlightBlock(Hints.activeBlock.id);var b=BlocklyApps.getBBox_(Hints.activeBlock.getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content,Hints.hintSelected.modal)}};Hints.Categories.Iddle={show:function(b){var c=BlocklyApps.getBBox_(Blockly.mainWorkspace.topBlocks_[0].getSvgRoot());var a={top:"120px"};a[Blockly.RTL?"right":"left"]=(c.x-500)+"px";a.width="440px";createInfoDlg(Hints.hintSelected.content,a,Game.missionTitle,Hints.hintSelected.modal);Hints.showedIddle++},naturalCondition:"(Blockly.mainWorkspace.topBlocks_.length > 0)"};Hints.Categories.BlockDeleted={show:function(b){var a={top:"120px"};a.width="440px";createInfoDlg(Hints.hintSelected.content,a,Game.missionTitle)}};Hints.showedErrorHint=false;Hints.Categories.LastError={show:function(a){var b=BlocklyApps.getBBox_(Game.lastErrorData.block.getSvgRoot());createRightDlg(b.x,b.y,Hints.hintSelected.content);Hints.showedErrorHint=true},naturalCondition:"(!Hints.showedErrorHint && Game.lastErrorData.block != null)"};Hints.Categories.ShowCountInstructions={show:function(a){if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("Hints_ShowCountInstructions").innerHTML}var b=BlocklyApps.getBBox_(Game.counterInstruction);createRightDlg(b.x,b.y,Hints.hintSelected.content);Hints.showedCountInstrutionsHint=true},naturalCondition:"(Game.firstTime && !Hints.showedCountInstrutionsHint)"};Hints.Categories.Slider={show:function(a){Game.slider.svg.style.visibility="visible";if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("NoBugs_slider").innerHTML}var b=BlocklyApps.getBBox_(document.getElementById("divslider"));createDownDlg(b.x,b.y,Hints.hintSelected.content)},naturalCondition:"Game.howManyRuns >= Game.slider.timesBefore && Game.slider.svg.style.visibility == 'hidden'"};Hints.Categories.SliderEx={show:function(a){Game.slider.svg.style.visibility="visible";if(Hints.hintSelected.content==null){Hints.hintSelected.content=document.getElementById("NoBugs_slider").innerHTML}var b=BlocklyApps.getBBox_(document.getElementById("divslider"));createDownDlg(b.x,b.y,Hints.hintSelected.content)}};Hints.Categories.Free={show:function(b){var a={top:"120px"};a.width="440px";createInfoDlg(Hints.hintSelected.content,a,Game.missionTitle,Hints.hintSelected.modal)}};"use strict";var MyBlocklyApps={};MyBlocklyApps.showDialog=function(h,n,c,p,i,l,b,q,k,g){if(BlocklyApps.isDialogVisible_){MyBlocklyApps.hideDialog(false)}BlocklyApps.isDialogVisible_=true;BlocklyApps.dialogOrigin_=n;BlocklyApps.dialogDispose_=q;var j=document.getElementById("dialog");j.style.width="80%";j.style.height="auto";var o=document.getElementById("dialogShadow");var e=document.getElementById("dialogBorder");for(var a in b){j.style[a]=b[a]}if(p){o.style.visibility="visible";o.style.opacity=0.3;o.style.zIndex=110}var f=null;if(g===undefined||g===true){f=document.createElement("div");f.id="dialogHeader";if(l!=null){f.innerHTML="<b style='position:absolute;left:5px'>"+l+"</b>"}if(k!=undefined||k!=null){f.style.textAlign="right";var m=document.createElement("button");m.id="closeDialog";m.style.padding="0px";m.style.margin="0px";m.style.minWidth="0px";m.style.backgroundColor="transparent";m.style.border="none";m.innerHTML="<img src='images/closedialog.png' style='width:16px;height:16px'/>";m.onclick=function(){k();MyBlocklyApps.hideDialog("false")};f.appendChild(m)}j.appendChild(f);BlocklyApps.dialogMouseDownWrapper_=Blockly.bindEvent_(f,"mousedown",null,BlocklyApps.dialogMouseDown_)}j.appendChild(h);h.className=h.className.replace("dialogHiddenContent","");if(i){j.style.top=Math.max(0,((window.innerHeight-j.clientHeight)/2))+"px";j.style.left=Math.max(0,((window.innerWidth-j.clientWidth)/2))+"px"}function d(){if(BlocklyApps.isDialogVisible_){j.style.visibility="visible";j.style.zIndex=120;e.style.visibility="hidden"}}if(c&&n){BlocklyApps.matchBorder_(n,false,0.2);BlocklyApps.matchBorder_(j,true,0.8);window.setTimeout(d,175)}else{d()}};MyBlocklyApps.hideDialog=function(f){if(!BlocklyApps.isDialogVisible_){return}BlocklyApps.dialogUnbindDragEvents_();if(BlocklyApps.dialogMouseDownWrapper_){Blockly.unbindEvent_(BlocklyApps.dialogMouseDownWrapper_);BlocklyApps.dialogMouseDownWrapper_=null}BlocklyApps.isDialogVisible_=false;var a=(f===false)?null:BlocklyApps.dialogOrigin_;var c=document.getElementById("dialog");var h=document.getElementById("dialogShadow");var b=document.getElementById("dialogBorder");if(c.style.setAttribute){c.style.setAttribute("cssText","")}else{c.setAttribute("style","")}h.style.opacity=0;function d(){h.style.visibility="hidden";b.style.visibility="hidden"}if(a){BlocklyApps.matchBorder_(c,false,0.8);BlocklyApps.matchBorder_(a,true,0.2);window.setTimeout(d,175)}else{d()}c.style.visibility="hidden";c.style.zIndex=-1;var g=document.getElementById("dialogHeader");if(g){g.parentNode.removeChild(g)}while(c.firstChild){var e=c.firstChild;e.className+=" dialogHiddenContent";document.body.appendChild(e)}BlocklyApps.dialogDispose_&&BlocklyApps.dialogDispose_();BlocklyApps.dialogDispose_=null};MyBlocklyApps.unbindClick=function(a,b){if(typeof a=="string"){a=document.getElementById(a)}a.removeEventListener("click",b);a.removeEventListener("touchend",b)};MyBlocklyApps.newShowModalDialog=function(b){var a=$("<div />").css({width:"800px",height:"600px",zIndex:"1"}).addClass("dialog");a.css("visibility","visible");a.html(b);var d=Math.max(0,((window.innerHeight-a.height())/2));var c=Math.max(0,((window.innerWidth-a.width())/2));a.offset({top:d,left:c});$("body").append(a)};MyBlocklyApps.lockWindow=function(){var a=document.getElementById("dialogShadow");a.style.visibility="visible";a.style.opacity=0.3};MyBlocklyApps.unlockWindow=function(){var a=document.getElementById("dialogShadow");a.style.visibility="hidden";a.style.opacity=0};var afterMyPaste=Blockly.WorkspaceSvg.prototype.paste;var beforeMyKeyDown=Blockly.onKeyDown_;var afterMyMouseMove=Blockly.onMouseMove_;var myIsTargetSvg=false;MyBlocklyApps.onKeyDown_=function(b){if(Blockly.isTargetInput_(b)){return}if(b.keyCode==27){if($("#resetButton").attr("disabled")!=="disabled"){$("#resetButton").click()}Blockly.hideChaff()}else{if(b.keyCode==8||b.keyCode==46){try{Blockly.hideChaff();if(Game.blocksSelected.length==0){if(Blockly.selected.isDeletable()){Blockly.selected.dispose(true,true)}}else{Game.blocksSelected.forEach(function(c){if(c.isDeletable()){c.dispose(true,true)}});Game.blocksSelected=[]}}finally{b.preventDefault()}}else{if(b.keyCode==119){if($("#debugButton").attr("disabled")!=="disabled"){$("#debugButton").click()}}else{if(b.keyCode==121){if($("#runButton").attr("disabled")!=="disabled"){$("#runButton").click()}}else{if(b.ctrlKey&&!b.shiftKey){if(Blockly.selected){Blockly.hideChaff();if(b.keyCode==67||b.keyCode==88){if(Game.toolbox!=='<xml id="toolbox" style="display: none"></xml>'){if(b.keyCode==67){Blockly.copy_(Blockly.selected)}else{if(b.keyCode==88){Blockly.copy_(Blockly.selected);if(Game.blocksSelected.length==0){Blockly.selected.dispose(true,true)}else{Game.blocksSelected.forEach(function(c){if(c.isDeletable()&&c.isMovable()){c.dispose(true,true)}});Game.blocksSelected=[]}}}}}}if(b.keyCode==86){if(Blockly.clipboardXml_){Blockly.clipboardSource_.paste(Blockly.clipboardXml_)}}else{if(b.keyCode==90){if(Game.lastDeletedBlocks.length>0){Game.lastDeletedBlocks.forEach(function(c){});Game.lastDeletedBlocks=[]}}}}else{if(b.ctrlKey&&b.shiftKey){var a=null;switch(b.keyCode){case 49:if(Game.toolbox.indexOf('<block type="move_goToBarCounter">')==-1){return}a=transformStrToXml("<block type='move_goToBarCounter'><value name='VALUE'><block type='math_number'><field name='NUM'>3</field></block></value></block>").childNodes[0];break;case 50:if(Game.toolbox.indexOf('<block type="move_goToDisplay">')==-1){return}a=transformStrToXml("<block type='move_goToDisplay'></block></value></block>").childNodes[0];break;case 51:if(Game.toolbox.indexOf('custom="VARIABLE"')==-1){return}a=transformStrToXml("<block type='variables_set'></block>").childNodes[0];break;case 52:if(Game.toolbox.indexOf('<block type="controls_if">')==-1){return}a=transformStrToXml("<block type='controls_if'></block>").childNodes[0];break;case 53:if(Game.toolbox.indexOf('<block type="controls_for">')==-1){return}a=transformStrToXml('<block type="controls_for"><field name="VAR">i</field><value name="FROM"><block type="math_number"><field name="NUM">1</field></block></value><value name="TO"><block type="math_number"><field name="NUM">3</field></block></value><value name="BY"><block type="math_number" deletable="false"><field name="NUM">1</field></block></value></block>').childNodes[0];break;case 54:if(Game.toolbox.indexOf('<block type="controls_whileUntil">')==-1){return}a=transformStrToXml('<block type="controls_whileUntil"><value name="BOOL"><block type="logic_compare"><field name="OP">LTE</field><value name="A"><block type="variables_get"><field name="VAR">item</field></block></value><value name="B"><block type="math_number"><field name="NUM">10</field></block></value></block></value></block>').childNodes[0];break}if(a!=null){if(Blockly.selected){Blockly.selected.unselect()}Blockly.hideChaff();Blockly.Xml.domToBlock(Blockly.mainWorkspace,a)}}}}}}}};Blockly.BlockSvg.prototype.checkBlocks=function(e,f,d){var h=Blockly.BlockSvg.Game;var c=e.nextConnection.targetConnection!=null;for(var b=0;b<e.childBlocks_.length;b++){var g=e.childBlocks_[b];if((c&&g!=e.nextConnection.targetConnection.sourceBlock_)||!c){while(g!=null){if(f==1){var a=h.blocksSelected.indexOf(g);if(a!=-1){h.blocksSelected[a].unselect();h.blocksSelected.splice(a,1)}else{if(g.type==="controls_if"){this.checkBlocks(g,1)}}}else{if(g==d){return false}}if(g.nextConnection!=null&&g.nextConnection.targetConnection!=null){g=g.nextConnection.targetConnection.sourceBlock_}else{g=null}}}}return true};Blockly.BlockSvg.prototype.select=function(){var c=Blockly.BlockSvg.Game;try{if(c.hideHints){Hints.hideHintWithTimer()}}catch(g){}myIsTargetSvg=false;if(!c.SHIFTPRESSED){c.blocksSelected.forEach(function(i){i.unselect()});c.blocksSelected=[];if(Blockly.selected){Blockly.selected.unselect()}}else{if(Blockly.selected&&Blockly.selected!=this&&c.blocksSelected.length==0){c.blocksSelected.push(Blockly.selected)}else{var h=c.blocksSelected.indexOf(this);if(h!=-1){c.blocksSelected.splice(h,1);this.unselect();return}}if(c.blocksSelected.length>0){var b=this.parentBlock_;var a=this;while(b!=null){if(b.type==="controls_if"){if(c.blocksSelected.indexOf(b)==-1){a=b}else{if(!this.checkBlocks(b,2,a)){return}}}b=b.parentBlock_}if(this.type==="controls_if"){this.checkBlocks(this,1)}var k=false;for(var f=0;f<c.blocksSelected.length;f++){var d=c.blocksSelected[f];var e=null;if(f<c.blocksSelected.length-1){e=c.blocksSelected[f+1]}while(d!=null&&d.nextConnection!=null&&d!=e){var j=d.nextConnection.targetConnection;if(j!=null&&j.sourceBlock_.id===this.id){c.blocksSelected.splice(f+1,0,this);k=true;break}if(j==null){d=null}else{d=j.sourceBlock_}}if(k){break}}if(!k){c.blocksSelected.splice(0,0,this)}}}Blockly.selected=this;this.addSelect();Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};Blockly.BlockSvg.prototype.unselect=function(){var a=Blockly.BlockSvg.Game;if(a.blocksSelected.length>0&&myIsTargetSvg){a.blocksSelected.forEach(function(b){b.removeSelect()});a.blocksSelected=[]}else{this.removeSelect()}if(a.blocksSelected.length>0){Blockly.selected=a.blocksSelected[a.blocksSelected.length-1]}else{Blockly.selected=null}Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};Blockly.copy_=function(b){var d=Blockly.BlockSvg.Game;if(d.blocksSelected.length>0){Blockly.clipboard_=[];var a=null;var c=null;d.blocksSelected.forEach(function(f){var g=Blockly.littleCopy_(f);var e=null;if(a!=null){if(a.nextConnection!=null&&a.nextConnection.targetConnection!=null&&a.nextConnection.targetConnection.sourceBlock_.id===f.id){e=c}}Blockly.clipboard_.push({xml:g,previous:e});c=g;a=f})}else{Blockly.clipboard_=[{xml:Blockly.littleCopy_(b),previous:null}]}};Blockly.littleCopy_=function(c){var a=Blockly.Xml.blockToDom_(c);a.removeAttribute("deletable");Blockly.Xml.deleteNext(a);var b=c.getRelativeToSurfaceXY();a.setAttribute("x",Blockly.RTL?-b.x:b.x);a.setAttribute("y",b.y);Blockly.clipboardXml_=a;Blockly.clipboardSource_=c.workspace;return a};Blockly.WorkspaceSvg.prototype.paste=function(d){var e=Blockly.BlockSvg.Game;var a=Blockly.mainWorkspace;var c=[];var b=null;if(Blockly.selected!=null){Blockly.selected.unselect()}a.allVars=Blockly.Variables.allVariables(Blockly.mainWorkspace);Blockly.clipboard_.forEach(function(h){if(!a.aux){var g=h.xml.getAttribute("type");if(g.indexOf("procedures_def")==0){return}}var f=afterMyPaste.bind(a,h.xml);f();var i=Blockly.mainWorkspace.getBlockById(h.xml.id);if(h.previous!=null){c[c.length-1].nextConnection.connect(Blockly.selected.previousConnection)}c.push(Blockly.selected);b=i});a.allVars=null;e.blocksSelected=c;e.blocksSelected.forEach(function(f){f.addSelect()})};function unselectAll(){var a=Blockly.BlockSvg.Game;a.blocksSelected.forEach(function(b){if(b!=Blockly.selected){b.removeSelect()}});a.blocksSelected=[]}Blockly.onMouseMove_=function(a){unselectAll();afterMyMouseMove(a)};MyBlocklyApps.onMouseDown_=function(a){if(Blockly.selected){Blockly.selected.unselect()}unselectAll()};Blockly.onKeyDown_=function(a){if(Blockly.isTargetInput_(a)){return}var b=Blockly.BlockSvg.Game;beforeMyKeyDown(a);if(a.ctrlKey&&a.keyCode==88){b.blocksSelected.forEach(function(c){if(c.isDeletable()&&c.isMovable()){c.dispose(true,true)}})}else{if(a.keyCode==8||a.keyCode==46){try{b.blocksSelected.forEach(function(c){if(c.isDeletable()){c.dispose(true,true)}});b.blocksSelected=[]}finally{a.preventDefault()}}}};Blockly.Procedures.findLegalName=function(a,d){if(d.isInFlyout){return a}do{var b=Game.editor.newProcedureNameIsLegal(a,d);if(b){return a}var c=a.match(/^(.*?)(\d+)$/);if(!c){a+="2"}else{a=c[1]+(parseInt(c[2],10)+1)}}while(true)};Blockly.Procedures.allProcedures=function(a){var c=[];var b=[];Game.editor.retrieveProcedures(c,b);b.sort(Blockly.Procedures.procTupleComparator_);c.sort(Blockly.Procedures.procTupleComparator_);return[b,c]};Blockly.Procedures.flyoutCategory=function(g,d,e,b){if(b.targetWorkspace.aux){if(Blockly.Blocks.procedures_defnoreturn){var f=Blockly.Block.obtain(b,"procedures_defnoreturn");f.initSvg();g.push(f);d.push(e*2)}if(Blockly.Blocks.procedures_defreturn){var f=Blockly.Block.obtain(b,"procedures_defreturn");f.initSvg();g.push(f);d.push(e*2)}if(d.length){d[d.length-1]=e*3}}function c(k,i){for(var h=0;h<k.length;h++){var m=Blockly.Block.obtain(b,i);m.setFieldValue(k[h][0],"NAME");var l=[];for(var j=0;j<k[h][1].length;j++){l[j]="ARG"+j}m.setProcedureParameters(k[h][1],l);m.initSvg();g.push(m);d.push(e*2)}}var a=Blockly.Procedures.allProcedures(b.targetWorkspace);c(a[0],"procedures_callnoreturn");c(a[1],"procedures_callreturn")};Blockly.Procedures.rename=function(b){var a=b.trim();if(!VariableNames.regex.test(a)){a=a.replace(/ /gi,"_");if(!VariableNames.regex.test(a)){a=a+"1"}b=a}b=b.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");var c=this;b=Blockly.Procedures.findLegalName(b,this.sourceBlock_);Game.editor.renameCallers(c.text_,b);return b};Blockly.Procedures.disposeCallers=function(b,a){Game.editor.disposeCallers(b)};Blockly.Procedures.mutateCallers=function(c,b,d,a){Game.editor.mutateCallers(c,d,a)};Blockly.Workspace.prototype.oldGetTopBlocks=Blockly.Workspace.prototype.getTopBlocks;Blockly.Workspace.prototype.getTopBlocks=function(a){var b=this.oldGetTopBlocks(a);if(this.aux&&this.genCode){for(var c=b.length-1;c>=0;c--){if(b[c].type.indexOf("procedures_def")==-1){b.splice(c,1)}}}return b};Blockly.setMainWorkspaceMetrics_=function(b){if(Blockly.getMainWorkspace()!=this){return}if(!this.scrollbar){throw"Attempt to set main workspace scroll without scrollbars."}var c=this.getMetrics();if(goog.isNumber(b.x)){this.scrollX=-c.contentWidth*b.x-c.contentLeft}if(goog.isNumber(b.y)){this.scrollY=-c.contentHeight*b.y-c.contentTop}var a=this.scrollX+c.absoluteLeft;var d=this.scrollY+c.absoluteTop;this.translate(a,d);if(this.options.gridPattern){this.options.gridPattern.setAttribute("x",a);this.options.gridPattern.setAttribute("y",d)}};MyBlocklyApps.variableIsArgument=function(b,f){var e=b.getAllBlocks();for(var d=0;d<e.length;d++){if(e[d].getVars&&e[d].type.indexOf("procedures_def")>-1){var a=e[d].getVars();for(var c=0;c<a.length;c++){if(a[c].toLowerCase()===f){return true}}}}return false};Blockly.Variables.isIntoAFunction=function(b){var a=b.parentBlock_;while(a!=null&&a.type.indexOf("procedures_def")==-1){a=a.parentBlock_}return(a!=null)};Blockly.Variables.allVariables=function(h){var a;if(h.getDescendants){a=h.getDescendants()}else{if(h.getAllBlocks){a=h.getAllBlocks()}else{throw"Not Block or Workspace: "+h}}var d=Object.create(null);for(var i=0;i<a.length;i++){if(a[i].getVars&&a[i].type.indexOf("procedures_def")==-1&&!Blockly.Variables.isIntoAFunction(a[i])){var c=a[i].getVars();for(var g=0;g<c.length;g++){var f=c[g];if(MyBlocklyApps.variableIsArgument(h,f.toLowerCase())){continue}if(f){d[f.toLowerCase()]=f}}}}var e=[];for(var b in d){e.push(d[b])}return e};Blockly.Variables.procVariables=function(e){var a=Blockly.Variables.allVariables(e.workspace);var b=[];a.forEach(function(f){b[f.toLowerCase()]=f});var d=e.parentBlock_;while(d!=null){if(d.type.indexOf("procedures_def")>-1){d.getVars().forEach(function(f){b[f.toLowerCase()]=f});break}d=d.parentBlock_}if(d!=null){d.childBlocks_.forEach(function(f){Blockly.FieldVariable.getVars(f).forEach(function(g){b[g.toLowerCase()]=g})})}a=[];for(var c in b){a.push(b[c])}return a};"use strict";var Graph=(function(f){var h=function(k){var j=[],i=null;for(i in k){Object.prototype.hasOwnProperty.call(k,i)&&j.push(i)}return j};var g=function(j,i){return parseFloat(j)-parseFloat(i)};var e=function(w,k,i,x){x=x||Infinity;var l={},n={"0":[k]},j={},o;var p=function(C,B){var A=""+C;if(!n[A]){n[A]=[]}n[A].push(B)};l[k]=0;while(n){if(!(o=h(n)).length){break}o.sort(g);var y=o[0],z=n[y],r=z.shift(),m=parseFloat(y),q=w[r]||{};if(!z.length){delete n[y]}for(var u in q){if(Object.prototype.hasOwnProperty.call(q,u)){var v=q[u],t=v+m,s=l[u];if((s===f)||(s>t)){l[u]=t;p(t,u);j[u]=r}}}}if(l[i]===f){return null}else{return j}};var a=function(l,i){var j=[],k=i;while(k){j.push(k);k=l[k]}j.reverse();return j};var d=function(l,j){var o=j.shift(),i,n,k=[],m;while(j.length){i=j.shift();n=e(l,o,i);if(n){m=a(n,i);if(j.length){k.push.apply(k,m.slice(0,-1))}else{return k.concat(m)}}else{return null}o=i}};var c=function(n,p){try{return Array.prototype.slice.call(n,p)}catch(o){var k=[];for(var m=p||0,j=n.length;m<j;++m){k.push(n[m])}return k}};var b=function(i){this.map=i};b.prototype.findShortestPath=function(j,i){if(Object.prototype.toString.call(j)==="[object Array]"){return d(this.map,j)}else{if(arguments.length===2){return d(this.map,[j,i])}else{return d(this.map,c(arguments))}}};b.findShortestPath=function(j,k,i){if(Object.prototype.toString.call(k)==="[object Array]"){return d(j,k)}else{if(arguments.length===3){return d(j,[k,i])}else{return d(j,c(arguments,1))}}};return b})();"use strict";var SnackMan={};PreloadImgs.put("cooler","images/cooler_new.png");PreloadImgs.put("display","images/display_new.png");PreloadImgs.put("boxoffruits","images/boxoffruits.png");PreloadImgs.put("juicemachine","images/juicemachine.png");PreloadImgs.put("icecreammachine","images/icecreammachine.png");PreloadImgs.put("mesa","images/mesa.png");PreloadImgs.put("chair1","images/cadeira1.png");PreloadImgs.put("chair2","images/cadeira2.png");SnackMan=function(a,c,o,n){var k=o.childNodes[0].getElementsByTagName("cooker")[0].childNodes[0].nodeValue;this.path={n2:{n1:1,n3:1},n3:{n2:1,n4:1},n4:{n3:1,n5:1},n5:{n4:1,n6:1},n6:{n5:1,n7:1},n7:{n6:1,n8:1},n8:{n7:1,n9:1},n9:{n8:1,n10:1},n10:{n9:1,n11:1},n12:{n11:1,n13:1},n13:{n12:1,n14:1},n14:{n13:1,n15:1},n15:{n14:1,n16:1},n16:{n15:1,n17:1},n17:{n16:1,n18:1},n18:{n17:1,n19:1},n19:{n18:1,n20:1},n20:{n19:1,n21:1},n22:{n21:0.5,n23:0.5},n23:{n22:0.5,n24:0.5},n24:{n23:0.5,n25:0.5},n25:{n24:0.5,n26:0.5},n26:{n25:0.5,n27:0.5},n27:{n26:0.5,n28:0.5},n28:{n27:0.5,n29:0.5},n29:{n28:0.5,n30:0.5},n30:{n29:0.5,n31:0.5},n32:{n31:1,n33:1},n33:{n32:1,n34:1},n34:{n33:1,n35:1},n35:{n34:1,n36:1},n36:{n35:1,n37:1},n37:{n36:1,n38:1},n38:{n37:1,n39:1},n39:{n38:1,n40:1},n40:{n39:1,n11:1},n41:{n31:0.5,n42:0.5},n42:{n41:0.5,n43:0.5},n43:{n42:0.5,n44:0.5},n44:{n43:0.5,n45:0.5},n45:{n44:0.5,n46:0.5},n46:{n45:0.5,n47:0.5},n47:{n46:0.5,n48:0.5},n48:{n47:0.5,n49:0.5},n49:{n48:0.5,n50:0.5},n50:{n49:0.5,n51:0.5},n51:{n50:0.5,n52:0.5},n52:{n51:0.5,n53:0.5},n53:{n52:0.5,n54:0.5},n54:{n53:0.5,n55:0.5},n55:{n54:0.5,n56:0.5},n56:{n55:0.5,n57:0.5},n57:{n56:0.5,n58:0.5},n58:{n57:0.5,n59:0.5},n59:{n58:0.5,n1:0.5},n60:{n1:1,n61:1},n61:{n60:1,n62:1},n62:{n61:1,n63:1},n63:{n62:1,n64:1},n64:{n63:1,n65:1},n65:{n64:1,n66:1},n66:{n65:1,n67:1},n67:{n66:1,n68:1},n68:{n67:1,n69:1},n70:{n31:0.5,n71:0.5},n71:{n70:0.5,n72:0.5},n72:{n71:0.5,n73:0.5},n73:{n72:0.5,n74:0.5},n74:{n73:0.5,n75:0.5},n75:{n74:0.5,n76:0.5},n76:{n75:0.5,n77:0.5},n77:{n76:0.5,n78:0.5},n78:{n77:0.5,n79:0.5},n80:{n79:0.5,n81:0.5},n81:{n80:0.5,n82:0.5},n82:{n81:0.5,n83:0.5},n83:{n82:0.5,n84:0.5},n84:{n83:0.5,n85:0.5},n85:{n84:0.5,n86:0.5},n86:{n85:0.5,n87:0.5},n87:{n86:0.5,n88:0.5},n88:{n87:0.5,n89:0.5},n89:{n88:0.5,n90:0.5},n90:{n89:0.5,n91:0.5},n91:{n90:0.5,n92:0.5},n92:{n91:0.5,n93:0.5},n93:{n92:0.5,n94:0.5},n94:{n93:0.5,n95:0.5},n95:{n94:0.5,n96:0.5},n96:{n95:0.5,n97:0.5},n97:{n96:0.5,n98:0.5},n98:{n97:0.5,n99:0.5},n99:{n98:0.5,n1:0.5},n100:{n79:1,n101:1},n101:{n100:1,n102:1},n102:{n101:1,n103:1},n103:{n102:1,n104:1},n104:{n103:1,n105:1},n105:{n104:1,n106:1},n107:{n106:1,n108:1},n108:{n107:1,n109:1},n109:{n108:1,n110:1},n110:{n109:1,n111:1},n111:{n110:1,n112:1},n112:{n111:1,n113:1},n113:{n112:1,n114:1},n114:{n113:1,n115:1},n115:{n114:1,n116:1},n116:{n115:1,n1:1},n117:{n106:1,n118:1},n118:{n117:1,n119:1},n119:{n118:1,n120:1},n120:{n119:1,n121:1},n121:{n120:1,n122:1},n122:{n121:1,n123:1},n123:{n122:1,n124:1},n124:{n123:1,n125:1},n125:{n124:1,n126:1},n126:{n125:1,n69:1},n128:{n127:1,n129:1},n129:{n128:1,n130:1},n130:{n129:1,n131:1},n131:{n130:1,n132:1},n132:{n131:1,n133:1},n133:{n132:1,n134:1},n134:{n133:1,n135:1},n135:{n134:1,n136:1},n136:{n135:1,n137:1},n137:{n136:1,n1:1},n138:{n127:1,n139:1},n139:{n138:1,n140:1},n140:{n139:1,n141:1},n141:{n140:1,n142:1},n142:{n141:1,n143:1},n143:{n142:1,n144:1},n144:{n143:1,n145:1},n145:{n144:1,n146:1},n146:{n145:1,n147:1},n147:{n146:1,n11:1},n149:{n148:1,n150:1},n150:{n149:1,n151:1},n151:{n150:1,n152:1},n152:{n151:1,n153:1},n153:{n152:1,n154:1},n154:{n153:1,n155:1},n155:{n154:1,n156:1},n156:{n155:1,n157:1},n157:{n156:1,n158:1},n158:{n157:1,n159:1},n159:{n158:1,n1:1},n148:{n160:1,n149:1},n160:{n148:1,n161:1},n161:{n160:1,n162:1},n162:{n161:1,n163:1},n163:{n162:1,n164:1},n164:{n163:1,n165:1},n165:{n164:1,n166:1},n166:{n165:1,n167:1},n167:{n166:1,n168:1},n168:{n167:1,n169:1},n169:{n168:1,n170:1},n170:{n169:1,n171:1},n171:{n170:1,n172:1},n172:{n171:1,n173:1},n173:{n172:1,n174:1},n174:{n173:1,n175:1},n175:{n174:1,n176:1},n176:{n175:1,n177:1},n177:{n176:1,n178:1},n178:{n177:1,n179:1},n1:{n2:1,n59:1,n60:1,n99:1,n116:1,n137:1,n159:1},n11:{n10:1,n12:1,n40:1,n147:1,nIceCream3:1},n21:{n20:1,n22:1},n31:{n30:1,n32:1,n41:1,n70:1},n79:{n78:1,n80:1,n80:1,n100:1},n106:{n105:1,n107:1,n117:1},n127:{n128:1,n138:1},n69:{n68:1,n126:1},nIceCream3:{n11:1,nIceCream2:1},nIceCream2:{n11:1,nIceCream1:1},nIceCream1:{nIceCream2:1,nIceCream:1},nIceCream:{nIceCream1:1,n14:1,n12:1}};this.nodes={n1:{id:"n1",x:270,y:356},n2:{id:"n2",x:266,y:344},n3:{id:"n3",x:262,y:332},n4:{id:"n4",x:258,y:320},n5:{id:"n5",x:254,y:308},n6:{id:"n6",x:250,y:296},n7:{id:"n7",x:246,y:284},n8:{id:"n8",x:242,y:272},n9:{id:"n9",x:238,y:260},n10:{id:"n10",x:234,y:248},n11:{id:"n11",x:230,y:240},n12:{id:"n12",x:218,y:243},n13:{id:"n13",x:206,y:246},n14:{id:"n14",x:194,y:249},n15:{id:"n15",x:182,y:252},n16:{id:"n16",x:170,y:255},n17:{id:"n17",x:158,y:258},n18:{id:"n18",x:146,y:261},n19:{id:"n19",x:134,y:264},n20:{id:"n20",x:122,y:267},n21:{id:"n21",x:110,y:276},n22:{id:"n22",x:110,y:284},n23:{id:"n23",x:110,y:292},n24:{id:"n24",x:110,y:300},n25:{id:"n25",x:110,y:308},n26:{id:"n26",x:110,y:316},n27:{id:"n27",x:110,y:324},n28:{id:"n28",x:110,y:332},n29:{id:"n29",x:110,y:340},n30:{id:"n30",x:110,y:348},n31:{id:"n31",x:110,y:356},n32:{id:"n32",x:122,y:345},n33:{id:"n33",x:134,y:334},n34:{id:"n34",x:146,y:323},n35:{id:"n35",x:158,y:312},n36:{id:"n36",x:170,y:301},n37:{id:"n37",x:182,y:290},n38:{id:"n38",x:194,y:279},n39:{id:"n39",x:206,y:268},n40:{id:"n40",x:218,y:257},n41:{id:"n41",x:118,y:356},n42:{id:"n42",x:126,y:356},n43:{id:"n43",x:134,y:356},n44:{id:"n44",x:142,y:356},n45:{id:"n45",x:150,y:356},n46:{id:"n46",x:158,y:356},n47:{id:"n47",x:166,y:356},n48:{id:"n48",x:174,y:356},n49:{id:"n49",x:182,y:356},n50:{id:"n50",x:190,y:356},n51:{id:"n51",x:198,y:356},n52:{id:"n52",x:206,y:356},n53:{id:"n53",x:214,y:356},n54:{id:"n54",x:222,y:356},n55:{id:"n55",x:230,y:356},n56:{id:"n56",x:238,y:356},n57:{id:"n57",x:246,y:356},n58:{id:"n58",x:254,y:356},n59:{id:"n59",x:262,y:356},n60:{id:"n60",x:271,y:364},n61:{id:"n61",x:272,y:372},n62:{id:"n62",x:273,y:380},n63:{id:"n63",x:274,y:388},n64:{id:"n64",x:275,y:396},n65:{id:"n65",x:276,y:404},n66:{id:"n66",x:277,y:412},n67:{id:"n67",x:278,y:420},n68:{id:"n68",x:279,y:428},n69:{id:"n69",x:284,y:438},n70:{id:"n70",x:110,y:364},n71:{id:"n71",x:110,y:372},n72:{id:"n72",x:110,y:380},n73:{id:"n73",x:110,y:388},n74:{id:"n74",x:110,y:396},n75:{id:"n75",x:110,y:404},n76:{id:"n76",x:110,y:412},n77:{id:"n77",x:110,y:420},n78:{id:"n78",x:110,y:428},n79:{id:"n79",x:110,y:436},n80:{id:"n80",x:118,y:432},n81:{id:"n81",x:126,y:428},n82:{id:"n82",x:134,y:424},n83:{id:"n83",x:142,y:420},n84:{id:"n84",x:150,y:416},n85:{id:"n85",x:158,y:412},n86:{id:"n86",x:166,y:408},n87:{id:"n87",x:174,y:404},n88:{id:"n88",x:182,y:400},n89:{id:"n89",x:190,y:396},n90:{id:"n90",x:198,y:392},n91:{id:"n91",x:206,y:388},n92:{id:"n92",x:214,y:384},n93:{id:"n93",x:222,y:380},n94:{id:"n94",x:230,y:376},n95:{id:"n95",x:238,y:372},n96:{id:"n96",x:246,y:368},n97:{id:"n97",x:254,y:364},n98:{id:"n98",x:262,y:360},n99:{id:"n99",x:270,y:356},n100:{id:"n100",x:125,y:433},n101:{id:"n101",x:140,y:430},n102:{id:"n102",x:155,y:427},n103:{id:"n103",x:170,y:424},n104:{id:"n104",x:185,y:421},n105:{id:"n105",x:200,y:418},n106:{id:"n106",x:200,y:416},n107:{id:"n107",x:207,y:410},n108:{id:"n108",x:214,y:404},n109:{id:"n109",x:221,y:398},n110:{id:"n110",x:228,y:392},n111:{id:"n111",x:235,y:386},n112:{id:"n112",x:242,y:380},n113:{id:"n113",x:249,y:374},n114:{id:"n114",x:256,y:368},n115:{id:"n115",x:263,y:362},n116:{id:"n116",x:270,y:356},n117:{id:"n117",x:208,y:418},n118:{id:"n118",x:216,y:420},n119:{id:"n119",x:224,y:422},n120:{id:"n120",x:232,y:424},n121:{id:"n121",x:240,y:426},n122:{id:"n122",x:248,y:428},n123:{id:"n123",x:256,y:430},n124:{id:"n124",x:264,y:432},n125:{id:"n125",x:272,y:434},n126:{id:"n126",x:280,y:436},n127:{id:"n127",x:300,y:240},n128:{id:"n128",x:296,y:251},n129:{id:"n129",x:292,y:262},n130:{id:"n130",x:288,y:273},n131:{id:"n131",x:284,y:284},n132:{id:"n132",x:280,y:295},n133:{id:"n133",x:276,y:306},n134:{id:"n134",x:272,y:317},n135:{id:"n135",x:268,y:328},n136:{id:"n136",x:264,y:339},n137:{id:"n137",x:260,y:350},n138:{id:"n138",x:293,y:240},n139:{id:"n139",x:286,y:240},n140:{id:"n140",x:279,y:240},n141:{id:"n141",x:272,y:240},n142:{id:"n142",x:265,y:240},n143:{id:"n143",x:258,y:240},n144:{id:"n144",x:251,y:240},n145:{id:"n145",x:244,y:240},n146:{id:"n146",x:237,y:240},n147:{id:"n147",x:230,y:240},n148:{id:"n148",x:258,y:180},n149:{id:"n149",x:258,y:196},n150:{id:"n150",x:260,y:212},n151:{id:"n151",x:260,y:228},n152:{id:"n152",x:260,y:244},n153:{id:"n153",x:260,y:260},n154:{id:"n154",x:260,y:276},n155:{id:"n155",x:260,y:292},n156:{id:"n156",x:260,y:308},n157:{id:"n157",x:260,y:324},n158:{id:"n158",x:260,y:340},n159:{id:"n159",x:260,y:356},n160:{id:"n160",x:256,y:176},n161:{id:"n161",x:254,y:172},n162:{id:"n162",x:252,y:168},n163:{id:"n163",x:250,y:164},n164:{id:"n164",x:248,y:160},n165:{id:"n165",x:246,y:156},n166:{id:"n166",x:244,y:152},n167:{id:"n167",x:242,y:148},n168:{id:"n168",x:240,y:144},n169:{id:"n169",x:236,y:144},n170:{id:"n170",x:232,y:144},n171:{id:"n171",x:228,y:144},n172:{id:"n172",x:224,y:144},n173:{id:"n173",x:220,y:144},n174:{id:"n174",x:216,y:144},n175:{id:"n175",x:212,y:144},n176:{id:"n176",x:208,y:144},n177:{id:"n177",x:204,y:144},n178:{id:"n178",x:200,y:144},nIceCream:{id:"nIceCream",x:200,y:240},nIceCream1:{id:"nIceCream1",x:208,y:240},nIceCream2:{id:"nIceCream2",x:215,y:240},nIceCream3:{id:"nIceCream3",x:223,y:240}};this.keynodes=["n1","n11","n21","n31","n69","n79","n106","n127","nIceCream","n168","n178"];this.snackManFinalPath=new Array();this.mapGraph={};this.createGraph();this.counter=[this.snackManFinalPath[2],this.snackManFinalPath[3],this.snackManFinalPath[5]];this.table=[this.snackManFinalPath[10],this.snackManFinalPath[9]];this.displayNode=this.snackManFinalPath[1];this.coolerNode=this.snackManFinalPath[4];this.boxOfFruitsNode=this.snackManFinalPath[6];this.juiceMachineNode=this.snackManFinalPath[7];this.iceCreamMachineNode=this.snackManFinalPath[8];this.heightCooker=91;if(k.indexOf("counter")==0){this.initialPosition=this.counter[parseInt(k.substring(7))-1]}else{if(k==="cooler"){this.initialPosition=this.coolerNode}else{if(k==="display"){this.initialPosition=this.displayNode}else{this.initialPosition=this.snackManFinalPath[0]}}}this.currentNode=this.initialPosition;AvatarImgMaker.createMiniAnimationBody(Game.tempCtxDisplay,n);this.img=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:this.currentNode.x,y:this.currentNode.y-this.heightCooker,width:150,height:this.heightCooker,sourceY:0,img:Game.tempDisplay});this.imgCooker=this.img.image;var g=document.createElement("canvas");g.width=Game.tempDisplay.width;g.height=Game.tempDisplay.height;var l=g.getContext("2d");AvatarImgMaker.createMiniAnimationBodyPlatter(l,n);this.imgPlatter=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:this.currentNode.x,y:this.currentNode.y-this.heightCooker,width:150,height:this.heightCooker,sourceY:0,img:g});this.imgCookerPlatter=this.imgPlatter.image;this.cooler=new Sprite({ticksPerFrame:0,numberOfFrames:4,horzSeq:true,x:280,y:360,width:320,height:80,sourceX:0,sourceY:0,img:PreloadImgs.get("cooler")});this.display=new Sprite({ticksPerFrame:0,numberOfFrames:4,horzSeq:true,x:200,y:200,width:160,height:40,sourceX:0,sourceY:0,img:PreloadImgs.get("display")});var f=o.evaluate("count(//mission/commands/category[@name='goToBoxOfFruits'])",o,null,XPathResult.ANY_TYPE,null);this.showJuice=f.numberValue>0;if(this.showJuice){this.boxOfFruits=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:200,y:408,width:96,height:32,sourceX:0,sourceY:0,img:PreloadImgs.get("boxoffruits")});this.juiceMachine=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:320,y:190,width:120,height:40,sourceX:0,sourceY:0,img:PreloadImgs.get("juicemachine")})}var q=o.evaluate("count(//mission/commands/category[@name='icecream'])",o,null,XPathResult.ANY_TYPE,null);this.showIceCream=q.numberValue>0;if(this.showIceCream){this.iceCreamMachine=new Sprite({ticksPerFrame:0,numberOfFrames:9,horzSeq:false,x:160,y:160,width:40,height:720,sourceX:0,sourceY:0,img:PreloadImgs.get("icecreammachine")})}else{this.iceCreamMachine=null}if(a){this.mesa=PreloadImgs.get("mesa");this.cad1=PreloadImgs.get("chair1");this.cad2=PreloadImgs.get("chair2")}else{this.mesa=null}this.installedMachines=[];this.extendedCommands=[];this.objective={};this.objective.objectives=[];this.objective.ordered=c.getAttribute("ordered")==="true";this.objective.xpIndividual=parseInt(c.getAttribute("xpIndividual"));this.objective.xpFinal=parseInt(c.getAttribute("xpFinal"));this.objective.xpTotalTime=parseInt(c.getAttribute("xpTotalTime"));var e=c.getAttribute("xpTotalRun");if(e==null){this.objective.xpTotalRun=null}else{this.objective.xpTotalRun=parseInt(e)}var d=c.getAttribute("maxCommands");this.objective.maxCommands=parseInt((d==null?"0":d));d=c.getAttribute("maxCommandsReward");this.objective.maxCommandsReward=parseInt((d==null?"0":d));d=c.getAttribute("maxCommandsRewardCoins");this.objective.maxCommandsRewardCoins=parseInt((d==null?"0":d));this.objective.debug=c.getAttribute("debug")==="true";var b=c.getElementsByTagName("objective");var p=0;for(var j=0;j<b.length;j++){var h=b[j].childNodes[0].nodeValue;if(h==="talk"){p++}this.createObjective(h,b[j])}if(p>0){this.createObjective("countTalk",p)}if(this.objective.ordered){this.createAditionalObjective(c,"ordered")}this.hasVarQtd=this.createAditionalObjective(c,"varQtd");this.hasCommQtd=this.createAditionalObjective(c,"commQtd");this.lastObjectiveAchieved=-1;this.allObjectivesAchieved=false;this.catched=0;this.delivered=0;this.talkText=null;this.listeners=[]};SnackMan.prototype.createObjective=function(a,b){var d=Objective.factory(a);var c=d.init(b);this.objective.objectives.push(c)};SnackMan.prototype.createAditionalObjective=function(b,c){var a=b.getAttribute(c);if(a!=null){this.createObjective(c,a);return true}return false};SnackMan.prototype.createGraph=function(){for(var a=0;a<this.keynodes.length;a++){this.snackManFinalPath[a]=this.nodes[this.keynodes[a]]}this.graph=new Graph(this.path)};SnackMan.prototype.reset=function(){this.currentNode=this.initialPosition;this.catched=0;this.delivered=0;this.talkText=null;this.img.image=this.imgCooker;this.img.x=this.currentNode.x;this.img.y=this.currentNode.y-this.heightCooker;this.img.sourceY=0;this.img.frameIndex=1;this.cooler.sourceX=0;this.cooler.frameIndex=0;if(this.iceCreamMachine!=null){this.iceCreamMachine.frameIndex=0}this.lastObjectiveAchieved=-1;this.allObjectivesAchieved=false;for(var a=0;a<this.objective.objectives.length;a++){Objective.reset(this.objective.objectives[a])}this.notifyListeners("ObjectiveAccomplished",0,this.objective.objectives.length);for(var a=0;a<this.installedMachines.length;a++){this.installedMachines[a].machineCfg.production=[]}};SnackMan.prototype.speechBubble=function(c,f,a,g){var d=c.measureText(f);var b=d.width;if(b<25){b=25}var e=20;c.beginPath();c.strokeStyle="black";c.lineWidth="1";c.fillStyle="rgba(255, 255, 255, 0.8)";c.moveTo(a,g);c.lineTo(a+4,g);c.lineTo(a+9,g+10);c.lineTo(a+9,g);c.lineTo(a+b,g);c.quadraticCurveTo(a+5+b,g,a+5+b,g-(e*0.2));c.lineTo(a+5+b,g-(e*0.8));c.quadraticCurveTo(a+5+b,g-e,a+b,g-e);c.lineTo(a,g-e);c.quadraticCurveTo(a-5,g-e,a-5,g-(e*0.8));c.lineTo(a-5,g-(e*0.2));c.quadraticCurveTo(a-5,g,a,g);c.fill();c.stroke();c.closePath();c.textAlign="left";c.fillStyle="#000";c.fillText(f,a,g-6)};SnackMan.prototype.draw=function(a){if(this.mesa!=null){a.drawImage(this.mesa,200,73);a.drawImage(this.cad1,160,80);a.drawImage(this.cad2,280,80)}this.drawInstalledMachines(a);this.display.draw(a);if(this.showJuice){this.juiceMachine.draw(a)}if(this.showIceCream){this.iceCreamMachine.draw(a)}this.img.draw(a);this.cooler.draw(a);if(this.showJuice){this.boxOfFruits.draw(a)}if(this.talkText!=null){this.speechBubble(a,this.talkText,this.img.x,this.img.y)}};SnackMan.prototype.update=function(){var b=[];for(var a=0;a<arguments.length;a++){b.push(arguments[a])}BlocklyApps.log.push(b);CustomerManager.update()};SnackMan.prototype.goToBarCounter=function(a){if(a<1||a>3){BlocklyApps.log.push(["fail","Error_doesntExistCounter"]);throw false}this.animateSnackMan(this.counter[a-1])};SnackMan.prototype.goToTable=function(a){if(a<1||a>2){BlocklyApps.log.push(["fail","Error_doesntExistTable"]);throw false}this.animateSnackMan(this.table[a-1])};SnackMan.prototype.goToDisplay=function(){this.animateSnackMan(this.displayNode)};SnackMan.prototype.goToCooler=function(){this.animateSnackMan(this.coolerNode)};SnackMan.prototype.alertRun=function(a){alert(a)};SnackMan.prototype.getCustomer=function(){for(var a=0;a<this.counter.length;a++){if(this.currentNode.id===this.counter[a].id){return(CustomerManager.getCustomerCounter(a+1))}}for(var a=0;a<this.table.length;a++){if(this.currentNode.id===this.table[a].id){return(CustomerManager.getCustomerTable(a+1))}}BlocklyApps.log.push(["fail","Error_isntCloseToCustomer"]);throw false};SnackMan.prototype.isThereACustomer=function(){var a=this.getCustomer();return a!=null};SnackMan.prototype.askForDrink=function(){var b=this.getCustomer();if(!b){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var a=b.askForDrink();if(a==null){BlocklyApps.log.push(["fail","Error_isntThirsty"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askForDrink",b);return a};SnackMan.prototype.pickUpDrink=function(a){if(this.currentNode.id!=this.coolerNode.id){BlocklyApps.log.push(["fail","Error_isntFrontCooler"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(a.data.drinkOrFood!="drink"){BlocklyApps.log.push(["fail","Error_doesntOrderDrink"]);throw false}if(a.data.descr.indexOf("coke")==-1){BlocklyApps.log.push(["fail","Error_wrongPlaceForDrink"]);throw false}this.update("OC");this.update("OC");this.update("OC");this.update("CC");this.update("CC");this.update("CC");this.update("IP");var b={type:"item",descr:a.data.descr,drinkOrFood:"drink",source:a.data.source,sourceType:a.data.sourceType};this.verifyObjectives("pickUpDrink",b);this.catched++;return b};SnackMan.prototype.askWantHowManyDrinks=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askWantHowManyDrinks();this.verifyObjectives("askWantHowManyDrinks",a);return b};SnackMan.prototype.hasThirsty=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askHasThirsty",a);return a.hasThirsty()};SnackMan.prototype.askForFood=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askForFood();if(b==null){BlocklyApps.log.push(["fail","Error_isntHunger"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askForFood",a);return b};SnackMan.prototype.askWantHowManyFoods=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askWantHowManyFoods();this.verifyObjectives("askWantHowManyFoods",a);return b};SnackMan.prototype.hasHunger=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askHasHunger",a);return a.hasHunger()};SnackMan.prototype.pickUpHotDog=function(a){if(this.currentNode.id!=this.displayNode.id){BlocklyApps.log.push(["fail","Error_isntFrontDisplay"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(a.data.drinkOrFood!="food"){BlocklyApps.log.push(["fail","Error_doesntOrderFood"]);throw false}if(a.data.descr.indexOf("hotdog")==-1){BlocklyApps.log.push(["fail","Error_onlyHotDog"]);throw false}this.update("OD");this.update("OD");this.update("OD");this.update("CD");this.update("CD");this.update("CD");this.update("IP");var b={type:"item",descr:a.data.descr,drinkOrFood:"food",source:a.data.source,sourceType:a.data.sourceType};this.verifyObjectives("pickUpFood",b);this.catched++;return b};SnackMan.prototype.verifyGenericPickUp=function(a,b){if(this.currentNode.id!=b.node.id){BlocklyApps.log.push(["fail",b.errorIsntFront]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(a.data.drinkOrFood!=b.drinkOrFood){BlocklyApps.log.push(["fail","Error_doesntOrder"+b.drinkOrFood.substring(0,1).toUpperCase()+b.drinkOrFood.substring(1)]);throw false}if(a.data.descr.indexOf(b.produce)==-1){BlocklyApps.log.push(["fail","$Error_only"+b.typeOfDrinkFood.substring(0,1).toUpperCase()+b.typeOfDrinkFood.substring(1)]);throw false}};SnackMan.prototype.finishPickUp=function(a,c){var b={type:"item",descr:"$$"+c.produce,drinkOrFood:c.drinkOrFood,source:a.data.source,sourceType:a.data.sourceType};this.catched++;return b};SnackMan.prototype.genericPickUp=function(b,d){this.verifyGenericPickUp(b,d);var e=d.numberOfFrames-1;for(var a=0;a<e;a++){this.update("OM",d)}for(var a=0;a<e;a++){this.update("CM",d)}this.update("IP");return this.finishPickUp(b,d)};SnackMan.prototype.genericPrepare=function(d,b){if(this.currentNode.id!=d.node.id){BlocklyApps.log.push(["fail",d.errorIsntFront]);throw false}if(d.production.length>0){BlocklyApps.log.push(["fail","$Error_StillHasProductInStock"]);throw false}var f=d.commsProduce[b];var h=[];for(var e=0;e<d.commsProduce[b].qtProduce;e++){h.push({prodX:f.prodX,prodY:f.prodY,prodXDelta:f.prodXDelta,prodYDelta:f.prodYDelta,prodImg:f.prodImg})}var g=d.numberOfFrames;for(var a=0;a<g;a++){this.update("OM",d)}this.update("PM",d,h)};SnackMan.prototype.genericOnlyPickUp=function(a,b){this.verifyGenericPickUp(a,b);if(b.production.length==0){BlocklyApps.log.push(["fail","$Error_DoesntHaveProductInStock"]);throw false}b.production.shift();this.update("KM",b);this.update("IP");var c=this.finishPickUp(a,b);return c};SnackMan.prototype.deliver=function(e){if(e.data===undefined||e.data===null||e.data==="undefined"||e.type==="number"){BlocklyApps.log.push(["fail","Error_variableHaventContentToDeliver"]);throw false}var f=this.getCustomer();if(!f){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var d=f.deliver(e.data);if(d.happy==Customer.DELIVERED_BAD){BlocklyApps.log.push(["fail",d.reason]);throw false}if(d!=null){this.verifyObjectives("deliver",{allCustomers:false,customer:f})}if(Game.forDeliver===undefined||Game.forDeliver===null){e.data=null}else{var b=Game.forDeliver.array;b[Game.forDeliver.index]=null;delete Game.forDeliver}if(d.happy>=Customer.DELIVERED_PARTIAL){this.delivered++}if(d.happy!=Customer.DELIVERED_PARTIAL){for(var c=0;c<11;c++){this.update("IM",0)}this.update("IO",d.money,this.catched-this.delivered)}else{this.update("IO",null,this.catched-this.delivered)}};SnackMan.prototype.talk=function(a){this.update("TA",a);this.verifyObjectives("talk",a);this.verifyObjectives("countTalk")};SnackMan.prototype.goToBoxOfFruits=function(){this.animateSnackMan(this.boxOfFruitsNode)};SnackMan.prototype.goToJuiceMachine=function(){this.animateSnackMan(this.juiceMachineNode)};SnackMan.prototype.pickUpFruits=function(a){if(this.currentNode.id!=this.boxOfFruitsNode.id){BlocklyApps.log.push(["fail","Error_isntFrontBoxOfFruits"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="order"){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(!(a.data.type==="order"&&a.data.descr.indexOf("$$juiceof")==0)){BlocklyApps.log.push(["fail","Error_onlyFruits"]);throw false}this.update("SF");this.update("SF");this.update("HF");this.update("HF");this.update("IP");var b={type:"item",descr:"$$"+a.data.descr.substring(9),drinkOrFood:"drink",source:a.data.source,sourceType:a.data.sourceType};return b};SnackMan.prototype.prepareAndPickUpJuice=function(a){if(this.currentNode.id!=this.juiceMachineNode.id){BlocklyApps.log.push(["fail","Error_isntFrontJuiceMachine"]);throw false}if(a.data==null||a.data===undefined||a.data.type!="item"){BlocklyApps.log.push(["fail","Error_doesntHaveItem"]);throw false}if(a.data.descr!="$$orange"){BlocklyApps.log.push(["fail","Error_onlyPutFruits"]);throw false}this.update("MJ");this.update("MJ");this.update("HJ");this.update("HJ");this.update("IP");var b={type:"item",descr:"$$juiceof"+a.data.descr.substring(2),drinkOrFood:"drink",source:a.data.source,sourceType:a.data.sourceType};this.catched++;return b};SnackMan.prototype.animateSnackMan=function(b){var a=this.graph.findShortestPath(this.currentNode.id,b.id);for(var c=0;c<a.length;c++){var d=this.nodes[a[c]];this.update("MS",this.currentNode.x,this.currentNode.y,d.x,d.y);this.currentNode=d}this.update("CO",0)};SnackMan.prototype.cashIn=function(c){if(c==undefined||c.data==undefined){BlocklyApps.log.push(["fail","Error_noValueInParameter"]);throw false}if(isNaN(c)){BlocklyApps.log.push(["fail","Error_paramIsNotANumber"]);throw false}var b=this.getCustomer();if(!b){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var a=b.cashIn(c);this.verifyObjectives("cashIn",{allCustomers:false,customer:b});this.verifyObjectives("totalOfSell",{value:c});return a};SnackMan.prototype.giveChange=function(b,c){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}if(a.giveChange(b,c)){this.verifyObjectives("giveTheWholeChange",{allCustomers:false,customer:a});this.verifyObjectives("giveSomeChange",{allCustomers:false,customer:a})}};SnackMan.prototype.goToIceCreamMachine=function(){this.animateSnackMan(this.iceCreamMachineNode)};SnackMan.prototype.pickUpIceCream=function(b){if(this.currentNode.id!=this.iceCreamMachineNode.id){BlocklyApps.log.push(["fail","Error_isntFrontIceCreamMachine"]);throw false}var a=b.data;if(a==='"$$$icecreamofchocolate"'||a==='"$$$icecreamofstrawberry"'||a==='"$$$icecreamofvanilla"'){a={type:"order",descr:a.substring(2,a.length-1),source:null,sourceType:null}}if(a==null||a===undefined||(a.type!="order")){BlocklyApps.log.push(["fail","Error_doesntHaveOrder"]);throw false}if(!((a.type==="order"&&a.descr.indexOf("$$icecreamof")==0))){BlocklyApps.log.push(["fail","Error_onlyIceCream"]);throw false}var c=null;switch(a.descr){case"$$icecreamofchocolate":c=0;break;case"$$icecreamofvanilla":c=3;break;case"$$icecreamofstrawberry":c=6;break}this.update("DI",c);this.update("DI",c+1);this.update("DI",c+2);this.update("UI",c+2);this.update("UI",c+1);this.update("UI",c);this.update("IP");var d={type:"item",descr:a.descr,drinkOrFood:"food",source:a.source,sourceType:a.sourceType};this.verifyObjectives("catchFruits",d);this.catched++;return d};SnackMan.prototype.askWantHowManyIceCream=function(){var a=this.getCustomer();if(!a){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var b=a.askWantHowManyIceCream();this.verifyObjectives("askWantHowManyIceCream",a);return b};SnackMan.prototype.askForIceCream=function(){var b=this.getCustomer();if(!b){BlocklyApps.log.push(["fail","Error_thereIsntCustomer"]);throw false}var a=b.askForIceCream();if(a==null){BlocklyApps.log.push(["fail","Error_isntHungerForIceCream"]);throw false}this.update("XX");this.update("IM",0);this.verifyObjectives("askForIceCream",b);return a};SnackMan.prototype.animate=function(i,c){if(i!=="IM"){this.talkText=null}switch(i){case"AL":this.alertRun(c);break;case"CO":this.checkObjectives();case"IM":this.changeSnackManImage(c);break;case"MS":this.changeSnackManPosition(c.shift(),c.shift(),c.shift(),c.shift());break;case"OC":this.nextOpenCoolerImage();break;case"CC":this.nextCloseCoolerImage();break;case"OD":this.nextOpenDisplayImage();break;case"CD":this.nextCloseDisplayImage();break;case"IP":this.changeImagePlatter();break;case"IO":var g=c.shift();g=c.shift();if(g==0){this.changeImageOriginal()}break;case"SF":this.nextShowFruitImage();break;case"HF":this.nextHideFruitImage();break;case"MJ":this.nextShowJuiceMachineImage();break;case"HJ":this.nextHideJuiceMachineImage();break;case"OM":var f=c.shift().machine;if(f.invert==true){f.invertDirection()}f.update();break;case"CM":var f=c.shift().machine;if(f.invert==false){f.invertDirection()}f.update();break;case"PM":var f=c.shift();f.production=c.shift();break;case"KM":break;case"TA":var d=c.shift();d=d.data;if(Array.isArray(d)){var b="[";for(var a=0;a<d.length;a++){if(b.length>1){b=b+","}var h=d[a];if(h===undefined){h="0"}else{if(typeof(d[a])==="object"){h="-"}}b=b+h}d=b+"]"}this.talkText=d;break;case"DI":case"UI":this.showIceCreamMachine(c.shift());break}};SnackMan.prototype.changeSnackManImage=function(a){this.img.sourceY=a;this.img.update()};SnackMan.prototype.changeSnackManPosition=function(c,b,a,d){if(a<c){this.img.sourceY=this.heightCooker}else{if(a>c){this.img.sourceY=this.heightCooker*2}else{if(d<b){this.img.sourceY=this.heightCooker*3}else{this.img.sourceY=0}}}this.img.update();this.img.x=a;this.img.y=d-this.heightCooker};SnackMan.prototype.nextOpenCoolerImage=function(){if(this.cooler.invert==true){this.cooler.invertDirection()}this.updateCoolerImage()};SnackMan.prototype.nextCloseCoolerImage=function(){if(this.cooler.invert==false){this.cooler.invertDirection()}this.updateCoolerImage()};SnackMan.prototype.updateCoolerImage=function(){this.cooler.update()};SnackMan.prototype.nextShowFruitImage=function(){if(this.boxOfFruits.invert==true){this.boxOfFruits.invertDirection()}this.updateBoxOfFruitsImage()};SnackMan.prototype.nextHideFruitImage=function(){if(this.boxOfFruits.invert==false){this.boxOfFruits.invertDirection()}this.updateBoxOfFruitsImage()};SnackMan.prototype.updateBoxOfFruitsImage=function(){this.boxOfFruits.update()};SnackMan.prototype.nextShowJuiceMachineImage=function(){if(this.juiceMachine.invert==true){this.juiceMachine.invertDirection()}this.updateJuiceMachineImage()};SnackMan.prototype.nextHideJuiceMachineImage=function(){if(this.juiceMachine.invert==false){this.juiceMachine.invertDirection()}this.updateJuiceMachineImage()};SnackMan.prototype.updateJuiceMachineImage=function(){this.juiceMachine.update()};SnackMan.prototype.nextOpenDisplayImage=function(){if(this.display.invert==true){this.display.invertDirection()}this.updateDisplayImage()};SnackMan.prototype.nextCloseDisplayImage=function(){if(this.display.invert==false){this.display.invertDirection()}this.updateDisplayImage()};SnackMan.prototype.updateDisplayImage=function(){this.display.update()};SnackMan.prototype.changeImagePlatter=function(){this.img.image=this.imgCookerPlatter};SnackMan.prototype.changeImageOriginal=function(){this.img.image=this.imgCooker};SnackMan.prototype.showIceCreamMachine=function(a){this.iceCreamMachine.frameIndex=a};SnackMan.prototype.drawInstalledMachines=function(a){for(var b=0;b<this.installedMachines.length;b++){this.installedMachines[b].drawExt(a)}};SnackMan.prototype.installMachine=function(idmachine,machinename,machinex,machiney,machinepath,machineErrorIsntFront,machineDrinkOrFood,machineTypeOfDrinkFood,commands,machineImg,machineNumberOfFrames,machineHeight){var machineProduce="machine"+idmachine+"-prod";var machine=new Sprite({ticksPerFrame:0,numberOfFrames:machineNumberOfFrames,horzSeq:false,x:parseInt(machinex),y:parseInt(machiney),width:32,height:machineHeight,sourceX:0,sourceY:0,img:PreloadImgs.get(machineImg)});machine.drawExt=function(ctx){this.draw(ctx);for(var i=0;i<this.machineCfg.production.length;i++){var p=this.machineCfg.production[i];var img=PreloadImgs.get(p.prodImg);ctx.drawImage(img,this.x+p.prodX+(i*p.prodXDelta),this.y+p.prodY+(i*p.prodYDelta))}};this.installedMachines.push(machine);var mp=machinepath.split("#$#");var path=JSON.parse(mp[0]);for(var key1 in path){var myObj2=path[key1];this.path[key1]=myObj2;for(var key2 in myObj2){if(this.path[key2]!=undefined){this.path[key2][key1]=myObj2[key2]}}}var nodes=JSON.parse(mp[1]);for(var i=0;i<nodes.length;i++){this.nodes[nodes[i].id]=nodes[i]}var machineCfg={};machineCfg.node=nodes[0];machineCfg.errorIsntFront=machineErrorIsntFront;machineCfg.drinkOrFood=machineDrinkOrFood;machineCfg.typeOfDrinkFood=machineTypeOfDrinkFood;machineCfg.produce=machineProduce;machineCfg.numberOfFrames=machineNumberOfFrames;machineCfg.machine=machine;machineCfg.production=[];PreloadImgs.put("$"+machineProduce,"images/$$"+machineProduce+".png",true);machine.machineCfg=machineCfg;machineCfg.commsProduce=[];for(var i=0;i<commands.length;i++){var com=commands[i];Blockly.Blocks[com[0]]={bodyFunc:com[3],init:new Function(com[2])};Blockly.JavaScript[com[0]]=function(block){var xpt=eval(Blockly.Blocks[block.type].bodyFunc);return xpt};var run=null;switch(com[4]){case"M":run=new Function("machine","hero.animateSnackMan( machine.node );");break;case"C":run=new Function("machine","order","return hero.genericPickUp( order, machine ); ");break;case"P":var confProduce={};confProduce.qtProduce=parseInt(com[5]);confProduce.prodX=parseInt(com[6]);confProduce.prodY=parseInt(com[7]);confProduce.prodXDelta=parseInt(com[8]);confProduce.prodYDelta=parseInt(com[9]);confProduce.prodImg=com[10];machineCfg.commsProduce.push(confProduce);PreloadImgs.put(confProduce.prodImg,"images/machine"+confProduce.prodImg+".png",true);run=new Function("machine","hero.genericPrepare( machine, "+(machineCfg.commsProduce.length-1)+" ); ");break;case"K":run=new Function("machine","order","return hero.genericOnlyPickUp( order, machine ); ");break}this.extendedCommands.push({name:com[0],nameLang:com[1],run:run,machine:machineCfg})}};SnackMan.prototype.hasMachineFor=function(c){if(c==="hotdog"||c==="coke"||c==="juiceoforange"||c.indexOf("icecreamof")==0){return true}for(var a=0;a<this.installedMachines.length;a++){var b=this.installedMachines[a].machineCfg;if(b.produce===c){return true}}return false};SnackMan.prototype.checkObjectives=function(){this.verifyObjectives("goesTo",{nx:this.img.x,ny:this.img.y+this.heightCooker});this.verifyObjectives("goesToDisplay",{nx:this.img.x,ny:this.img.y+this.heightCooker});this.verifyObjectives("goesToCooler",{nx:this.img.x,ny:this.img.y+this.heightCooker})};SnackMan.prototype.verifyObjectives=function(c,a){var b=true;if(c==="deliver"){b=this.verifyObjectives("deliverGifts",a);b=this.verifyObjectives("customDeliver",a)&&b}if(!Objective.verifyObjectives(c,a)){return false}else{b=b&&true}$.growl({title:BlocklyApps.getMsg("NoBugs_goalAchieved"),message:BlocklyApps.getMsg("NoBugs_achieved")+" "+(this.lastObjectiveAchieved+1)+" "+BlocklyApps.getMsg("NoBugs_of")+" "+this.objective.objectives.length});this.notifyListeners("ObjectiveAccomplished",this.lastObjectiveAchieved+1,this.objective.objectives.length);Game.alertGoalButton();return b};SnackMan.prototype.addReward=function(f,k,h,j){var g={totalXP:0,baseXP:0,totalCoins:0,baseCoins:0,bonusXP:[],bonusCoins:[]};if(this.allObjectivesAchieved){if(f==-1){g.totalXP=this.objective.xpFinal;g.baseXP=g.totalXP;return g}var a=3-CountXP.getTimes();if(a==0){g.totalXP=this.objective.xpFinal}else{g.totalXP=this.objective.xpIndividual*a}g.baseXP=g.totalXP;if(f<=this.objective.maxCommands){if(this.objective.maxCommandsReward>0){g.totalXP+=this.objective.maxCommandsReward;g.bonusXP.push({name:"Victory_MaxCommands",value:this.objective.maxCommandsReward,extraInfo:null})}else{g.totalCoins+=this.objective.maxCommandsRewardCoins;g.bonusCoins.push({name:"Victory_MaxCommands",value:this.objective.maxCommandsRewardCoins,extraInfo:null})}}if(h!=null&&k<=h){j=j.split(" ");var e=Math.floor(h/j.length);var b=0;for(var d=1;d<=j.length;d++){if(k<=e*d){b=parseInt(j[d-1]);break}}if(b>0){var c=Math.floor((k/60));var l=k-(c*60);g.bonusCoins.push({name:"Victory_TimeBonus",value:b,extraInfo:(c>0?c+"'":"")+l+'"'});g.totalCoins+=b}}}return g};SnackMan.prototype.addListener=function(a,b){this.listeners.push({eventType:a,listener:b})};SnackMan.prototype.notifyListeners=function(){var b=arguments[0];var c=[];for(var a=1;a<arguments.length;a++){c.push(arguments[a])}this.listeners.forEach(function(d){if(d.eventType===b){d.listener["on"+b](c)}})};"use strict";var CustOpt={};CustOpt.path={n2:{n1:1,n3:1},n3:{n2:1,n4:1},n4:{n3:1,n5:1},n5:{n4:1,n6:1},n6:{n5:1,n7:1},n7:{n6:1,n8:1},n8:{n7:1,n9:1},n9:{n8:1,n10:1},n10:{n9:1,n11:1},n11:{n10:1,n12:1},n12:{n11:1,n13:1},n13:{n12:1,n14:1},n14:{n13:1,n15:1},n15:{n14:1,n16:1},n16:{n15:1,n17:1},n17:{n16:1,n18:1},n18:{n17:1,n19:1},n19:{n18:1,n20:1},n20:{n19:1,n21:1},n21:{n20:1,n22:1},n22:{n21:1,n23:1},n23:{n22:1,n24:1},n24:{n23:1,n25:1},n25:{n24:1,n26:1},n26:{n25:1,n27:1},n27:{n26:1,n28:1},n28:{n27:1,n29:1},n29:{n28:1,n30:1},n30:{n29:1,n31:1},n31:{n30:1,n32:1},n32:{n31:1,n33:1},n33:{n32:1,n34:1},n34:{n33:1,n35:1},n35:{n34:1,n36:1},n36:{n35:1,n37:1},n37:{n36:1,n38:1},n38:{n37:1,n39:1},n40:{n39:1,n41:1},n41:{n40:1,n42:1},n42:{n41:1,n43:1},n43:{n42:1,n44:1},n44:{n43:1,n45:1},n45:{n44:1,n46:1},n46:{n45:1,n47:1},n47:{n46:1,n48:1},n48:{n47:1,n49:1},n39:{n38:1,n40:1,n50:1},n50:{n39:1,n51:1},n51:{n50:1,n52:1},n52:{n51:1,n53:1},n53:{n52:1,n54:1},n54:{n53:1,n55:1},n55:{n54:1,n56:1},n56:{n55:1,n57:1},n57:{n56:1,n58:1},n58:{n57:1,n59:1},n59:{n58:1,n60:1},n60:{n59:1,n61:1},n61:{n60:1,n62:1},n62:{n61:1,n63:1},n63:{n62:1,n64:1},n64:{n63:1,n65:1},n65:{n64:1,n66:1},n66:{n65:1,n67:1},n67:{n66:1,n68:1},n68:{n67:1,n69:1},n70:{n69:1,n71:1},n71:{n70:1,n72:1},n72:{n71:1,n73:1},n73:{n72:1,n74:1},n74:{n73:1,n75:1},n75:{n74:1,n76:1},n76:{n75:1,n77:1},n77:{n76:1,n78:1},n78:{n77:1,n79:1},n69:{n68:1,n70:1,n80:1},n80:{n69:1,n81:1},n81:{n80:1,n82:1},n82:{n81:1,n83:1},n83:{n82:1,n84:1},n84:{n83:1,n85:1},n85:{n84:1,n86:1},n86:{n85:1,n87:1},n87:{n86:1,n88:1},n88:{n87:1,n89:1},n89:{n88:1,n90:1},n90:{n89:1,n91:1},n91:{n90:1,n92:1},n92:{n91:1,n93:1},n93:{n92:1,n94:1},n94:{n93:1,n95:1},n95:{n94:1,n96:1},n96:{n95:1,n97:1},n97:{n96:1,n98:1},n98:{n97:1,n99:1},n100:{n99:1,n101:1},n101:{n100:1,n102:1},n102:{n101:1,n103:1},n103:{n102:1,n104:1},n104:{n103:1,n105:1},n105:{n104:1,n106:1},n106:{n105:1,n107:1},n107:{n106:1,n108:1},n108:{n107:1,n109:1},n99:{n98:1,n100:1},n110:{n1:1,n111:1},n111:{n110:1,n112:1},n112:{n111:1,n113:1},n113:{n112:1,n114:1},n114:{n113:1,n115:1},n115:{n114:1,n116:1},n116:{n115:1,n117:1},n117:{n116:1,n118:1},n118:{n117:1,n119:1},n119:{n118:1,n120:1},n120:{n119:1,n121:1},n121:{n120:1,n122:1},n122:{n121:1,n123:1},n123:{n122:1,n124:1},n124:{n123:1,n125:1},n125:{n124:1,n126:1},n126:{n125:1,n127:1},n127:{n126:1,n128:1},n128:{n127:1,n129:1},n129:{n128:1,n130:1},n130:{n129:1,n131:1},n131:{n130:1,n132:1},n132:{n131:1,n133:1},n133:{n132:1,n134:1},n134:{n133:1,n135:1},n135:{n134:1,n136:1},n136:{n135:1,n137:1},n137:{n136:1,n138:1},n138:{n137:1,n139:1},n139:{n138:1,n140:1},n140:{n139:1,n141:1},n141:{n140:1,n142:1},n142:{n141:1,n143:1},n143:{n142:1,n144:1},n144:{n143:1,n145:1},n145:{n144:1,n146:1},n146:{n145:1,n147:1},n147:{n146:1,n148:1},n148:{n147:1,n149:1},n149:{n148:1,n150:1},n1:{n2:1,n110:1},n49:{n48:1},n79:{n78:1},n109:{n108:1},n149:{n148:1}};CustOpt.nodes={n1:{id:"n1",x:40,y:105},n2:{id:"n2",x:36,y:105},n3:{id:"n3",x:32,y:105},n4:{id:"n4",x:28,y:105},n5:{id:"n5",x:24,y:105},n6:{id:"n6",x:20,y:105},n7:{id:"n7",x:16,y:105},n8:{id:"n8",x:12,y:105},n9:{id:"n9",x:8,y:105},n10:{id:"n10",x:4,y:105},n11:{id:"n11",x:0,y:105},n12:{id:"n12",x:0,y:111},n13:{id:"n13",x:0,y:117},n14:{id:"n14",x:0,y:123},n15:{id:"n15",x:0,y:129},n16:{id:"n16",x:0,y:135},n17:{id:"n17",x:0,y:141},n18:{id:"n18",x:0,y:147},n19:{id:"n19",x:0,y:153},n20:{id:"n20",x:0,y:159},n21:{id:"n21",x:0,y:165},n22:{id:"n22",x:0,y:171},n23:{id:"n23",x:0,y:177},n24:{id:"n24",x:0,y:183},n25:{id:"n25",x:0,y:189},n26:{id:"n26",x:0,y:195},n27:{id:"n27",x:0,y:201},n28:{id:"n28",x:0,y:207},n29:{id:"n29",x:0,y:213},n30:{id:"n30",x:0,y:219},n31:{id:"n31",x:0,y:225},n32:{id:"n32",x:0,y:231},n33:{id:"n33",x:0,y:237},n34:{id:"n34",x:0,y:243},n35:{id:"n35",x:0,y:249},n36:{id:"n36",x:0,y:255},n37:{id:"n37",x:0,y:261},n38:{id:"n38",x:0,y:267},n39:{id:"n39",x:0,y:273},n40:{id:"n40",x:3,y:276},n41:{id:"n41",x:6,y:276},n42:{id:"n42",x:9,y:276},n43:{id:"n43",x:12,y:276},n44:{id:"n44",x:15,y:276},n45:{id:"n45",x:18,y:276},n46:{id:"n46",x:21,y:276},n47:{id:"n47",x:24,y:276},n48:{id:"n48",x:27,y:276},n49:{id:"n49",x:44,y:276},n50:{id:"n50",x:0,y:280},n51:{id:"n51",x:0,y:284},n52:{id:"n52",x:0,y:288},n53:{id:"n53",x:0,y:292},n54:{id:"n54",x:0,y:296},n55:{id:"n55",x:0,y:300},n56:{id:"n56",x:0,y:304},n57:{id:"n57",x:0,y:308},n58:{id:"n58",x:0,y:312},n59:{id:"n59",x:0,y:316},n60:{id:"n60",x:0,y:320},n61:{id:"n61",x:0,y:324},n62:{id:"n62",x:0,y:328},n63:{id:"n63",x:0,y:332},n64:{id:"n64",x:0,y:336},n65:{id:"n65",x:0,y:340},n66:{id:"n66",x:0,y:344},n67:{id:"n67",x:0,y:348},n68:{id:"n68",x:0,y:352},n69:{id:"n69",x:0,y:356},n70:{id:"n70",x:3,y:356},n71:{id:"n71",x:6,y:356},n72:{id:"n72",x:9,y:356},n73:{id:"n73",x:12,y:356},n74:{id:"n74",x:15,y:356},n75:{id:"n75",x:18,y:356},n76:{id:"n76",x:21,y:356},n77:{id:"n77",x:24,y:356},n78:{id:"n78",x:27,y:356},n79:{id:"n79",x:44,y:356},n80:{id:"n80",x:0,y:360},n81:{id:"n81",x:0,y:364},n82:{id:"n82",x:0,y:368},n83:{id:"n83",x:0,y:372},n84:{id:"n84",x:0,y:376},n85:{id:"n85",x:0,y:380},n86:{id:"n86",x:0,y:384},n87:{id:"n87",x:0,y:388},n88:{id:"n88",x:0,y:392},n89:{id:"n89",x:0,y:396},n90:{id:"n90",x:0,y:400},n91:{id:"n91",x:0,y:404},n92:{id:"n92",x:0,y:408},n93:{id:"n93",x:0,y:412},n94:{id:"n94",x:0,y:416},n95:{id:"n95",x:0,y:420},n96:{id:"n96",x:0,y:424},n97:{id:"n97",x:0,y:428},n98:{id:"n98",x:0,y:432},n99:{id:"n99",x:0,y:436},n100:{id:"n100",x:3,y:436},n101:{id:"n101",x:6,y:436},n102:{id:"n102",x:9,y:436},n103:{id:"n103",x:12,y:436},n104:{id:"n104",x:15,y:436},n105:{id:"n105",x:18,y:436},n106:{id:"n106",x:21,y:436},n107:{id:"n107",x:24,y:436},n108:{id:"n108",x:27,y:436},n109:{id:"n109",x:44,y:436},n110:{id:"n110",x:46,y:107},n111:{id:"n111",x:52,y:109},n112:{id:"n112",x:58,y:111},n113:{id:"n113",x:64,y:113},n114:{id:"n114",x:70,y:115},n115:{id:"n115",x:76,y:117},n116:{id:"n116",x:82,y:119},n117:{id:"n117",x:88,y:121},n118:{id:"n118",x:94,y:123},n119:{id:"n119",x:100,y:125},n120:{id:"n120",x:106,y:127},n121:{id:"n121",x:112,y:129},n122:{id:"n122",x:118,y:131},n123:{id:"n123",x:124,y:133},n124:{id:"n124",x:130,y:135},n125:{id:"n125",x:136,y:137},n126:{id:"n126",x:142,y:139},n127:{id:"n127",x:148,y:141},n128:{id:"n128",x:154,y:143},n129:{id:"n129",x:160,y:145},n130:{id:"n130",x:166,y:145},n131:{id:"n131",x:172,y:145},n132:{id:"n132",x:178,y:145},n133:{id:"n133",x:184,y:145},n134:{id:"n134",x:190,y:145},n135:{id:"n135",x:196,y:145},n136:{id:"n136",x:202,y:145},n137:{id:"n137",x:208,y:145},n138:{id:"n138",x:214,y:145},n139:{id:"n139",x:220,y:145},n140:{id:"n140",x:226,y:145},n141:{id:"n141",x:232,y:145},n142:{id:"n142",x:238,y:145},n143:{id:"n143",x:244,y:145},n144:{id:"n144",x:250,y:145},n145:{id:"n145",x:256,y:145},n146:{id:"n146",x:262,y:145},n147:{id:"n147",x:268,y:145},n148:{id:"n148",x:274,y:145},n149:{id:"n149",x:280,y:145}};CustOpt.keynodes=["n1","n49","n79","n109","n129","n149"];CustOpt.counter=[CustOpt.keynodes[1],CustOpt.keynodes[2],CustOpt.keynodes[3]];CustOpt.table=[CustOpt.keynodes[4],CustOpt.keynodes[5]];CustOpt.door="n1";CustOpt.customerFinalPath=new Array();PreloadImgs.put("$customer01","images/$customer01.png");PreloadImgs.put("$customer01_anger","images/$customer01_anger.png");PreloadImgs.put("$customer02","images/$customer02.png");PreloadImgs.put("$customer02_anger","images/$customer02_anger.png");PreloadImgs.put("$customer03","images/$customer03.png");PreloadImgs.put("$customer03_anger","images/$customer03_anger.png");PreloadImgs.put("coin","images/coin.png");PreloadImgs.put("anger","images/anger.png");PreloadImgs.put("duvida","images/duvida.png");PreloadImgs.put("heart","images/heart.png");PreloadImgs.put("$coke","images/$$coke.png");PreloadImgs.put("$hotdog","images/$$hotdog.png");PreloadImgs.put("$juiceoforange","images/$$juiceoforange.png");PreloadImgs.put("$orange","images/$$orange.png");PreloadImgs.put("$icecreamofchocolate","images/$$icecreamofchocolate.png");PreloadImgs.put("$icecreamofvanilla","images/$$icecreamofvanilla.png");PreloadImgs.put("$icecreamofstrawberry","images/$$icecreamofstrawberry.png");PreloadImgs.put("baloon_1","images/baloon_1.png");PreloadImgs.put("baloonr_1","images/baloonr_1.png");PreloadImgs.put("baloon_2","images/baloon_2.png");PreloadImgs.put("baloonr_2","images/baloonr_2.png");PreloadImgs.put("baloon_3","images/baloon_3.png");PreloadImgs.put("baloonr_3","images/baloonr_3.png");CustOpt.createCustomerPath=function(){for(var a=0;a<CustOpt.keynodes.length;a++){CustOpt.customerFinalPath[a]=CustOpt.nodes[CustOpt.keynodes[a]]}CustOpt.graph=new Graph(CustOpt.path)};CustOpt.createCustomerPath();var Customer={};Customer=function(b){this.pay=b.pay;this.limitedChanges=b.limitedChanges.split(",");for(var c=0;c<this.limitedChanges.length;c++){this.limitedChanges[c]=parseInt(this.limitedChanges[c])}this.randomType=b.randomType;this.hasRandom=b.hasRandom;this.drinks=b.drinks;this.dUnfulfilled=0;this.foods=b.foods;this.fUnfulfilled=0;var a=function(d){d.delivered=false};this.drinks.forEach(a);this.foods.forEach(a);this.currentNode=CustOpt.nodes[b.init];this.reallyCurrentNode=this.currentNode;this.dest=CustOpt.nodes[b.place.id];this.place=b.place.id;this.placeType=b.place.type;this.goOutIfPayed=b.goOutIfPayed;this.state=(this.currentNode.id===CustOpt.customerFinalPath[0].id?0:8);this.showCustomer=this.state!==0;this.showDoor=!this.showCustomer;this.log=[];this.custHeight=76;this.img=new Sprite({ticksPerFrame:0,numberOfFrames:3,horzSeq:true,x:this.currentNode.x,y:this.currentNode.y-this.custHeight,width:120,height:77,sourceY:0,img:PreloadImgs.get("$customer"+b.id)});if(this.state===8){this.img.update()}this.id=b.id;this.imgCustAnger=PreloadImgs.get("$customer"+b.id+"_anger");this.door=new Sprite({ticksPerFrame:0,numberOfFrames:4,horzSeq:false,x:0,y:0,width:120,height:480,img:PreloadImgs.get("doors")});this.coin=new Sprite({ticksPerFrame:0,numberOfFrames:10,horzSeq:true,width:440,height:40,sourceY:0,img:PreloadImgs.get("coin")});this.showCoin=false;this.fire=new Sprite({ticksPerFrame:0,numberOfFrames:10,horzSeq:true,width:160,height:32,sourceY:0,img:PreloadImgs.get("anger")});this.showFire=false;this.heart=new Sprite({ticksPerFrame:0,numberOfFrames:5,horzSeq:true,width:200,height:40,sourceY:0,img:PreloadImgs.get("heart")});this.showLove=false;this.openMission=b.openMission;this.idxPattern=b.idxPattern;this.baloonLeft=b.baloonLeft;this.amountPaid=0;this.amountChangeReceived=0;this.amountChangeExpected=0;this.changeReceived=[];this.deliveredItems=[]};Customer.prototype.afterConstruct=function(){this.wishesDrinks=[];this.wishesDrinks=this.wishesDrinks.concat(this.drinks);this.wishesFoods=[];this.wishesFoods=this.wishesFoods.concat(this.foods)};Customer.prototype.randomizeFoodAndDrink=function(){var a=(Math.floor(Math.random()*100)%3);switch(a){case 0:this.drinks=[];break;case 1:this.foods=[];break}};Customer.prototype.update=function(){switch(this.state){case 0:case 1:case 2:this.log.push(["UD"]);case 3:break;case 4:this.log.push(["SC",true]);this.state=50;return;case 50:case 51:case 52:this.log.push(["CD"]);if(this.state==52){this.state=5;return}break;case 5:this.log.push(["SD",false]);this.path=CustOpt.graph.findShortestPath(this.currentNode.id,this.dest.id);break;case 6:if(this.moveToSomePlace()){return}else{break}case 7:this.log.push(["MF",this.currentNode.x,this.currentNode.y,this.currentNode.x,this.currentNode.y,this.currentNode.id]);break;case 8:if(this.drinks.length==this.dUnfulfilled&&this.foods.length==this.fUnfulfilled&&this.openMission){if(this.goOutIfPayed&&(this.amountPaid==0||this.amountChangeExpected!=this.amountChangeReceived)){return}this.state=32}return;case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:this.log.push(["UC",true]);break;case 20:this.log.push(["UC",false]);this.state=8;return;case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:this.log.push(["UF",true]);break;case 31:this.log.push(["UF",false]);this.state=8;return;case 32:this.log.push(["SD",true]);this.path=CustOpt.graph.findShortestPath(this.dest.id,CustOpt.door);break;case 33:if(this.moveToSomePlace()){return}else{break}case 34:case 35:case 36:this.log.push(["UD"]);break;case 37:this.log.push(["SC",false]);this.log.push(["UD"]);this.log.push(["SD",false]);break;case 38:if(this.log.length==0){CustomerManager.removeCustomer(this);if(this.openMission){CustomerManager.createCustomerByPattern(this.idxPattern,CustOpt.door)}}return;case 39:case 41:case 42:case 43:case 44:this.log.push(["UH",true]);break;case 45:this.log.push(["UH",false]);break;case 46:return}this.state++};Customer.prototype.moveToSomePlace=function(){var a=this.path.shift();if(a){a=CustOpt.nodes[a];this.log.push(["MC",this.currentNode.x,this.currentNode.y,a.x,a.y,a.id]);this.currentNode=a;return true}return false};Customer.prototype.animate=function(){var a=this.log.shift();if(a){var b=a.shift();switch(b){case"MF":this.img.frameIndex=0;case"MC":this.changeCustomerPosition(a);break;case"SC":this.showCustomer=a.shift();break;case"SD":this.showDoor=a.shift();break;case"CD":this.door.invert=true;this.door.update();break;case"UD":this.door.invert=false;this.door.update();break;case"UC":this.showCoin=a.shift();this.coin.update();break;case"UF":this.showFire=a.shift();this.fire.update();break;case"UH":this.showLove=a.shift();this.heart.update();break}}};Customer.prototype.changeCustomerPosition=function(a){if(a[2]<a[0]){this.img.sourceY=80}else{if(a[2]>a[0]){this.img.sourceY=160}else{if(a[3]<a[1]){this.img.sourceY=240}else{this.img.sourceY=0}}}this.img.update();this.img.x=a[2];this.img.y=a[3]-this.custHeight;this.reallyCurrentNode=CustOpt.nodes[a[4]]};Customer.prototype.draw=function(b){if(this.showDoor){this.door.draw(b)}if(this.showCustomer){if(this.showFire){b.drawImage(this.imgCustAnger,this.img.x,this.img.y)}else{this.img.draw(b);var e=[];var a=(CustomerManager.randomization.length>0)||(this.hasRandom);var d=(!a)||(Game.runningStatus!==0)||(Game.victory);if(d){for(var c=0;c<this.foods.length;c++){if(!this.foods[c].delivered){e.push(PreloadImgs.get("$"+this.foods[c].item))}}for(var c=0;c<this.drinks.length;c++){if(!this.drinks[c].delivered){e.push(PreloadImgs.get("$"+this.drinks[c].item))}}}else{e.push(PreloadImgs.get("duvida"))}if(e.length>0){Baloon.draw(b,this.img.x,this.img.y+20,e,this.baloonLeft)}}}if(this.showCoin){this.coin.draw(b,22,20)}else{if(this.showFire){this.fire.draw(b)}else{if(this.showLove){this.heart.draw(b)}}}};Customer.prototype.askWantHowManyFoods=function(){return this.wishesFoods.length};Customer.prototype.askHowMuchInFoodsIfSell=function(){var a=0;for(var b=0;b<this.wishesFoods.length;b++){a+=this.wishesFoods[b].price}return a};Customer.prototype.askWantHowManyDrinks=function(){return this.wishesDrinks.length};Customer.prototype.askHowMuchInDrinksIfSell=function(){var a=0;for(var b=0;b<this.wishesDrinks.length;b++){a+=this.wishesDrinks[b].price}return a};Customer.prototype.askForDrink=function(){if(this.dUnfulfilled>=this.drinks.length){return null}var b=null;for(var a=0;a<this.drinks.length;a++){if(!this.drinks[a].delivered){b=this.drinks[a];break}}return{type:"order",descr:"$$"+b.item,drinkOrFood:"drink",source:this.currentNode.id,sourceType:this.placeType}};Customer.prototype.hasThirsty=function(){return(this.dUnfulfilled<this.drinks.length)};Customer.prototype.askForFood=function(){if(this.fUnfulfilled>=this.foods.length){return null}var b=null;for(var a=0;a<this.foods.length;a++){if(!this.foods[a].delivered){b=this.foods[a];break}}return{type:"order",descr:"$$"+b.item,drinkOrFood:"food",source:this.currentNode.id,sourceType:this.placeType}};Customer.prototype.hasHunger=function(){return(this.fUnfulfilled<this.foods.length)};Customer.prototype.askForIceCream=function(){if(this.fUnfulfilled>=this.foods.length){return null}for(var a=this.fUnfulfilled;a<this.foods.length;a++){var b=this.foods[a];if(b.item.indexOf("icecreamof")==0){return{type:"order",descr:"$$"+b.item,drinkOrFood:"food",source:this.currentNode.id,sourceType:this.placeType}}}return null};Customer.prototype.askWantHowManyIceCream=function(){var b=0;for(var a=0;a<this.wishesFoods.length;a++){if(this.wishesFoods[a].item.indexOf("icecreamof")===0){b++}}return b};Customer.DELIVERED_BAD=0;Customer.DELIVERED_PARTIAL=1;Customer.DELIVERED_TOTAL=2;Customer.DELIVERED_THANK_YOU=4;Customer.prototype.deliver=function(f){var e=0;var j=Customer.DELIVERED_BAD;var g=null;if(f.source==null){j=Customer.DELIVERED_THANK_YOU;this.showLove=true;this.heart.x=this.img.x+5;this.heart.y=this.img.y-20;this.state=39}else{if((f.type==="item")&&((f.drinkOrFood==="drink"&&(this.dUnfulfilled<this.drinks.length))||(f.drinkOrFood==="food"&&(this.fUnfulfilled<this.foods.length)))){if(f.source===this.currentNode.id){var h=null;var a=(f.drinkOrFood==="drink"?this.drinks:this.foods);for(var c=0;c<a.length;c++){if(a[c].delivered==false&&f.descr==="$$"+a[c].item){h=a[c];break}}if(h!=null){if(f.drinkOrFood==="drink"){this.dUnfulfilled++}else{this.fUnfulfilled++}h.delivered=true;j=(this.fullDelivered()?Customer.DELIVERED_TOTAL:Customer.DELIVERED_PARTIAL)}else{g="Error_deliveredWrongRequest"}}else{g="Error_doesntMatchPosition"}}else{g="Error_deliveredWrongRequest"}if(j===Customer.DELIVERED_TOTAL){var b=function(d){e+=d.price};this.foods.forEach(b);this.drinks.forEach(b);this.showCoin=true;this.coin.x=this.img.x+5;this.coin.y=this.img.y-20;this.state=9}else{if(j==Customer.DELIVERED_BAD){this.showFire=true;this.fire.x=this.img.x+8;this.fire.y=this.img.y-32;this.state=21}}}if(j!=Customer.DELIVERED_BAD){this.deliveredItems.push(f)}return{money:e,happy:j,reason:g}};Customer.prototype.howManyHotDogs=function(){return this.askWantHowManyFoods()-this.askWantHowManyIceCream()};Customer.prototype.fullDelivered=function(){return(this.dUnfulfilled==this.drinks.length)&&(this.fUnfulfilled==this.foods.length)};Customer.prototype.totalOfFoodDelivered=function(){return this.fUnfulfilled};Customer.prototype.totalOfDrinksDelivered=function(){return this.dUnfulfilled};Customer.prototype.qtdDeliveredOf=function(b){var a=0;this.deliveredItems.forEach(function(c){if(c.descr.indexOf(b)==0){a++}});return a};Customer.prototype.hasReceivedGift=function(b){for(var a=0;a<this.deliveredItems.length;a++){if(this.deliveredItems[a].source==null&&this.deliveredItems[a].descr===b){return true}}return false};Customer.prototype.hasReceivedItem=function(c,b){if(c==null||c==="food"){for(var a=0;a<this.foods.length;a++){if(this.foods[a].delivered&&this.foods[a].item==b){return true}}}if(c==null||c==="drink"){for(var a=0;a<this.drinks.length;a++){if(this.drinks[a].delivered&&this.drinks[a].item==b){return true}}}return false};Customer.prototype.totalOfMoneyDelivered=function(){var a=0;for(var b=0;b<this.foods.length;b++){if(this.foods[b].delivered){a+=this.foods[b].price}}for(var b=0;b<this.drinks.length;b++){if(this.drinks[b].delivered){a+=this.drinks[b].price}}return a};Customer.typesOfMoney=[10,20];Customer.prototype.cashIn=function(c){var d=this.askHowMuchInDrinksIfSell()+this.askHowMuchInFoodsIfSell();if(this.amountPaid!=0){BlocklyApps.log.push(["fail","Error_alreadyPaid"]);throw false}if(d!=c){BlocklyApps.log.push(["fail","Error_incorrectAccount"]);throw false}if(this.pay==null){var b=[].concat(Customer.typesOfMoney);if(d>10){b.splice(0,1)}var a=Math.floor(Math.random()*b.length);this.amountPaid=b[a]}else{this.amountPaid=parseInt(this.pay)}this.amountChangeExpected=this.amountPaid-d;return{type:"money",descr:"$$banknote"+this.amountPaid,value:this.amountPaid,source:this.currentNode.id,sourceType:this.placeType}};Customer.prototype.isPaid=function(){return this.amountPaid>0};Customer.prototype.isChangeReceived=function(){return this.amountChangeExpected==this.amountChangeReceived};Customer.prototype.isTheBestChange=function(){var b=this.amountChangeExpected;var c=this.limitedChanges;for(var a=0;a<c.length;a++){var g=c[a];var i=Math.floor(b/g);var h=null;var e=function(f){if(f.type==g){h=f.qtd}};this.changeReceived.forEach(e);var d=!(i==0||(h!=null&&h==i));if(d){return false}b-=(i*g)}return true};Customer.prototype.receivedChange=function(b,c){var a=0;b=this.convertMoney(b);this.changeReceived.forEach(function(d){if(d.type===b){a+=d.qtd}});return(c==a)};Customer.prototype.convertMoney=function(b){var a="";switch(b){case'"$$$money20"':a=20;break;case'"$$$money10"':a=10;break;case'"$$$money5"':a=5;break;case'"$$$money2"':a=2;break;case'"$$$money1"':a=1;break}return a};Customer.prototype.giveChange=function(c,d){if(c===undefined||c.data===undefined||isNaN(c.data)){BlocklyApps.log.push(["fail","Error_qtyOfMoneyInvalid"]);throw false}c=parseInt(c.data);var a=0;if(d!=undefined&&d.data!=undefined){a=this.convertMoney(d.data)}if(a==0){BlocklyApps.log.push(["fail","Error_typeOfMoneyInvalid"]);throw false}var b=a*c;if(this.amountChangeReceived+b>this.amountChangeExpected){BlocklyApps.log.push(["fail","Error_changeExceeded"]);throw false}this.amountChangeReceived+=b;this.changeReceived.push({qtd:c,type:a});return this.amountChangeExpected==this.amountChangeReceived};"use strict";var CustomerManager={};var customers=[];PreloadImgs.put("banco","images/banco.png");CustomerManager.init=function(c,b,a,d){this.banco=PreloadImgs.get("banco");this.openMission=c;this.tests=b;this.currentTest=0;this.optCustomers=a;this.randomization=[];this.history=[];if(d!=undefined){this.parseSN(d)}};CustomerManager.nextTest=function(){this.currentTest++;if(this.currentTest==this.tests){return false}customers=[];CustomerManager.createCustomers();return true};CustomerManager.parseSN=function(e){var a=e.getElementsByTagName("randomization");for(var b=0;b<a.length;b++){var d=a[b];var c={};c.qtd=d.getAttribute("qtd");c.type=d.textContent.toString();c.set=d.getAttribute("set");if(c.set==null){c.set="new"}this.randomization[b]=c}};CustomerManager.reset=function(){this.patterns=[];this.history=[];customers=[];this.currentTest=0;var f=this.optCustomers.firstElementChild;while(f!=null){var o=f.getElementsByTagName("init")[0].textContent.toString();if(o==="door"){o=CustOpt.door}else{if(o.indexOf("counter")==0){o=CustOpt.counter[parseInt(o.substring(7))-1]}else{o=CustOpt.table[parseInt(o.substring(5))-1]}}var j=f.getElementsByTagName("dest")[0];if(j!=null){j=j.textContent.toString();if(j.indexOf("counter")==0){j={id:CustOpt.counter[parseInt(j.substring(7))-1],type:"counter"}}else{if(j.indexOf("table")==0){j={id:CustOpt.table[parseInt(j.substring(5))-1],type:"table"}}}}var h=f.getElementsByTagName("pay")[0];if(h!=null){h=h.textContent.toString()}var r=f.getElementsByTagName("limitedChanges")[0];if(r==null){r="20, 10, 5, 2, 1"}else{r=r.textContent.toString()}var p=f.getElementsByTagName("goOutIfPayed")[0];if(p==null){p=false}else{p=p.textContent.toString()==="true"}var m=f.getElementsByTagName("id")[0].textContent.toString();var d=f.getElementsByTagName("orders")[0].getElementsByTagName("order");var l=[];for(var q=0;q<d.length;q++){var c=d[q].getAttribute("randomType");var b=d[q].getElementsByTagName("foods")[0];var g=d[q].getElementsByTagName("drinks")[0];var k=CustomerManager.extractItems("food",b,null,c);var a=CustomerManager.extractItems("drink",g,k.length,c);var n=d[q].getElementsByTagName("dest")[0];if(n!=null){n=n.textContent.toString();if(n.indexOf("table")==0){n={id:CustOpt.table[parseInt(n.substring(5))-1],type:"table"}}}if(c==="random"){var t=CustomerManager.randomOrder(parseInt(d[q].getAttribute("randomMin")),parseInt(d[q].getAttribute("randomMax")),k,a);k=t[0];a=t[1]}var e=b.getAttribute("randomMin");var s=g.getAttribute("randomMin");l.push({hasRandom:c!=null||(e!==null)||(s!==null),randomType:c,place:n,foods:k,drinks:a})}if(l.length>0){this.patterns.push({init:o,place:j,id:m,pay:h,limitedChanges:r,goOutIfPayed:p,pattern:l,idxCustPattern:0})}f=f.nextElementSibling}CustomerManager.createCustomers()};CustomerManager.createCustomers=function(){this.createCustomersBasedOnPattern();this.transformSN()};CustomerManager.transformSN=function(){if(this.randomization.length>0){var d=null;for(var b=0;b<this.randomization.length;b++){var a;if(this.randomization[b].qtd==="random"){a=Math.floor((Math.random()*(customers.length+1)))}else{a=this.randomization[b].qtd}switch(this.randomization[b].set){case"new":d=this.selectCustomers(customers.length-a,[]);break;case"notTheSame":d=this.selectCustomers(customers.length-a,d);break}switch(this.randomization[b].type){case"thirsty":for(var c=0;c<d.length;c++){customers[d[c]].drinks=[]}break;case"hungry":for(var c=0;c<d.length;c++){customers[d[c]].foods=[]}break}}customers.forEach(function(e){e.afterConstruct()})}};CustomerManager.createCustomersBasedOnPattern=function(){for(var b=0;b<this.patterns.length;b++){var a=this.patterns[b].place;var c=false;for(var b=0;b<customers.length;b++){if(customers[b].id===a.id&&customers[b].type===a.type){c=true;break}}if(!c){CustomerManager.createCustomerByPattern(b,this.patterns[b].init)}}};CustomerManager.createCustomerByPattern=function(b,h){var d=b;var a=this.patterns[d].pattern[this.patterns[d].idxCustPattern];this.patterns[d].idxCustPattern=(this.patterns[d].idxCustPattern+1)%this.patterns[d].pattern.length;var f=a.foods;var e=a.drinks;var c=(this.patterns[d].place==="-"?a.place:this.patterns[d].place);var g=new Customer({init:h,place:c,id:this.patterns[d].id,hasRandom:a.hasRandom,randomType:a.randomType,foods:f,drinks:e,openMission:this.openMission,idxPattern:d,baloonLeft:((c.type==="counter"&&customers.length%2==0)||(c.type==="table"&&c.id===CustOpt.table[0])),pay:this.patterns[d].pay,limitedChanges:this.patterns[d].limitedChanges,goOutIfPayed:this.patterns[d].goOutIfPayed});if(this.randomization.length==0){g.afterConstruct()}customers.push(g);return g};CustomerManager.selectCustomers=function(d,f){var g=[];var b=0;for(var c=0;c<customers.length;c++){if(f.indexOf(c)==-1){g[b]=c;b++}}var a=[];for(var c=0;c<d;c++){var e=Math.floor((Math.random()*(g.length)));a[c]=g[e];g.splice(e,1)}return a};CustomerManager.randomOrder=function(g,d,f,e){var c=Math.floor((Math.random()*((d-g)+1)))+g;var b=f.length+e.length;while(b>c){var a=Math.floor((Math.random()*(b)));if(a<f.length){f.splice(a,1)}else{e.splice(a-f.length,1)}b--}return[f,e]};CustomerManager.extractItems=function(v,t,q,b){var c=q!=null;var h=t.getAttribute("randomMin");h=parseInt(h==null?"-1":h);if(c&&b==="atLeastOne"&&q==0){h=1}var e=t.getAttribute("differentFromPrevious")==="true";var d=t.getElementsByTagName(v);var k=[];for(var o=0;o<d.length;o++){k[o]=o}if(h>-1){var m=parseInt(t.getAttribute("randomMax"));var r=Math.floor((Math.random()*((m-h)+1)))+h;if(q==0&&r==0){r=1}if(e){for(var p=0;p<customers.length;p++){var n;if(c){n=customers[p].drinks}else{n=customers[p].foods}n.forEach(function(s){for(var i=d.length-1;i>=0;i--){if(d[i].childNodes[0].nodeValue===s.item){k.splice(i,1);break}}})}}while(k.length>r){var f=Math.floor((Math.random()*(k.length)));k.splice(f,1)}}var g=[];for(var o=0;o<k.length;o++){var u=d[k[o]];var l=u.childNodes[0].nodeValue;if(hero.hasMachineFor(l)){var a=parseInt(u.getAttribute("price"));g.push({item:l,price:a})}}return g};CustomerManager.removeCustomer=function(a){this.history.push(a);var b=customers.indexOf(a);customers.splice(b,1)};CustomerManager.update=function(a){if(a===undefined){a=1}for(var c=0;c<customers.length;c++){for(var b=0;b<a;b++){customers[c].update()}}};CustomerManager.animation=function(){for(var a=0;a<customers.length;a++){customers[a].animate()}};CustomerManager.draw=function(b){var e=[true,true,true];for(var d=0;d<customers.length;d++){var a=customers[d].reallyCurrentNode.id;for(var c=0;c<CustOpt.counter.length;c++){if(a===CustOpt.counter[c]){e[c]=false;break}}}CustomerManager.drawCounters(b,e);for(var d=0;d<customers.length;d++){customers[d].draw(b)}};CustomerManager.drawCounters=function(a,c){for(var b=0;b<c.length;b++){if(c[b]){var d=CustOpt.nodes[CustOpt.counter[b]];a.drawImage(this.banco,d.x,d.y-40)}}};CustomerManager.getCustomerCounter=function(b){b=b-1;for(var a=0;a<customers.length;a++){if(customers[a].currentNode.id===CustOpt.counter[b]){return customers[a]}}return null};CustomerManager.getCustomerTable=function(b){b=b-1;for(var a=0;a<customers.length;a++){if(customers[a].currentNode.id===CustOpt.table[b]){return customers[a]}}return null};CustomerManager.getCustomerPosition=function(b){for(var a=0;a<CustOpt.counter.length;a++){if(b===CustOpt.counter[a]){return a+1+" "}}for(var a=0;a<CustOpt.table.length;a++){if(b===CustOpt.table[a]){return a+1+" "}}return"0"};CustomerManager.totalOfFood=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=c[d].askWantHowManyFoods()}return b};return a(customers)+a(this.history)};CustomerManager.totalOfDrink=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=c[d].askWantHowManyDrinks()}return b};return a(customers)+a(this.history)};CustomerManager.totalOfMoneyIfSell=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=c[d].askHowMuchInFoodsIfSell();b+=c[d].askHowMuchInDrinksIfSell()}return b};return a(customers)+a(this.history)};CustomerManager.customerMoneyIfSell=function(a){a--;for(var b=0;b<customers.length;b++){if(customers[b].currentNode.id===CustOpt.counter[a]){return customers[b].askHowMuchInFoodsIfSell()+customers[b].askHowMuchInDrinksIfSell()}}return 0};CustomerManager.totalOfMoneyGave=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){if(c[d].isPaid()){b+=c[d].amountPaid}else{b-=100}}return b};return a(customers)+a(this.history)};CustomerManager.totalOfMoneyDelivered=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=c[d].totalOfMoneyDelivered()}return b};return a(customers)+a(this.history)};CustomerManager.customerMoneyGave=function(a){a--;for(var b=0;b<customers.length;b++){if(customers[b].currentNode.id===CustOpt.counter[a]){if(customers[b].isPaid()){return customers[b].amountPaid}else{return -100}}}return -100};CustomerManager.totalOfFoodDeliveredCustomer=function(a){a--;for(var b=0;b<customers.length;b++){if(customers[b].currentNode.id===CustOpt.counter[a]){return customers[b].totalOfFoodDelivered()}}return 0};CustomerManager.totalOfFoodDelivered=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=c[d].totalOfFoodDelivered()}return b};return a(customers)+a(this.history)};CustomerManager.totalOfDrinksDelivered=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=c[d].totalOfDrinksDelivered()}return b};return a(customers)+a(this.history)};CustomerManager.qtdDeliveredOf=function(a){var b=function(d){var c=0;for(var e=0;e<d.length;e++){c+=d[e].qtdDeliveredOf(a)}return c};return b(customers)+b(this.history)};CustomerManager.fullDeliveredCustomers=function(){var a=function(c){var b=0;for(var d=0;d<c.length;d++){b+=(c[d].fullDelivered()?1:0)}return b};return a(customers)+a(this.history)};CustomerManager.fullDeliveredCustomersHowManyPlaces=function(){var a=[];var b=function(c){for(var d=0;d<c.length;d++){if(c[d].fullDelivered()){if(a.indexOf(c[d].place)==-1){a.push(c[d].place)}}}};b(customers);b(this.history);return a.length};CustomerManager.greatestCustomer=function(e){var d=-1;var a=0;for(var c=0;c<customers.length;c++){var b=customers[c][e]();if(b>d){d=b;a=c}}return a};"use strict";var Sprite={};Sprite=function(a){this.frameIndex=0;this.tickCount=0;if(a.ticksPerFrame===undefined){this.ticksPerFrame=1}else{this.ticksPerFrame=a.ticksPerFrame}this.numberOfFrames=a.numberOfFrames||1;this.horzSeq=a.horzSeq;this.x=a.x;this.y=a.y;this.sourceX=a.sourceX||0;this.sourceY=a.sourceY||0;this.width=a.width;this.height=a.height;if(a.img){this.image=a.img}else{this.image=new Image();this.image.src=a.imgSrc}this.invert=false};Sprite.prototype.update=function(){this.tickCount+=1;if(this.tickCount>this.ticksPerFrame){this.tickCount=1;if((!this.invert&&this.frameIndex<this.numberOfFrames-1)||(this.invert&&this.frameIndex>0)){if(this.invert){this.frameIndex-=1}else{this.frameIndex+=1}}else{if(this.invert){this.frameIndex=this.numberOfFrames-1}else{this.frameIndex=0}}}};Sprite.prototype.invertDirection=function(){this.invert=!this.invert;this.tickCount=0;this.frameIndex=(this.invert?this.numberOfFrames-1:0)};Sprite.prototype.draw=function(i,a,e){var d=this.numberOfFrames;var b=this.frameIndex;var g,f,h,c;if(this.horzSeq){g=b*this.width/d;f=this.sourceY;h=this.width/d;c=this.height;if(a===undefined){a=this.width/d;e=this.height}}else{g=this.sourceX;f=b*this.height/d;h=this.width;c=this.height/d;if(a===undefined){a=this.width;e=this.height/d}}i.drawImage(this.image,g,f,h,c,this.x,this.y,a,e)};"use strict";NoBugsInterpreter.prototype=new Interpreter;NoBugsInterpreter.prototype.constructor=NoBugsInterpreter;NoBugsInterpreter.prototype.parent=Interpreter.prototype;function NoBugsInterpreter(b,a){this.creatingScope=0;this.variables=[];this.prepareAddArguments=false;this.base=Interpreter;this.base(b,a)}NoBugsInterpreter.prototype.populateScope_=function(b,a){this.creatingScope++;this.parent.populateScope_.call(this,b,a);this.creatingScope--};NoBugsInterpreter.prototype.setProperty=function(e,b,d,a,c){this.parent.setProperty.call(this,e,b,d,a,c);if(this.creatingScope>0||this.stateStack[0].func_){if(b!=="prototype"&&b!=="length"&&d.type!=="function"){if(this.stateStack[0].func_&&((b.data!==undefined&&b.type!=="string")||b==="arguments")){return}this.variables.push({scope:e,name:(b.data?b.data:b)})}}};"use strict";var NoBugsJavaScript={};NoBugsJavaScript.oldVarSet=null;NoBugsJavaScript.oldLogicCompare=null;NoBugsJavaScript.varName=null;NoBugsJavaScript.oldMathArith=null;NoBugsJavaScript.typeComparison="function nobugsComparison(arg0, arg1, operator) {if (arg0.type != undefined ) {arg0 = arg0.descr; } else if (arg1.type != undefined) {arg1 = arg1.descr;}var OPERATORS={'EQ': '==','NEQ': '!=','LT': '<','LTE': '<=','GT': '>','GTE': '>='};return eval(arg0 + ' ' + OPERATORS[operator] + ' ' + arg1);};";NoBugsJavaScript.redefine=function(){Blockly.Msg.CONTROLS_IF_MSG_THEN=BlocklyApps.getMsg("Blockly_ifThen");Blockly.Msg.CONTROLS_FOR_TITLE=BlocklyApps.getMsg("Blockly_controlFor");Blockly.Msg.PROCEDURES_DEFRETURN_TITLE=BlocklyApps.getMsg("Blockly_function");Blockly.Msg.PROCEDURES_DEFNORETURN_TITLE=BlocklyApps.getMsg("Blockly_procedure");Blockly.Msg.PROCEDURES_DEFRETURN_PROCEDURE=BlocklyApps.getMsg("Blockly_functionName");Blockly.Msg.PROCEDURES_DEFNORETURN_PROCEDURE=Blockly.Msg.PROCEDURES_DEFRETURN_PROCEDURE;if(NoBugsJavaScript.oldVarSet==null){NoBugsJavaScript.oldVarSet=Blockly.JavaScript.variables_set;Blockly.JavaScript.variables_set=NoBugsJavaScript.newVarSet;NoBugsJavaScript.oldMathArith=Blockly.JavaScript.math_arithmetic;Blockly.JavaScript.math_arithmetic=NoBugsJavaScript.newMathArith}if(NoBugsJavaScript.oldLogicCompare==null){NoBugsJavaScript.oldLogicCompare=Blockly.JavaScript.logic_compare;Blockly.JavaScript.logic_compare=NoBugsJavaScript.newLogicCompare}if(NoBugsJavaScript.oldLogicOperation==null){NoBugsJavaScript.oldLogicOperation=Blockly.JavaScript.logic_operation;Blockly.JavaScript.logic_operation=NoBugsJavaScript.newLogicOperation}};NoBugsJavaScript.newVarSet=function(b){var a=NoBugsJavaScript.oldVarSet(b);return'NoBugsJavaScript.varName="'+b.getFieldValue("VAR")+'";\n'+a+"\nNoBugsJavaScript.varName=null;\n"};NoBugsJavaScript.ARITH_OPERATORS={ADD:[" + ",Blockly.JavaScript.ORDER_ADDITION],MINUS:[" - ",Blockly.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",Blockly.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",Blockly.JavaScript.ORDER_DIVISION],POWER:[null,Blockly.JavaScript.ORDER_COMMA]};NoBugsJavaScript.newMathArith=function(g){var f="";if(g.inputList[0].connection.targetConnection!=null&&g.inputList[0].connection.targetConnection.sourceBlock_.type==="variables_get"){f='"'+g.inputList[0].connection.targetConnection.sourceBlock_.inputList[0].fieldRow[0].text_+'"'}if(g.inputList[1].connection.targetConnection!=null&&g.inputList[1].connection.targetConnection.sourceBlock_.type==="variables_get"){f=f+(f===""?"":",")+'"'+g.inputList[1].connection.targetConnection.sourceBlock_.inputList[0].fieldRow[0].text_+'"'}var b=g.getFieldValue("OP");var a=NoBugsJavaScript.ARITH_OPERATORS[b][1];var e=Blockly.JavaScript.valueToCode(g,"A",a)||"0";var d=Blockly.JavaScript.valueToCode(g,"B",a)||"0";var c='nobugsMathArith(%0, %1, "%2")'.format(e,d,b);return["(verifyVariableInitialized(["+f+"])?"+c+":null)",Blockly.JavaScript.ORDER_FUNCTION_CALL]};function nobugsMathArith(arg0,arg1,operator){operator=NoBugsJavaScript.ARITH_OPERATORS[(operator.data==null?operator:operator.data)][0];if(isNaN(parseInt(arg0))){arg0=arg0.data;if(arg0==undefined){BlocklyApps.log.push(["fail","Error_variableDoesntInitialized"]);throw false}if(arg0.type!=undefined){arg0=arg0.value}}if(isNaN(parseInt(arg1))){arg1=arg1.data;if(arg1==undefined){BlocklyApps.log.push(["fail","Error_variableDoesntInitialized"]);throw false}if(arg1.type!=undefined){arg1=arg1.value}}if(arg0==undefined||arg1==undefined){BlocklyApps.log.push(["fail","Error_onceVariableIsNotANumber"]);throw false}if(!operator){var code="Math.pow("+arg0+", "+arg1+")";return eval(code)}else{if(operator===NoBugsJavaScript.ARITH_OPERATORS.DIVIDE[0]){return eval("Math.floor("+arg0+" / "+arg1+")")}}return eval(arg0+" "+operator+" "+arg1)}NoBugsJavaScript.OPERATORS={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="};NoBugsJavaScript.newLogicCompare=function(f){var g=f.getFieldValue("OP");var b=NoBugsJavaScript.OPERATORS[g];var a=(b=="=="||b=="!=")?Blockly.JavaScript.ORDER_EQUALITY:Blockly.JavaScript.ORDER_RELATIONAL;var e=Blockly.JavaScript.valueToCode(f,"A",a)||"0";var d=Blockly.JavaScript.valueToCode(f,"B",a)||"0";var c='nobugsComparison(%0, %1, "%2")'.format(e,d,g);return[c,a]};function nobugsComparison(arg0,arg1,operator){if(hero!==null&&hero!==undefined){hero.verifyObjectives("useBlock",{type:"logic_compare",value:operator.data})}operator=NoBugsJavaScript.OPERATORS[(operator.data==null?operator:operator.data)];if(!isNaN(parseInt(arg0))){return eval(arg0+" "+operator+" "+arg1)}if(arg0===true||arg0===false||arg0==="true"||arg0==="false"){return eval(arg0+" "+operator+" "+arg1)}arg0=arg0.data;arg1=arg1.data;if(arg0==undefined||arg1==undefined){BlocklyApps.log.push(["fail","Error_variableDoesntInitialized"]);throw false}if(arg0.type!=undefined){arg0='"'+arg0.descr+'"'}else{if(arg1.type!=undefined){arg1='"'+arg1.descr+'"'}}var ret=eval(arg0+" "+operator+" "+arg1);return ret}NoBugsJavaScript.verifyLogicOperation=function(a){if(hero!==null&&hero!==undefined){hero.verifyObjectives("useBlock",{type:"logic_operation",value:a.data})}return true};NoBugsJavaScript.newLogicOperation=function(b){var c=b.getFieldValue("OP");var a=NoBugsJavaScript.oldLogicOperation(b);a[0]='(verifyLogicOperation("'+c+'") && '+a[0]+")";return a};NoBugsJavaScript.arrayCreate=function(b){b=b.data;if(isNaN(b)){BlocklyApps.log.push(["fail","Error_parameterIsNotANumber"]);throw false}if(b<=0){BlocklyApps.log.push(["fail","Error_parameterMustBeGreaterThanZero"]);throw false}var c=new Array(b);for(var a=0;a<c.length;a++){c[a]=0}return c};NoBugsJavaScript.testParameters=function(b,a){if(!b.length){BlocklyApps.log.push(["fail","Error_parameterIsNotAnArray"]);throw false}if(isNaN(a)){BlocklyApps.log.push(["fail","Error_parameterIsNotANumber"]);throw false}if(a<0){BlocklyApps.log.push(["fail","Error_parameterMustBeEqualsGreaterThanZero"]);throw false}if(a>=b.length){BlocklyApps.log.push(["fail","Error_tryToAccessAPositionOutOfBounds"]);throw false}};NoBugsJavaScript.arrayLength=function(a){a=a.data;if(!a.length){BlocklyApps.log.push(["fail","Error_parameterIsNotAnArray"]);throw false}return a.length};NoBugsJavaScript.arrayGetValue=function(b,a){b=b.data;a=a.data;NoBugsJavaScript.testParameters(b,a);return b[a]};NoBugsJavaScript.arraySetValue=function(c,a,b){c=c.data;a=a.data;b=b.data;NoBugsJavaScript.testParameters(c,a);c[a]=b};Blockly.Variables.intoTheFunction=function(c,f){var a=[];f.forEach(function(g){a[g.toLowerCase()]=g});var d=[];c.childBlocks_.forEach(function(g){Blockly.FieldVariable.getVars(g).forEach(function(h){if(a[h.toLowerCase()]==null){d[h.toLowerCase()]=h}})});var b=[];for(var e in d){b.push(d[e])}return b};Blockly.JavaScript.procedures_defreturn=function(c){var f=Blockly.JavaScript.variableDB_.getName(c.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE);var h=Blockly.JavaScript.statementToCode(c,"STACK");if(Blockly.JavaScript.STATEMENT_PREFIX){h=Blockly.JavaScript.prefixLines(Blockly.JavaScript.STATEMENT_PREFIX.replace(/%1/g,"'"+c.id+"'"),Blockly.JavaScript.INDENT)+h}var a=Blockly.JavaScript.valueToCode(c,"RETURN",Blockly.JavaScript.ORDER_NONE)||"";if(a){a="verifyVariableInitialized(['"+a+"']);\n  return "+a+";\n"}var e=[];for(var g=0;g<c.arguments_.length;g++){e[g]=Blockly.JavaScript.variableDB_.getName(c.arguments_[g],Blockly.Variables.NAME_TYPE)}var k=[];var j=Blockly.Variables.intoTheFunction(c,e);for(var d=0;d<j.length;d++){k[d]="var "+Blockly.JavaScript.variableDB_.getName(j[d],Blockly.Variables.NAME_TYPE)+";"}var b="function "+f+"("+e.join(", ")+") {\n"+k.join("\n")+'changeTab("'+c.workspace.id+'");\n'+h+Blockly.JavaScript.STATEMENT_PREFIX.replace(/%1/g,"'"+c.id+"'")+a+"}";b=Blockly.JavaScript.scrub_(c,b);Blockly.JavaScript.definitions_[f]=b;return null};Blockly.JavaScript.procedures_defnoreturn=Blockly.JavaScript.procedures_defreturn;Blockly.JavaScript.procedures_callnoreturn=function(f){var e=Blockly.JavaScript.variableDB_.getName(f.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE);var b=[];var d=[];for(var a=0;a<f.arguments_.length;a++){b[a]=Blockly.JavaScript.valueToCode(f,"ARG"+a,Blockly.JavaScript.ORDER_COMMA)||"null";d[a]='"'+b[a]+'"'}var c=e+"("+b.join(", ")+");\n";c="verifyVariableInitialized(["+d.join(", ")+"]);\n"+c;return c+'changeTab("'+f.workspace.id+'");\n'};Blockly.JavaScript.procedures_callreturn=function(f){var e=Blockly.JavaScript.variableDB_.getName(f.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE);var b=[];var d=[];for(var a=0;a<f.arguments_.length;a++){b[a]=Blockly.JavaScript.valueToCode(f,"ARG"+a,Blockly.JavaScript.ORDER_COMMA)||"null";d[a]='"'+b[a]+'"'}var c=e+"("+b.join(", ")+")";return["verifyVariableInitialized(["+d.join(", ")+']) && changeTab("'+f.workspace.id+'", '+c+")",,Blockly.JavaScript.ORDER_FUNCTION_CALL]};"use strict";function loadMission(c){var a=new window.XMLHttpRequest();a.open("GET",c,false);a.setRequestHeader("Content-Type","text/xml");a.send("");var b=a.responseXML;return b}function transformStrToXml(a){if(window.DOMParser){return(new window.DOMParser()).parseFromString(a,"text/xml")}else{if(typeof window.ActiveXObject!="undefined"&&new window.ActiveXObject("Microsoft.XMLDOM")){var b=new window.ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(xmlStr);return b}else{return null}}};"use strict";function findVariable(){var c=Game.jsInterpreter.variables;var a=c[0].scope.properties.NoBugsJavaScript.properties.varName.data;for(var b=1;b<c.length;b++){if(c[b].name===a){return c[b].scope.properties[a].data}}return null}var Objective={factories:[]};Objective.init=function(b,a){return{objective:b.childNodes[0].nodeValue,notExists:b.getAttribute("notExists"),achieved:false,achievedOrder:0,trata:a}};Objective.verifyObjectives=function(e,c){if((hero.allObjectivesAchieved||(hero.objective.debug&&Game.runningStatus!=2))){return false}if(e==="notExists"){Objective.notExists();return}var b=false;for(var d=0;d<hero.objective.objectives.length;d++){if(hero.objective.objectives[d].objective===e&&!hero.objective.objectives[d].achieved){var a=Objective.factory(e);if(hero.objective.objectives[d].notExists==null&&a.checkObjective(c,hero.objective.objectives[d])){Objective.markAchieved(hero.objective.objectives[d]);if((e==="deliver"||e==="giveTheWholeChange"||e==="giveSomeChange"||e==="conditional"||e=="customDeliver"||e==="callTimes")&&c.allCustomers){b=true}else{return true}}}}return b};Objective.notExists=function(){for(var a=0;a<hero.objective.objectives.length;a++){if(hero.objective.objectives[a].notExists==="true"){Objective.markAchieved(hero.objective.objectives[a])}}};Objective.reset=function(b){b.achieved=false;var a=Objective.factory(b.objective);if(a.reset){a.reset(b)}};Objective.markAchieved=function(a){hero.lastObjectiveAchieved++;hero.allObjectivesAchieved=(hero.lastObjectiveAchieved+1)==hero.objective.objectives.length;a.achieved=true;a.achievedOrder=hero.lastObjectiveAchieved};Objective.factory=function(a){var b=this.factories[a];if(b!=undefined){return b}switch(a){case"goesTo":this.factories[a]=new Objective.Counter();break;case"goesToDisplay":this.factories[a]=new Objective.GoesToDisplay();break;case"goesToCooler":this.factories[a]=new Objective.GoesToCooler();break;case"askForFood":this.factories[a]=new Objective.AskForFood();break;case"pickUpFood":this.factories[a]=new Objective.PickUpFood();break;case"askHasHunger":this.factories[a]=new Objective.AskSomething("explanation_askHasHunger");break;case"askForDrink":this.factories[a]=new Objective.AskSomething("explanation_askForDrink");break;case"askWantHowManyFoods":this.factories[a]=new Objective.AskSomething("explanation_askWantHowManyFoods");break;case"askWantHowManyDrinks":this.factories[a]=new Objective.AskSomething("explanation_askWantHowManyDrinks");break;case"askForIceCream":this.factories[a]=new Objective.AskSomething("explanation_askForIceCream");break;case"askWantHowManyIceCream":this.factories[a]=new Objective.AskSomething("explanation_askWantHowManyIceCream");break;case"pickUpDrink":this.factories[a]=new Objective.PickUpDrink();break;case"askHasThirsty":this.factories[a]=new Objective.AskSomething("explanation_askHasThirsty");break;case"deliver":this.factories[a]=new Objective.Deliver();break;case"deliverGifts":this.factories[a]=new Objective.DeliverGifts();break;case"customDeliver":this.factories[a]=new Objective.CustomDeliver();break;case"conditional":this.factories[a]=new Objective.Conditional();break;case"varQtd":this.factories[a]=new Objective.VarQtd();break;case"commQtd":this.factories[a]=new Objective.CommsQtd();break;case"talk":this.factories[a]=new Objective.Talk();break;case"countTalk":this.factories[a]=new Objective.CountTalk();break;case"cashIn":this.factories[a]=new Objective.CashIn();break;case"giveTheWholeChange":this.factories[a]=new Objective.GiveTheWholeChange();break;case"giveSomeChange":this.factories[a]=new Objective.GiveSomeChange();break;case"useBlock":this.factories[a]=new Objective.UseBlock();break;case"totalOfSell":this.factories[a]=new Objective.TotalOfSell();break;case"callTimes":this.factories[a]=new Objective.CallTimes();break;case"ordered":this.factories[a]=new Objective.Ordered();break;case"music":this.factories[a]=new Objective.Music();break;case"clickMission":this.factories[a]=new Objective.ClickMission();break}return this.factories[a]};Objective.createExplanationItemPlacePos=function(f,d,c,a){var b=BlocklyApps.getMsg("_"+d.place);var e=BlocklyApps.getMsg(f);return e.format(b+" "+d.pos,c,a)};Objective.Counter=function(){};Objective.Counter.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");return b};Objective.Counter.prototype.checkObjective=function(a,b){var c=hero.counter[b.pos-1];if(a.nx==c.x&&a.ny==c.y){return true}return false};Objective.Counter.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_counter");return b.format(a.pos)};Objective.GoesToDisplay=function(){};Objective.GoesToDisplay.prototype.init=function(a){var b={objective:"goesToDisplay",achieved:false,trata:this};return b};Objective.GoesToDisplay.prototype.checkObjective=function(a,b){if(a.nx==hero.displayNode.x&&a.ny==hero.displayNode.y){return true}return false};Objective.GoesToDisplay.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_goestodisplay");return b};Objective.GoesToCooler=function(){};Objective.GoesToCooler.prototype.init=function(a){var b={objective:"goesToCooler",achieved:false,trata:this};return b};Objective.GoesToCooler.prototype.checkObjective=function(a,b){if(a.nx==hero.coolerNode.x&&a.ny==hero.coolerNode.y){return true}return false};Objective.GoesToCooler.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_goestocooler");return b};Objective.AskForFood=function(){};Objective.AskForFood.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.distinct=a.getAttribute("distinct")==="true";return b};Objective.AskForFood.prototype.checkObjective=function(c,b){if(b.distinct){var a=findVariable();if(a!=undefined){return false}}if(b.place==="counter"){if(c.currentNode.id===CustOpt.counter[b.pos-1]){return true}}return false};Objective.AskForFood.prototype.createExplanationItem=function(a){if(a.distinct){return Objective.createExplanationItemPlacePos("explanation_askForFoodDistinctVar",a)}return Objective.createExplanationItemPlacePos("explanation_askForFood",a)};Objective.CatchSomething=function(a){this.key=a};Objective.CatchSomething.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.CatchSomething.prototype.checkObjective=function(c,b){var d=null;if(b.place==="counter"){d=CustomerManager.getCustomerCounter(b.pos)}if(d==null){return false}var a=this.askSomething(d);return c.descr===a.descr};Objective.CatchSomething.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos(this.key,a)};Objective.CatchSomething.prototype.askSomething=function(a){return{descr:"nothing"}};Objective.PickUpFood=function(){Objective.CatchSomething.call(this,"explanation_catchFood")};inherits(Objective.CatchSomething,Objective.PickUpFood);Objective.PickUpFood.prototype.askSomething=function(a){return a.askForFood()};Objective.PickUpDrink=function(){Objective.CatchSomething.call(this,"explanation_catchDrink")};inherits(Objective.CatchSomething,Objective.PickUpDrink);Objective.PickUpDrink.prototype.askSomething=function(a){return a.askForDrink()};Objective.AskSomething=function(a){Objective.AskForFood.call(this);this.keyExplanation=a};inherits(Objective.AskForFood,Objective.AskSomething);Objective.AskSomething.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos(this.keyExplanation,a)};Objective.AskForDrink=function(){Objective.AskForFood.call(this)};inherits(Objective.AskForFood,Objective.AskForDrink);Objective.AskForDrink.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_askForDrink",a)};Objective.AskHasThirsty=function(){Objective.AskForFood.call(this)};inherits(Objective.AskForFood,Objective.AskHasThirsty);Objective.AskHasThirsty.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_askHasThirsty",a)};Objective.Deliver=function(){};Objective.Deliver.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.Deliver.prototype.checkObjective=function(a,b){var c=null;if(b.place==="counter"){if(a.allCustomers){c=CustomerManager.getCustomerCounter(b.pos)}else{if(a.customer.currentNode.id===CustOpt.counter[b.pos-1]){c=a.customer}}}if(c==null){return false}return !(c.hasThirsty()||c.hasHunger())};Objective.Deliver.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_deliver",a)};Objective.DeliverGifts=function(){};Objective.DeliverGifts.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.value=a.getAttribute("value");b.gift=a.getAttribute("gift");return b};Objective.DeliverGifts.prototype.checkObjective=function(options,objective){var cust=null;if(objective.place==="counter"){if(options.allCustomers){cust=CustomerManager.getCustomerCounter(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.counter[objective.pos-1]){cust=options.customer}}}if(cust==null){return false}var typeOfGift=eval(objective.value);if(typeOfGift===""){for(var i=0;i<cust.deliveredItems.length;i++){if(cust.deliveredItems[i].source==null){return false}}return true}return(cust.hasReceivedGift(typeOfGift))};Objective.DeliverGifts.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_delivergifts",a,a.gift)};Objective.CustomDeliver=function(){};Objective.CustomDeliver.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.value=a.getAttribute("value");b.text=a.getAttribute("text");b.fullText=a.getAttribute("fullText");return b};Objective.CustomDeliver.prototype.checkObjective=function(options,objective){var cust=null;if(objective.place==="counter"){if(options.allCustomers){cust=CustomerManager.getCustomerCounter(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.counter[objective.pos-1]){cust=options.customer}}}else{if(objective.place==="table"){if(options.allCustomers){cust=CustomerManager.getCustomerTable(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.table[objective.pos-1]){cust=options.customer}}}}if(cust==null){return false}var typeOfItem=eval(objective.value);if(typeOfItem===""){return(cust.fUnfulfilled==0)&&(cust.dUnfulfilled==0)}var foodOrDrink=null;var itemId=typeOfItem;if(typeOfItem.indexOf("#")>0){var ti=typeOfItem.split("#");foodOrDrink=ti[0];itemId=ti[1]}return(cust.hasReceivedItem(foodOrDrink,itemId))};Objective.CustomDeliver.prototype.createExplanationItem=function(a){if(a.fullText==="true"){return a.text}return Objective.createExplanationItemPlacePos("explanation_customdeliver",a,a.text)};Objective.Conditional=function(){};Objective.Conditional.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.condition=a.getAttribute("condition");b.text=a.getAttribute("text");return b};Objective.Conditional.prototype.checkObjective=function(options,objective){return eval(objective.condition)};Objective.Conditional.prototype.createExplanationItem=function(a){return a.text};Objective.CashIn=function(){};Objective.CashIn.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.CashIn.prototype.checkObjective=function(a,b){var c=null;if(b.place==="counter"){if(a.allCustomers){c=CustomerManager.getCustomerCounter(b.pos)}else{if(a.customer.currentNode.id===CustOpt.counter[b.pos-1]){c=a.customer}}}if(c==null){return false}return(c.isPaid())};Objective.CashIn.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_cashin",a)};Objective.GiveTheWholeChange=function(){};Objective.GiveTheWholeChange.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");return b};Objective.GiveTheWholeChange.prototype.checkObjective=function(a,b){var c=null;if(b.place==="counter"){if(a.allCustomers){c=CustomerManager.getCustomerCounter(b.pos)}else{if(a.customer.currentNode.id===CustOpt.counter[b.pos-1]){c=a.customer}}}if(c==null){return false}return(c.isPaid()&&c.isChangeReceived()&&c.isTheBestChange())};Objective.GiveTheWholeChange.prototype.createExplanationItem=function(a){return Objective.createExplanationItemPlacePos("explanation_givethewholechange",a)};Objective.GiveSomeChange=function(){};Objective.GiveSomeChange.prototype.init=function(a){var b=Objective.init(a,this);b.pos=a.getAttribute("pos");b.place=a.getAttribute("place");b.type=a.getAttribute("type");b.qtd=a.getAttribute("qtd");return b};Objective.GiveSomeChange.prototype.checkObjective=function(options,objective){var cust=null;if(objective.place==="counter"){if(options.allCustomers){cust=CustomerManager.getCustomerCounter(objective.pos)}else{if(options.customer.currentNode.id===CustOpt.counter[objective.pos-1]){cust=options.customer}}}if(cust==null){return false}var q=eval(objective.qtd);return(cust.isPaid()&&cust.receivedChange('"'+objective.type+'"',q))};Objective.GiveSomeChange.prototype.createExplanationItem=function(c){var b="",a="";if(c.type==="$$$money20"){b="_banknotes";a=20}else{if(c.type==="$$$money10"){b="_banknotes";a=10}else{if(c.type==="$$$money5"){b="_banknotes";a=5}else{if(c.type==="$$$money2"){b="_coins";a=2}else{b="_coins";a=1}}}}return Objective.createExplanationItemPlacePos("explanation_givesomechange",c,BlocklyApps.getMsg(b),a)};Objective.VarQtd=function(){};Objective.VarQtd.prototype.init=function(b){var a={objective:"varQtd",achieved:false,trata:this};a.qtd=b;return a};Objective.VarQtd.prototype.checkObjective=function(a,b){return(Game.jsInterpreter.variables.length-1)<=b.qtd};Objective.VarQtd.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_varQtd");return b.format(a.qtd)};Objective.CommsQtd=function(){};Objective.CommsQtd.prototype.init=function(b){var a={objective:"commQtd",achieved:false,trata:this};a.qtd=b;return a};Objective.CommsQtd.prototype.checkObjective=function(a,b){var c=Game.editor.countInstructions();return c<=b.qtd};Objective.CommsQtd.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_commsQtd");return b.format(a.qtd)};Objective.Talk=function(){};Objective.Talk.prototype.init=function(a){var b=Objective.init(a,this);b.text=a.getAttribute("text");b.value=a.getAttribute("value");b.type=a.getAttribute("type");return b};Objective.Talk.prototype.checkObjective=function(options,objective){var value=eval(objective.value);if(objective.type!==null){if(Array.isArray(options.data)&&objective.type==="array"){if(value.indexOf("##")>-1){value=value.split("##");if(value.length!==options.data.length){return false}}for(var i=0;i<options.data.length;i++){if(JSON.stringify(options.data[i])!==value[i]+""){return false}}return true}}return value===options.data};Objective.Talk.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_talk");return b.format(a.text)};Objective.CountTalk=function(){};Objective.CountTalk.prototype.init=function(b){var a={objective:"countTalk",achieved:false,trata:this};a.qtd=b;a.count=0;return a};Objective.CountTalk.prototype.reset=function(a){a.count=0};Objective.CountTalk.prototype.checkObjective=function(a,b){if(a&&a.allCustomers){return b.count<=b.qtd}b.count++;return false};Objective.CountTalk.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_counttalk");return b.format(a.qtd)};Objective.UseBlock=function(){};Objective.UseBlock.prototype.init=function(a){var b=Objective.init(a,this);b.type=a.getAttribute("type");b.value=a.getAttribute("value");return b};Objective.UseBlock.prototype.checkObjective=function(a,b){if(b.value!=null){if(!(b.value===a.value)){return false}}return(b.type===a.type)};Objective.UseBlock.prototype.createExplanationItem=function(a){var c=BlocklyApps.getMsg("explanation_useblock");var b=(a.value!=null?" ["+a.value+"]":"");return c.format(BlocklyApps.getMsg("descr_"+a.type)+b)};Objective.TotalOfSell=function(){};Objective.TotalOfSell.prototype.init=function(a){var b=Objective.init(a,this);b.value=parseInt(a.getAttribute("value"));b.current=0;return b};Objective.TotalOfSell.prototype.reset=function(a){a.current=0};Objective.TotalOfSell.prototype.checkObjective=function(a,b){b.current+=a.value;return(b.current>=b.value)};Objective.TotalOfSell.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_sellobjective");return b.format(a.value)};Objective.CallTimes=function(){};Objective.CallTimes.prototype.init=function(a){var b=Objective.init(a,this);b.block=a.getAttribute("block");b.times=parseInt(a.getAttribute("times"));return b};Objective.CallTimes.prototype.reset=function(a){Game.callTimes={}};Objective.CallTimes.prototype.checkObjective=function(a,b){var c=Game.callTimes[b.block];c=(c===undefined?0:c);return(c<=b.times)};Objective.CallTimes.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_callTimesObjective");return b.format(a.block,a.times)};Objective.Ordered=function(){};Objective.Ordered.prototype.init=function(){var a={objective:"ordered",achieved:false,trata:this,achievedOrder:0};return a};Objective.Ordered.prototype.reset=function(a){a.achievedOrder=hero.objective.objectives.length-1};Objective.Ordered.prototype.checkObjective=function(a,c){if(!hero.objective.ordered){return true}var d=-1;for(var b=0;b<hero.objective.objectives.length-1;b++){if(!(hero.objective.objectives[b].achievedOrder===d+1)){return false}d=hero.objective.objectives[b].achievedOrder}return true};Objective.Ordered.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_ordered");return b};Objective.Music=function(){};Objective.Music.prototype.init=function(a){var b={objective:"music",achieved:false,trata:this,achievedOrder:0};b.status=a.getAttribute("status");return b};Objective.Music.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_music");return b.format(BlocklyApps.getMsg("explanation_"+a.status))};Objective.Music.prototype.checkObjective=function(a,b){return a.status===b.status};Objective.ClickMission=function(){};Objective.ClickMission.prototype.init=function(a){var b={objective:"clickMission",achieved:false,trata:this,achievedOrder:0};b.missionId=parseInt(a.getAttribute("missionId"));return b};Objective.ClickMission.prototype.createExplanationItem=function(a){var b=BlocklyApps.getMsg("explanation_clickmission");return b.format(a.missionId)};Objective.ClickMission.prototype.checkObjective=function(a,b){return a.missionId===b.missionId};"use strict";var Questionnaire={};Questionnaire.createForm=function(questionnaire){var form=document.createElement("form");var div=document.createElement("div");div.style.height="480px";div.style.overflow="scroll";div.id="questions";var table=document.createElement("table");div.appendChild(table);form.appendChild(div);var input=document.createElement("input");var questionNumber=1;var missions=Game.loginData.missionHist;for(var j=0;j<questionnaire.length;j++){if(missions!=null&&questionnaire[j].showRules!=null){Game.finishedMissionId=0;for(var i=missions.length-1;i>=0;i--){if(questionnaire[j].classId==missions[i][4]){Game.finishedMissionId+=missions[i][3]}}var condition=eval(questionnaire[j].showRules);if(!condition){continue}}var trQ=document.createElement("tr");var tdQ=document.createElement("td");tdQ.className="questionnaireDiv";trQ.appendChild(tdQ);tdQ.innerHTML=questionnaire[j].description;table.appendChild(trQ);for(var i=0;i<questionnaire[j].questions.length;i++){var tr=document.createElement("tr");if(questionnaire[j].questions[i].type[0].toUpperCase()!="L"){tr.setAttribute("questionId",questionnaire[j].questions[i].id)}var td=document.createElement("td");tr.appendChild(td);if(questionnaire[j].questions[i].type[0].toUpperCase()!="L"){td.innerHTML="<b>"+(questionNumber++)+"</b> - "+questionnaire[j].questions[i].description}else{td.innerHTML="<b>"+(questionNumber++)+"</b> - "}td=document.createElement("td");tr.appendChild(td);table.appendChild(tr);tr=document.createElement("tr");if(questionnaire[j].questions[i].type[0].toUpperCase()!="L"){tr.setAttribute("questionId",questionnaire[j].questions[i].id)}td=document.createElement("td");switch(questionnaire[j].questions[i].type[0].toUpperCase()){case"N":input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="number";input.min="0";input.max="130";input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype",questionnaire[j].questions[i].type[0].toUpperCase());input.onkeypress=function(event){return((event.charCode>=48&&event.charCode<=57)||event.charCode==0)};input.addEventListener("change",Questionnaire.closeDrop,false);td.appendChild(input);break;case"S":var identifier="a";for(var x=0;x<questionnaire[j].questions[i].options.length;x++){input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="radio";input.value=questionnaire[j].questions[i].options[x].value;input.id=questionnaire[j].id+"_"+questionnaire[j].questions[i].id+"_"+x;input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype",questionnaire[j].questions[i].type[0].toUpperCase());input.addEventListener("change",Questionnaire.closeDrop,false);var label=document.createElement("label");label.innerHTML=identifier+") ";identifier=Questionnaire.nextChar(identifier);td.appendChild(label);td.appendChild(input);label=document.createElement("label");label.htmlFor=input.id;label.innerHTML=questionnaire[j].questions[i].options[x].description;td.appendChild(label);var br=document.createElement("br");td.appendChild(br)}break;case"T":if(questionnaire[j].questions[i].type.length==1){input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="text";input.style.width="100%";input.maxLength="150";input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.addEventListener("change",Questionnaire.closeDrop,false);input.setAttribute("qtype","T");td.appendChild(input)}else{var cont=questionnaire[j].questions[i].type.substring(1,questionnaire[j].questions[i].type.length);var identifier="a";var maxLen=Math.floor(150/cont);for(var x=0;x<cont;x++){input=document.createElement("input");input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.type="text";input.style.width="300px";input.maxLength=maxLen;input.style.marginTop="5px";input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype","T");input.addEventListener("change",Questionnaire.closeDrop,false);var label=document.createElement("label");label.innerHTML=identifier+") ";identifier=Questionnaire.nextChar(identifier);td.appendChild(label);td.appendChild(input);var br=document.createElement("br");td.appendChild(br)}}break;case"L":var box=document.createElement("table");box.style.borderWidth="1px";box.style.borderCollapse="collapse";box.border="1";var boxHead=document.createElement("thead");var boxTr=document.createElement("tr");var boxTd=document.createElement("td");boxTr.appendChild(boxTd);var options=questionnaire[j].questions[i].options;if(questionnaire[j].questions[i].options!=null){for(var x=0;x<questionnaire[j].questions[i].options.length;x++){boxTd=document.createElement("th");boxTd.style.textAlign="center";boxTd.style.padding="5px";boxTd.innerHTML=questionnaire[j].questions[i].options[x].description;boxTr.appendChild(boxTd);boxHead.appendChild(boxTr)}}var boxBody=document.createElement("tbody");while(i<questionnaire[j].questions.length&&questionnaire[j].questions[i].type[0].toUpperCase()==="L"){boxTr=document.createElement("tr");boxTr.setAttribute("questionId",questionnaire[j].questions[i].id);boxTd=document.createElement("td");boxTd.innerHTML=questionnaire[j].questions[i].description;boxTd.style.padding="5px";boxTr.appendChild(boxTd);for(var x=0;x<options.length;x++){boxTd=document.createElement("td");boxTd.style.textAlign="center";input=document.createElement("input");input.type="radio";input.setAttribute("questionId",questionnaire[j].questions[i].id);input.className="answer";input.name=questionnaire[j].id+"_"+questionnaire[j].questions[i].id;input.setAttribute("questionrequired",new String(questionnaire[j].questions[i].required).toUpperCase());input.setAttribute("qtype",questionnaire[j].questions[i].type[0].toUpperCase());input.addEventListener("change",Questionnaire.closeDrop,false);input.id=questionnaire[j].id+"_"+questionnaire[j].questions[i].id+"_"+x;input.value=options[x].value;boxTd.appendChild(input);boxTr.appendChild(boxTd);boxBody.appendChild(boxTr)}i++}i--;box.appendChild(boxHead);box.appendChild(boxBody);td.appendChild(box);break;default:}tr.appendChild(td);table.appendChild(tr)}}if(questionNumber==1){return null}else{return form}};Questionnaire.closeDrop=function(){if(Questionnaire.drop!=null&&Questionnaire.drop!=undefined){Questionnaire.drop.remove();Questionnaire.drop=null}};Questionnaire.nextChar=function(a){return String.fromCharCode(a.charCodeAt(0)+1)};Questionnaire.handlingQuestionnaire=function(a){var e=document.getElementsByClassName("answer");var h=[];for(var d=0;d<e.length;d++){var k=e[d];var j=k.name.split("_")[0];var b=k.name.split("_")[1];switch(k.getAttribute("qtype").toUpperCase()){case"N":h.push([j,b,k.value]);break;case"L":case"S":var g=document.getElementsByName(k.name);for(var f=0;f<g.length;f++){if(g[f].checked){h.push([j,b,g[f].value])}if(f!=g.length-1){d++}}break;case"T":var g=document.getElementsByName(k.name);var c="";for(var f=0;f<g.length;f++){if(g[f].value!=""){c=c+"<answer><![CDATA["+g[f].value+"]]></answer>"}if(f!=g.length-1){d++}}if(c.length>0){h.push([j,b,c])}break;default:}}a(h)};Questionnaire.consistQuestionnaire=function(){Questionnaire.closeDrop();var c=false;var d=document.getElementsByClassName("answer");for(var b=0;b<d.length;b++){var n=d[b];var m=n.name.split("_")[0];var a=n.name.split("_")[1];var k=false;var l=n.getAttribute("qtype").toUpperCase();switch(l){case"N":if(n.getAttribute("questionrequired").toUpperCase()=="TRUE"){if(n.value!=""){k=true}}else{k=true}break;case"L":case"S":var j=document.getElementsByName(n.name);if(j[0].getAttribute("questionrequired").toUpperCase()=="TRUE"){for(var g=0;g<j.length;g++){if(j[g].checked){k=true}if(g!=j.length-1){b++}}}else{k=true}break;case"T":var j=document.getElementsByName(n.name);if(j[0].getAttribute("questionrequired").toUpperCase()=="TRUE"){for(var g=0;g<j.length;g++){if(j[g].value==""){break}if(g!=j.length-1){b++}k=true}}else{k=true}break}if(!k){c=true;var e=Questionnaire.getTrsByQuestionId(a);for(var g=0;g<e.length;g++){e[g].style.color="red"}var f=Questionnaire.getInputByQuestionId(a);f.focus();if(f.type=="radio"){if((f.labels!=undefined&&f.labels.length>0)||(f.previousElementSibling!=null&&f.previousElementSibling.nodeName.toUpperCase()=="LABEL")){f=f.parentElement}else{f=Questionnaire.getTrsByQuestionId(a)[0].childNodes[0]}}Questionnaire.drop=new Drop({target:f,content:BlocklyApps.getMsg("NoBugs_requiredField"),position:"left middle",classes:"drop-theme-arrows",openOn:""});Questionnaire.drop.open();return}else{var h=Questionnaire.getTrsByQuestionId(a);for(var g=0;g<h.length;g++){h[g].style.color="black"}}}return !c};Questionnaire.getTrsByQuestionId=function(a){var d=[];var c=document.getElementsByTagName("tr");for(var b=0;b<c.length;b++){if(c[b].getAttribute("questionId")==a){d.push(c[b])}}return d};Questionnaire.getInputByQuestionId=function(a){var c=document.getElementsByClassName("answer");for(var b=0;b<c.length;b++){if(c[b].getAttribute("questionId")==a){return c[b]}}return null};"use strict";var VariableNames={};VariableNames.regex=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|null|this|true|void|with|break|catch|class|const|false|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[\x24A-Z\x5Fa-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC][\x240-9A-Z\x5Fa-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0\u08A2-\u08AC\u08E4-\u08FE\u0900-\u0963\u0966-\u096F\u0971-\u0977\u0979-\u097F\u0981-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C01-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C82\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191C\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1D00-\u1DE6\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA697\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A\uAA7B\uAA80-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE26\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]*$/;VariableNames.validate=function(a){var b=Blockly.Variables.procVariables(Game.sourceBlock_);return VariableNames.regex.test(a)&&b.indexOf(a)==-1};"use strict";var Selector={};Selector=function(e,f,b,m,d,c,g,a,l,h,k,i,n,j){this.data=e;this.clickTarget=l;this.genContent=h;this.enabledCssClass=d;this.disabledCssClass=c;this.freeAccessCssClass=j;this.generalTabCss=g;this.tabCss=a;this.fMissionEnabled=k;this.fMissionTarget=i;this.fMissionFreeAccess=n;this.width=b;this.height=m;this.tamCell=f;this.clickTargetEnabled=null};Selector.prototype.build=function(){var t=this.data;if(document.getElementById("tt0")!=null){$("#tt0").remove()}var p=0;var f=true;var c="body";var l="tt"+p;var s=$('<div id = "'+l+'"/>').addClass("tab-container").appendTo(c);var g=$("<ul>").addClass(this.generalTabCss).appendTo(s);var m="";var a=0;var n="";for(var o=0;o<t[p].levels.length;o++){var k="selectMissionPanel"+p+o;$('<div id = "'+k+'"/>').addClass("selectMissionPanel").appendTo(s);var q=parseInt(t[p].levels[o].howManyItems);var b=parseInt((f?t[p].levels[o].howManyItemsAchieved:"-1"));var h=$('<li id = "l'+k+'"/>').addClass(this.tabCss).appendTo(g);$("<a/>").attr("href","#"+k).appendTo(h).html(t[p].levels[o].name);if(n===""){n="li#l"+k}if(b<q&&f){m="li#l"+k;a=o}t[p].levels[o].lastAllAchieved=f;this.createGridView(p,o,"#"+k,q,b,t[p].groupId,t[p].levels[o].id);f=b==q}$("#"+l).easytabs({defaultTab:(m===""?n:m),updateHash:false});this.tabSelected=a;if(t[p].levels.length>3){var d=Math.floor(a/3);var r=$("<button id='previousSetOfTab'/>").css("min-width","2em").css("padding","0px").css("background-color","transparent").css("display",(d==0?"none":"")).appendTo(g);$("<img>").attr("src","images/talkprevious.png").css("width","20px").appendTo(r);$("#previousSetOfTab").unbind("click").click(this.previousTabs.bind(this));var e=$("<button id='nextSetOfTab'/>").css("min-width","2em").css("padding","0px").css("background-color","transparent").css("display",(d==Math.floor(t[p].levels.length/3)?"none":"")).appendTo(g);$("<img>").attr("src","images/talknext.png").css("width","20px").appendTo(e);$("#nextSetOfTab").unbind("click").click(this.nextTabs.bind(this));for(var o=0;o<d*3;o++){$("#lselectMissionPanel"+p+o).css("display","none")}for(var o=(d+1)*3;o<t[p].levels.length;o++){$("#lselectMissionPanel"+p+o).css("display","none")}}return("tt0")};Selector.prototype.previousTabs=function(){this.goToTabs((Math.floor(this.tabSelected/3)*3)-3)};Selector.prototype.nextTabs=function(){this.goToTabs((Math.floor(this.tabSelected/3)*3)+3)};Selector.prototype.goToTabs=function(a){var e=Math.floor(this.tabSelected/3);var d=e*3;var c=0;for(var b=0;b<3;b++){$("#lselectMissionPanel0"+(d+b)).css("display","none")}d=a;for(var b=0;b<3&&b<this.data[c].levels.length;b++){$("#lselectMissionPanel0"+(d+b)).css("display","")}if(d==0){$("#previousSetOfTab").css("display","none")}else{$("#previousSetOfTab").css("display","")}if(d+3>=this.data[c].levels.length){$("#nextSetOfTab").css("display","none")}else{$("#nextSetOfTab").css("display","")}this.tabSelected=d;$("#tt0").easytabs("select","selectMissionPanel0"+this.tabSelected)};Selector.prototype.createGridView=function(n,b,k,h,c,e,m){var d=5;for(var g=1;g<=h;g++){var o=Math.floor((g-1)/d);var j=(g-1)%d;var a=$("<div />").attr("id","mission_l"+m+"_m"+g).attr("idgroup",e).attr("iditem",g).attr("idlevel",m).addClass("gridViewChild").addClass("missionSquare").css("height",this.tamCell).css("width",this.tamCell).css("left",(35*j)+10+(j*this.tamCell)).css("top",(35*o)+60+(o*this.tamCell)).html(this.genContent(g));if(this.fMissionEnabled(n,b,g)){a.addClass(this.enabledCssClass);a.addClass("missionEnabled")}else{if(this.fMissionTarget(n,b,g)){var f=true;if(this.fMissionFreeAccess!==undefined){f=!this.fMissionFreeAccess(n,b,g)}if(f){a.addClass(this.disabledCssClass)}else{a.addClass(this.freeAccessCssClass)}a.addClass("missionTarget");a.addClass("missionTargetFlat")}else{a.addClass(this.disabledCssClass);a.addClass("missionDisabled")}}$(k).append(a)}$(".missionTarget").unbind("click").click(this.clickTarget);$(".missionEnabled").unbind("click");if(this.clickTargetEnabled!=null){$(".missionEnabled").click(this.clickTargetEnabled)}};var Baloon={};Baloon.draw=function(l,k,j,e,d){if(l){var h=0,m=0;var c,b,a;if(d){c="baloon_1";b="baloon_2";a="baloon_3";h=k-32}else{c="baloonr_1";b="baloonr_2";a="baloonr_3";h=k+32;m=2}var g=j-30;switch(e.length){case 1:l.drawImage(PreloadImgs.get(c),h,g);l.drawImage(e[0],h+m+5,g+5,20,20);break;case 2:l.drawImage(PreloadImgs.get(b),h,g);for(var f=0;f<e.length;f++){l.drawImage(e[f],h+m+6,g+2+(18*f),18,18)}break;case 3:l.drawImage(PreloadImgs.get(a),h,g);if(d){h+=3}else{h+=10}for(var f=0;f<e.length;f++){l.drawImage(e[f],h+m+5,g+2+(16*f),16,16)}break}}};"use strict";var leaderBoardCreated=false;var version=0;function addTooltip(){if(leaderBoardCreated){return}new Tooltip({target:document.getElementById("leaderpoints"),position:"top left",content:BlocklyApps.getMsg("Tooltip_TabMoney")});new Tooltip({target:document.getElementById("leadertime"),position:"top left",content:BlocklyApps.getMsg("Tooltip_TabTime")});new Tooltip({target:document.getElementById("leaderruns"),position:"top left",content:BlocklyApps.getMsg("Tooltip_TabRun")});new Tooltip({target:document.getElementById("leadercontest"),position:"top left",content:"Entre as miss&#245;es do torneio: ordenado pela quantidade vencida, tentativas e tempo"})}function createTable(a){a.ingrid({height:250,paging:false,resizableCols:false,sorting:false,gridClass:"leaderboard-table",headerClass:"leaderboard-table-header",colWidths:[25,45,250],colClasses:["leaderboard-table-col-position","leaderboard-table-col-picture","leaderboard-table-col-name"]})}function populateLBTables(c,d){var a=$("<tbody/>");var b=1;d.forEach(function(e){var f=$("<tr id = "+c+"_"+e.id+"/>");f.append($("<td>").html((e.pos!==undefined?e.pos:b)));f.append($("<td>").html("<img height='64px' src='userPhoto?u="+e.id+"&v="+version+"'/>"));f.append($("<td>").html(e.name+"<br/>"+e.value));a.append(f);b++});return finishTable(c,a)}function populateContestTable(a,b){b=[{id:Game.loginData.userLogged.id,name:b.name,value:"",pos:b.pos+"&#186;"}];return populateLBTables(a,b)}function finishTable(b,a){var c=$("<table id = "+b+"/>");var d=$("<tr/>");d.append($("<th/>"));d.append($("<th/>"));d.append($("<th/>"));c.append($("<thead/>").append(d));c.append(a);return c}function goToLine(a,b){$(a+" .mCustomScrollbar").mCustomScrollbar("scrollTo",$(b),{scrollInertia:0})}function highlightCurrentUser(a){$(a).addClass("leaderboard-row-me")}function explainTab(d,b,a,c){$("#explaintab").html(BlocklyApps.getMsg("LeaderBoard_"+a.selector.substring(1)))}function createsLeaderBoard(){UserControl.retrieveContest(continueCreating)}function continueCreating(c){if(c[0]){$("#leadercontest").css("display","inline-block")}else{$("#leadercontest").css("display","none")}version++;addTooltip();var b=Game.loginData.leaderBoard;var f=[],e=[],a=[];b.forEach(function(k){f.push({id:k[0],name:k[1],value:k[2]});var j=k[3];var g=Math.floor(j/60);j=j-(g*60);var i;if(g>60){i=Math.floor(g/60);g=g-(i*60);i=i+"h "}else{i=""}e.push({id:k[0],name:k[1],value:i+addZeros(g,2)+"min "+addZeros(j,2)+"s",missionDone:k[5],timeSeconds:k[3]});a.push({id:k[0],name:k[1],value:k[4],missionDone:k[5]})});f.sort(function(h,g){return g.value-h.value});e.sort(function(h,g){var i=g.missionDone-h.missionDone;if(i==0){return h.timeSeconds-g.timeSeconds}else{return i}});a.sort(function(h,g){var i=g.missionDone-h.missionDone;if(i==0){return h.value-g.value}else{return i}});if(leaderBoardCreated){$("#tabs-points").empty();$("#tabs-time").empty();$("#tabs-runs").empty();$("#tabs-contest").empty()}$("#tabs-points").append(populateLBTables("table_points",f));$("#tabs-time").append(populateLBTables("table_time",e));$("#tabs-runs").append(populateLBTables("table_runs",a));if(c[0]){$("#tabs-contest").append(populateContestTable("table_contest",c[1]))}var d="#table_points_"+Game.loginData.userLogged.id;$("#tabs-points").attr("rowId",d);$("#tabs-time").attr("rowId","#table_time_"+Game.loginData.userLogged.id);$("#tabs-runs").attr("rowId","#table_runs_"+Game.loginData.userLogged.id);$("#leaderboard").easytabs({updateHash:false,animate:false});$("#leaderboard").easytabs("select","#tabs-points");$("#leaderboard").bind("easytabs:after",function(h,i,g){goToLine(g.selector,g.attr("rowId"))});$("#leaderboard").bind("easytabs:after",explainTab);createTable($("#table_points"));highlightCurrentUser(d);createTable($("#table_time"));highlightCurrentUser($("#tabs-time").attr("rowId"));createTable($("#table_runs"));highlightCurrentUser($("#tabs-runs").attr("rowId"));if(c[0]){createTable($("#table_contest"))}$(".ingrid > div:nth-child(2)").addClass("mCustomScrollbar").mCustomScrollbar({theme:"nobug"});$(".mCSB_container").css({"margin-right":"0px"});goToLine("#tabs-points",d);leaderBoardCreated=true;$("#explaintab").html(BlocklyApps.getMsg("LeaderBoard_tabs-points"))}function createNoLeaderBoardInfo(){version++;addTooltip();$("#leadercontest").css("display","none");var a=[{id:Game.loginData.userLogged.id,name:BlocklyApps.getMsg("Text_NotEnabledToSeeLeaderBoard").format(Game.loginData.leaderBoard[0][1]),value:""}];if(leaderBoardCreated){$("#tabs-points").empty();$("#tabs-time").empty();$("#tabs-runs").empty()}$("#tabs-points").append(populateLBTables("table_points",a));$("#tabs-time").append(populateLBTables("table_time",a));$("#tabs-runs").append(populateLBTables("table_runs",a));$("#leaderboard").easytabs({updateHash:false,animate:false});$("#leaderboard").easytabs("select","#tabs-points");$("#leaderboard").bind("easytabs:after",explainTab);createTable($("#table_points"));createTable($("#table_time"));createTable($("#table_runs"));$(".ingrid > div:nth-child(2)").addClass("mCustomScrollbar").mCustomScrollbar({theme:"nobug"});leaderBoardCreated=true;$("#explaintab").html(BlocklyApps.getMsg("LeaderBoard_tabs-points"))};PreloadImgs.put("bus","images/bus.png");PreloadImgs.put("city_map1","images/city_map.png");PreloadImgs.put("busback","images/bus_back.png");PreloadImgs.put("middleBuildings","images/middleBuildings.png");PreloadImgs.put("signs","images/signs.png");PreloadImgs.put("blinkSchool","images/blinkSchool.png");PreloadImgs.put("school","images/school.png");PreloadImgs.put("trees","images/trees.png");PreloadImgs.put("carred","images/car_red.png");PreloadImgs.put("carredback","images/car_red_back.png");PreloadImgs.put("cargreen","images/car_green.png");PreloadImgs.put("cargreendown","images/car_green_down.png");var CityMap={};CityMap.init=function(a){CityMap.flagBusDir=false;CityMap.flagCarRedDir=true;CityMap.flagCarGreenDir=false;CityMap.onclick=a.onclick;CityMap.blinkSchool=false;CityMap.bus={left:0,top:100};CityMap.bus.img=new Sprite({ticksPerFrame:1,numberOfFrames:2,horzSeq:true,x:403,y:-73,width:160,height:59,sourceY:0,img:PreloadImgs.get("bus")});CityMap.busBack={left:0,top:100};CityMap.busBack.img=new Sprite({ticksPerFrame:1,numberOfFrames:2,horzSeq:true,x:400,y:212,width:160,height:59,sourceY:0,img:PreloadImgs.get("busback")});CityMap.car_red={left:0,top:100};CityMap.car_red.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:-280,y:-152,width:160,height:59,sourceY:0,img:PreloadImgs.get("carred")});CityMap.car_red_back={left:0,top:100};CityMap.car_red_back.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:-161,y:280,width:160,height:59,sourceY:0,img:PreloadImgs.get("carredback")});CityMap.car_green={left:0,top:100};CityMap.car_green.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:-280,y:-152,width:160,height:59,sourceY:0,img:PreloadImgs.get("cargreen")});CityMap.car_green_down={left:0,top:100};CityMap.car_green_down.img=new Sprite({ticksPerFrame:0,numberOfFrames:2,horzSeq:true,x:703,y:-240,width:160,height:59,sourceY:0,img:PreloadImgs.get("cargreendown")});CityMap.map1=PreloadImgs.get("city_map1");CityMap.middleBuildings=PreloadImgs.get("middleBuildings");CityMap.signs=PreloadImgs.get("signs");CityMap.school_hoover=PreloadImgs.get("blinkSchool");CityMap.school=PreloadImgs.get("school");CityMap.trees=PreloadImgs.get("trees");CityMap.canvas=document.getElementById("city_map");CityMap.canvasCtx=CityMap.canvas.getContext("2d");CityMap.canvas.removeEventListener("mousemove",CityMap.mouseMove);CityMap.canvas.removeEventListener("click",CityMap.click);CityMap.canvas.addEventListener("mousemove",CityMap.mouseMove,false);CityMap.canvas.addEventListener("click",CityMap.click,false)};CityMap.mouseMove=function(b){var a=CityMap.getMousePos(b);CityMap.blinkSchool=CityMap.testMouseOver(a.x,a.y)};CityMap.click=function(a){if(CityMap.blinkSchool){CityMap.onclick(a)}};CityMap.getMousePos=function(a){var b=CityMap.canvas.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}};CityMap.testMouseOver=function(a,d){var b=[190,230,233,241,198,172,184,172,160,142,159,160];var c=[163,187,228,233,262,250,238,232,241,229,216,178];return CityMap.pnpoly(b.length,b,c,a,d)};CityMap.pnpoly=function(b,g,f,a,k){var e,d,h=false;for(e=0,d=b-1;e<b;d=e++){if(((f[e]>k)!=(f[d]>k))&&(a<(g[d]-g[e])*(k-f[e])/(f[d]-f[e])+g[e])){h=!h}}return h};CityMap.startAnimation=function(){CityMap.animate=true;window.setTimeout(CityMap.animateMap,75)};CityMap.stopAnimation=function(){CityMap.animate=false};CityMap.animateMap=function(){if(!CityMap.animate){return}CityMap.canvas.style.cursor=(CityMap.blinkSchool?"pointer":"default");CityMap.canvasCtx.drawImage((CityMap.map1),0,0,400,300);CityMap.animateBus();CityMap.animateCarRed();CityMap.animateCarGreen();CityMap.canvasCtx.drawImage((CityMap.signs),0,0,400,300);CityMap.canvasCtx.drawImage((CityMap.middleBuildings),0,0,400,300);CityMap.canvasCtx.drawImage((CityMap.trees),0,0,400,300);CityMap.canvasCtx.drawImage((CityMap.blinkSchool?CityMap.school_hoover:CityMap.school),0,0,400,300);window.setTimeout(CityMap.animateMap,75)};CityMap.animateBus=function(){if(!CityMap.flagBusDir){CityMap.bus.img.draw(CityMap.canvasCtx);CityMap.bus.img.update();CityMap.flagBusDir=(CityMap.bus.img.x+CityMap.bus.img.width)>0?false:true;CityMap.bus.img.x-=1+Math.cos(60*Math.PI/180);CityMap.bus.img.y+=Math.sin(60*Math.PI/180);CityMap.busBack.img.x=400;CityMap.busBack.img.y=212}else{CityMap.bus.img.x=403;CityMap.bus.img.y=-73;CityMap.busBack.img.draw(CityMap.canvasCtx);CityMap.busBack.img.update();CityMap.flagBusDir=(CityMap.busBack.img.x+CityMap.busBack.img.width)<=0?false:true;CityMap.busBack.img.x-=1+Math.cos(60*Math.PI/180);CityMap.busBack.img.y-=Math.sin(60*Math.PI/180)}};CityMap.animateCarRed=function(){if(!CityMap.flagCarRedDir){CityMap.car_red.img.draw(CityMap.canvasCtx);CityMap.car_red.img.update();CityMap.flagCarRedDir=CityMap.car_red.img.x>=400?true:false;CityMap.car_red.img.x+=1+Math.cos(60*Math.PI/180);CityMap.car_red.img.y+=Math.sin(60*Math.PI/180);CityMap.car_red_back.img.x=-161;CityMap.car_red_back.img.y=280}else{CityMap.car_red.img.x=-280;CityMap.car_red.img.y=-152;CityMap.car_red_back.img.draw(CityMap.canvasCtx);CityMap.car_red_back.img.update();CityMap.flagCarRedDir=CityMap.car_red_back.img.x<=400?true:false;CityMap.car_red_back.img.x+=1+Math.cos(60*Math.PI/180);CityMap.car_red_back.img.y-=Math.sin(60*Math.PI/180)}};CityMap.animateCarGreen=function(){if(!CityMap.flagCarGreenDir){CityMap.car_green.img.draw(CityMap.canvasCtx);CityMap.car_green.img.update();CityMap.flagCarGreenDir=CityMap.car_green.img.x<=400?false:true;CityMap.car_green.img.x+=1+Math.cos(60*Math.PI/180);CityMap.car_green.img.y+=Math.sin(60*Math.PI/180);CityMap.car_green_down.img.x=703;CityMap.car_green_down.img.y=-240}else{CityMap.car_green.img.x=-280;CityMap.car_green.img.y=-152;CityMap.car_green_down.img.draw(CityMap.canvasCtx);CityMap.car_green_down.img.update();CityMap.flagCarGreenDir=(CityMap.car_green_down.img.x+CityMap.car_green_down.img.width)<0?false:true;CityMap.car_green_down.img.x-=1+Math.cos(60*Math.PI/180);CityMap.car_green_down.img.y+=Math.sin(60*Math.PI/180)}};"use strict";var SelectMission={};SelectMission.generateBoard=function(a){$("#selectMissionBoard").empty();var b=false;Game.loginData.missionHist.forEach(function(c){b=b||c[2]!=c[3]});if(!b){MyBlocklyApps.showDialog(document.getElementById("dialogNoMoreMissions"),null,true,true,true,null,{width:"600px"},null);return}SelectMission.finishGenerateBoard()};SelectMission.finishGenerateBoard=function(){var a=SelectMission.missionsRetrieved(Game.loginData.missionHist);$("#selectMissionBoard").append($("#"+a));$("#"+a).append($('<div id="bbLineSeparator">'));Cufon.set("fontFamily","DK Crayon Crumble");Cufon(".bbtabs");var b=function(){$("#selectMissionBoard").empty()};MyBlocklyApps.showDialog(document.getElementById("dialogSelectMission"),null,false,true,true,BlocklyApps.getMsg("Text_SelectMission"),{width:"480px",height:"470px"},null,b);SelectMission.stopAnimation=false;window.setTimeout(SelectMission.blinkTarget,50)};SelectMission.missionsRetrieved=function(b){var r=[];var p=null;var n=[];for(var o=0;o<b.length;o++){var h=null;var q=r.indexOf(b[o][0]);if(q==-1){r.push(b[o][0]);h={group:b[o][0],groupId:b[o][4],levels:[]};n.push(h)}else{h=n[q]}var f={name:b[o][1],id:b[o][5],howManyItems:b[o][2],howManyItemsAchieved:b[o][3],repeateable:[],freeFinishableMission:[],achievedFreeMission:[]};for(var m=0;m<b[o][6].length;m++){f.repeateable.push(b[o][6][m][0]);if(b[o][6][m][1]==1){f.freeFinishableMission.push(b[o][6][m][0])}}if(b[o][7]!==null){f.achievedFreeMission=[].concat(b[o][7])}h.levels.push(f)}var k=function(i){var s=this.getAttribute("idgroup");var t=this.getAttribute("iditem");var l=this.getAttribute("idlevel");var j=function(){$("#selectMissionBoard").empty();MyBlocklyApps.hideDialog(true);SelectMission.stopAnimation=true;Game.missionSelected(s,l,t,p.classList.contains("missionEnabled"))};p=this;if(!this.classList.contains("missionEnabled")){UserControl.verifyContest(s,l,t,function(u){if(u[0]==true){j()}else{alert(u[1]+" "+u[2],null,{height:"200px"})}})}else{j()}};var g=function(l){var s=generateImages(l,2);var j=$.each(s,function(t){s[t]="<img src='images/bb"+this+"' width='16' height='16'/>"});return j};var e=function(u,t,l){if(n[u].levels[t].repeateable.indexOf(l)>-1){if(n[u].levels[t].freeFinishableMission.indexOf(l)>-1){if(n[u].levels[t].achievedFreeMission.indexOf(l)>-1){return true}}return false}var v=parseInt((n[u].levels[t].lastAllAchieved?n[u].levels[t].howManyItemsAchieved:"-1"));var s=v+1;return l<s};var d=function(v,u,s){var l=n[v].levels[u].repeateable.indexOf(s);if(l>-1){return true}var w=parseInt((n[v].levels[u].lastAllAchieved?n[v].levels[u].howManyItemsAchieved:"-1"));var t=w+1;return(l==-1&&s==t)||(l>-1&&s<=t)};var c=function(t,s,l){return(n[t].levels[s].repeateable.indexOf(l)>-1&&n[t].levels[s].freeFinishableMission.indexOf(l)==-1)};var a=new Selector(n,50,385,250,"unlockBack","lockBack","bbtabs","bbtab",k,g,e,d,c,"freeAccessBack");a.clickTargetEnabled=k;return a.build()};SelectMission.blinkTarget=function(){if(SelectMission.stopAnimation){return}$(".missionTargetFlat").addClass("missionTargetBlind").removeClass("missionTargetFlat");window.setTimeout(SelectMission.unblinkTarget,700)};SelectMission.unblinkTarget=function(){if(SelectMission.stopAnimation){return}$(".missionTargetBlind").addClass("missionTargetFlat").removeClass("missionTargetBlind");window.setTimeout(SelectMission.blinkTarget,700)};"use strict";var SelectLevel={};SelectLevel.generateBoard=function(a){for(var d=0;d<Game.loginData.missionHist.length;d++){var e=Game.loginData.missionHist[d];var f=e[8].split("-");var c=new Date(f[0],f[1],f[2]);$("#level_"+(d+1)).removeClass();if(Date.now()>=c){if(e[2]==e[3]){$("#level_"+(d+1)).addClass("levels");var h=$("<div class='levelok' id='levelok_"+(d+1)+"'/>");$("#level_"+(d+1)).append(h)}else{if(e[9]==0){$("#level_"+(d+1)).addClass("levels")}else{var g=Game.loginData.missionHist[e[9]-1];if(g[2]==g[3]){$("#level_"+(d+1)).addClass("levels")}else{$("#level_"+(d+1)).addClass("levels_disabled")}}}}else{$("#level_"+(d+1)).addClass("levels_disabled")}}var b=function(){$("div").remove(".levelok")};$("#selectLevel .levels").unbind("click").click(SelectLevel.levelSelected);MyBlocklyApps.showDialog(document.getElementById("dialogSelecLevel"),null,false,true,true,BlocklyApps.getMsg("Text_SelectLevel"),{width:"750px",height:"530px"},null,b)};SelectLevel.levelSelected=function(b){var a=b.target.id;a=parseInt(a.substring(a.indexOf("_")+1));MyBlocklyApps.hideDialog(false);var e=Game.loginData.missionHist[a-1];var d=false;var c=e[3]+1;if(e[2]==e[3]){d=true;c=1}Game.missionSelected(e[4],e[5],c,d)};var InGrid={};InGrid.emptyLines=function(b){var a=$(b+" tbody");a.empty()};InGrid.loadLines=function(c,b){InGrid.emptyLines(c);var a=$(c+" tbody");b.forEach(function(d){var e=$("<tr/>");e.append($("<td>").html(d.name));e.append($("<td>").html(d.value));a.append(e)})};InGrid.createNewVarTable=function(e){$("#var_content").empty();var b=$("<table>").attr("id","vars");var d=$("<thead>");var c=$("<tr>");c.append($("<th>").html(BlocklyApps.getMsg("NoBugs_VarName")));c.append($("<th>").html(BlocklyApps.getMsg("NoBugs_VarValue")));d.append(c);b.append(d);$("#var_content").append(b);var a=$("<tbody>");e.forEach(function(f){var g=$("<tr/>");g.append($("<td>").html(f.name));g.append($("<td>").html(f.value));a.append(g)});b.append(a)};InGrid.createNewTipTable=function(d,c){$("#tips_content").empty();var b=$("<table>").attr("id","tips");b.addClass("varsgrid").addClass("tipsgrid");$("#tips_content").append(b);var a=$("<tbody>");c.forEach(function(g){var h=$("<tr/>");var j=g.text;var e=g.indent;for(var f=0;f<e;f++){h.append($("<td>").css("background-color","#DDDDDD"))}h.append($("<td>").attr("colspan",(d-e)+1).html(j));a.append(h)});b.append(a)};"use strict";PreloadImgs.put("body","images/cooker-body.png",false);PreloadImgs.put("mouth-M","images/cooker-mouth-m.png",false);PreloadImgs.put("mouth-F","images/cooker-mouth-f.png",false);PreloadImgs.put("eyes-M","images/cooker-eyes-m.png",false);PreloadImgs.put("eyes-M-fundo","images/cooker-eyes-f-fundo.png",false);PreloadImgs.put("eyes-F","images/cooker-eyes-f.png",false);PreloadImgs.put("eyes-F-fundo","images/cooker-eyes-f-fundo.png",false);PreloadImgs.put("head-M","images/cooker-head-m.png",false);PreloadImgs.put("head-F","images/cooker-head-f.png",false);PreloadImgs.put("Hat-1","images/cooker-hat-1.png",false);PreloadImgs.put("Hat-2","images/cooker-hat-2.png",false);PreloadImgs.put("Clothes-1","images/cooker-clothes-1.png",false);PreloadImgs.put("Clothes-1-pants","images/cooker-clothes-1-pants.png",false);PreloadImgs.put("Clothes-1-scarf","images/cooker-clothes-1-scarf.png",false);PreloadImgs.put("Add-1-M","images/cooker-add-1-m.png",false);PreloadImgs.put("Add-2-M","images/cooker-add-2-m.png",false);PreloadImgs.put("Add-3-M","images/cooker-add-3-m.png",false);PreloadImgs.put("Add-1-F","images/cooker-add-1-f.png",false);PreloadImgs.put("Add-2-F","images/cooker-add-2-f.png",false);PreloadImgs.put("Add-3-F","images/cooker-add-3-f.png",false);PreloadImgs.put("mini-body","images/mini-cooker-body.png",false);PreloadImgs.put("mini-mouth-M","images/mini-cooker-mouth-m.png",false);PreloadImgs.put("mini-mouth-F","images/mini-cooker-mouth-f.png",false);PreloadImgs.put("mini-eyes-M","images/mini-cooker-eyes-m.png",false);PreloadImgs.put("mini-eyes-M-fundo","images/mini-cooker-eyes-f-fundo.png",false);PreloadImgs.put("mini-eyes-F","images/mini-cooker-eyes-f.png",false);PreloadImgs.put("mini-eyes-F-fundo","images/mini-cooker-eyes-f-fundo.png",false);PreloadImgs.put("mini-head-M","images/mini-cooker-head-m.png",false);PreloadImgs.put("mini-head-F","images/mini-cooker-head-f.png",false);PreloadImgs.put("mini-Hat-1","images/mini-cooker-hat-1.png",false);PreloadImgs.put("mini-Hat-2","images/mini-cooker-hat-2.png",false);PreloadImgs.put("mini-Clothes-1","images/mini-cooker-clothes-1.png",false);PreloadImgs.put("mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants.png",false);PreloadImgs.put("mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf.png",false);PreloadImgs.put("mini-Add-1-M","images/mini-cooker-add-1-m.png",false);PreloadImgs.put("mini-Add-2-M","images/mini-cooker-add-2-m.png",false);PreloadImgs.put("mini-Add-3-M","images/mini-cooker-add-3-m.png",false);PreloadImgs.put("mini-Add-1-F","images/mini-cooker-add-1-f.png",false);PreloadImgs.put("mini-Add-2-F","images/mini-cooker-add-2-f.png",false);PreloadImgs.put("mini-Add-3-F","images/mini-cooker-add-3-f.png",false);PreloadImgs.put("0#0.mini-Clothes-1","images/mini-cooker-clothes-1-r0c0.png",false);PreloadImgs.put("0#0.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r0c0.png",false);PreloadImgs.put("0#0.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf.png",false);PreloadImgs.put("0#1.mini-Clothes-1","images/mini-cooker-clothes-1.png",false);PreloadImgs.put("0#1.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants.png",false);PreloadImgs.put("0#1.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf.png",false);PreloadImgs.put("0#2.mini-Clothes-1","images/mini-cooker-clothes-1-r0c2.png",false);PreloadImgs.put("0#2.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r0c2.png",false);PreloadImgs.put("0#2.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf.png",false);PreloadImgs.put("0#0.mini-body","images/mini-cooker-body-r0c0.png",false);PreloadImgs.put("0#1.mini-body","images/mini-cooker-body.png",false);PreloadImgs.put("0#2.mini-body","images/mini-cooker-body-r0c2.png",false);PreloadImgs.put("0#0.mini-hand","images/mini-cooker-body-r0c0-hand.png",false);PreloadImgs.put("0#1.mini-hand","",false);PreloadImgs.put("0#2.mini-hand","images/mini-cooker-body-r0c2-hand.png",false);PreloadImgs.put("0.mini-Hat-1","images/mini-cooker-hat-1.png",false);PreloadImgs.put("0.mini-Hat-2","images/mini-cooker-hat-2.png",false);PreloadImgs.put("1#0.mini-Clothes-1","images/mini-cooker-clothes-1-r1c0.png",false);PreloadImgs.put("1#0.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r1c0.png",false);PreloadImgs.put("1#0.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf-r1.png",false);PreloadImgs.put("1#1.mini-Clothes-1","images/mini-cooker-clothes-1-r1c1.png",false);PreloadImgs.put("1#1.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r1c1.png",false);PreloadImgs.put("1#1.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf-r1.png",false);PreloadImgs.put("1#2.mini-Clothes-1","images/mini-cooker-clothes-1-r1c2.png",false);PreloadImgs.put("1#2.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r1c2.png",false);PreloadImgs.put("1#2.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf-r1.png",false);PreloadImgs.put("1#0.mini-body","",false);PreloadImgs.put("1#1.mini-body","",false);PreloadImgs.put("1#2.mini-body","",false);PreloadImgs.put("1#0.mini-hand","images/mini-cooker-body-r1c0-hand.png",false);PreloadImgs.put("1#1.mini-hand","images/mini-cooker-body-r1c1-hand.png",false);PreloadImgs.put("1#2.mini-hand","images/mini-cooker-body-r1c2-hand.png",false);PreloadImgs.put("1.mini-mouth-M","images/mini-cooker-mouth-m-r1.png",false);PreloadImgs.put("1.mini-mouth-F","images/mini-cooker-mouth-f-r1.png",false);PreloadImgs.put("1.mini-head","images/mini-cooker-head-r1.png",false);PreloadImgs.put("1.mini-eyes-M","images/mini-cooker-eyes-m-r1.png",false);PreloadImgs.put("1.mini-eyes-F","images/mini-cooker-eyes-f-r1.png",false);PreloadImgs.put("1.mini-eyes-M-fundo","images/mini-cooker-eyes-f-r1-fundo.png",false);PreloadImgs.put("1.mini-eyes-F-fundo","images/mini-cooker-eyes-f-r1-fundo.png",false);PreloadImgs.put("1.mini-Hat-1","images/mini-cooker-hat-1-r1.png",false);PreloadImgs.put("1.mini-Hat-2","images/mini-cooker-hat-2-r1.png",false);PreloadImgs.put("1.mini-Add-1-M","images/mini-cooker-add-1-m-r1.png",false);PreloadImgs.put("1.mini-Add-2-M","images/mini-cooker-add-2-m-r1.png",false);PreloadImgs.put("1.mini-Add-3-M","images/mini-cooker-add-3-m-r1.png",false);PreloadImgs.put("1.mini-Add-1-F","images/mini-cooker-add-1-f-r1.png",false);PreloadImgs.put("1.mini-Add-2-F","images/mini-cooker-add-2-f-r1.png",false);PreloadImgs.put("1.mini-Add-3-F","images/mini-cooker-add-3-f-r1.png",false);PreloadImgs.put("2#0.mini-Clothes-1","images/mini-cooker-clothes-1-r2c0.png",false);PreloadImgs.put("2#0.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r2c0.png",false);PreloadImgs.put("2#0.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf-r2.png",false);PreloadImgs.put("2#1.mini-Clothes-1","images/mini-cooker-clothes-1-r2c1.png",false);PreloadImgs.put("2#1.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r2c1.png",false);PreloadImgs.put("2#1.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf-r2.png",false);PreloadImgs.put("2#2.mini-Clothes-1","images/mini-cooker-clothes-1-r2c2.png",false);PreloadImgs.put("2#2.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r2c2.png",false);PreloadImgs.put("2#2.mini-Clothes-1-scarf","images/mini-cooker-clothes-1-scarf-r2.png",false);PreloadImgs.put("2#0.mini-body","",false);PreloadImgs.put("2#1.mini-body","",false);PreloadImgs.put("2#2.mini-body","",false);PreloadImgs.put("2#0.mini-hand","images/mini-cooker-body-r2c0-hand.png",false);PreloadImgs.put("2#1.mini-hand","images/mini-cooker-body-r2c1-hand.png",false);PreloadImgs.put("2#2.mini-hand","images/mini-cooker-body-r2c2-hand.png",false);PreloadImgs.put("2.mini-mouth-M","images/mini-cooker-mouth-m-r2.png",false);PreloadImgs.put("2.mini-mouth-F","images/mini-cooker-mouth-f-r2.png",false);PreloadImgs.put("2.mini-head","images/mini-cooker-head-r2.png",false);PreloadImgs.put("2.mini-eyes-M","images/mini-cooker-eyes-m-r2.png",false);PreloadImgs.put("2.mini-eyes-M-fundo","images/mini-cooker-eyes-m-r2-fundo.png",false);PreloadImgs.put("2.mini-eyes-F","images/mini-cooker-eyes-f-r2.png",false);PreloadImgs.put("2.mini-eyes-F-fundo","images/mini-cooker-eyes-f-r2-fundo.png",false);PreloadImgs.put("2.mini-Hat-1","images/mini-cooker-hat-1-r2.png",false);PreloadImgs.put("2.mini-Hat-2","images/mini-cooker-hat-2-r2.png",false);PreloadImgs.put("2.mini-Add-1-M","images/mini-cooker-add-1-m-r2.png",false);PreloadImgs.put("2.mini-Add-2-M","images/mini-cooker-add-2-m-r2.png",false);PreloadImgs.put("2.mini-Add-3-M","images/mini-cooker-add-3-m-r2.png",false);PreloadImgs.put("2.mini-Add-1-F","images/mini-cooker-add-1-f-r2.png",false);PreloadImgs.put("2.mini-Add-2-F","images/mini-cooker-add-2-f-r2.png",false);PreloadImgs.put("2.mini-Add-3-F","images/mini-cooker-add-3-f-r2.png",false);PreloadImgs.put("3#0.mini-Clothes-1","images/mini-cooker-clothes-1-r3c0.png",false);PreloadImgs.put("3#0.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r0c0.png",false);PreloadImgs.put("3#0.mini-Clothes-1-scarf","",false);PreloadImgs.put("3#1.mini-Clothes-1","images/mini-cooker-clothes-1-r3c1.png",false);PreloadImgs.put("3#1.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants.png",false);PreloadImgs.put("3#1.mini-Clothes-1-scarf","",false);PreloadImgs.put("3#2.mini-Clothes-1","images/mini-cooker-clothes-1-r3c2.png",false);PreloadImgs.put("3#2.mini-Clothes-1-pants","images/mini-cooker-clothes-1-pants-r0c2.png",false);PreloadImgs.put("3#2.mini-Clothes-1-scarf","",false);PreloadImgs.put("3#0.mini-body","images/mini-cooker-body-r0c0.png",false);PreloadImgs.put("3#1.mini-body","images/mini-cooker-body.png",false);PreloadImgs.put("3#2.mini-body","images/mini-cooker-body-r0c2.png",false);PreloadImgs.put("3.mini-head","images/mini-cooker-head-r3.png",false);PreloadImgs.put("3#0.mini-hand","",false);PreloadImgs.put("3#1.mini-hand","",false);PreloadImgs.put("3#2.mini-hand","",false);PreloadImgs.put("3.mini-eyes-F","",false);PreloadImgs.put("3.mini-eyes-M","",false);PreloadImgs.put("3.mini-Hat-1","images/mini-cooker-hat-1-r3.png",false);PreloadImgs.put("3.mini-Hat-2","images/mini-cooker-hat-2-r3.png",false);PreloadImgs.put("3.mini-Add-1-M","",false);PreloadImgs.put("3.mini-Add-2-M","",false);PreloadImgs.put("3.mini-Add-3-M","",false);PreloadImgs.put("3.mini-Add-1-F","images/mini-cooker-add-1-f-r3.png",false);PreloadImgs.put("3.mini-Add-2-F","images/mini-cooker-add-2-f-r3.png",false);PreloadImgs.put("3.mini-Add-3-F","images/mini-cooker-add-3-f-r3.png",false);PreloadImgs.put("0#0.mini-platter","images/platter-r0.png",false);PreloadImgs.put("0#1.mini-platter","images/platter-r0.png",false);PreloadImgs.put("0#2.mini-platter","images/platter-r0c2.png",false);PreloadImgs.put("1#0.mini-platter","images/platter-r0.png",false);PreloadImgs.put("1#1.mini-platter","images/platter-r0.png",false);PreloadImgs.put("1#2.mini-platter","images/platter-r0.png",false);PreloadImgs.put("2#0.mini-platter","images/platter-r2c0.png",false);PreloadImgs.put("2#1.mini-platter","images/platter-r2c1.png",false);PreloadImgs.put("2#2.mini-platter","images/platter-r2c2.png",false);PreloadImgs.put("3#0.mini-platter","images/platter-r0.png",false);PreloadImgs.put("3#1.mini-platter","images/platter-r0.png",false);PreloadImgs.put("3#2.mini-platter","images/platter-r0.png",false);var AvatarEditor={};var AvatarImgMaker={};var ae_Width=288,ae_Height=401,ae_TopHead=118;var mae_Width=50,mae_Height=91;function filterChangeColor(t,s,l,q,j,c){var f=t.getImageData(0,0,s,l);var o=null;if(c!=undefined){o=c.getImageData(0,0,s,l)}else{c=t;o=f}var e=j;for(var k=0;k<f.data.length;k+=4){if(f.data[k+3]<50){continue}var a=f.data[k];var m=f.data[k+1];var p=f.data[k+2];var n=Math.sqrt((a-q.r)*(a-q.r)+(m-q.g)*(m-q.g)+(p-q.b)*(p-q.b));if(n<400){o.data[k]=(a/255)*e.r;o.data[k+1]=(m/255)*e.g;o.data[k+2]=(p/255)*e.b}}c.putImageData(o,0,0)}var CreateItems={};CreateItems.hat=function(a,c,b){return{id:c,img:(c===""?c:PreloadImgs.get(a+c)),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:255},color:b}};CreateItems.add=function(b,c,a){return{id:c,img:(c===""?c:PreloadImgs.get(b+c+"-"+AvatarImgMaker.gender)),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:255},color:a}};CreateItems.clothes=function(e,f,c){var a=null;try{a=PreloadImgs.get(e+f+"-pants")}catch(b){}var d={img:PreloadImgs.get(e+f),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:255},color:c,imgBack:a};d.id=f;return d};CreateItems.scarf=function(c,d,a){var b={img:PreloadImgs.get(c+d+"-scarf"),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:255},color:a};return b};CreateItems.mouth=function(a){return{id:"mouth",img:PreloadImgs.get(a+"mouth-"+AvatarImgMaker.gender),x:0,y:0,width:ae_Width,height:ae_Height}};CreateItems.eyes=function(d,b){d+="-"+AvatarImgMaker.gender;var a=null;try{a=PreloadImgs.get(d+"-fundo")}catch(c){}return{img:PreloadImgs.get(d),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:255},color:b,imgBack:a}};CreateItems.head=function(b,a){b=b+"-"+AvatarImgMaker.gender;return{img:PreloadImgs.get(b),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:0},color:a}};CreateItems.body=function(b,a){return{img:PreloadImgs.get(b),x:0,y:0,width:ae_Width,height:ae_Height,baseColor:{r:255,g:255,b:0},color:a}};CreateItems.platter=function(a){return{img:PreloadImgs.get(a),x:0,y:0,width:ae_Width,height:ae_Height}};AvatarImgMaker.init=function(){if(AvatarImgMaker.initialized===true){return}AvatarImgMaker.initialized=true;AvatarImgMaker.canvasTemp=document.getElementById("avatarTemp");AvatarImgMaker.canvasTempCtx=AvatarImgMaker.canvasTemp.getContext("2d");AvatarImgMaker.canvasTemp2=document.getElementById("avatarTemp2");AvatarImgMaker.canvasTemp2Ctx=AvatarImgMaker.canvasTemp2.getContext("2d");AvatarImgMaker.canvas=document.getElementById("avatar");AvatarImgMaker.canvasCtx=AvatarImgMaker.canvas.getContext("2d");AvatarImgMaker.keys=[];AvatarImgMaker.keys.push("body");AvatarImgMaker.keys.push("clothes");AvatarImgMaker.keys.push("scarf");AvatarImgMaker.keys.push("head");AvatarImgMaker.keys.push("eyes");AvatarImgMaker.keys.push("mouth");AvatarImgMaker.keys.push("add");AvatarImgMaker.keys.push("hat")};AvatarImgMaker.configGender=function(a){AvatarImgMaker.gender=a};function cloneArray(b){var a=new Array();b.forEach(function(c){a.push(c.slice())});return a}AvatarImgMaker.createBody=function(e,c,a,d){var b=cloneArray(c);AvatarImgMaker.createItems(b,"");AvatarImgMaker._draw(AvatarImgMaker.canvasCtx,0,0,ae_Width,ae_Height,1,AvatarImgMaker.keys,AvatarImgMaker.items,a,d);e.clearRect(0,0,a,d);e.drawImage(AvatarImgMaker.canvas,0,0,a,d)};AvatarImgMaker.createMiniBody=function(c,b){var a=cloneArray(b);AvatarImgMaker.createItems(a,"mini-");AvatarImgMaker._draw(c,0,0,mae_Width,mae_Height,6,AvatarImgMaker.keys,AvatarImgMaker.items)};AvatarImgMaker.createMiniAnimationBody=function(k,h){var b=cloneArray(h);AvatarImgMaker.createItems(b,"mini-");var l=[];l.push("body");l.push("clothes");l.push("scarf");l.push("head");l.push("eyes");l.push("mouth");l.push("add");l.push("hat");k.clearRect(0,0,120,320);AvatarImgMaker._draw(k,mae_Width,0,mae_Width,mae_Height,6,l,AvatarImgMaker.items);l.splice(2,0,"hand");AvatarImgMaker.createRowItems("0#0.mini-");AvatarImgMaker._draw(k,0,0,mae_Width,mae_Height,6,l,AvatarImgMaker.items);AvatarImgMaker.createRowItems("0#2.mini-");AvatarImgMaker._draw(k,mae_Width*2,0,mae_Width,mae_Height,6,l,AvatarImgMaker.items);for(var d=1;d<=3;d++){var a=null;var c=null;if(AvatarImgMaker.items.add.id!==""){c=PreloadImgs.get(d+".mini-"+AvatarImgMaker.items.add.id+"-"+AvatarImgMaker.gender)}if(d<3){a=PreloadImgs.get(d+".mini-mouth-"+AvatarImgMaker.gender)}else{}AvatarImgMaker.items.add.img=c;AvatarImgMaker.items.mouth.img=a;AvatarImgMaker.items.head.img=PreloadImgs.get(d+".mini-head");AvatarImgMaker.items.eyes.img=PreloadImgs.get(d+".mini-eyes-"+AvatarImgMaker.gender);if(AvatarImgMaker.items.hat.id!==""){AvatarImgMaker.items.hat.img=PreloadImgs.get(d+".mini-"+AvatarImgMaker.items.hat.id)}try{AvatarImgMaker.items.eyes.imgBack=PreloadImgs.get(d+".mini-eyes-"+AvatarImgMaker.gender+"-fundo")}catch(g){}for(var e=0;e<=2;e++){var f=d+"#"+e+".mini-";AvatarImgMaker.createRowItems(f);AvatarImgMaker._draw(k,e*mae_Width,mae_Height*d,mae_Width,mae_Height,6,l,AvatarImgMaker.items)}}};AvatarImgMaker.createMiniAnimationBodyPlatter=function(h,b){AvatarImgMaker.createItems(b,"mini-");var k=[];k.push("body");k.push("clothes");k.push("scarf");k.push("platter");k.push("head");k.push("eyes");k.push("mouth");k.push("add");k.push("hat");h.clearRect(0,0,120,320);AvatarImgMaker.items.platter=CreateItems.platter("0#1.mini-platter");AvatarImgMaker._draw(h,mae_Width,0,mae_Width,mae_Height,6,k,AvatarImgMaker.items);k.splice(2,0,"hand");AvatarImgMaker.createRowItems("0#0.mini-");AvatarImgMaker._draw(h,0,0,mae_Width,mae_Height,6,k,AvatarImgMaker.items);AvatarImgMaker.items.platter=CreateItems.platter("0#2.mini-platter");AvatarImgMaker.createRowItems("0#2.mini-");AvatarImgMaker._draw(h,mae_Width*2,0,mae_Width,mae_Height,6,k,AvatarImgMaker.items);for(var d=1;d<=3;d++){var a=null;var c=null;if(AvatarImgMaker.items.add.id!==""){c=PreloadImgs.get(d+".mini-"+AvatarImgMaker.items.add.id+"-"+AvatarImgMaker.gender)}if(d<3){a=PreloadImgs.get(d+".mini-mouth-"+AvatarImgMaker.gender)}else{}AvatarImgMaker.items.add.img=c;AvatarImgMaker.items.mouth.img=a;AvatarImgMaker.items.head.img=PreloadImgs.get(d+".mini-head");AvatarImgMaker.items.eyes.img=PreloadImgs.get(d+".mini-eyes-"+AvatarImgMaker.gender);if(AvatarImgMaker.items.hat.id!==""){AvatarImgMaker.items.hat.img=PreloadImgs.get(d+".mini-"+AvatarImgMaker.items.hat.id)}try{AvatarImgMaker.items.eyes.imgBack=PreloadImgs.get(d+".mini-eyes-"+AvatarImgMaker.gender+"-fundo")}catch(g){}if(d==1||d==3){k.splice(4,1);k.splice(0,0,"platter")}else{k.splice(0,1);k.splice(4,0,"platter")}for(var e=0;e<=2;e++){var f=d+"#"+e+".mini-";AvatarImgMaker.createRowItems(f);AvatarImgMaker.items.platter=CreateItems.platter(f+"platter");AvatarImgMaker._draw(h,e*mae_Width,mae_Height*d,mae_Width,mae_Height,6,k,AvatarImgMaker.items)}}};AvatarImgMaker.createRowItems=function(b){AvatarImgMaker.items.clothes.img=PreloadImgs.get(b+AvatarImgMaker.items.clothes.id);try{AvatarImgMaker.items.clothes.imgBack=PreloadImgs.get(b+AvatarImgMaker.items.clothes.id+"-pants")}catch(a){}try{AvatarImgMaker.items.scarf.img=PreloadImgs.get(b+AvatarImgMaker.items.clothes.id+"-scarf")}catch(a){}AvatarImgMaker.items.body.img=PreloadImgs.get(b+"body");AvatarImgMaker.items.hand=CreateItems.body(b+"hand",AvatarImgMaker.items.body.color)};AvatarImgMaker.createItems=function(a,b){AvatarImgMaker.items=[];a.forEach(function(c){var d=null;switch(c[0]){case"body":case"skin":AvatarImgMaker.items.head=CreateItems.head(b+"head",hexToRgb(c[2]));d=CreateItems.body(b+"body",hexToRgb(c[2]));c[0]="body";break;case"clothes":AvatarImgMaker.items.scarf=CreateItems.scarf(b,c[1],hexToRgb(c[3]));case"add":case"hat":d=CreateItems[c[0]](b,c[1],hexToRgb(c[2]));break;default:d=CreateItems[c[0]](b+c[1],hexToRgb(c[2]))}AvatarImgMaker.items[c[0]]=d})};AvatarImgMaker._draw=function(i,a,g,b,d,f,e,c){i.clearRect(a,g,b,d);e.forEach(function(h){var k=c[h];if(k.img===""||k.img===null){return}var j=b;var m=d;var l=k.img;if(l.currentSrc===""){return}AvatarImgMaker.canvasTemp.width=j;AvatarImgMaker.canvasTemp.height=m;if(k.imgBack!=undefined){AvatarImgMaker.canvasTempCtx.clearRect(0,0,j,m);AvatarImgMaker.canvasTempCtx.drawImage(k.imgBack,0,0);i.drawImage(AvatarImgMaker.canvasTemp,a+(k.x/f),g+(k.y/f))}AvatarImgMaker.canvasTempCtx.clearRect(0,0,j,m);AvatarImgMaker.canvasTempCtx.drawImage(l,0,0);if(k.color!==undefined){filterChangeColor(AvatarImgMaker.canvasTempCtx,j,m,k.baseColor,k.color)}i.drawImage(AvatarImgMaker.canvasTemp,a+(k.x/f),g+(k.y/f))})};AvatarEditor.initialized=false;AvatarEditor.init=function(){if(AvatarEditor.initialized){return}$("#avatar-tabs").easytabs({animate:false,updateHash:false,tabActiveClass:"selected-tab",panelActiveClass:"displayed"});$("#avatar-tabs ul li a").addClass("nobugs_font_light");AvatarEditor.itemColor={r:255,g:255,b:255};AvatarEditor.items=[];AvatarEditor.miniItems=[];AvatarEditor.keys=[];AvatarEditor.canvasTemp=document.getElementById("avatarTemp");AvatarEditor.canvasTempCtx=AvatarEditor.canvasTemp.getContext("2d");AvatarEditor.canvasTemp2=document.getElementById("avatarTemp2");AvatarEditor.canvasTemp2Ctx=AvatarEditor.canvasTemp2.getContext("2d");AvatarEditor.canvas=document.getElementById("avatar");AvatarEditor.canvasCtx=AvatarEditor.canvas.getContext("2d");$(".avatar-item").click(AvatarEditor.selectItem);AvatarEditor.hatColor={r:255,g:255,b:255};$("#cpHat").colorpicker({history:false,displayIndicator:false});$("#cpHat").on("change.color",function(b,a){if(arguments.length==3){AvatarEditor.hatColor=arguments[2]}else{AvatarEditor.hatColor=hexToRgb(a)}AvatarEditor.changeColor(AvatarEditor.hatColor,"#tab-hats",{r:255,g:255,b:255});AvatarEditor.selectHat(AvatarEditor.hat);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpHat");$("#cpHat div:first-child").css("width","0px");AvatarEditor.drawTab("#tab-hats");$("#tab-hats").on("click",function(a){if(a.target.id==="tab-hats"){$("#cpHat").trigger("change.color",[null,AvatarEditor.hatColor])}});$("#cpEyes").colorpicker({history:false,displayIndicator:false});$("#cpEyes").on("change.color",function(b,a){AvatarEditor.selectEye(a);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpEyes");AvatarEditor.choicesOfColor("#cpEyes",["#000000","#5977FF","#188242","#B16608"]);$("#cpEyes div:first-child").css("width","0px");$("#cpSkin, #cpSkinSpecial").colorpicker({history:false,displayIndicator:false});$("#cpSkin, #cpSkinSpecial").on("change.color",function(b,a){AvatarEditor.selectSkin(a);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpSkin");AvatarEditor.choicesOfColor("#cpSkin",["#F2DAD5","#F39C7A","#AF876D","#544035"]);AvatarEditor.removeColorLines("#cpSkinSpecial");AvatarEditor.choicesOfColor("#cpSkinSpecial",["#FFD90F","#88CCFF"]);$("#cpSkin div:first-child, #cpSkinSpecial div:first-child").css("width","0px");$("#cpAdd").colorpicker({history:false,displayIndicator:false});AvatarEditor.removeColorLines("#cpAdd");AvatarEditor.choicesOfColor("#cpAdd",["#000000","#F2DA91","#B73801","#DBDBDB"]);$("#cpAdd div:first-child").css("width","0px");$("#cpAdd").on("change.color",function(b,a){if(arguments.length==3){AvatarEditor.addColor=arguments[2]}else{AvatarEditor.addColor=hexToRgb(a)}AvatarEditor.changeColor(AvatarEditor.addColor,"#withtab-adds",{r:255,g:255,b:255});AvatarEditor.selectAdd(AvatarEditor.add);AvatarEditor.draw()});AvatarEditor.addColor={r:255,g:255,b:255};AvatarEditor.drawTab("#withtab-adds");$("#tab-body").on("click",function(a){if(a.target.id==="tab-body"){$("#cpAdd").trigger("change.color",[null,AvatarEditor.addColor])}});AvatarEditor.scarfColor={r:255,g:0,b:0};AvatarEditor.coatColor={r:255,g:255,b:255};$("#cpCoat").colorpicker({history:false,displayIndicator:false});$("#cpCoat").on("change.color",function(b,a){if(arguments.length==3){AvatarEditor.coatColor=arguments[2]}else{AvatarEditor.coatColor=hexToRgb(a)}AvatarEditor.changeColor2Elems("#tab-clothes","scarf",AvatarEditor.coatColor,AvatarEditor.scarfColor);AvatarEditor.selectClothes(AvatarEditor.clothes);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpCoat");$("#cpScarf").colorpicker({history:false,displayIndicator:false});$("#cpScarf").on("change.color",function(b,a){AvatarEditor.scarfColor=hexToRgb(a);AvatarEditor.changeColor2Elems("#tab-clothes","scarf",AvatarEditor.coatColor,AvatarEditor.scarfColor);AvatarEditor.selectClothes(AvatarEditor.clothes);AvatarEditor.draw()});AvatarEditor.removeColorLines("#cpScarf");AvatarEditor.drawTab("#tab-clothes");$("#tab-clothes").on("click",function(a){if(a.target.id==="tab-clothes"){$("#cpCoat").trigger("change.color",[null,AvatarEditor.coatColor])}});BlocklyApps.bindClick("avatarEditorOK",AvatarEditor.okClick);BlocklyApps.bindClick("avatarEditorCancel",AvatarEditor.cancelClick);$(".evo-more").remove();$("#cpHat .evo-palette tr").append($("<td>").css("background-color","#ffffff"));$("#cpCoat .evo-palette tr").append($("<td>").css("background-color","#ffffff"));$("#cpScarf .evo-palette tr").append($("<td>").css("background-color","#ffffff"));AvatarEditor.initialized=true};AvatarEditor.cancelClick=function(){$("#avatar-tabs").unbind("easytabs:after");$("#blocknotab-hats").remove();$("#blocknotab-clothes").remove();$("#blockskinSpecial").remove();$("#blocknotab-adds").remove();MyBlocklyApps.hideDialog(true);if(AvatarEditor.afterCloseFunc!==undefined&&AvatarEditor.afterCloseFunc!==null){AvatarEditor.afterCloseFunc()}};AvatarEditor.okClick=function(){var a=Game.loginData.avatar;a[0]=["skin","",rgbToHex(AvatarEditor.skinColor)];a[1]=["eyes","eyes",rgbToHex(AvatarEditor.eyeColor)];a[2]=["hat",AvatarEditor.hat,rgbToHex(AvatarEditor.hatColor)];a[3]=["clothes",AvatarEditor.clothes,rgbToHex(AvatarEditor.coatColor),rgbToHex(AvatarEditor.scarfColor)];a[4]=["mouth",""];a[5]=["add",AvatarEditor.add,rgbToHex(AvatarEditor.addColor)];AvatarEditor.cancelClick();Game.drawMiniAvatar();UserControl.saveAvatar(document.getElementById("avatarPlayer").toDataURL(),Game.loginData.avatar,Game.createsLeaderboard)};AvatarEditor.show=function(c,f,m,k,h,i,g,l,d,n){$("#cpAdd-F").css("display","none");$("#cpAdd-M").css("display","none");$("#cpAdd-?".replace("?",AvatarImgMaker.gender)).css("display","block");AvatarEditor.itemColor={r:0,g:0,b:0};AvatarEditor.items=[];AvatarEditor.miniItems=[];AvatarEditor.keys=[];$("#avatar-tabs").easytabs("select","#tab-body");AvatarEditor.hatColor=hexToRgb(g);AvatarEditor.scarfColor=hexToRgb(m);AvatarEditor.coatColor=hexToRgb(f);AvatarEditor.addColor=hexToRgb(d);var j="";if(i.indexOf("blocked")==0){j=i.split(":")[1];i=""}var b="";if(c.indexOf("blocked")==0){b=c.split(":")[1];c=c.split(":")[2]}var e="";if(k.indexOf("blocked")==0){e=k.split(":")[1];k=k.split(":")[2]}var a="";if(l.indexOf("blocked")==0){a=l.split(":")[1];l=l.split(":")[2]}AvatarEditor.clothes=c;AvatarEditor.hat=i;AvatarEditor.add=l;AvatarEditor.keys.push("body");AvatarEditor.changeColor2Elems("#tab-clothes","scarf",AvatarEditor.coatColor,AvatarEditor.scarfColor);AvatarEditor.selectClothes(c);AvatarEditor.keys.push("head");AvatarEditor.selectSkin(k);AvatarEditor.selectEye(h);AvatarEditor.items.mouth=CreateItems.mouth("");AvatarEditor.miniItems.mouth=CreateItems.mouth("mini-");AvatarEditor.keys.push("mouth");AvatarEditor.changeColor(AvatarEditor.addColor,"#withtab-adds",{r:255,g:255,b:255});AvatarEditor.selectAdd(l);AvatarEditor.changeColor(AvatarEditor.hatColor,"#tab-hats",{r:255,g:255,b:255});AvatarEditor.selectHat(i);$("#avatar-tabs").bind("easytabs:after",function(p,q,o){$(o.selector).trigger("click")});$("#avatar-tabs").css("display","block");AvatarEditor.afterCloseFunc=n;AvatarEditor.draw();MyBlocklyApps.showDialog(document.getElementById("profileditor"),null,false,true,true,BlocklyApps.getMsg("Avatar_EditorTitle"),{width:"800px"},null);if(j!==""){AvatarEditor.blockElement(j,"notab-hats","420px","435px","-7px",true)}if(b!==""){AvatarEditor.blockElement(b,"notab-clothes","420px","435px","-7px",true)}if(e!==""){AvatarEditor.blockElement(e,"skinSpecial","50px","210px","-15px",false)}if(a!==""){AvatarEditor.blockElement(a,"notab-adds","300px","435px","-7px",true)}$("#tab-body").click()};AvatarEditor.createBlock=function(d,c,a,b){return $("<div id ='block"+d+"'>").css("height",c).css("width",a).css("margin-top",b).css("position","fixed").css("backgroundColor","grey").css("opacity","0.9").css("color","white")};AvatarEditor.createWarn=function(b,d,a){var c=$("<table width='100%' height='100%'>").append($("<tr>").append($("<td align='center' id='avatar_info_"+d+"'>")));$("#block"+d).append(c);$("#avatar_info_"+d).append($("<span>").html((a?BlocklyApps.getMsg("Avatar_EnableByXp"):"")+b+"<img style='vertical-align: middle;' src='images/xp.png'/>").addClass("nobugs_font"))};AvatarEditor.blockTab=function(a,b){AvatarEditor.createBlock(b,"450px","272px","-7px").prependTo("#tab-"+b);AvatarEditor.createWarn(a,b,true)};AvatarEditor.blockElement=function(e,f,d,b,c,a){AvatarEditor.createBlock(f,d,b,c).prependTo("#"+f);AvatarEditor.createWarn(e,f,a)};AvatarEditor.removeColorLines=function(b){var a=$(b+" .evo-palette tr");a.splice(a.length-1,1);a.remove()};AvatarEditor.choicesOfColor=function(b,a){var d=$(b+" .evo-palette tr");d.empty();for(var c=0;c<a.length;c++){d.append($("<td/>").css("background-color",a[c]))}};AvatarEditor.draw=function(){AvatarImgMaker._draw(AvatarImgMaker.canvasCtx,0,0,ae_Width,ae_Height,1,AvatarEditor.keys,AvatarEditor.items);AvatarImgMaker._draw(AvatarImgMaker.canvasCtx,ae_Width-50,ae_Height-90,50,mae_Height,6,AvatarEditor.keys,AvatarEditor.miniItems)};AvatarEditor.selectItem=function(a){var b=this.id.split("-");AvatarEditor["select"+b[0]](this.id);AvatarEditor.draw()};AvatarEditor.selectHat=function(a){if(a===""){return}if(AvatarEditor.keys.indexOf("hat")==-1){AvatarEditor.keys.push("hat")}AvatarEditor.hat=a;AvatarEditor.items.hat=CreateItems.hat("",a,AvatarEditor.itemColor);AvatarEditor.miniItems.hat=CreateItems.hat("mini-",a,AvatarEditor.itemColor)};AvatarEditor.selectClothes=function(a){if(AvatarEditor.keys.indexOf("clothes")==-1){AvatarEditor.keys.push("clothes");AvatarEditor.keys.push("scarf")}AvatarEditor.clothes=a;AvatarEditor.items.clothes=CreateItems.clothes("",a,AvatarEditor.coatColor);AvatarEditor.items.scarf=CreateItems.scarf("",a,AvatarEditor.scarfColor);AvatarEditor.miniItems.clothes=CreateItems.clothes("mini-",a,AvatarEditor.coatColor);AvatarEditor.miniItems.scarf=CreateItems.scarf("mini-",a,AvatarEditor.scarfColor)};AvatarEditor.selectEye=function(a){AvatarEditor.eyeColor=hexToRgb(a);if(AvatarEditor.keys.indexOf("eyes")==-1){AvatarEditor.keys.push("eyes")}AvatarEditor.items.eyes=CreateItems.eyes("eyes",AvatarEditor.eyeColor);AvatarEditor.miniItems.eyes=CreateItems.eyes("mini-eyes",AvatarEditor.eyeColor)};AvatarEditor.selectAdd=function(a){if(a===""){return}if(AvatarEditor.keys.indexOf("add")==-1){AvatarEditor.keys.splice(AvatarEditor.keys.indexOf("mouth")+1,0,"add")}a=a.replace("-?","");AvatarEditor.add=a;AvatarEditor.items.add=CreateItems.add("",a,AvatarEditor.itemColor);AvatarEditor.miniItems.add=CreateItems.add("mini-",a,AvatarEditor.itemColor)};AvatarEditor.selectSkin=function(a){AvatarEditor.skinColor=hexToRgb(a);AvatarEditor.items.head=CreateItems.head("head",AvatarEditor.skinColor);AvatarEditor.items.body=CreateItems.body("body",AvatarEditor.skinColor);AvatarEditor.miniItems.head=CreateItems.head("mini-head",AvatarEditor.skinColor);AvatarEditor.miniItems.body=CreateItems.body("mini-body",AvatarEditor.skinColor)};AvatarEditor.drawTab=function(a,j,m,b,l,f){m=(m==undefined?"":"-"+m);var k=$(a+" .avatar-item");j=(j||j==undefined);for(var d=0;d<k.length;d++){var n=k[d].getContext("2d");var e=k[d].getAttribute("imgTop");var h=k[d].getAttribute("imgHeight");var g=k[d].getAttribute("imgWidth");var c=PreloadImgs.get(k[d].id.replace("?",AvatarImgMaker.gender)+m);AvatarEditor.canvasTemp2.width=k[d].width;AvatarEditor.canvasTemp2.height=k[d].height;AvatarEditor.canvasTemp2Ctx.clearRect(0,0,k[d].width,k[d].height);if(e!=undefined){AvatarEditor.canvasTemp2Ctx.drawImage(c,0,-parseInt(e))}else{if(h!=undefined){AvatarEditor.canvasTemp2Ctx.drawImage(c,0,0,parseInt(g),parseInt(h),0,0,k[d].width,k[d].height)}else{AvatarEditor.canvasTemp2Ctx.drawImage(c,0,0,k[d].width,k[d].height)}}if(b!==undefined){b(AvatarEditor.canvasTemp2Ctx,k[d].width,k[d].height,l,f)}if(j){n.clearRect(0,0,k[d].width,k[d].height)}n.drawImage(AvatarEditor.canvasTemp2,0,0)}};AvatarEditor.changeColor=function(b,e,a,d,c){AvatarEditor.itemColor=b;AvatarEditor.drawTab(e,d,c,filterChangeColor,a,b)};AvatarEditor.changeColor2Elems=function(d,c,b,a){AvatarEditor.changeColor(b,d,{r:255,g:255,b:255});AvatarEditor.changeColor(a,d,{r:255,g:255,b:255},false,c)};"use strict";var CharacterDialog={};CharacterDialog=function(c,l,i,b,h){var a=$("<div>").attr("id","talkDlg").addClass("dlgTalk").appendTo("body");var k=$("<div>").addClass("dlgTalkBaloon");k.append($("<button id='dlgClose'>").addClass("dlgTalkClose"));k.append($("<div>").addClass("dlgTalkText"));var g=$("<button id='dlgPrevious'>").addClass("dlgTalkButton").addClass("nobugs_button").append($("<img>").attr("src","images/talkprevious.png"));k.append(g);var n=$("<button id='dlgNext'>").addClass("dlgTalkButton").addClass("nobugs_button").append($("<img>").attr("src","images/talknext.png"));k.append(n);var m=$("<button id='dlgCloseOK'>").addClass("dlgTalkButton").addClass("nobugs_button").append($("<img>").attr("src","images/talknextclose.png"));k.append(m);a.append(k);var j=document.getElementById("talkDlg");j.style.display="inline";j.style.left=c+"px";j.style.top=l+"px";var e={top:"200px",left:"700px"};var d={top:"200px",left:"600px"};this.dlg=j;this.conversation=h;this.idx=0;this.previousChar=null;this.evtClose=b;this.leftChar=(c-3)+"px";this.topChar=(l-96)+"px";this.txt=this.dlg.getElementsByClassName("dlgTalkText")[0];this.updateText();this.nextButton=n.get(0);this.nextButton.onclick=this.next.bind(this);this.nextButton.style.top=e.top;this.nextButton.style.left=e.left;this.nextCloseButton=m.get(0);this.nextCloseButton.onclick=this.nextClose.bind(this);this.nextCloseButton.style.top=e.top;this.nextCloseButton.style.left=e.left;if(this.conversation.length==1){var f=h[0].nextButton;if(f===undefined){f="close"}if(f==="close"){this.nextCloseButton.style.display="inline"}else{if(f==="next"){this.nextButton.style.display="inline";this.nextButton.onclick=this.nextClose.bind(this)}else{}}}else{this.nextButton.style.display="inline"}this.prevButton=g.get(0);this.prevButton.onclick=this.previous.bind(this);this.prevButton.style.top=d.top;this.prevButton.style.left=d.left;this.closeButton=this.dlg.getElementsByClassName("dlgTalkClose")[0];if(i){this.closeButton.onclick=this.nextClose.bind(this)}else{this.closeButton.style.display="none"}Cufon(".dlgTalkText")};CharacterDialog.prototype.show=function(b){this.dlg.style.display="inline";for(var a in b){this.dlg.style[a]=b[a]}};CharacterDialog.prototype.nextClose=function(){$("#talkDlg").remove();if(this.previousChar!=null){this.previousChar.css("display","none")}if(this.evtClose!=null){this.evtClose()}};CharacterDialog.prototype.next=function(){this.idx++;this.updateText();if(this.idx==this.conversation.length-1){this.nextButton.style.display="none";this.nextCloseButton.style.display="inline"}this.prevButton.style.display="inline"};CharacterDialog.prototype.previous=function(){this.idx--;this.updateText();if(this.idx==0){this.prevButton.style.display="none"}this.nextCloseButton.style.display="none";this.nextButton.style.display="inline"};CharacterDialog.prototype.updateText=function(){if(this.previousChar!=null){this.previousChar.css("display","none")}var a=this.conversation[this.idx].character;if(a!=null){this.previousChar=$("#"+a).css("display","inline").css("left",this.leftChar).css("top",this.topChar)}this.txt.innerHTML=this.conversation[this.idx].msg;Cufon(".dlgTalkText")};CharacterDialog.creates=function(a,e,b,d){$("<img>").attr("id","teachTalk").attr("src","images/teacher.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");var c=[];d.forEach(function(f){c.push({character:"teachTalk",msg:f})});new CharacterDialog(a,e,false,function(){$("#teachTalk").remove();b()},c)};"use strict";PreloadImgs.put("intro-background-f","images/mesafamilia-f.png",false);PreloadImgs.put("intro-background-m","images/mesafamilia-m.png",false);var IntroGame={};IntroGame.start=function(){IntroGame.track=new PlayAudio(["music/DailyBeetle.mp3"]);var a=Game.loginData.userLogged.sex.toLowerCase();$("<div>").attr("id","introback").append($("<img>").css("width","700px").attr("src","images/mesafamilia-"+a+".png")).appendTo("body");$("<img>").attr("id","dadTalk").attr("src","images/father.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");$("<img>").attr("id","youTalk").attr("src","images/you-"+a+".png").addClass("dlgCharPhoto").css("display","none").appendTo("body");$("<img>").attr("id","momTalk").attr("src","images/mother_.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");$("<img>").attr("id","grandmomTalk").attr("src","images/grandmother.png").addClass("dlgCharPhoto").css("display","none").appendTo("body");MyBlocklyApps.showDialog(document.getElementById("introback"),null,false,true,true,null,{width:"auto"},null,null,false);var c=document.getElementById("dialog");var b=new CharacterDialog(c.offsetLeft-50,(c.offsetTop+340),false,IntroGame.finish,[{character:"dadTalk",msg:BlocklyApps.getMsg("Intro_Dlg1").format(Game.loginData.userLogged.name.split(" ")[0])},{character:"momTalk",msg:BlocklyApps.getMsg("Intro_Dlg2")},{character:"youTalk",msg:BlocklyApps.getMsg("Intro_Dlg3")},{character:"dadTalk",msg:BlocklyApps.getMsg("Intro_Dlg4")},{character:"grandmomTalk",msg:BlocklyApps.getMsg("Intro_Dlg5")},{character:"momTalk",msg:BlocklyApps.getMsg("Intro_Dlg6")},{character:"youTalk",msg:BlocklyApps.getMsg("Intro_Dlg7")},{character:"dadTalk",msg:BlocklyApps.getMsg("Intro_Dlg8")},{character:"youTalk",msg:BlocklyApps.getMsg("Intro_Dlg9")}]);IntroGame.track.play();b.show({"z-index":150})};IntroGame.finish=function(){$("#introback").remove();$("#dadTalk").remove();$("#youTalk").remove();$("#momTalk").remove();$("#grandmomTalk").remove();MyBlocklyApps.hideDialog(true);Game.logged();IntroGame.track.stop();IntroGame.track.clear()};IntroGame.createDiv=function(b){var a=$("<div id ='"+b+"'>").css("height","100%").css("width","100%").css("position","fixed").css("backgroundColor","grey").css("opacity","0.5").css("z-index","1000").prependTo("body");return a};IntroGame.presentTeacher=function(b){IntroGame.createDiv("presentTeacher");var a=$("<img>").attr("id","imgTeacher").attr("src","images/teacher_info.png").css("width","300px").css("position","absolute").css("z-index","2001").css("left","150px").css("top","50px");a.prependTo("body");var c=new CharacterDialog(375,200,false,IntroGame.closePresentTeacher,[{character:null,msg:BlocklyApps.getMsg("Intro_PresentTeacher").format($("#playerName").html()),nextButton:"next"}]);$("#talkDlg").css("z-index","2000");c.show();IntroGame.fRet=b};IntroGame.closePresentTeacher=function(){$("#presentTeacher").remove();$("#imgTeacher").remove();IntroGame.fRet()};IntroGame.focusAvatar=function(){var e=IntroGame.createDiv("focusAvatar");var c=BlocklyApps.getBBox_(document.getElementById("avatarEditorButton"));var a=$("<img>").attr("id","imgTeacher").attr("src","images/teacher_point_hand.png").css("width","410px").css("position","absolute").css("z-index","2001").css("left",(c.x+80)+"px").css("top","50px");a.prependTo("body");var b=$("<button>").addClass("nobugs_button").attr("id","focusButton").css("font-size","14px").css("width",c.width+"px").css("height",c.height+"px").css("position","relative").css("top",(c.y-5)+"px").css("left",(c.x-13)+"px").html("Avatar");b.click(IntroGame.closeFocusAvatar);e.append(b);var d=new CharacterDialog(c.x+350,c.y,false,null,[{character:null,msg:BlocklyApps.getMsg("Intro_AvatarEditor"),nextButton:null}]);$("#talkDlg").css("z-index","2000");d.show();IntroGame.cDialog=d};IntroGame.closeFocusAvatar=function(){IntroGame.cDialog.nextClose();$("#focusButton").remove();$("#focusAvatar").remove();$("#imgTeacher").remove();Game.openAvatarEditor(null,IntroGame.closeAvatarEditor)};IntroGame.closeAvatarEditor=function(){var a=BlocklyApps.getBBox_(document.getElementById("city_map"));IntroGame.createDiv("closeAvatarEditor1").css("left",(a.x+a.width)+"px").css("height","305px").css("top","100px");IntroGame.createDiv("closeAvatarEditor2").css("height","100px").css("width","100%");IntroGame.createDiv("closeAvatarEditor3").css("width",(a.x-10)+"px").css("height","305px").css("top","100px");IntroGame.createDiv("closeAvatarEditor4").css("top","405px").css("width","100%");var c=$("<img>").attr("id","imgTeacher-hand").attr("src","images/teacher_attention_hand-hand.png").css("width","105px%").css("position","absolute").css("z-index","2001").css("left",(a.x+130)+"px").css("top","347px").css("height","135px");c.prependTo("body");c=$("<img>").attr("id","imgTeacher-body").attr("src","images/teacher_attention_hand-body.png").css("width","296px").css("position","absolute").css("z-index","2001").css("left",(a.x+130+105)+"px").css("top","250px");c.prependTo("body");var d=new CharacterDialog(a.x+300,200,false,IntroGame.closePresentTeacher,[{character:null,msg:BlocklyApps.getMsg("Intro_ClickSchool"),nextButton:null}]);$("#talkDlg").css("z-index","2000");d.show()};IntroGame.closeBeforeCity=function(){IntroGame.cDialog.nextClose();$("#closeAvatarEditor1").remove();$("#closeAvatarEditor2").remove();$("#closeAvatarEditor3").remove();$("#closeAvatarEditor4").remove();$("#imgTeacher-hand").remove();$("#imgTeacher-body").remove()};"use strict";var noBugsAudio=document.createElement("audio");var PlayAudio=function(b){this.files=b;this.index=0;try{noBugsAudio.pause()}catch(a){}this.playing=false};PlayAudio.prototype.playNext=function(){if(!window.Audio){return}if(this.index==this.files.length){this.index=0}noBugsAudio.src=this.files[this.index];this.index+=1;noBugsAudio.play()};PlayAudio.prototype.shuffle=function(){for(var c=this.files.length-1;c>0;c--){var b=Math.floor(Math.random()*(c+1));var a=this.files[c];this.files[c]=this.files[b];this.files[b]=a}};PlayAudio.prototype.play=function(){if(this.playing||!window.Audio){return}noBugsAudio.addEventListener("ended",this.playNext.bind(this));this.playNext();this.playing=true};PlayAudio.prototype.stop=function(){this.playing=false;this.clear();try{noBugsAudio.pause()}catch(a){}};PlayAudio.prototype.clear=function(){noBugsAudio.removeEventListener("ended",this.playNext)};"use strict";PreloadImgs.put("run","images/run.png");PreloadImgs.put("runout","images/run_out.png");var CountXP={};CountXP.init=function(b,a){CountXP.timeReset=true;if(CountXP.ctx!=null){CountXP.stop(true)}this.canvasId=b;CountXP.ctx=document.getElementById(b).getContext("2d");this.showCanvas=a};CountXP.config=function(g,a,h,e,d,b,f,c){CountXP.starting=true;CountXP.consumedMaxStars=false;CountXP.dif=0;CountXP.current=0;CountXP.aFraction=1;CountXP.timeReset=false;$("#missionXP2").css("display",(c?"none":"inline"));$("#missionXP3").css("display",(c?"none":"inline"));$("#stopWatch").css("display",(c?"none":"inline"));if(c){$("#xpPoints").html(h);if(d){d(0)}return}if(!this.showCanvas){if(d){d(3)}return}if(a.dif==undefined){a.dif=0}CountXP.byTime=g;if(g){document.getElementById(CountXP.canvasId).width="32"}else{document.getElementById(CountXP.canvasId).width="40";CountXP.lastHowManyRuns=Game.howManyRuns}CountXP.dif=a.dif;CountXP.runImg=PreloadImgs.get("run");CountXP.runOutImg=PreloadImgs.get("runout");CountXP.stopShowingWhenReachTheTime=(f===undefined?false:f);CountXP.eventChangeStars=d;CountXP.showPoints=b;CountXP.aFraction=a.aFraction;CountXP.current=a.current;CountXP.freeWizardConsumed=a.freeWizardConsumed;CountXP.pointsFinal=e;CountXP.changeImgs();if((CountXP.getTimes()<3)&&(CountXP.showPoints)){$("#xpPoints").html("x"+h);CountXP.draw()}CountXP.starting=false};CountXP.start=function(){if(!this.showCanvas){CountXP.ctx.clearRect(0,0,40,40);return}if(!CountXP.byTime){return}if(CountXP.getTimes()<3){CountXP.tick();CountXP.handler=setInterval(CountXP.tick,1000)}};CountXP.stop=function(a){if(!this.showCanvas){return}if(a&&CountXP.ctx!=null){CountXP.ctx.clearRect(0,0,40,40)}clearInterval(CountXP.handler)};CountXP.tick=function(){CountXP.draw();CountXP.sumCurrent()};CountXP.sumCurrent=function(){if(CountXP.stopShowingWhenReachTheTime&&CountXP.getTimes()>0){CountXP.stop(false)}CountXP.current++;if(CountXP.getCurrent()>0&&CountXP.getCurrent()%CountXP.aFraction==0){CountXP.changeImgs()}};CountXP.draw=function(){var k=CountXP.ctx;k.clearRect(0,0,40,40);if(CountXP.byTime){k.beginPath();k.arc(16,18,10,0,2*Math.PI);k.lineWidth=2;k.strokeStyle="#000000";k.rect(15,4,2,2);k.rect(13,2,6,2);k.stroke();var c=CountXP.getCurrent()/CountXP.aFraction;if(CountXP.stopShowingWhenReachTheTime&&CountXP.getTimes()>0){c=1}k.beginPath();k.arc(16,18,5,1.5*Math.PI,(1.5+((c)*2))*Math.PI,false);k.lineWidth=10;k.strokeStyle="#ad2323";k.stroke()}else{var m=8;var j=32-m-8;var f=10;var l=f/2;k.fillStyle="#fff7eb";k.lineJoin="round";k.lineWidth=f;k.strokeStyle="#fff7eb";var b=2,a=j,d=4+(CountXP.aFraction*(2+m)),h=m+8;k.strokeRect(b+l,a+l,d-f,h-f);k.fillRect(b+l,a+l,d-f,h-f);j+=4;var g=CountXP.aFraction-(CountXP.getCurrent()%CountXP.aFraction);for(var e=0;e<CountXP.aFraction;e++){k.drawImage((e>=g?CountXP.runOutImg:CountXP.runImg),6+(e*(2+m)),j,m,m)}}};CountXP.changeImgs=function(){if(!CountXP.showPoints){return}for(var a=0;a<3;a++){document.getElementById("missionXP"+(a+1)).style.backgroundImage="url(images/"+(3-CountXP.getTimes()>=(a+1)?"xp.png":"xp_disabled.png")+")"}if(CountXP.eventChangeStars){CountXP.eventChangeStars(CountXP.getTimes())}if(CountXP.getTimes()>=3){CountXP.clearTheWatch()}};CountXP.getEnabledStars=function(){return 3-CountXP.getTimes()};CountXP.setConsumedMaxStars=function(){CountXP.stop();CountXP.consumedMaxStars=true;CountXP.changeImgs()};CountXP.clearTheWatch=function(){CountXP.ctx.clearRect(0,0,40,40);$("#xpPoints").html("+"+CountXP.pointsFinal);CountXP.stop(true)};CountXP.resetTimes=function(){CountXP.timeReset=true};CountXP.getTimes=function(){if(CountXP.timeReset){return undefined}var a=0;if(CountXP.freeWizardConsumed||CountXP.consumedMaxStars){a=3}else{a=Math.floor(CountXP.getCurrent()/CountXP.aFraction);a=(a>3?3:a)}return a};CountXP.getCurrent=function(){var a=CountXP.current+CountXP.dif;a=(a<0?0:a);return a};CountXP.newRun=function(){if(CountXP.lastHowManyRuns!=Game.howManyRuns&&!CountXP.byTime&&CountXP.getTimes()<3){CountXP.lastHowManyRuns=Game.howManyRuns;CountXP.sumCurrent();if(CountXP.getTimes()<3){CountXP.draw()}}};CountXP.updateStars=function(){if(CountXP.byTime){return}if(CountXP.getTimes()>=3){CountXP.clearTheWatch()}else{CountXP.draw()}};"use strict";var Tests={};var TestRT={};Tests.createForm=function(g){Tests.test=g;Tests.idx=-1;Tests.dropShowed=false;Tests.dropExpand=null;var f=document.createElement("div");f.id="testquestions";f.style.height="100%";var c=document.createElement("table");var d=document.createElement("tr");c.appendChild(d);var a=document.createElement("img");a.src="images/teacher_info.png";a.style.margin="10px";a.style.height="350px";var e=document.createElement("td");e.appendChild(a);d.appendChild(e);var b=document.createElement("span");b.style.display="block";b.style.padding="10px";b.style.margin="10px";b.innerHTML=g.description+"<br/><br/>";var e=document.createElement("td");e.appendChild(b);d.appendChild(e);f.appendChild(c);b=document.createElement("span");b.innerHTML="Acrescer/descontar do b&ocirc;nus: "+g.timeRewardXP+" <img src='images/xp.png' style='vertical-align:middle'/> a cada "+g.timeXP+" segundos antecipados/extras.";b.style.padding="10px";b.style.border="1px solid black";b.style.width="95%";b.style.display="block";b.style.textAlign="center";e.appendChild(b);$("#testsStart").css("display","inline");$("#testsLogoff").css("display","inline");$("#testsNextQuestion").css("display","none");$("#testsLetBlank").css("display","none");$("#testsPlay").css("display","none");$("#continueTestAnotherDay").css("display","none");window.addEventListener("resize",Tests.resizeWindow);window.addEventListener("beforeunload",Tests.stopNow);return f};Tests.start=function(){$("#testsStart").css("display","none");$("#testsLogoff").css("display","none");$("#testsNextQuestion").css("display","inline");$("#testsLetBlank").css("display","inline");$("#testsPlay").css("display","none");Tests.idx=0;Tests.drawQuestion()};Tests.nextQuestion=function(){confirm("Deseja realmente executar essa a&#231;&#227;o ?",function(){Tests.performQuestion(null,null)})};Tests.performQuestion=function(blankValue,finished){Tests.closeDrop();if(Tests.dropExpand!=null){Tests.dropExpand.close()}Blockly.WidgetDiv.hide();var finishTest=(finished==true||finished==null);var answer=document.getElementById("answerQuestion");var valueAnswer=null;if(answer.type==="number"){if(finishTest){valueAnswer=(blankValue!=null?blankValue:answer.value.trim());if(valueAnswer===""){Tests.drop=new Drop({target:answer,content:BlocklyApps.getMsg("NoBugs_requiredField"),position:"left middle",classes:"drop-theme-arrows",constrainToScrollParent:false,openOn:""});Tests.drop.open();return}}else{valueAnswer="?"}}else{if(blankValue!=null){valueAnswer=blankValue}else{valueAnswer=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.mainWorkspace));if(finishTest){BlocklyApps.log=[];var js=Blockly.JavaScript;var newLogicCompare=Blockly.JavaScript.logic_compare;var newLogicOperation=Blockly.JavaScript.logic_operation;Blockly.JavaScript.logic_compare=NoBugsJavaScript.oldLogicCompare;Blockly.JavaScript.logic_operation=function(block){var r=NoBugsJavaScript.oldLogicOperation(block);r[0]="("+r[0]+")";return r};var code="function highlightBlock(c){};var NoBugsJavaScript = {};"+js.workspaceToCode(Blockly.mainWorkspace);var question=Tests.test.questions[Tests.idx];var result="F";try{result=(eval(question.answer)?"T":"F")}catch(ex){}Blockly.JavaScript.logic_compare=newLogicCompare;Blockly.JavaScript.logic_operation=newLogicOperation}else{result="?"}valueAnswer=result+valueAnswer}}var timeSpent=0;if(valueAnswer==-1){timeSpent=CountXP.aFraction}else{timeSpent=(CountXP.getTimes()*CountXP.aFraction)+CountXP.getCurrent()}UserControl.saveTestQuestionAnswer(parseInt(answer.testId),parseInt(answer.questionId),timeSpent,valueAnswer,{async:false,callback:function(){}});if(finishTest){Tests.idx++;if(Tests.idx==Tests.test.questions.length){UserControl.retrieveTestRewards(answer.testId,Tests.drawFinal)}else{Tests.drawQuestion()}}};Tests.drawFinal=function(c){$("#testquestions").empty();var d=document.createElement("table");var e=document.createElement("tr");d.appendChild(e);var f=document.createElement("td");e.appendChild(f);var a=document.createElement("img");a.src="images/teacher_info.png";a.style.margin="10px";a.style.height="350px";f.rowSpan="3";f.appendChild(a);f=document.createElement("td");e.appendChild(f);f.innerHTML="Agora que voc&ecirc; encerrou essas quest&otilde;es de b&ocirc;nus, vamos avaliar quanto voc&ecirc; ganhou :";e=document.createElement("tr");d.appendChild(e);f=document.createElement("td");f.style.verticalAlign="top";e.appendChild(f);var b=document.createElement("table");f.appendChild(b);b.style.border="1px solid yellow";b.style.borderRadius="10px";b.style.padding="10px";b.style.backgroundColor="#F8D686";b.style.margin="0 auto";e=document.createElement("tr");b.appendChild(e);f=document.createElement("td");e.appendChild(f);f.innerHTML="Pontos de XP";f=document.createElement("td");e.appendChild(f);f.innerHTML=c[0]+"<img src='images/xp.png' style='vertical-align:middle'/>";f.style.textAlign="right";e=document.createElement("tr");b.appendChild(e);f=document.createElement("td");e.appendChild(f);f.innerHTML="Moedas";f.style.textAlign="right";f=document.createElement("td");e.appendChild(f);f.innerHTML=c[1]+"<img src='images/coin2.png' style='vertical-align:middle'/>";f.style.textAlign="right";e=document.createElement("tr");d.appendChild(e);f=document.createElement("td");e.appendChild(f);if(c[0]==0&&c[1]==0){f.innerHTML="Existir&atilde;o no futuro outras oportunidades para receber b&ocirc;nus. Mais aten&ccedil;&atilde;o da pr&oacute;xima vez."}else{f.innerHTML="Parab&eacute;ns pelo seu desempenho, e continue a jogar."}$("#testquestions").append(d);UserControl.addRewardsToCurrentUser(c[0],c[1]);$("#testsStart").css("display","none");$("#testsLogoff").css("display","none");$("#testsNextQuestion").css("display","none");$("#testsLetBlank").css("display","none");$("#testsPlay").css("display","inline");$("#continueTestAnotherDay").css("display","none");Game.hideHints=true};Tests.drawQuestion=function(){var question=Tests.test.questions[Tests.idx];$("#testquestions").empty();var stopWatch=document.createElement("div");stopWatch.style.position="fixed";stopWatch.style.right="0px";var canvas=document.createElement("canvas");canvas.id="stopWatchTests";canvas.width="40";canvas.height="32";stopWatch.appendChild(canvas);stopWatch.innerHTML=stopWatch.innerHTML+"<br/>"+(question.timeLimit/60)+" min";$("#testquestions").append(stopWatch);CountXP.init("stopWatchTests",true);var current=0;if(question.previousAnswer!=null){current=question.previousAnswer.timeSpend}CountXP.config(true,{aFraction:question.timeLimit,current:current},0,0,null,false,true,true);CountXP.start();var table=document.createElement("table");table.id="testTableContent";table.width="100%";table.style.borderCollapse="collapse";var tr=document.createElement("tr");var td=document.createElement("td");td.id="tdContent";td.innerHTML=changeImgHex(question.description);table.appendChild(tr);tr.appendChild(td);$("#testquestions").append(table);var mainDiv=document.createElement("div");mainDiv.id="testAnswerId";mainDiv.style.borderTop="1px solid black";$("#testquestions").append(mainDiv);var div=document.createElement("div");mainDiv.appendChild(div);div.style["float"]="left";div.style.padding="10px";div.style.fontSize="14px";div.innerHTML=question.question;Tests.dropExpand=null;var input=null;switch(question.answerType){case"N":input=document.createElement("input");input.id="answerQuestion";input.type="number";input.value="";input.style.borderColor="red";input.style.margin="10px";input.addEventListener("change",Tests.closeDrop,false);input.onkeypress=function(event){return((event.charCode>=48&&event.charCode<=57)||event.charCode==0)};mainDiv.appendChild(input);$("#continueTestAnotherDay").css("display","none");break;case"C":var movePanel=document.createElement("div");movePanel.className="move-panel";movePanel.style.right="10px";movePanel.style.position="fixed";movePanel.style.top="auto";movePanel.style.backgroundColor="white";var b=document.createElement("a");b.id="testExpandWorkspace";b.className="move-up";b.onclick=Tests.hideElements;movePanel.appendChild(b);var tdButton=document.createElement("td");tdButton.style.borderBottom="1px solid red";tdButton.style.verticalAlign="bottom";tdButton.appendChild(movePanel);mainDiv.appendChild(tdButton);input=document.createElement("div");input.id="answerQuestion";input.type="blockly";input.style.width="98%";mainDiv.appendChild(input);TestRT={};eval(question.language);var sizeBlockly=$("#testquestions").height()-$("#testTableContent").height()-35;$("#answerQuestion").css("height",sizeBlockly+"px");Blockly.inject(input,{media:"media/",rtl:false,toolbox:question.toolbox,trashcan:true,comments:false,scrollbars:true,zoom:{enabled:true,controls:true,wheel:true,maxScale:2,minScale:0.1,scaleSpeed:1.1}});Game.hideHints=false;var toolBox=$(".blocklyToolboxDiv");if(toolBox.length>0){$("body").detach(".blocklyToolboxDiv");$("#answerQuestion").append(toolBox)}if(!Tests.dropShowed){Tests.dropExpand=new Drop({target:movePanel,content:"Clique aqui para expandir",position:"left bottom",classes:"drop-theme-arrows",constrainToScrollParent:false,tetherOptions:{offset:"0 25"},remove:true,openOn:""})}var answerBlocks=null;if(question.previousAnswer==null){answerBlocks=question.blocks}else{answerBlocks=question.previousAnswer.answer}Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,Blockly.Xml.textToDom(answerBlocks));break}input.testId=Tests.test.id;input.questionId=question.id;$("#testsNextQuestion").html(BlocklyApps.getMsg("Tests_Done")+" ["+question.xpReward+" <img src='images/xp.png' style='vertical-align:middle;width:20px'/>]");$("#testsLetBlank").html(BlocklyApps.getMsg("Tests_LetBlank")+" ["+question.xpRewardBlank+" <img src='images/xp.png' style='vertical-align:middle;width:20px'/>]");$("#continueTestAnotherDay").css("display","inline")};Tests.resizeWindow=function(b){if(document.getElementById("answerQuestion").type!=="blockly"){return}var a=$("#testquestions").height()-$("#testTableContent").height()-35;$("#answerQuestion").css("height",a+"px");if(Tests.dropExpand!=null&&!Tests.dropShowed){Tests.dropExpand.open();Tests.dropShowed=true}};Tests.hideElements=function(){if(Tests.dropExpand!=null){Tests.dropExpand.close()}var d=document.getElementById("tdContent");var c=d.firstElementChild;while(c!=null){c.style.display="none";c=c.nextElementSibling}var b=document.getElementById("testExpandWorkspace");b.className="move-down";b.onclick=Tests.showElements;Blockly.fireUiEvent(window,"resize")};Tests.showElements=function(){var d=document.getElementById("tdContent");var c=d.firstElementChild;while(c!=null){c.style.display="inline";c=c.nextElementSibling}var b=document.getElementById("testExpandWorkspace");b.className="move-up";b.onclick=Tests.hideElements;Blockly.fireUiEvent(window,"resize")};Tests.closeDrop=function(){if(Tests.drop!=null&&Tests.drop!=undefined){Tests.drop.remove();Tests.drop=null}};Tests.letBlank=function(){confirm("Deseja realmente executar essa a&#231;&#227;o ?",function(){Tests.performQuestion("-1",true)})};Tests.stopNow=function(){window.removeEventListener("resize",Tests.resizeWindow);window.removeEventListener("beforeunload",Tests.stopNow);if(Tests.dropExpand!=null){Tests.dropExpand.close()}if(Tests.idx>=0){Tests.performQuestion(null,false)}Game.logoffButtonClick()};Tests.play=function(){window.removeEventListener("resize",Tests.resizeWindow);window.removeEventListener("beforeunload",Tests.stopNow);$("#testsPlay").css("display","none");$("#testquestions").remove();MyBlocklyApps.hideDialog(false);BlocklyApps.dialogDispose_=Game.afterTestDialog.f};"use strict";function addAlertMsg(b,a){$("#alertwindowprompt").remove();var f=$("<div/>").attr("id","alertwindowprompt").appendTo(b);var c=$("<table/>").appendTo(f);var e=$("<tr/>").attr("align","center").attr("rowspan","2").appendTo(c);var g=$("<td/>").appendTo(e);$("<img/>").attr("src","images/error.png").css("padding","10px").appendTo(g);$("<td/>").html(a).appendTo(e);$("<tr/>").append("<td/>").append("<td/>").appendTo(c)}function centerWindowPrompt(){var a=$(window);var c=Math.max((a.height()-$("#window_prompt")[0].clientHeight)/2,0);var b=Math.max(($(window).width()-$("#window_prompt")[0].clientWidth)/2,0);$("#window_prompt").css("top",c+"px");$("#window_prompt").css("left",b+"px")}function NoBugsWindowPrompt(h,c,b,e){var d=$("<div/>").addClass("WindowPrompt").attr("id","window_prompt");if(e!==undefined&&e!==null){addAlertMsg(d,e)}$("<p/>").html(h).appendTo(d);var g=$("<form/>").appendTo(d);$("<input/>").addClass("nobugs_inputs").css("width","100%").val(c).appendTo(g);$("<br/>").appendTo(g);$("<button/>").attr("type","submit").addClass("nobugs_button").html("OK").appendTo(g);$("<button/>").attr("type","button").addClass("nobugs_button").attr("id","closePrompt").html((BlocklyApps?BlocklyApps.getMsg("dialogCancel"):"Cancel")).appendTo(g);d.appendTo("body");var a=$("#window_prompt").overlay({mask:{color:"#000",loadSpeed:200},closeOnClick:false,load:false,onLoad:function(){$("#window_prompt input").focus()}});$("#closePrompt").click(function(f){b(null);a.eq(0).overlay().close();$("#window_prompt").remove();$("#exposeMask").remove()});$("#window_prompt form").submit(function(j){var f=$("input",this).val();var i=(b(f));if(i==null){a.eq(0).overlay().close();$("#window_prompt").remove();$("#exposeMask").remove()}else{addAlertMsg($("#window_prompt")[0],i);centerWindowPrompt()}return j.preventDefault()});$("#window_prompt").overlay().load();centerWindowPrompt()}function alert(b,c,a){$("#alert").modal({closeHTML:"<button style='padding:0px;margin:0px;min-width:0px;background-color:transparent;position:absolute; right:10px; top:2px;'><img src='images/closedialog.png' style='width:16px;height:16px'/></button>",position:["20%"],overlayId:"confirm-overlay",containerId:"confirm-container",onShow:function(e){if(a!=undefined){var g=$("#confirm-container");for(var d in a){g.css(d,a[d])}}var f=this;$(".message",e.data[0]).append(b);$(".yes",e.data[0]).click(function(){if($.isFunction(c)){c.apply()}f.close()})}})};"use strict";PreloadImgs.put("mission_selected","images/mission-completed.png");PreloadImgs.put("mission_selected_high","images/mission-completed-hightlight.png");var MissionSelection={};MissionSelection=function(a){this.canvas=document.getElementById("mission_level");this.canvasCtx=this.canvas.getContext("2d");this.level=Game.loginData.missionHist[a-1];this.current=Game.loginData.missionIdx;this.hightlight=-1;this.mouseMoveWrapper=Blockly.bindEvent_(this.canvas,"mousemove",this,this.mouseMove);this.clickWrapper=Blockly.bindEvent_(this.canvas,"click",this,this.click);this.circles=[];this.show()};MissionSelection.prototype.mouseMove=function(b){var a=this.getMousePos(b);var d=-1;for(var c=0;c<this.circles.length;c++){if(this.testMouseOver(a.x,a.y,this.circles[c].x,this.circles[c].y)){d=c;break}}this.hightlight=d;this.show();this.canvas.style.cursor=(d==-1?"default":"pointer")};MissionSelection.prototype.click=function(c){var a=this.getMousePos(c);var e=-1;for(var d=0;d<this.circles.length;d++){if(this.testMouseOver(a.x,a.y,this.circles[d].x,this.circles[d].y)){e=d;break}}if(e>-1){LogClick.store(e+1);var b=true;if(hero.verifyObjectives("clickMission",{missionId:e+1})){if(hero.allObjectivesAchieved){Game.verifyVictory();b=false}}if(b){Game.nextMission(this.level[4],this.level[5],e+1,e+1<=this.level[3])}}};MissionSelection.prototype.dispose=function(){Blockly.unbindEvent_(this.mouseMoveWrapper);Blockly.unbindEvent_(this.clickWrapper)};MissionSelection.prototype.getMousePos=function(a){var b=this.canvas.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}};MissionSelection.prototype.testMouseOver=function(e,d,b,g){var c=Math.abs(e-b),a=Math.abs(d-g),f=Math.sqrt(c*c+a*a);return f<8};MissionSelection.prototype.show=function(){var a=this.canvasCtx;var c=2*Math.PI;a.clearRect(0,0,500,500);a.strokeStyle="#ffd89d";var e=12;var d=6;var f=18;for(var b=0;b<this.level[2];b++){a.beginPath();a.moveTo(e+(b*f)+d,e);a.arc(e+(b*f),e,d,0,c);if(b<=this.level[3]){this.circles.push({x:e+(b*f),y:e});if(b==this.hightlight){a.fillStyle="#ffd89d"}else{a.fillStyle="#fff7eb"}a.fill()}a.stroke();if(this.current-1==b){a.moveTo(e+(b*f)+d+2,e);a.arc(e+(b*f),e,d+2,0,c);a.stroke()}if(b<this.level[3]){if(b==this.hightlight){a.drawImage(PreloadImgs.get("mission_selected_high"),(e/2)+(b*f),(e/2)-3)}else{a.drawImage(PreloadImgs.get("mission_selected"),(e/2)+(b*f),(e/2)-3)}}}a.closePath()};"use strict";function showOneEditArea(a){Hints.noHints=false;$("#multiBlockly").css("display","none");$("#"+a).css("display","inline")}function resizeOneEditArea(a,b,c){a.style.top=(c==0?b:c)+"px";a.style.left=(c==0?Game.redimDiv.style.left:"0px");a.style.width=Game.redimDiv.style.width;a.style.height=(c==0?"":(Game.redimDiv.clientHeight-30)+"px")}var BlocklyEditor={};BlocklyEditor=function(b,a){this.id=b;this.editArea=document.getElementById(b);this.ws=null;this.top=a};BlocklyEditor.prototype.show=function(){showOneEditArea(this.id)};BlocklyEditor.prototype.cleanCode=function(){Blockly.getMainWorkspace().clear()};BlocklyEditor.prototype.initialize=function(a,b){this.editArea.innerHTML="";this.ws=Blockly.inject(this.editArea,a);this.ws.id=this.id;this.ws.aux=b>0;this.ws.index=b};BlocklyEditor.prototype.backgroundColor=function(a){$("#blockly .blocklySvg").css("background-color",a)};BlocklyEditor.prototype.showCountInstructions=function(){return true};BlocklyEditor.prototype.hasDebug=function(){return true};BlocklyEditor.prototype.zoom=function(){if(Game.zoomLevel>1){while(Blockly.getMainWorkspace().scale<Game.zoomLevel){Blockly.getMainWorkspace().zoomCenter(1)}}else{if(Game.zoomLevel<1){while(Blockly.getMainWorkspace().scale>Game.zoomLevel){Blockly.getMainWorkspace().zoomCenter(-1)}}}};BlocklyEditor.prototype.loadCode=function(b){var a=Blockly.Xml.textToDom(b);Blockly.Xml.domToWorkspace(this.ws,a);Game.moveBlocks()};BlocklyEditor.prototype.resize=function(a){resizeOneEditArea(this.editArea,a,this.top)};BlocklyEditor.prototype.dispose=function(){this.ws.dispose()};BlocklyEditor.prototype.visibleTabs=function(a){if(this.id===a){this.ws.setVisible(true);this.ws.markFocused()}else{this.ws.setVisible(false)}};BlocklyEditor.prototype.getXmlValue=function(){return'<ws id="'+this.ws.index+'">'+Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(this.ws))+"</ws>"};BlocklyEditor.prototype.verifyFunctionTabs=function(){if(this.id="blockly"){return}var a=this.ws.getTopBlocks();var b=this;a.forEach(function(c){if(c.type.indexOf("procedures_def")==-1){Game.selectTab(b.id);Blockly.selected=c;throw {isNoBugs:true,msg:"Error_TabOnlyWithFunctions"}}})};BlocklyEditor.prototype.changeToFirstTab=function(){};BlocklyEditor.prototype.semanticAnalysis=function(){Game.countInstructions(this.ws.getTopBlocks(),Game.semanticAnalysis)};BlocklyEditor.prototype.getJsCode=function(){this.ws.genCode=true;var a=Game.convertWaits(Blockly.JavaScript.workspaceToCode(this.ws));this.ws.genCode=false;return a};BlocklyEditor.prototype.getFirstEditArea=function(){return this.editArea};BlocklyEditor.prototype.getOffsetTop=function(){return 0};BlocklyEditor.prototype.newProcedureNameIsLegal=function(a,b){return Blockly.Procedures.isLegalName(a,this.ws,b)};BlocklyEditor.prototype.retrieveProcedures=function(e,c){var b=this.ws;var f=b.getAllBlocks();for(var d=0;d<f.length;d++){if(f[d].getProcedureDef){var a=f[d].getProcedureDef();if(a){if(a[2]){e.push(a)}else{c.push(a)}}}}};BlocklyEditor.prototype.renameCallers=function(c,a){var d=this.ws.getAllBlocks();for(var b=0;b<d.length;b++){if(d[b].renameProcedure){d[b].renameProcedure(c,a)}}};BlocklyEditor.prototype.disposeCallers=function(a){var c=Blockly.Procedures.getCallers(a,this.ws);for(var b=0;b<c.length;b++){c[b].dispose(true,false)}};BlocklyEditor.prototype.mutateCallers=function(b,e,a){var d=Blockly.Procedures.getCallers(b,this.ws);for(var c=0;c<d.length;c++){d[c].setProcedureParameters(e,a)}};BlocklyEditor.prototype.countInstructions=function(a,b){b=(b==undefined?Blockly.mainWorkspace.getTopBlocks():b);if(a==undefined){return Game.countInstructions(b)}else{return Game.countInstructions(b,a)}};BlocklyEditor.prototype.addChangeListener=function(a){Blockly.mainWorkspace.addChangeListener(a)};BlocklyEditor.prototype.removeChangeListener=function(a){Blockly.mainWorkspace.removeChangeListener(a)};BlocklyEditor.prototype.bindMouseDownSvgGroupEvent=function(b,a){return Blockly.bindEvent_(Blockly.mainWorkspace.svgGroup_,"mousedown",b,a)};BlocklyEditor.prototype.lengthTopBlocks=function(){return Blockly.mainWorkspace.getTopBlocks().length};BlocklyEditor.prototype.traceOn=function(a){Blockly.mainWorkspace.traceOn(a)};BlocklyEditor.prototype.hideChaff=function(){Blockly.hideChaff()};BlocklyEditor.prototype.highlightBlock=function(a){Blockly.mainWorkspace.highlightBlock(a)};BlocklyEditor.prototype.addCommands=function(a){};var MultiBlockEditor={};MultiBlockEditor=function(){this.editArea=document.getElementById("multiBlockly");Hints.noHints=true;$("#multiBlockly").css("display","inline");$("#blockly").css("display","none");$("#multiBlockly").easytabs({updateHash:false,animate:false});$("#multiBlockly").bind("easytabs:after",function(b,c,a){if(Blockly.selected!=null){myIsTargetSvg=true;Blockly.selected.unselect();myIsTargetSvg=false}Game.selectTab(a.attr("id"))});$("#multiBlockly").easytabs("select","#blockly1");this.blocklys=[];this.blocklys.push(new BlockEditor("blockly1",35));this.blocklys.push(new BlockEditor("blockly2",35));this.blocklys.push(new BlockEditor("blockly3",35));this.blocklys.push(new BlockEditor("blockly4",35));this.blocklys.push(new BlockEditor("blockly5",35));this.blocklys.push(new BlockEditor("blockly6",35))};inherits(BlocklyEditor,MultiBlockEditor);MultiBlockEditor.prototype.cleanCode=function(){for(var a=0;a<this.blocklys.length;a++){this.blocklys[a].cleanCode()}};MultiBlockEditor.prototype.initialize=function(c){for(var d=0;d<this.blocklys.length;d++){var a=this.blocklys[d];a.initialize(c,d)}Game.selectTab(this.blocklys[0].id);Blockly.mainWorkspace.addChangeListener(Hints.changeListener)};MultiBlockEditor.prototype.zoom=function(){this.blocklys[0].zoom()};MultiBlockEditor.prototype.loadCode=function(b,a){this.blocklys[a].loadCode(b)};MultiBlockEditor.prototype.resize=function(a){this.blocklys.forEach(function(c){c.resize(a)})};MultiBlockEditor.prototype.dispose=function(){this.blocklys.forEach(function(a){a.dispose()})};MultiBlockEditor.prototype.visibleTabs=function(a){this.blocklys.forEach(function(c){c.visibleTabs(a)})};MultiBlockEditor.prototype.getXmlValue=function(){var a="";this.blocklys.forEach(function(c){a=a+c.getXmlValue()});return a};MultiBlockEditor.prototype.verifyFunctionTabs=function(){for(var a=1;a<this.blocklys.length;a++){this.blocklys[a].verifyFunctionTabs()}};MultiBlockEditor.prototype.changeToFirstTab=function(){Game.changeTab("blockly1")};MultiBlockEditor.prototype.semanticAnalysis=function(){this.blocklys.forEach(function(a){a.semanticAnalysis()})};MultiBlockEditor.prototype.getJsCode=function(){var b="";for(var a=this.blocklys.length-1;a>=0;a--){b=b+this.blocklys[a].getJsCode()}return b};MultiBlockEditor.prototype.getFirstEditArea=function(){return this.blocklys[0].editArea};MultiBlockEditor.prototype.getOffsetTop=function(){return this.getFirstEditArea().parentElement.parentElement.offsetTop};MultiBlockEditor.prototype.newProcedureNameIsLegal=function(a,c){for(var b=0;b<this.blocklys.length;b++){if(!this.blocklys[b].newProcedureNameIsLegal(a,c)){return false}}return true};MultiBlockEditor.prototype.retrieveProcedures=function(b,a){this.blocklys.forEach(function(c){c.retrieveProcedures(b,a)})};MultiBlockEditor.prototype.renameCallers=function(b,a){this.blocklys.forEach(function(c){c.renameCallers(b,a)})};MultiBlockEditor.prototype.disposeCallers=function(a){this.blocklys.forEach(function(c){c.disposeCallers(a)})};MultiBlockEditor.prototype.mutateCallers=function(b,c,a){this.blocklys.forEach(function(d){d.mutateCallers(b,c,a)})};var CodeEditor={};CodeEditor=function(){this.editArea=document.getElementById("codeeditor");this.id="codeeditor";this.top=0};CodeEditor.prototype.show=function(){showOneEditArea(this.id)};CodeEditor.prototype.cleanCode=function(){};CodeEditor.prototype.initialize=function(){ace.require("ace/ext/language_tools");ace.require("ace/mode/javascript");ace.require("ace/worker/javascript");var a=ace.edit("codeeditor");a.setTheme("ace/theme/chrome");a.getSession().setMode("ace/mode/javascript");a.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:true});var b=ace.require("ace/snippets").snippetManager;ace.config.loadModule("ace/snippets/javascript",function(c){if(c){b.files.javascript=c;c.snippets=[];b.register(c.snippets,c.scope)}});a.getSession().setTabSize(2);a.getSession().setUseSoftTabs(true);a.$blockScrolling=Infinity;a.getSession().on("changeMode",function(d){var c=ace.edit("codeeditor").getSession();c.$worker.removeAllListeners("annotate");c.$worker.on("annotate",function(e){var f=e.data;c.setAnnotations(f)});c.$worker.call("changeOptions",[{undef:true,global:a.availableCommands}])});a.completers=[this.completer];this.editor=a};CodeEditor.prototype.backgroundColor=function(a){};CodeEditor.prototype.addCommands=function(f){this.editor.completerItems=[];this.editor.availableCommands={};var e=Blockly.parseToolboxTree_(f);var c=e.children;for(var b=0;b<c.length;b++){for(var a=0;a<c[b].children.length;a++){var d=Blockly.Snippets[e.children[b].children[a].attributes.type.nodeValue];if(d){this.editor.completerItems.push(d.completer);if(d.registeredName){this.editor.availableCommands[d.registeredName]=true}}}}this.editor.completerItems.push(Blockly.Snippets["var"].completer)};CodeEditor.prototype.showCountInstructions=function(){return false};CodeEditor.prototype.hasDebug=function(){return false};CodeEditor.prototype.zoom=function(){};CodeEditor.prototype.loadCode=function(a){};CodeEditor.prototype.resize=function(a){resizeOneEditArea(this.editArea,a,this.top)};CodeEditor.prototype.dispose=function(){};CodeEditor.prototype.visibleTabs=function(a){};CodeEditor.prototype.getXmlValue=function(){};CodeEditor.prototype.verifyFunctionTabs=function(){};CodeEditor.prototype.changeToFirstTab=function(){};CodeEditor.prototype.semanticAnalysis=function(){};CodeEditor.prototype.getJsCode=function(){return this.editor.getValue()};CodeEditor.prototype.getFirstEditArea=function(){return this.editArea};CodeEditor.prototype.getOffsetTop=function(){return 0};CodeEditor.prototype.newProcedureNameIsLegal=function(a,b){};CodeEditor.prototype.retrieveProcedures=function(b,a){};CodeEditor.prototype.renameCallers=function(b,a){};CodeEditor.prototype.disposeCallers=function(a){};CodeEditor.prototype.mutateCallers=function(b,c,a){};CodeEditor.prototype.bindMouseDownSvgGroupEvent=function(){};CodeEditor.prototype.countInstructions=function(a){return 0};CodeEditor.prototype.addChangeListener=function(a){};CodeEditor.prototype.removeChangeListener=function(a){};CodeEditor.prototype.lengthTopBlocks=function(){return 0};CodeEditor.prototype.traceOn=function(a){};CodeEditor.prototype.hideChaff=function(){};CodeEditor.prototype.highlightBlock=function(a){};CodeEditor.prototype.completer={getCompletions:function(a,c,e,b,d){d(null,a.completerItems)}};var AchievementData={};AchievementData=function(){};AchievementData.prototype.getData=function(){};var AchievementWindow={};AchievementWindow=function(){$("#achievementCloseButton").click(this.closeButtonClick);var a=this;UserControl.listAchievements({async:false,callback:function(b){var c=a.populateTable(b);c.ingrid({height:500,paging:false,resizableCols:false,sorting:false,colClasses:["achievement-table-col-position","achievement-table-col-position"],colWidths:[385,385]});$("#achievementContentWindow .ingrid > div:nth-child(2)").addClass("mCustomScrollbar").mCustomScrollbar({theme:"nobug"});$("#achievementContentWindow .mCSB_container").css({"margin-right":"0px"});$("#achievementWindow .mCSB_scrollTools").css("width","5px")}})};AchievementWindow.prototype.populateTable=function(d){var h=$("<tbody/>");var g=null;for(var e=0;e<d.length;e++){if(e%2==0){g=$("<tr/>");h.append(g)}var f=d[e];var a=$("<div class='achievement'>");var k=(f.achieved?"":"-webkit-filter: grayscale(1); filter: gray; filter: grayscale(1);");a.append($("<img src='achievementBadge?id="+f.id+"' style='width:128px; float: left; "+k+"'/>"));var c=$("<div style='font-weight: bold; margin-bottom: 10px'/>");c.html(AchievementWindow.fillFields(BlocklyApps.getMsg(f.title),f.titleFields));a.append(c);c=$("<div/>");c.html(AchievementWindow.fillFields(BlocklyApps.getMsg(f.description),f.descriptionFields));a.append(c);if(f.rewardCoins){c=$("<div style='float:right'/>");c.html(f.rewardCoins+"<img style='vertical-align: middle; padding-left: 3px' src='images/coin2.png'/>");a.append(c)}else{if(f.rewardXP){c=$("<div style='float:right'/>");c.html(f.rewardXP+"<img style='vertical-align: middle; padding-left: 3px' src='images/xp.png'/>");a.append(c)}}g.append($("<td>").html(a))}if(d.length%2==1){g.append($("<td>"))}var j=$("<table/>");var b=$("<tr/>");b.append($("<th/>"));b.append($("<th/>"));j.append($("<thead/>").append(b));j.append(h);$("#achievementContentWindow").append(j);return j};AchievementWindow.prototype.show=function(){$("#achievementWindow").css("display","block");var a=this;MyBlocklyApps.showDialog(document.getElementById("achievementWindow"),null,false,true,true,BlocklyApps.getMsg("Achievement_Title"),{width:"800px",height:"600px"},function(){a.dispose()})};AchievementWindow.fillFields=function(b,a){if(a==null){return b}var c=new RegExp("\\[%([A-Z])\\w+%\\]");do{var d=c.exec(b);if(d==null){return b}b=b.replace(d[0],a[d[0].substring(2,d[0].length-2)])}while(true)};AchievementWindow.prototype.dispose=function(){$("#achievementContentWindow .ingrid").remove();$("#achievementContentWindow").empty()};AchievementWindow.prototype.closeButtonClick=function(){$("#achievementCloseButton").unbind("click");MyBlocklyApps.hideDialog(true)};