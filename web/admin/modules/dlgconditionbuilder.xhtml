<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	
	<h:outputStylesheet id="condBuilderCss">
	#formCondBuilder .ui-fieldset-legend  {
		border : none;
		font-weight: bold;
		background: none;
		padding: 0px;
		cursor: text !important;
	}
	</h:outputStylesheet>
	
	<p:dialog id="condBuilderDialog" showEffect="fade" 
		hideEffect="fade" widgetVar="condBuilderDlg" 
		header="#{msg['condition']}" minHeight="40" 
		closable="false" dynamic="true" modal="true" 
		resizable="false" onShow="PF('condBuilderDlg').initPosition()">
		
		<h:form id="formCondBuilder">
			<p:fieldset id="field" legend="#{msg['condition']}" rendered="#{condVC.expandedFieldset == true}">
				<p:panelGrid columns="2">
					<p:outputLabel for="chooseFPBtn" value="#{msg['funcProvider']}: " />
					<p:panelGrid columns="2">
						<p:commandButton id="chooseFPBtn" value="#{msg['choose']}" 
							icon="ui-icon-search" oncomplete="PF('funcProvDlg').show()"
							action="#{condVC.showFuncProv}"
							update=":funcProvDialog"/>
						<h:outputText rendered="#{condVC.condition.function != null}" value="#{condVC.condition.function.name}()"/>
					</p:panelGrid>
					
					<p:outputLabel for="comparatorMenu" value="#{msg['comparator']}: " />
					<p:selectOneMenu id="comparatorMenu" value="#{condVC.condition.comparator}">
						<f:selectItems value="#{condVC.comparators}" />
					</p:selectOneMenu>
					
					<p:outputLabel for="condValue" value="#{msg['value']}: " />
					<p:autoComplete id="condValue" value="#{condVC.condition.value}" completeMethod="#{condVC.getBoolValues}" />
				</p:panelGrid>

				<p:watermark for="condValue" value="#{msg['enterVal']}" />
				<p:commandButton id="saveCondBtn" value="#{msg['save']}" icon="ui-icon-circle-arrow-s" 
					update=":formCondBuilder :growlMsgs" 
					actionListener="#{condVC.addCondition}"
					style="maring-top: 10px; float: right;" />
			</p:fieldset>	
				
			<p:panelGrid columns="4">
				<p:commandButton value="#{msg['add']}" icon="ui-icon-circle-plus" actionListener="#{condVC.setExpandedFieldset(true)}" update=":formCondBuilder" />
				<p:commandButton value="#{msg['delete']}" icon="ui-icon-trash" update=":formCondBuilder" actionListener="#{condVC.deleteCondition}" />
				<p:commandButton value="#{msg['add']} [add]" update=":formCondBuilder" actionListener="#{condVC.addCondition(true)}" />
				<p:commandButton value="#{msg['add']} [or]" update=":formCondBuilder" actionListener="#{condVC.addCondition(false)}" />
			</p:panelGrid>
			
			<p:orderList id="coList" value="#{condVC.conditions}" var="c" itemValue="#{c}" converter="#{condVC.converter}" controlsLocation="right">      		
				<p:column>
					<p:commandLink actionListener="#{condVC.getConditionById}" style="display: block; text-decoration: none !important;" update=":formCondBuilder:field">
						<f:param name="editConditionID" value="#{c.id}" />
						<h:outputText value="#{c.conditionString}" />
					</p:commandLink>
				</p:column>
			</p:orderList>
			
			<p:panelGrid columns="2" style="float: right;">
	    		<p:commandButton value="#{msg['ok']}" icon="ui-icon-check" 
	    			actionListener="#{condVC.checkCondition}"
	    			update=":formDlgHints, :formCondBuilder, :growlMsgs"/>
	      		<p:commandButton value="#{msg['cancel']}" icon="ui-icon-close" 
	      			oncomplete="PF('condBuilderDlg').hide()" 
	      			actionListener="#{condVC.setExpandedFieldset(false)}"/>
	       	</p:panelGrid>
    	</h:form>
	</p:dialog>
	
	<ui:include src="dlgfuncprov.xhtml" />
	
</ui:composition>