<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	
	<h:outputStylesheet id="condBuilderCss">
	#formCondBuilder .ui-fieldset-legend  {
		border : none;
		font-weight: bold;
		background: none;
		padding: 0px;
		cursor: text !important;
	}
	</h:outputStylesheet>
	
	<p:dialog id="condBuilderDialog" showEffect="fade" 
		hideEffect="fade" widgetVar="condBuilderDlg" 
		header="#{msg['condition']}" minHeight="40" 
		closable="false" dynamic="true" modal="true" 
		resizable="false" onShow="PF('condBuilderDlg').initPosition()">
		
		<h:form id="formCondBuilder">
			<p:fieldset id="field" legend="#{msg['condition']}">
				<p:panelGrid columns="2">
					<p:outputLabel for="chooseFPBtn" value="#{msg['funcProvider']}: " />
					<p:panelGrid columns="2">
						<p:commandButton id="chooseFPBtn" value="#{msg['choose']}" 
							icon="ui-icon-search" oncomplete="PF('funcProvDlg').show()"
							action="#{condVC.showFuncProv}"
							update=":funcProvDialog"
							disabled="#{condVC.allowedFieldset == false}"/>
						<h:outputText rendered="#{condVC.condition.function != null}" value="#{condVC.condition.function.name}()"/>
					</p:panelGrid>
					
					<p:outputLabel for="comparatorMenu" value="#{msg['comparator']}: " />
					<p:selectOneMenu id="comparatorMenu" value="#{condVC.condition.comparator}" disabled="#{condVC.allowedFieldset == false}">
						<f:selectItems value="#{condVC.comparators}" />
					</p:selectOneMenu>
					
					<p:outputLabel for="condValue" value="#{msg['value']}: " />
					<p:autoComplete id="condValue" value="#{condVC.condition.value}" completeMethod="#{condVC.getBoolValues}" disabled="#{condVC.allowedFieldset == false}"/>
				</p:panelGrid>

				<p:watermark for="condValue" value="#{msg['enterVal']}" />

				<p:panelGrid columns="2" style="maring-top: 10px; float: right;">
					<p:commandButton value="#{msg['save']}" icon="ui-icon-circle-arrow-s" 
						update=":formCondBuilder :growlMsgs" 
						actionListener="#{condVC.addCondition}"
						disabled="#{condVC.allowedFieldset == false}"/>
					<p:commandButton value="#{msg['cancel']}" icon="ui-icon-closethick" 
						update=":formCondBuilder :growlMsgs" 
						actionListener="#{condVC.setAllowedFieldset(false)}"
						disabled="#{condVC.allowedFieldset == false}"/>
					</p:panelGrid>
			</p:fieldset>	
				
			<p:panelGrid columns="4">
				<p:commandButton value="#{msg['add']}" icon="ui-icon-circle-plus" actionListener="#{condVC.setAllowedFieldset(true)}" update=":formCondBuilder" />
				<p:commandButton value="#{msg['add']} [AND]" update=":formCondBuilder" actionListener="#{condVC.addCondition(true)}" />
				<p:commandButton value="#{msg['add']} [OR]" update=":formCondBuilder" actionListener="#{condVC.addCondition(false)}" />
			</p:panelGrid>
			
			<p:orderList id="coList" value="#{condVC.conditions}" var="c" itemValue="#{c}" converter="#{condVC.converter}" controlsLocation="right">      		
				<p:column>
					<h:outputText value="#{c.conditionString}" />
					
					<p:commandLink title="#{msg['edit']}" actionListener="#{condVC.editCondition}" style="border-radius: 10px;float: right !important;" update=":formCondBuilder:field,:growlMsgs">
						<f:param name="editConditionID" value="#{c.id}" />
						<span class="ui-icon ui-icon-pencil" />
					</p:commandLink>
					
					<p:commandLink title="#{msg['delete']}" actionListener="#{condVC.deleteCondition}" style="border-radius: 10px;float: right !important;" update=":formCondBuilder,:growlMsgs">
						<f:param name="editConditionID" value="#{c.id}" />
						<span class="ui-icon ui-icon-trash" />
					</p:commandLink>
					
				</p:column>
			</p:orderList>
			
			<p:panelGrid columns="2" style="float: right;">
	    		<p:commandButton value="#{msg['ok']}" icon="ui-icon-check" 
	    			actionListener="#{condVC.checkCondition}"
	    			update=":formDlgHints, :formCondBuilder, :growlMsgs"/>
	      		<p:commandButton value="#{msg['cancel']}" icon="ui-icon-closethick" 
	      			oncomplete="PF('condBuilderDlg').hide()" 
	      			actionListener="#{condVC.setAllowedFieldset(false)}"/>
	       	</p:panelGrid>
    	</h:form>
	</p:dialog>
	
	<ui:include src="dlgfuncprov.xhtml" />
	
</ui:composition>